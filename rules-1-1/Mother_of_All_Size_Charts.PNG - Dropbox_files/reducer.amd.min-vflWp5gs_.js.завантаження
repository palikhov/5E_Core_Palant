define(["require","exports","tslib","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/comments2/src/mentions/index","typescript/libraries/comments2/src/transforms/index","typescript/component_libraries/files_components/src/blades/comments/data/transform","redux","api_v2/redux/comments2","api_v2/redux/media_addon","typescript/component_libraries/flows/src/components/approval-forms/reducer","typescript/component_libraries/files_components/src/blades/comments/data/uuid"],(function(e,n,t,a,r,i,s,o,d,_,u,c){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.reducer=n.reducers=n.DEFAULT_STATE=n.Status=void 0;var l;(l=n.Status||(n.Status={}))[l.Disabled=0]="Disabled",l[l.ReadOnly=1]="ReadOnly",l[l.FullyEnabled=2]="FullyEnabled",n.DEFAULT_STATE={threads:{},supportedEnhancements:{},boltInfo:{fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},activeThreadID:{},focusedThreadID:{},hoverThreadID:{},mentionsSearchResult:{currentQuery:"",result:[]},draftAnnotation:{},annotationState:null,permissions:{},editorFocusRequest:{},pendingNavigationToActiveThreadAnnotation:{},status:{},thirdPartySource:{},mediaAddonFeatures:null,subscriptionStatus:{},enableCommentStatus:{},showResolvedComments:!1,approvalFormStatus:{}};var m=function(e){return g(e.payload.arg.stream)};function g(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function f(e){var n=e.payload.arg,t=n.stream,a=n.id;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:a}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:a}:{}}function v(e){var n,t=e.payload.arg,a=t.id,r=t.stream.identifier,i=null===(n=e.meta)||void 0===n?void 0:n.threadId;return"file_path_or_id"===r[".tag"]?{fileIdOrUrl:r.file_path_or_id,commentId:a,threadId:i}:"shared_link_details"===r[".tag"]?{fileIdOrUrl:r.url,commentId:a,threadId:i}:{}}function p(e,n,a,r){var i;return t.__assign(t.__assign({},e),((i={})[n]=a,i.pending={action:r,originalValue:e[n],pendingValue:a},i))}function A(e,n,a,r,i){var s,o=e.comments,d=o.findIndex((function(e){return e.id===n})),_=o[d];if(!_)return e;var u=t.__assign(t.__assign({},_),((s={})[a]=r,s)),c=t.__spreadArrays(o);return c.splice(d,1,u),p(e,"comments",c,i)}function h(e,n,a){var r;return t.__assign(t.__assign({},e),((r={})[n]=a?e.pending.originalValue:e[n],r.pending=void 0,r))}n.reducers={boltInfo:function(e,a){var r,i;if(void 0===e&&(e=n.DEFAULT_STATE.boltInfo),a.type===d.Action.ListCommentsResult){var s=a.payload,o=s.arg,_=s.result,u=g(o.stream);if(u&&_)return{fileIdentifierToBoltMap:t.__assign(t.__assign({},e.fileIdentifierToBoltMap),(r={},r[u]=_.bolt_info,r)),boltUniqueIdToStream:t.__assign(t.__assign({},e.boltUniqueIdToStream),(i={},i[_.bolt_info.unique_id]=o.stream,i))}}return e},threads:function(e,t){void 0===e&&(e=n.DEFAULT_STATE.threads);var r=!!t.error;switch(t.type){case d.Action.AddComment:return T(e,t);case d.Action.AddCommentResult:return I(e,t,r);case d.Action.MarkThreadRead:case d.Action.MarkThreadUnread:return y(e,t);case d.Action.MarkThreadReadResult:case d.Action.MarkThreadUnreadResult:return b(e,t,r);case d.Action.ResolveThread:case d.Action.UnresolveThread:return C(e,t);case d.Action.ResolveThreadResult:case d.Action.UnresolveThreadResult:return S(e,t,r);case d.Action.EditComment:return E(e,t);case d.Action.EditCommentResult:return R(e,t,r);case d.Action.DeleteComment:return w(e,t);case d.Action.DeleteCommentResult:return D(e,t,r);case d.Action.ListCommentsResult:case d.Action.LoggedOutListCommentsResult:return U(e,t);case a.Action.AddAndCommitComment:return O(e,t);case a.Action.EditAndCommitComment:return V(e,t);case a.Action.DeleteAndCommitComment:return M(e,t);case a.Action.DeleteAndCommitThread:return k(e,t);default:return e}},supportedEnhancements:function(e,n){var a,r;if(void 0===e&&(e={}),n.type===d.Action.ListCommentsResult){var i=n.payload,s=i.arg,o=i.result,_=g(s.stream);if(null!=_&&null!=o)return t.__assign(t.__assign({},e),((a={})[_]=null!==(r=o.supported_enhancements)&&void 0!==r?r:{},a))}return e},activeThreadID:function(e,r){var i,s,o,_;switch(void 0===e&&(e=n.DEFAULT_STATE.activeThreadID),r.type){case a.Action.ActivateThread:case a.Action.ActivateInitialThread:return t.__assign(t.__assign({},e),((i={})[r.payload.fileViewerId]=r.payload.threadId,i));case a.Action.DeactivateAllThreads:return t.__assign(t.__assign({},e),((s={})[r.payload.fileViewerId]="",s));case d.Action.AddComment:if(r.meta&&r.meta.tempThreadId)return t.__assign(t.__assign({},e),((o={})[r.meta.fileViewerId]=r.meta.tempThreadId,o));break;case d.Action.AddCommentResult:var u=r.meta,c=r.payload.result;if(c&&u&&u.tempThreadId===e[u.fileViewerId])return t.__assign(t.__assign({},e),((_={})[u.fileViewerId]=c.id,_))}return e},focusedThreadID:function(e,r){void 0===e&&(e=n.DEFAULT_STATE.hoverThreadID);var i=r.type,s=r.payload;if(i===a.Action.FocusThread){var o=t.__assign({},e);return null==s.threadId?delete o[s.fileViewerId]:o[s.fileViewerId]=s.threadId,o}return e},hoverThreadID:function(e,r){void 0===e&&(e=n.DEFAULT_STATE.hoverThreadID);var i=r.type,s=r.payload;if(i===a.Action.HoverThread){var o=t.__assign({},e);return null==s.threadId?delete o[s.fileViewerId]:o[s.fileViewerId]=s.threadId,o}return e},mentionsSearchResult:function(e,a){switch(void 0===e&&(e=n.DEFAULT_STATE.mentionsSearchResult),a.type){case r.MentionsAction.SearchContacts:return t.__assign(t.__assign({},e),{currentQuery:a.payload});case r.MentionsAction.SearchContactsResult:if(a.payload.query===e.currentQuery)return t.__assign(t.__assign({},e),{result:a.payload.result})}return e},permissions:function(e,a){var r;if(void 0===e&&(e=n.DEFAULT_STATE.permissions),a.type!==d.Action.ListCommentsResult&&a.type!==d.Action.LoggedOutListCommentsResult)return e;var i=a.payload,s=i.arg,o=i.result,_=g(s.stream);if(!_||!o)return e;var u=o.permissions;return t.__assign(t.__assign({},e),((r={})[_]=u,r))},draftAnnotation:function(e,r){var i;switch(void 0===e&&(e=n.DEFAULT_STATE.draftAnnotation),r.type){case a.Action.UpdateDraftAnnotation:var s=r.payload,o=s.fileViewerId,_=s.annotation;return _===e[o]?e:t.__assign(t.__assign({},e),((i={})[o]=_,i));case a.Action.CancelAnnotating:case a.Action.ClearDraftAnnotation:return(o=r.payload.fileViewerId)in e?(delete(u=t.__assign({},e))[o],u):e;case d.Action.AddComment:var u;if(null!=r.meta)return(o=r.meta.fileViewerId)in e?(delete(u=t.__assign({},e))[o],u):e}return e},annotationState:function(e,t){switch(void 0===e&&(e=n.DEFAULT_STATE.annotationState),t.type){case a.Action.CancelAnnotating:case d.Action.AddComment:return null;case a.Action.ActivateThread:case a.Action.ActivateInitialThread:return null===e?"viewing":"viewing"!==e?null:e;case a.Action.DeactivateAllThreads:return"viewing"===e?null:e;case a.Action.StartAnnotating:return t.payload.accessible?"annotating-ax":"annotating";case a.Action.ConfirmDraftAnnotation:return"commenting"}return e},editorFocusRequest:function(e,r){var i,s;void 0===e&&(e=n.DEFAULT_STATE.editorFocusRequest);var o=r.type,d=r.payload;if(o===a.Action.ConfirmDraftAnnotation&&!e[d.fileViewerId])return t.__assign(t.__assign({},e),((i={})[d.fileViewerId]=!0,i));if(o===a.Action.FocusEditor&&!e[d.fileViewerId])return t.__assign(t.__assign({},e),((s={})[d.fileViewerId]=!0,s));if(o===a.Action.EditorDidFocus&&e[d.fileViewerId]){var _=t.__assign({},e);return delete _[d.fileViewerId],_}return e},pendingNavigationToActiveThreadAnnotation:function(e,r){var i;void 0===e&&(e=n.DEFAULT_STATE.pendingNavigationToActiveThreadAnnotation);var s=r.type,o=r.payload;if(s===a.Action.ActivateThread||s===a.Action.ActivateInitialThread)return t.__assign(((i={})[o.fileViewerId]=!0,i),e);if(s===a.Action.ResolveNavigationToActiveThreadAnnotation){var d=t.__assign({},e);return delete d[o.fileViewerId],d}return e},status:function(e,a){var r,i,s,o;if(void 0===e&&(e=n.DEFAULT_STATE.status),a.type===d.Action.ListCommentsResult){var _,u=a.payload,c=u.arg,l=u.result;if((_=g(c.stream))&&l)switch(l.status[".tag"]){case"disabled":return t.__assign(t.__assign({},e),((r={})[_]=n.Status.Disabled,r));case"enabled":return t.__assign(t.__assign({},e),((i={})[_]=n.Status.FullyEnabled,i));case"readonly":return t.__assign(t.__assign({},e),((s={})[_]=n.Status.ReadOnly,s))}}if(a.type===d.Action.LoggedOutListCommentsResult&&(_=g((c=a.payload.arg).stream)))return t.__assign(t.__assign({},e),((o={})[_]=n.Status.FullyEnabled,o));return e},thirdPartySource:function(e,a){var r;if(void 0===e&&(e=n.DEFAULT_STATE.thirdPartySource),a.type!==d.Action.ListCommentsResult)return e;var s=a.payload,o=s.arg,_=s.result,u=g(o.stream);if(!u||!_)return e;var c=_.supported_enhancements&&_.supported_enhancements.third_party_source;return t.__assign(t.__assign({},e),((r={})[u]=c?i.thirdPartySourceToIThirdPartySource(c):void 0,r))},mediaAddonFeatures:function(e,n){var t;return void 0===e&&(e=null),n.type===_.Action.GetFeaturesResult?null!==(t=n.payload.result)&&void 0!==t?t:null:e},subscriptionStatus:function(e,a){var r,i;if(void 0===e&&(e=n.DEFAULT_STATE.subscriptionStatus),a.type!==d.Action.SubscribeResult&&a.type!==d.Action.UnsubscribeResult)return e;var s=m(a);if(void 0===s)return e;switch(a.type){case d.Action.SubscribeResult:return t.__assign(t.__assign({},e),((r={})[s]={isSubscribed:!0,canSubscribe:!0},r));case d.Action.UnsubscribeResult:return t.__assign(t.__assign({},e),((i={})[s]={isSubscribed:!1,canSubscribe:!0},i));default:return e}},enableCommentStatus:function(e,a){var r,i,s,o;if(void 0===e&&(e=n.DEFAULT_STATE.enableCommentStatus),a.type!==d.Action.EnableCommentingResult&&a.type!==d.Action.DisableCommentingResult&&a.type!==d.Action.ListCommentsResult&&a.type!==d.Action.LoggedOutListCommentsResult)return e;var _=m(a);if(void 0===_)return e;switch(a.type){case d.Action.EnableCommentingResult:return t.__assign(t.__assign({},e),((r={})[_]={commentsEnabled:!0,canEnableCommenting:!0},r));case d.Action.DisableCommentingResult:return t.__assign(t.__assign({},e),((i={})[_]={commentsEnabled:!1,canEnableCommenting:!0},i));case d.Action.ListCommentsResult:case d.Action.LoggedOutListCommentsResult:var u=a.payload.result;return u?t.__assign(t.__assign({},e),((s={})[_]={commentsEnabled:!("disabled"===u.status[".tag"]),canEnableCommenting:!!(null===(o=u.permissions)||void 0===o?void 0:o.can_enable_commenting)},s)):e;default:return e}},showResolvedComments:function(e,t){switch(void 0===e&&(e=n.DEFAULT_STATE.showResolvedComments),t.type){case a.Action.UpdateShowResolvedComments:return t.payload.showResolvedComments;default:return e}},approvalFormStatus:u.approvalReducer};var T=function(e,n){var a,r,i,o,d=n.payload.arg,_=d.thread_id,u=g(d.stream);if(!u||!n.meta)return e;var c=e[u],l=n.meta,m=l.content,f=l.author,v=l.annotation;if(_){var p=c[_],A=p.comments,h=t.__assign(t.__assign({},p),{comments:t.__spreadArrays(A,[s.newCommentFromICommentContent({content:m,threadId:_,author:f})]),annotation:v||p.annotation});return t.__assign(t.__assign({},e),((a={})[u]=t.__assign(t.__assign({},c),((r={})[_]=t.__assign(t.__assign({},h),{pending:{action:n.type,originalValue:p,newValue:h}}),r)),a))}var T=n.meta.tempThreadId;if(T){var I=s.newCommentFromICommentContent({threadId:T,author:f,content:m}),y=(h={id:T,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[I],annotation:v,isThirdParty:!1},t.__assign(t.__assign({},h),{pending:{action:n.type,originalValue:void 0,pendingValue:h}}));return t.__assign(t.__assign({},e),((i={})[u]=t.__assign(t.__assign({},c),((o={})[T]=y,o)),i))}return e},I=function(e,n,a){var r,i,s,o=n.payload.arg,d=o.thread_id,_=g(o.stream);if(!_||!n.meta)return e;var u=e[_];if(d){var c=t.__assign({},u[d]),l=c.pending.originalValue;return c.pending=void 0,t.__assign(t.__assign({},e),((r={})[_]=t.__assign(t.__assign({},u),((i={})[d]=a?l:c,i)),r))}var m=n.meta.tempThreadId,f=u;if(!a&&m in u&&n.payload.result){delete(f=t.__assign({},u))[m];var v=u[m],p=n.payload.result.id;v.readonly=!1,v.id=p,f[p]=t.__assign(t.__assign({},v),{pending:void 0})}return t.__assign(t.__assign({},e),((s={})[_]=f,s))},y=function(e,n){var a,r,i=f(n),s=i.fileIdOrUrl,o=i.threadId;if(!s||!o)return e;var _=e[s];return t.__assign(t.__assign({},e),((a={})[s]=t.__assign(t.__assign({},_),((r={})[o]=p(_[o],"read",n.type===d.Action.MarkThreadRead,n.type),r)),a))},b=function(e,n,a){var r,i,s=f(n),o=s.fileIdOrUrl,d=s.threadId;if(!o||!d)return e;var _=e[o];return t.__assign(t.__assign({},e),((r={})[o]=t.__assign(t.__assign({},_),((i={})[d]=h(_[d],"read",a),i)),r))},C=function(e,n){var a,r,i=f(n),s=i.fileIdOrUrl,o=i.threadId;if(!s||!o)return e;var _=e[s];return t.__assign(t.__assign({},e),((a={})[s]=t.__assign(t.__assign({},_),((r={})[o]=p(_[o],"resolved",n.type===d.Action.ResolveThread,n.type),r)),a))},S=function(e,n,a){var r,i,s=f(n),o=s.fileIdOrUrl,d=s.threadId;if(!o||!d)return e;var _=e[o];return t.__assign(t.__assign({},e),((r={})[o]=t.__assign(t.__assign({},_),((i={})[d]=h(_[d],"resolved",a),i)),r))},E=function(e,n){var a,r,i=v(n),s=i.fileIdOrUrl,o=i.threadId,d=i.commentId;if(!(s&&o&&d&&n.meta))return e;var _=e[s],u=n.meta.content;return t.__assign(t.__assign({},e),((a={})[s]=t.__assign(t.__assign({},_),((r={})[o]=A(_[o],d,"content",u,n.type),r)),a))},R=function(e,n,a){var r,i,s=v(n),o=s.fileIdOrUrl,d=s.threadId,_=s.commentId;if(!o||!d||!_)return e;var u=e[o];return t.__assign(t.__assign({},e),((r={})[o]=t.__assign(t.__assign({},u),((i={})[d]=h(u[d],"comments",a),i)),r))},w=function(e,n){var a,r,i=v(n),s=i.fileIdOrUrl,o=i.threadId,d=i.commentId;if(!s||!o||!d)return e;var _=e[s];return t.__assign(t.__assign({},e),((a={})[s]=t.__assign(t.__assign({},_),((r={})[o]=A(_[o],d,"deleted",!0,n.type),r)),a))},D=function(e,n,a){var r,i,s=v(n),o=s.fileIdOrUrl,d=s.threadId,_=s.commentId;if(!o||!d||!_)return e;var u=e[o];return t.__assign(t.__assign({},e),((r={})[o]=t.__assign(t.__assign({},u),((i={})[d]=h(u[d],"comments",a),i)),r))},U=function(e,n){var a,r=n.payload,s=r.arg,o=r.result,d=g(s.stream);return d&&o?t.__assign(t.__assign({},e),((a={})[d]=i.threadsToIThreadMap(o.threads,i.usersToIUserMap(o.users)),a)):e};function F(e,n,a){var r;return t.__assign(t.__assign({},e),((r={})[n]=a,r))}function L(e,n,a,r){var i,s=e.comments,o=s.findIndex((function(e){return e.id===n})),d=s[o];if(!d)return e;var _=t.__assign(t.__assign({},d),((i={})[a]=r,i)),u=t.__spreadArrays(s);return u.splice(o,1,_),F(e,"comments",u)}n.reducer=o.combineReducers(n.reducers);var V=function(e,n){var a,r,i=n.payload,s=i.content,o=i.threadId,d=i.fileIdentifier,_=i.commentId,u=e[d],c=u[o];return c?t.__assign(t.__assign({},e),((a={})[d]=t.__assign(t.__assign({},u),((r={})[o]=L(c,_,"content",s),r)),a)):e},O=function(e,n){var a,r,i,o,d=n.payload,_=d.author,u=d.content,l=d.threadId,m=d.fileIdentifier,g=e[m];if(l){var f=g[l];if(!f)return e;var v=f.comments,p=t.__assign(t.__assign({},f),{comments:t.__spreadArrays(v,[s.newCommentFromICommentContent({content:u,threadId:l,author:_})])});return t.__assign(t.__assign({},e),((a={})[m]=t.__assign(t.__assign({},g),((r={})[l]=t.__assign({},p),r)),a))}var A=c.v4(),h=s.newCommentFromICommentContent({threadId:A,author:_,content:u});p={id:A,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[h],isThirdParty:!1};return t.__assign(t.__assign({},e),((i={})[m]=t.__assign(t.__assign({},g),((o={})[A]=p,o)),i))},M=function(e,n){var a,r,i=n.payload,s=i.threadId,o=i.fileIdentifier,d=i.commentId;if(!o||!s||!d)return e;var _=e[o],u=_[s];return u?t.__assign(t.__assign({},e),((a={})[o]=t.__assign(t.__assign({},_),((r={})[s]=L(u,d,"deleted",!0),r)),a)):e},k=function(e,n){var a,r,i=n.payload,s=i.threadId,o=i.fileIdentifier;if(!o||!s)return e;var d=e[o],_=d[s];return _?t.__assign(t.__assign({},e),((a={})[o]=t.__assign(t.__assign({},d),((r={})[s]=F(_,"comments",_.comments.map((function(e){return t.__assign(t.__assign({},e),{deleted:!0})}))),r)),a)):e}}));
//# sourceMappingURL=reducer.amd.min.js-vflfTa2lN.map