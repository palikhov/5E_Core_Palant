define(["require","exports","tslib","modules/clean/security/crypto","modules/clean/security/util","modules/clean/csrf","modules/core/uri"],(function(e,r,t,n,o,i,s){"use strict";function a(e){return t.__awaiter(this,void 0,Promise,(function(){var r,s,a,c,u;return t.__generator(this,(function(t){switch(t.label){case 0:if(r=encodeURIComponent(e),s=o.stringToBytes(r),""===(a=i.readCsrfToken())||null===a)throw new Error("Missing CSRF token");return c=o.stringToBytes(a),[4,n.hmacMessage(c,s)];case 1:return u=t.sent(),[2,btoa(o.bytesToString(u))]}}))}))}function c(e,r,n){return t.__awaiter(this,void 0,Promise,(function(){var o,i,c;return t.__generator(this,(function(t){switch(t.label){case 0:return o=s.URI.parse(e),[4,a(n)];case 1:return i=t.sent(),o.updateQuery(((c={})[r]=i,c)),[2,o.toString()]}}))}))}Object.defineProperty(r,"__esModule",{value:!0}),r.readHmacCookieToken=r.addHeaderRedirectToken=r.addUrltoken=r.csrfHmacUrltoken=void 0,r.csrfHmacUrltoken=a,r.addUrltoken=c,r.addHeaderRedirectToken=function(e){return t.__awaiter(this,void 0,Promise,(function(){return t.__generator(this,(function(r){switch(r.label){case 0:return[4,c(e,"rtoken","header_redirect")];case 1:return[2,r.sent()]}}))}))},r.readHmacCookieToken=function(e,r){return t.__awaiter(this,void 0,Promise,(function(){var s,a,c,u,d,l,f,_;return t.__generator(this,(function(t){switch(t.label){case 0:if(3!==(s=e.split(":")).length)return[2,null];if(a=s[0],c=s[1],u=s[2],"1"!==a)return[2,null];d=(new TextEncoder).encode(c),l=decodeURIComponent(u);try{l=atob(l)}catch(e){return[2,null]}return f=o.stringToBytes(l),_=(new TextEncoder).encode(null!=r?r:i.readCsrfToken()),[4,n.verifyMessageHmac(_,d,f)];case 1:return t.sent()?[2,decodeURIComponent(c)]:[2,null]}}))}))}}));
//# sourceMappingURL=csrf_hmac.min.js-vflo11M8s.map