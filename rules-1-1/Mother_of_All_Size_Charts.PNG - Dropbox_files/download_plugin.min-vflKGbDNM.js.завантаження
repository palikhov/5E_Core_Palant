define(["require","exports","tslib","react","modules/core/i18n","dig-components/menu","dig-components/buttons","dig-components/icons/src","dig-components/icons","dig-components/tooltips","modules/clean/react/action_bar/action_bar_strings","modules/clean/react/action_bar/file_actions/portable/utils","modules/clean/react/action_bar/file_actions/portable/download","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/utils","modules/clean/file_store/utils","modules/clean/react/share_download/util","modules/clean/react/file_viewer/sdk_file_viewer/download_utils"],(function(e,t,n,o,i,a,l,r,c,s,u,d,f,p,m,_,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDownloadActionLoader=t.DOWNLOAD_ACTION_PLUGIN_ID=void 0,o=n.__importDefault(o),t.DOWNLOAD_ACTION_PLUGIN_ID="DOWNLOAD_ACTION",t.makeDownloadActionLoader=function(e,t,n,a,l,s){return function(){var D=(function(){function D(e){var t=this;this.lifecycle={previewWillInitialize:function(){t.actionDefinitions.atTopLevelIfSpace=t.actionToDisplay,t.actionDefinitions.alwaysInOverflow=[t.actionToDisplay]}},this.actionDefinitions={atTopLevelIfSpace:this.actionToDisplay,alwaysInOverflow:[this.actionToDisplay]},this.context=e}return Object.defineProperty(D.prototype,"actionToDisplay",{get:function(){var t=e().file;return!p.isLiveFile(t)||p.isPnmLinkNodeSelected(t)||p.isCloudDoc(t)?[]:m.isSharedFile(t)?[this.sharedDownloadButtonDefinition()]:[this.downloadButtonDefinition]},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"downloadButtonDefinition",{get:function(){var t=this;return d.makePluginActionDefinition({label:i.intl.formatMessage(u.DOWNLOAD_ACTION_STRING),icon:o.default.createElement(c.UIIcon,{src:r.DownloadLine}),action:function(){t.context.logUserAction({action:"download",context:"title_bar_open_split_button"});var n=e().file;f.downloadSingleFile({href:n.href,source:"PREVIEWS",isFswm:m.isSharedFile(n)})}})},enumerable:!1,configurable:!0}),D.prototype.sharedDownloadButtonDefinition=function(){var o=this;return v({downloadAllowed:_.isDownloadAllowed(a),downloadAction:function(){o.context.logUserAction({action:"download",context:"title_bar_download_split_button"});var n=e().file;w.downloadActiveFile(n,t,l,s)},saveACopyToDropboxAction:function(){var i=e().file;w.saveToDropbox(i,(function(e){return o.context.logUserAction({action:e,context:"title_bar_download_split_button"})}),t,n,l)},getActiveFile:e,user:t,shareToken:n,encryptionOptions:l})},D})();return Promise.resolve(D)}};var v=function(e){var t=e.downloadAction,f=e.saveACopyToDropboxAction,p=e.shareToken,m=e.downloadAllowed,_=o.default.createElement(c.UIIcon,{src:r.DownloadLine}),w=i.intl.formatMessage(u.DOWNLOAD_ACTION_STRING),v=function(e){e.menuItem.handler()},D=function(e){e.preventDefault(),e.stopPropagation(),t()},g=function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),t())},b=d.getCustomActionOverflowItem({icon:_,label:w,action:t}),A=null;p&&(A=d.getCustomActionOverflowItem({icon:o.default.createElement(c.UIIcon,{src:r.DropboxLine}),label:i.intl.formatMessage({id:"WiS7tZ",defaultMessage:"Save a copy to Dropbox"}),action:function(){f()}}));var I=o.default.createElement(o.default.Fragment,null,b,A),h=function(e){var t=e.buttonProps;return o.default.createElement(a.Menu.Wrapper,{onSelection:v},(function(e){var i=e.getTriggerProps,r=e.getContentProps;return o.default.createElement(o.default.Fragment,null,o.default.createElement(l.Button,n.__assign({"aria-label":"Show options"},t,i(),{disabled:!m})),o.default.createElement(a.Menu.Content,n.__assign({},r(),{placement:"bottom-end"}),o.default.createElement(a.Menu.Segment,null,I)))}))},O=function(e){return o.default.createElement(s.Tooltip,{title:i.intl.formatMessage({id:"3IQVpL",defaultMessage:"You do not have permission to download this file"})},o.default.createElement("div",null,e))},y=o.default.createElement(a.Menu.Submenu,{disabled:!m,withTriggerContent:w,withLeftAccessory:_},o.default.createElement(a.Menu.Segment,null,I));return{renderButton:function(e){var t=o.default.createElement(l.SplitButton,{onClick:D,onKeyPress:g,variant:"opacity",renderMenu:h,disabled:!m},!e&&_,w);return m?t:O(t)},overflowItem:m?y:O(y)}}}));
//# sourceMappingURL=download_plugin.min.js-vflY_QfIf.map