define(["require","exports","tslib","react","typescript/libraries/comments2/src/components/annotation_conductor_layer/index","typescript/component_libraries/files_components/src/blades/comments/data/actions","file-viewer/comments2/plugin/layer/utils","file-viewer/comments2/plugin/utils"],(function(n,t,e,i,o,a,r,l){"use strict";function s(n,t){if(null==t)return null;var i=t.regions,o=t.type;return"image"===n.previewType?{type:"image",region:i[0]}:"ssr_doc"===n.previewType?{type:"document",regionType:"highlight"===o?"highlight":"rectangle",regions:i.map((function(t){return e.__assign(e.__assign({},t),{page:r.fileViewerPageToComments2Page(n.layer.pageIndex)})}))}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.AnnnotationConductor=void 0,i=e.__importStar(i);function c(n,t){var e=Math.abs(n-t);return e<.01?e:null}function d(n,t){var e=n.x,i=n.y,o=t.y,a=t.y+t.height,r=t.x,l=t.x+t.width;if(e>=r&&e<=l){if(null!=c(i,o))return!0;if(null!=c(i,a))return!0}if(i>=o&&i<=a){if(null!=c(e,r))return!0;if(null!=c(e,l))return!0}return!1}function u(n,t){if("image"===t.type){if(d(n,t.region))return!0}else if("document"===t.type)for(var e=0,i=t.regions;e<i.length;e++){if(d(n,i[e]))return!0}return!1}var p=(function(n){function t(){var t=n.apply(this,arguments)||this;return t.handleRegionSelection=function(n,e){var i=t.props,o=i.context.fileViewerId,r=i.dispatch;if(e)r(a.clearDraftAnnotation(o));else if(null!=n){var l=s(t.props,n);null!=l&&r(a.updateDraftAnnotation(o,l))}else r(a.cancelAnnotating(o))},t.handleAnnotationConfirm=function(){var n=t.props,e=n.dispatch,i=n.context.fileViewerId;e(a.confirmDraftAnnotation(i))},t.handleClick=function(n){var e=t.props,i=e.context.fileViewerId,o=e.dispatch,r=t.findThreadAtPoint(n);if(null==r)o(a.deactivateAllThreads({fileViewerId:i}));else{var l=t.props.context.getPluginData(),s=l.file,c=l.sharedLinkInfo;o(a.activateThread({fileId:s.fileId,sharedLinkURL:null==c?void 0:c.url,fileViewerId:i,threadId:r.id,isThirdParty:r.isThirdParty}))}},t.handleHoverPointChange=function(n){var e=t.props,i=e.context.fileViewerId,o=e.dispatch;if(null!=n){var r=t.findThreadAtPoint(n);o(null==r?a.hoverThread(i,null):a.hoverThread(i,r.id))}},t.isSelectionAnnotatable=function(n){var e=t.props;return"ssr_doc"===e.previewType&&e.queries.getPageForSelection(n)===e.layer.pageIndex},t.componentDidUpdate=function(n){var e=n.annotationState,i=t.props,o=i.annotationState,a=i.context,r=l.isEditingAnnotation(o);r!==l.isEditingAnnotation(e)&&a.getPluginData().navigation.toggleHideFloatingToolbar(r)},t.componentWillUnmount=function(){var n=t.props,e=n.context,i=n.annotationState,o=n.dispatch,r=n.context.fileViewerId;l.isEditingAnnotation(i)&&(e.getPluginData().navigation.toggleHideFloatingToolbar(!1),o(a.cancelAnnotating(r)))},t}return e.__extends(t,n),t.prototype.findThreadAtPoint=function(n){for(var t=0,e=this.props.threads;t<e.length;t++){var i=e[t],o=i.annotation;if(null!=o&&u(n,o))return i}},t.prototype.render=function(){var n=this.props,t=n.layer.dimensions,e=n.draftAnnotation,a=n.ui.scaleFactor,r=n.children,s=n.config,c=n.platform,d=n.annotationState,u=n.isActive,p=n.previewType;if(null==t)return r;var f=t.height,g=t.width;return i.createElement(i.Fragment,null,i.createElement(o.AnnotationConductorLayer,{canCreateHighlight:"image"!==p,canCreateRectangle:!s.isInBladeRightRail||l.isEditingAnnotation(d),canDismiss:!0,annotation:e,onAnnotationChange:this.handleRegionSelection,onAnnotationConfirm:this.handleAnnotationConfirm,onClick:this.handleClick,onHoverPointChange:this.handleHoverPointChange,layerSize:{height:f*a,width:g*a},isSelectionAnnotatable:this.isSelectionAnnotatable,useV2Design:s.isInBladeRightRail,intl:c.intl,annotationState:d,isActive:u},r))},t})(i.Component);t.AnnnotationConductor=p}));
//# sourceMappingURL=conductor.min.js-vflrfaBw8.map