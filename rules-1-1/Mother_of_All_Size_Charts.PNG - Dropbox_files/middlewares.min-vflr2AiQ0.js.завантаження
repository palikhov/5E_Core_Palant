define(["require","exports","file-viewer/zoom/actions","api_v2/redux/sharing","api_v2/redux/users","api_v2/redux/zoom","api_v2/redux/integrations","typescript/component_libraries/deep-integrations/src/instrumentation/constants"],(function(e,t,r,o,i,n,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zoomLoggingMiddleware=t.addingInviteeMiddleware=t.profileServiceMiddleware=t.getMeetingsForFileMiddleware=t.getFileMembersForZoomMiddleware=t.zoomSidebarMiddleware=void 0,t.zoomSidebarMiddleware=function(e){var t=e.dispatch,o=e.getState;return function(e){return function(i){if("@@previews/openSidebar"===i.type){var n=i.payload.fileViewerId,s=o();s.modes[n]&&"zoom"===s.modes[n].sidebar.selectedControlId&&r.fetchZoomSettings(t)}else"@@previews/modes/changeMode"===i.type&&"zoom"===i.payload.mode&&r.fetchZoomSettings(t);e(i)}}},t.getFileMembersForZoomMiddleware=function(e){var t=e.dispatch;return function(e){return function(r){if("@@previews/zoom/fetchFileMembers"===r.type){var n=r.payload;t(o.listFileMembersAction({arg:{file:n.fileId}}))}else if("@@apiv2_redux/sharing/list_file_members_result"===r.type||"@@apiv2_redux/sharing/list_file_members/continue_result"===r.type){n=r.payload;!r.error&&n.result&&(t(i.getAccountBatchAction({arg:{account_ids:n.result.users.map((function(e){return e.user.account_id}))}})),n.result.cursor&&t(o.listFileMembersContinueAction({arg:{cursor:n.result.cursor}})))}return e(r)}}},t.getMeetingsForFileMiddleware=function(e){var t=e.dispatch;return function(e){return function(r){if("@@apiv2_redux/zoom/list_zoom_meetings_for_file_result"===r.type){var o=r.payload,s=r.error;if(s)console.error(s);else if(o.result){var a={};o.result.zoom_meetings.forEach((function(e){e.invitees.forEach((function(e){return a[e]=!0})),a[e.host_dropbox_account_id]=!0}));var u=Object.keys(a);t(i.getAccountBatchAction({arg:{account_ids:u}})),o.result.cursor&&t(n.listZoomMeetingsForFileAction({arg:{file_id:o.arg.file_id,cursor:o.result.cursor}}))}else console.error("could not find result from payload of ListZoomMeetingsForFileResultAction")}return e(r)}}},t.profileServiceMiddleware=function(e){return function(t){var o=t.dispatch,i=t.getState,n=function(e){for(var t,n=i(),a=n.serviceInfo&&"fulfilled"===n.serviceInfo.state&&n.serviceInfo.value.connection_state[".tag"],u=0,c=e;u<c.length;u++){var l=c[u];"zoom"===l.service_type[".tag"]&&(t=l.connection_state[".tag"])}a&&t&&t!==a&&o(s.getUserSettingsAction({arg:{fetch_external_settings:[{".tag":"zoom"}]}})),o(r.listServicesResult({serviceInfo:e}))};return function(t){return function(r){switch(r.type){case"@@previews/zoom/authService":e&&e.authService(r.payload.serviceId);break;case"@@previews/zoom/subscribeListServices":e&&e.subscribe(n);break;case"@@previews/zoom/unsubscribeListServices":e&&e.unsubscribe()}return t(r)}}}},t.addingInviteeMiddleware=function(e){var t=!1;return function(o){var i=o.dispatch,n=function(e){return i(r.updateAddingInviteeSuggestions({suggestions:e}))};return function(r){return function(o){return e?("@@previews/zoom/queryAddingInviteeSuggestions"===o.type?t?e.querySuggestions(o.payload.query):console.error("should subscribe to invitee suggestion change first"):"@@previews/zoom/subscribeInviteeSuggestionsChange"===o.type?t?console.error("already subscribed to invitee suggestion change first"):(e.subscribeSuggestionsChange(n),t=!0):"@@previews/zoom/unsubscribeInviteeSuggestionsChange"===o.type&&(t?(e.unSubscribeSuggestionsChange(),t=!1):console.error("have not subscribed to invitee suggestion change")),r(o)):r(o)}}}},t.zoomLoggingMiddleware=function(e){return function(t){var o=t.dispatch,i=t.getState;return function(t){return function(n){if("@@previews/zoom/logZoomEvent"===n.type)e&&e.logZoomEvent(n.payload.event);else if("@@previews/openSidebar"===n.type){var s=n.payload.fileViewerId,u=i();u.modes[s]&&"zoom"===u.modes[s].sidebar.selectedControlId&&o(r.logZoomEvent({event:{event_name:a.InstrEventType.UserClick,feature_name:a.InstrFeatureType.ZoomFileViewerExtension,service_type:"zoom",extra:{action:a.InstrActionType.ReopenZoomSideBar}}}))}else if("@@previews/modes/changeMode"===n.type&&"zoom"===n.payload.mode)o(r.logZoomEvent({event:{event_name:a.InstrEventType.UserClick,feature_name:a.InstrFeatureType.ZoomFileViewerExtension,service_type:"zoom",extra:{action:a.InstrActionType.OpenZoomSideBar}}}));else if("@@apiv2_redux/integrations/get_user_settings_result"===n.type&&n.payload.result&&n.payload.result.zoom_settings&&n.payload.result.zoom_settings.external_settings&&n.payload.result.zoom_settings.external_settings.settings){var c=n.payload.result.zoom_settings.external_settings.settings.use_pmi_for_instant_meetings;o(r.logZoomEvent({event:{event_name:a.InstrEventType.ReceivedUserSetting,feature_name:a.InstrFeatureType.ZoomFileViewerExtension,service_type:"zoom",extra:{pmiSetting:c.toString()}}}))}t(n)}}}}}));
//# sourceMappingURL=middlewares.min.js-vflUuuxfD.map