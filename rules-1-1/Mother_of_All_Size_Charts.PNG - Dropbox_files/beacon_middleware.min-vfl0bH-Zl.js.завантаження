define(["require","exports","tslib","file-viewer/pass/types","file-viewer/pass/actions","api_v2/redux/users"],(function(e,n,r,t,s,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.beaconMiddleware=void 0,n.beaconMiddleware=function(e){var n=this;return function(a){var u=(function(e){return function(n,r){var a,u;void 0===r&&(r=!0);var c=n.events.filter((function(e){return e.info.status!==t.PresenceStatus.offline})).map((function(e){return e.agent.userId}));e(r?s.updateViewingUsers(((a={})[n.fileId]=n.events,a)):s.updateViewingUsersWithDelta(((u={})[n.fileId]=n.events,u))),c.length&&e(i.getAccountBatchAction({arg:{account_ids:c}}))}})(a.dispatch);return e.onBeacon(u),function(t){return function(s){return r.__awaiter(n,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return n=t(s),"@@presence/subscribe"!==s.type?[3,1]:(e.subscribe(s.payload.fileId,s.payload.previewSessionId),[3,7]);case 1:return"@@presence/unsubscribe"!==s.type?[3,2]:(e.unsubscribe(s.payload),[3,7]);case 2:if("@@presence/getFilePresence"!==s.type)return[3,7];r.label=3;case 3:return r.trys.push([3,6,,7]),e.getPresence?[4,e.getPresence(s.payload)]:[3,5];case 4:i=r.sent(),u(i),r.label=5;case 5:return[3,7];case 6:return r.sent(),[3,7];case 7:return[2,n]}}))}))}}}}}));
//# sourceMappingURL=beacon_middleware.min.js-vfl2slcPb.map