define(["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsentIframeWrapper=void 0;var i;(function(e){e.bodyContentChange="BODY_CONTENT_CHANGE",e.bannerResize="BANNER_RESIZE",e.displayButton="DISPLAY_BUTTON",e.priorConsent="PRIOR_CONSENT",e.consentChanged="CONSENT_CHANGED",e.consentWithdrawn="CONSENT_WITHDRAWN",e.consentDeclined="CONSENT_DECLINED",e.scriptLoaded="SCRIPT_LOADED",e.scriptLoadError="SCRIPT_LOAD_ERROR",e.toggleButtonMinimize="TOGGLE_BUTTON_MINIMIZE",e.dnsEnabled="DNS_ENABLED",e.dnsDisabled="DNS_DISABLED",e.ccpaConsentSettingsRegistered="CCPA_CONSENT_SETTINGS_REGISTERED",e.ccpaCookieFaqClick="CCPA_COOKIE_FAQ_CLICK",e.ccpaIframeLoad="CCPA_IFRAME_LOAD",e.ccpaIframeError="CCPA_IFRAME_ERROR"})(i||(i={}));var n=(function(){function e(e){this.bannerVisible=!1,this.optionsButtonLoaded=!1,this.manageCookiesSet=!1,this.log=e.log,this.waitForTTI=e.waitForTTI,this.ttiTimeout=e.ttiTimeout,this.iframeOrigin=e.iframeOrigin,this.iframeTitle=e.iframeTitle,this.clientInfo=e.clientInfo,this.disableBanner=e.disableBanner,this.countryCode=e.countryCode,this.isCcpaEnabled=e.isCcpaEnabled,this.isGpcEnabled=e.isGpcEnabled,this.hideGdpr=e.hideGdpr,this.ccpaToken=e.ccpaToken,this.urlHash=e.urlHash,this.onIframeLoad=e.onIframeLoad,this.setupSettingsReEntry=e.setupSettingsReEntry,this.onBannerVisible=e.onBannerVisible,this.onBannerNotVisible=e.onBannerNotVisible,this.onPriorConsent=e.onPriorConsent,this.onConsentChanged=e.onConsentChanged,this.onConsentDeclined=e.onConsentDeclined,this.onDNSEnabled=e.onDNSEnabled,this.onDNSDisabled=e.onDNSDisabled,this.onGPCEnabled=e.onGPCEnabled,this.redirect=e.redirect}return e.prototype.createIframe=function(){var e=this,t=new Date,i=document.createElement("iframe"),n=new URLSearchParams;n.append("hide_gdpr",String(this.hideGdpr)),n.append("is_ccpa_enabled",String(this.isCcpaEnabled)),n.append("gpc_signal",String(this.isGpcEnabled)),n.append("origin",encodeURIComponent(window.location.origin)),this.ccpaToken&&n.append("ccpa_token",this.ccpaToken);var o=this.iframeOrigin+"?"+n.toString()+this.urlHash;i.src=o,i.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms"),i.setAttribute("class","consent-iframe "+(this.disableBanner?"no-banner":"")),i.setAttribute("id","consent-iframe"),i.setAttribute("allowTransparency","true"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("hidden","true"),i.setAttribute("scrolling","no"),i.setAttribute("title",this.iframeTitle),i.setAttribute("tabindex","1"),document.body.insertBefore(i,document.body.childNodes[0]),i.addEventListener("load",(function(){e.handleIframeLoad(t,e.iframeOrigin)})),window.addEventListener("message",(function(t){return e.receiveMessage(t)}),!1),this.iframeEl=i},e.prototype.iframeExists=function(){return void 0!==this.iframeEl},e.prototype.receiveMessage=function(e){var t,n,o=e.data;if(e.source===(null===(t=this.iframeEl)||void 0===t?void 0:t.contentWindow))switch(o.message_type){case i.bodyContentChange:this.onBodyContentChange(o);break;case i.bannerResize:this.onBannerResize(o);break;case i.displayButton:this.onDisplayButton(o);break;case i.priorConsent:this.onPriorConsent(o.categories);break;case i.consentChanged:case i.consentWithdrawn:this.onConsentChanged(o.categories);break;case i.consentDeclined:this.onConsentDeclined(o.categories);break;case i.scriptLoaded:this.onScriptLoaded(o);break;case i.scriptLoadError:this.onScriptLoadError(o);break;case i.toggleButtonMinimize:this.onToggleButtonMinimize(o.buttonMinimized);break;case i.dnsEnabled:this.onDNSEnabled(o.optInToDNS,o.expireDate);break;case i.dnsDisabled:this.onDNSDisabled();break;case i.ccpaConsentSettingsRegistered:break;case i.ccpaCookieFaqClick:this.redirect("https://help.dropbox.com/accounts-billing/security/cookies");break;case i.ccpaIframeLoad:this.onCCPAIFrameLoad(o);break;case i.ccpaIframeError:null===(n=this.log)||void 0===n||n.logCCPAIframeError(o)}},e.prototype.openOptionsDialog=function(){this.send({message_type:"OPEN_OPTIONS_DIALOG"})},e.prototype.sendShowFloatingButton=function(e){this.send({message_type:"SHOW_FLOATING_BUTTON",text_override:e})},e.prototype.getBannerHeight=function(){var e;if(this.bannerVisible)return(null===(e=this.iframeEl)||void 0===e?void 0:e.height)?parseInt(this.iframeEl.height,10):0},e.prototype.send=function(e){var t,i;this.iframeEl,null===(i=null===(t=this.iframeEl)||void 0===t?void 0:t.contentWindow)||void 0===i||i.postMessage(e,this.iframeOrigin)},e.prototype.handleGPCSignal=function(){this.isGpcEnabled&&(this.onGPCEnabled(),this.send({message_type:"DNS_GPC_SIGNAL"}))},e.prototype.sendCountryCode=function(){this.countryCode&&this.send({message_type:"COUNTRY_CODE",country_code:this.countryCode})},e.prototype.handleIframeLoad=function(e,t){var i,n=this;null===(i=this.log)||void 0===i||i.logIframeLoad(e,t),this.waitForTTI({timeoutMS:this.ttiTimeout}).then((function(){n.handleGPCSignal(),n.sendCountryCode(),n.bannerVisible&&n.triggerOnBannerVisible(),n.onIframeLoad()}))},e.prototype.onBodyContentChange=function(e){var t,i,n,o,s,a,r=e.bannerVisible,l=e.dialogVisible,d=e.optionsButtonVisible,h=e.optionsButtonLoaded;this.bannerVisible=r&&!this.isGpcEnabled;var c=!this.bannerVisible&&!l&&!d;if(null===(t=this.iframeEl)||void 0===t||t.classList.toggle("banner-visible",r),null===(i=this.iframeEl)||void 0===i||i.classList.toggle("dialog-open",l),null===(n=this.iframeEl)||void 0===n||n.classList.toggle("button-enabled",d),h&&!this.optionsButtonLoaded&&(this.optionsButtonLoaded=!0,this.setupSettingsReEntry()),c?(this.setIframeHeight("0"),this.setIframeWidth("0")):null===(o=this.iframeEl)||void 0===o||o.removeAttribute("hidden"),this.bannerVisible?this.triggerOnBannerVisible():this.onBannerNotVisible&&this.onBannerNotVisible(),d){var p="true"===sessionStorage.getItem("cookie-settings-minimized");null===(s=this.iframeEl)||void 0===s||s.classList.toggle("prev-collapsed",p)}else null===(a=this.iframeEl)||void 0===a||a.classList.remove("prev-collapsed","collapsed","expanded")},e.prototype.onBannerResize=function(e){var t;e.bannerHeight&&e.bannerHeight!==(null===(t=this.iframeEl)||void 0===t?void 0:t.height)&&(this.setIframeHeight(e.bannerHeight),this.onBannerVisible&&this.triggerOnBannerVisible())},e.prototype.onDisplayButton=function(e){!this.manageCookiesSet&&e.buttonHeight&&e.buttonWidth&&(this.setIframeHeight(e.buttonHeight),this.setIframeWidth(e.buttonWidth))},e.prototype.onToggleButtonMinimize=function(e){var t,i,n,o;null===(t=this.iframeEl)||void 0===t||t.classList.remove("prev-collapsed"),null===(i=this.iframeEl)||void 0===i||i.classList.toggle("collapsed",e),null===(n=this.iframeEl)||void 0===n||n.classList.toggle("expanded",!e),sessionStorage.setItem("cookie-settings-minimized",(null===(o=this.iframeEl)||void 0===o?void 0:o.classList.contains("collapsed"))?"true":"false")},e.prototype.onScriptLoaded=function(e){var t;null===(t=this.log)||void 0===t||t.logPrivacyConsentScriptLoaded(e)},e.prototype.onScriptLoadError=function(e){var t;null===(t=this.log)||void 0===t||t.logPrivacyConsentScriptLoadError(e)},e.prototype.onCCPAIFrameLoad=function(e){var t;this.sendPrivacyConsentPageInfo();var i=Date.now()-e.start_time;null===(t=this.log)||void 0===t||t.logCCPAIframeLoad(i)},e.prototype.setIframeHeight=function(e){this.iframeEl&&(this.iframeEl.height=e)},e.prototype.setIframeWidth=function(e){this.iframeEl&&(this.iframeEl.width=e)},e.prototype.triggerOnBannerVisible=function(){var e,t=(null===(e=this.iframeEl)||void 0===e?void 0:e.height)?parseInt(this.iframeEl.height,10):0;this.onBannerVisible&&this.onBannerVisible(t)},e.prototype.sendPrivacyConsentPageInfo=function(){var e=window.location.hostname;this.send({message_type:"PRIVACY_CONSENT_PAGE_INFO",hostname:e,foreign_session_id:null,client_info:this.clientInfo})},e})();t.ConsentIframeWrapper=n}));
//# sourceMappingURL=consent_iframe_wrapper.min.js-vflFy-gQn.map