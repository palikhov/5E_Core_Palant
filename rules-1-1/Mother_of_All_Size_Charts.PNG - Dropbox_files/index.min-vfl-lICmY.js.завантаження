define(["require","exports","tslib","react","typescript/libraries/comments2/src/components/utils/throttle-debounce","classnames","typescript/libraries/comments2/src/components/annotation_conductor_layer/utilities","typescript/libraries/comments2/src/components/annotation_rectangle_creation_layer/utilities","typescript/libraries/comments2/src/components/annotation_highlight_creation_layer/index","typescript/libraries/comments2/src/components/annotation_rectangle_creation_layer/index","react-intl"],(function(t,e,n,o,i,a,r,s,l,c,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationConductorLayer=void 0,o=n.__importStar(o),a=n.__importDefault(a);var g=(function(t){function e(e){var n=t.call(this,e)||this;return n.mouseDownSurface=0,n.hasMouseMoved=!1,n.layerRef=null,n.onDragStart=function(t){(n.props.canCreateRectangle||n.props.canCreateHighlight&&r.isOnImage(t))&&t.preventDefault()},n.onKeyDown=function(t){var e=n.state.internalAnnotation;if(e&&"rnd"===e.type){var o=!1;"Enter"===t.key?(n.onRectChangeEnd(),o=!0):"ArrowUp"===t.key?(n.onArrowKey(0,-1,t.shiftKey),o=!0):"ArrowDown"===t.key?(n.onArrowKey(0,1,t.shiftKey),o=!0):"ArrowLeft"===t.key?(n.onArrowKey(-1,0,t.shiftKey),o=!0):"ArrowRight"===t.key&&(n.onArrowKey(1,0,t.shiftKey),o=!0),o&&(t.stopImmediatePropagation(),t.preventDefault())}},n.onMouseMove=function(t){var e=n.props.annotation,o=0===(void 0!==t.buttons?t.buttons:t.nativeEvent.which);n.hasMouseMoved=!0,!o||e||n.onHoverPointChange(r.toPoint(t))},n.onMouseDown=function(t){s.pertainsToLeftClick(t)&&(n.mouseDownSurface=r.getSurfaceFromEvt(t),n.hasMouseMoved=!1)},n.onMouseUp=function(t){var e=n.props,o=e.annotation,i=e.onClick;n.hasMouseMoved||0===n.mouseDownSurface||(o?n.attemptClearAllAnnotations():i&&i(r.toPoint(t))),n.mouseDownSurface=0},n.onHoverPointChange=i.throttle((function(t){var e=n.props.onHoverPointChange;e&&e(t)}),50),n.onMouseLeave=function(){n.onHoverPointChange(void 0)},n.onRectChangeStart=function(){var t=n.props.layerSize;if(n.layerRef&&t){var e=n.layerRef.getBoundingClientRect(),o={x:e.left,y:e.top,width:t.width,height:t.height};return n.setState({layerRect:o}),o}},n.onRectChange=function(t,e,o){var i=n.state.layerRect;if(i&&n.props.canCreateRectangle){var a=r.applyEdgeBounding(t,i,e),s=r.createRectangleFromPixelRectangle(a,i);o?n.props.onAnnotationChange({type:"rnd",regions:[s]},!0):n.setState({internalAnnotation:{type:"rnd",regions:[s]}})}},n.onRectChangeEnd=function(){var t,e,o=n.state.internalAnnotation;o?(n.props.onAnnotationChange(o,!1),null===(e=(t=n.props).onAnnotationConfirm)||void 0===e||e.call(t)):n.props.canDismiss&&n.props.onAnnotationChange(null,!1),n.setState({layerRect:null})},n.onTextHighlightChange=function(t){var e,o;if(n.layerRef&&n.highlightIsCreatable){var i=n.layerRef.getBoundingClientRect(),a=t.map((function(t){return r.createNormalizedRegion(t,i)}));n.clearWindowSelectionIfAny(),n.props.onAnnotationChange({type:"highlight",regions:a},!1),null===(o=(e=n.props).onAnnotationConfirm)||void 0===o||o.call(e),n.setButtonPosition(null)}},n.onCursorHighlightChange=function(t){if(t&&n.isCursorHighlightAnnotatable(t,window.getSelection())&&n.layerRef&&n.props.canCreateHighlight){var e=t.rangeRects,o=t.boundingRect,i=t.size,a=t.margin,s=n.layerRef.getBoundingClientRect(),l=r.getOverlayElementPosition(o,e[0],s,i,a);n.setButtonPosition(l)}else n.setButtonPosition(null)},n.setLayerRef=function(t){t&&(n.layerRef=t,n.layerRef.addEventListener("keydown",n.onKeyDown))},n.clearWindowSelectionIfAny=function(){var t=window.getSelection();t&&t.removeAllRanges()},n.attemptClearHighlightPlacement=function(){n.setButtonPosition(null),n.attemptClearAnnotation("highlight"),n.clearWindowSelectionIfAny()},n.attemptClearRectanglePlacement=function(){n.attemptClearAnnotation("rnd")},n.attemptClearAllAnnotations=function(){n.attemptClearHighlightPlacement(),n.attemptClearRectanglePlacement()},n.attemptClearAnnotation=function(t){var e=n.props.annotation;n.annotationIsDismissable&&e&&e.type===t&&n.props.onAnnotationChange(null,!1)},n.state={layerRect:null,buttonPosition:null,internalAnnotation:e.annotation},n}return n.__extends(e,t),Object.defineProperty(e.prototype,"className",{get:function(){var t=this.props.canCreateRectangle;return a.default(r.COMPONENT_CLASS_NAME,{"sc-annotation-conductor-layer__can-create":t,"sc-annotation-conductor-layer__is-creating-rnd":this.state.layerRect})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rectanglePlacement",{get:function(){var t=this.props.layerSize,e=this.state.internalAnnotation;if(e&&"rnd"===e.type){var n=e.regions[0];return r.createPlacementFromNormalizedRegion(n,t.width,t.height)}return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightPlacement",{get:function(){var t=this.props.annotation;return{button:this.state.buttonPosition,highlight:t&&"highlight"===t.type?{highlight:t.regions}:null}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"annotationIsDismissable",{get:function(){return null!==this.props.annotation&&this.props.canDismiss},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightIsCreatable",{get:function(){return this.props.canCreateHighlight&&this.state.buttonPosition},enumerable:!1,configurable:!0}),e.prototype.setButtonPosition=function(t){this.setState({buttonPosition:t&&n.__assign({},t)})},e.prototype.onArrowKey=function(t,e,n){var o=this.state,i=o.layerRect,a=o.internalAnnotation;if(i&&a){var s,l=a.regions[0],c=l.x,h=l.y,g=l.width,u=l.height,p=this.props.layerSize,f=p.width,y=p.height,m=.01;s=n?{x:c,y:h,width:g+t*m,height:u+e*m}:{x:c+t*m,y:h+e*m,width:g,height:u};var d=r.createPlacementFromNormalizedRegion(s,f,y,i);this.onRectChange(d,!n)}},e.prototype.isCursorHighlightAnnotatable=function(t,e){var n=this.props.isSelectionAnnotatable;return null!=e&&(null!=n?n(e):t.isInContainer)},e.prototype.componentDidUpdate=function(t){var e=t.annotationState,n=t.annotation,o=this.props,i=o.annotation,a=o.annotationState,r=o.canCreateRectangle,s=o.onAnnotationChange,l=o.isActive;if(null==i&&null!=n)this.setState({internalAnnotation:i});else if(null!=i&&null==n)this.setState({internalAnnotation:i});else if(l&&"annotating-ax"===a&&r&&"annotating-ax"!==e){var c=this.onRectChangeStart();if(c)s({type:"rnd",regions:[{x:0,y:0,width:c.width>500?200/c.width:.2,height:c.height>250?100/c.height:.1}]},!1),this.layerRef.focus()}},e.prototype.componentWillUnmount=function(){this.layerRef&&this.layerRef.removeEventListener("keydown",this.onKeyDown)},e.prototype.render=function(){var t=this,e=t.highlightPlacement,n=t.rectanglePlacement,i=t.props,a=t.state,r=t.className,s=i.children,g=i.useV2Design,u=i.intl,p=i.annotationState,f=a.buttonPosition;return o.createElement(h.RawIntlProvider,{value:u},o.createElement("div",{ref:this.setLayerRef,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseLeave,onMouseMove:this.onMouseMove,className:r,onDragStart:this.onDragStart,tabIndex:-1},o.createElement(l.AnnotationHighlightCreationLayer,{placement:e,buttonPosition:f,onTextHighlightChange:this.onTextHighlightChange,onCursorHighlightChange:this.onCursorHighlightChange,useV2Design:g},o.createElement(c.AnnotationRectangleCreationLayer,{placement:n,clearPlacement:this.attemptClearRectanglePlacement,onRectChangeStart:this.onRectChangeStart,onRectChange:this.onRectChange,onRectChangeEnd:this.onRectChangeEnd,useV2Design:g,annotationState:p},s))))},e})(o.PureComponent);e.AnnotationConductorLayer=g}));
//# sourceMappingURL=index.min.js-vfldnI8aN.map