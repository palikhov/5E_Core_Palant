define("modules/clean/react/fileops_actions",["require","exports","tslib","react","spectrum-sharing/utils/sharing_constants","modules/clean/em_string","modules/clean/file_operations/notifications","modules/clean/filepath/filepath","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/data/action_creators/index","modules/clean/react/browse/data/store","modules/clean/react/browse/models","modules/clean/react/files_view/file_actions/api_v2","modules/clean/react/files_view/file_actions/file_from_metadata","modules/clean/react/files_view/file_actions/rollback","modules/clean/react/snackbar","modules/clean/sharing/browse_exports","modules/clean/undo","modules/clean/viewer","modules/clean/web_user_action_events","modules/core/i18n","modules/core/notify","modules/core/browser"],(function(e,t,o,n,r,a,s,i,l,c,d,u,f,m,_,g,p,h,S,v,E,C,b,M,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showBatchCompletedSnackbar=t.nestedNamespaceSnackbars=t.getBatchUndoHandler=t.moveFiles=t.moveFiles_LEGACY=t.copyFiles_v2=t.copyFiles=void 0,n=o.__importDefault(n),s=o.__importStar(s),i=o.__importStar(i),l=o.__importStar(l),d=o.__importStar(d),u=o.__importStar(u),_=o.__importStar(_);var F="view_only_access_error",y="off_team_owner_error",L="owner_only_manage_membership_error",I="team_space_owner_only_manage_membership_error",O="team_space_only_on_team_sharing_error",P="ns_have_mounted_children_ns_error",A={sync:function(e){return b.intl.formatMessage({id:"tL3kkO",defaultMessage:"{count, plural, one{Copying {count} item...} other{Copying {count} items...}}"},{count:e})},undo:b.intl.formatMessage({id:"/M5Btv",defaultMessage:"Undoing copy..."}),undoFail:b.intl.formatMessage({id:"zHeX5Y",defaultMessage:"Couldn’t undo copy."}),undoComplete:b.intl.formatMessage({id:"hvAv6t",defaultMessage:"Copy undone."}),failure:function(e){return b.intl.formatMessage({id:"G2jO1n",defaultMessage:"{count, plural, one{Couldn’t copy {count} item.} other{Couldn’t copy {count} items.}}"},{count:e})},partialSuccess:function(e,t){return b.intl.formatMessage({id:"hR2/Hh",defaultMessage:"{count, plural, one{Copied {succesfully_copied_files} out of {count} item.} other{Copied {succesfully_copied_files} out of {count} items.}}"},{count:t,succesfully_copied_files:e})},success:function(e){return b.intl.formatMessage({id:"BDtFp+",defaultMessage:"{count, plural, one{Copied {count} item.} other{Copied {count} items.}}"},{count:e})}},k={sync:function(e){return b.intl.formatMessage({id:"O3t22Y",defaultMessage:"{count, plural, one{Pasting {count} item...} other{Pasting {count} items...}}"},{count:e})},undo:b.intl.formatMessage({id:"cwHYgu",defaultMessage:"Undoing paste..."}),undoFail:b.intl.formatMessage({id:"9ZbCky",defaultMessage:"Couldn’t undo paste."}),undoComplete:b.intl.formatMessage({id:"p9C+y6",defaultMessage:"Paste undone."}),failure:function(e){return b.intl.formatMessage({id:"7Yab1V",defaultMessage:"{count, plural, one{Couldn’t paste {count} item.} other{Couldn’t paste {count} items.}}"},{count:e})},partialSuccess:function(e,t){return b.intl.formatMessage({id:"pCUIin",defaultMessage:"{count, plural, one{Pasted {succesfully_copied_files} out of {count} item.} other{Pasted {succesfully_copied_files} out of {count} items.}}"},{count:t,succesfully_copied_files:e})},success:function(e){return b.intl.formatMessage({id:"is1Jb0",defaultMessage:"{count, plural, one{Pasted {count} item.} other{Pasted {count} items.}}"},{count:e})}};t.copyFiles=function(e){return e.useApiV2?T(e):N(e)};var N=function(e){var n=e.files,r=e.newPath,a=e.checkFSWs,i=e.onSuccess,c=e.onRequestNotSent,u=e.onUndo,f=e.user,m=e.dataApi;!(void 0===m?d:m).copyFiles({files:n,newPath:r,checkFSWs:a,userId:f.id,onSuccess:function(a){var c=a.newFiles,d=a.changesets,m=a.failureDetails;if(m){l.showFileSystemWarningsModal({fsws:m,onFinalAccept:function(){t.copyFiles(o.__assign(o.__assign({},e),{checkFSWs:!1}))},confirmText:b.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"})})}else i&&i(c),s.notifyCopySuccess(n.length,f,d,r,(function(){u&&u()}))}})&&c&&c()};function T(t){return o.__awaiter(this,void 0,void 0,(function(){var n,r,a,s,i,l,c,d,u,f,m,g;return o.__generator(this,(function(p){switch(p.label){case 0:return n=t.files,r=t.newPath,a=t.onError,s=t.onUndo,i=t.onSuccess,l=t.user,c=t.isLockedVaultFolder,d=t.isPasteAction,u=t.synchronousSingleFileActions,f=d?k:A,c?(Promise.all([new Promise((function(t,o){e(["modules/clean/react/vault/lib/api"],t,o)})).then(o.__importStar),new Promise((function(t,o){e(["vault/common/logging-types"],t,o)})).then(o.__importStar)]).then((function(e){var t=e[0].logProductAnalyticsEvent,o=e[1],n=o.AnalyticsEventActionSurface,r=o.AnalyticsEventAction,a=o.AnalyticsEventObject;return t({actionSurface:n.BROWSE,eventAction:r.SELECT,eventObject:a.COPY_INTO_LOCKED_VAULT})})),h.Snackbar.fail(b.intl.formatMessage({id:"MAy8Kw",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),"browse-action"),[2]):(h.Snackbar.sync(f.sync(n.length),!0,"browse-action"),[4,_.copyFiles(n,r,l.id,{checkFSWs:!1,synchronousSingleFileActions:Boolean(u)})]);case 1:return m=p.sent(),g={successLogAction:C.WebUserActionLogEvent.COPY_REQUEST_SUCCESS,failedLogAction:C.WebUserActionLogEvent.COPY_REQUEST_FAIL,undoingLogAction:C.WebUserActionLogEvent.COPY_UNDO,undoFailedLogAction:C.WebUserActionLogEvent.COPY_UNDO_REQUEST_FAIL,undoSuccessLogAction:C.WebUserActionLogEvent.COPY_UNDO_REQUEST_SUCCESS,undoingSnackbarText:f.undo,undoFailedSnackbarText:f.undoFail,undoSuccessSnackbarText:f.undoComplete,getFailureSnackbarText:f.failure,getPartialSuccessSnackbarText:f.partialSuccess,getSuccessSnackbarText:f.success},B(m,l,n,r,g,i,s,a),[2]}}))}))}function D(t){return o.__awaiter(this,void 0,void 0,(function(){var n,r,a,s,l,c,d,u,f,m,g,p,S,v,E,M,w,F;return o.__generator(this,(function(y){switch(y.label){case 0:return n=t.path,r=t.files,a=t.newPath,s=t.onError,l=t.onUndo,c=t.onSuccess,d=t.user,u=t.dataApiV2,f=void 0===u?_:u,m=t.checkFSWs,g=t.isLockedVaultFolder,p=t.extra,S=t.synchronousSingleFileActions,v=t.expEnableSharingNSF,E=void 0!==v&&v,g?(Promise.all([new Promise((function(t,o){e(["modules/clean/react/vault/lib/api"],t,o)})).then(o.__importStar),new Promise((function(t,o){e(["vault/common/logging-types"],t,o)})).then(o.__importStar)]).then((function(e){var t=e[0].logProductAnalyticsEvent,o=e[1],n=o.AnalyticsEventActionSurface,r=o.AnalyticsEventAction,a=o.AnalyticsEventObject;return t({actionSurface:n.BROWSE,eventAction:r.SELECT,eventObject:a.MOVE_INTO_LOCKED_VAULT})})),h.Snackbar.fail(b.intl.formatMessage({id:"fDvKfJ",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),"browse-action"),[2]):void 0!==n&&i.paths_are_equal(n,a)?(h.Snackbar.fail(b.intl.formatMessage({id:"V6/bVk",defaultMessage:"Those files already exist in that folder."}),"browse-action"),[2]):(h.Snackbar.sync(b.intl.formatMessage({id:"ENlS4s",defaultMessage:"{count, plural, one{Moving {count} item...} other{Moving {count} items...}}"},{count:r.length}),!0,"browse-action"),[4,f.moveFiles(r,a,d.id,{allowOwnershipTransfer:E,checkFSWs:m,synchronousSingleFileActions:Boolean(S)})]);case 1:return M=y.sent(),w=i.filename(a),F={successLogAction:C.WebUserActionLogEvent.MOVE_REQUEST_SUCCESS,failedLogAction:C.WebUserActionLogEvent.MOVE_REQUEST_FAIL,undoingLogAction:C.WebUserActionLogEvent.MOVE_UNDO,undoFailedLogAction:C.WebUserActionLogEvent.MOVE_UNDO_REQUEST_FAIL,undoSuccessLogAction:C.WebUserActionLogEvent.MOVE_UNDO_REQUEST_SUCCESS,undoingSnackbarText:b.intl.formatMessage({id:"BDPPA/",defaultMessage:"Undoing move..."}),undoFailedSnackbarText:b.intl.formatMessage({id:"ENMVb1",defaultMessage:"Couldn’t undo move."}),undoSuccessSnackbarText:b.intl.formatMessage({id:"O7CH0I",defaultMessage:"Move undone."}),getFailureSnackbarText:function(e,t){return(void 0===t?{}:t).isNestedNamespaceError?b.intl.formatMessage({id:"HdhXP9",defaultMessage:"{count, plural, one{Couldn’t move {count} item to {folderName}.} other{Couldn’t move {count} items to {folderName}.}} Shared folders can’t be moved to other shared folders."},{count:e,folderName:w}):b.intl.formatMessage({id:"Se5SXB",defaultMessage:"{count, plural, one{Couldn’t move {count} item to {folderName}.} other{Couldn’t move {count} items to {folderName}.}}"},{count:e,folderName:w})},getPartialSuccessSnackbarText:function(e,t,o){return(void 0===o?{}:o).isNestedNamespaceError?b.intl.formatMessage({id:"s8lIYX",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to {folderName}.} other{Moved {succesfully_moved_files} out of {count} items to {folderName}.}} Shared folders can’t be moved to other shared folders."},{count:t,succesfully_moved_files:e,folderName:w}):b.intl.formatMessage({id:"lfdYKG",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to {folderName}.} other{Moved {succesfully_moved_files} out of {count} items to {folderName}.}}"},{count:t,succesfully_moved_files:e,folderName:w})},getSuccessSnackbarText:function(e){return b.intl.formatMessage({id:"hMyik4",defaultMessage:"{count, plural, one{Moved {count} item to {folderName}.} other{Moved {count} items to {folderName}.}}"},{count:e,folderName:w})},extra:p},B(M,d,r,a,F,c,l,s,t),[2]}}))}))}function x(e,t,o,s,c){var d=E.Viewer.get_viewer().team_name,g=!1;"is_cdm_member"in e&&e.is_cdm_member&&i.inSubDirectory(e.cdm_tmf_path,s)&&(g=!0);var p=(function(e,t,o,s,i){var l=b.intl.formatMessage({id:"gVzSq7",defaultMessage:"You don’t have permission to move some of these items. Try moving items individually."}),c=null,d=(function(e){return 0===e.length?"":_.getFilenameFromActionInfo(e[0])})(s);t===y?c=1===s.length?null==o?b.intl.formatMessage({id:"eqzXgU",defaultMessage:"The owner of <strong>{file_name}</strong> is a member of another team."},{file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):b.intl.formatMessage({id:"F7A+9f",defaultMessage:"The owner of <strong>{file_name}</strong> isn’t a member of {team_name}."},{team_name:o,file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):null==o?b.intl.formatMessage({id:"1mkOQ2",defaultMessage:"The owner of some of these shared folders is a member of another team."}):b.intl.formatMessage({id:"kXptr+",defaultMessage:"The owner of some of these shared folders isn’t a member of {team_name}."},{team_name:o}):t===L?c=1===s.length?"is_cdm_member"in e&&e.is_cdm_member&&!i?b.intl.formatMessage({id:"rLKsQF",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to the {team_name} team space."},{team_name:o,file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):b.intl.formatMessage({id:"Xkb8gG",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to a team folder."},{file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):"is_cdm_member"in e&&e.is_cdm_member&&!i?b.intl.formatMessage({id:"Ic3QpQ",defaultMessage:"Only the owner can move some of these folders to the {team_name} team space."},{team_name:o}):b.intl.formatMessage({id:"AGXz3U",defaultMessage:"Only the owner can move some of these folders to a team folder."}):t===F?c=1===s.length?b.intl.formatMessage({id:"4nfaRz",defaultMessage:"You can only view <strong>{file_name}</strong>. Ask an owner or editor of the folder for access to edit it."},{file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):b.intl.formatMessage({id:"vSscn6",defaultMessage:"You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them."}):t===I||t===O?c=1===s.length?b.intl.formatMessage({id:"xYXgy4",defaultMessage:"If you need to move <strong>{file_name}</strong>, ask your admin to move it for you."},{file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):l:t===P&&(c=1===s.length?b.intl.formatMessage({id:"sFivS0",defaultMessage:"<strong>{file_name}</strong> has other shared folders inside it. Try moving each shared folder individually."},{file_name:a.Emstring.em_snippet(d,r.SNIPPET_SIZES.FILENAME),strong:function(e){return n.default.createElement("strong",{style:{fontWeight:500}},e)}}):l);return c})(e,t,d,o,g);if(null!=p){M.Notify.clear();var h=t===I||t===O||t===P,v=(function(e,t,o,n,s){if(t)return 1===n?b.intl.formatMessage({id:"MHxxzk",defaultMessage:"Can’t move out of the team space"}):b.intl.formatMessage({id:"XJI7dZ",defaultMessage:"Can’t move {num_of_files} items"},{num_of_files:n});return"is_cdm_member"in e&&e.is_cdm_member&&!s?b.intl.formatMessage({id:"S+fFwb",defaultMessage:"{count, plural, one{Can’t move shared folder to the {team_name} team space} other{Can’t move shared folders to the {team_name} team space}}"},{count:n,team_name:a.Emstring.em_snippet(o,r.SNIPPET_SIZES.DISPLAY_NAME)}):b.intl.formatMessage({id:"thmzHN",defaultMessage:"{count, plural, one{Can’t move shared folder to a team folder} other{Can’t move shared folders to a team folder}}"},{count:n})})(e,h,d,o.length,g),C="";C=h?"/help/business/team-space-overview#out":"/help/business/team-space-overview#move";var w=1===o.length,A=o[0]instanceof m.File&&w&&!h?b.intl.formatMessage({id:"tHNeW4",defaultMessage:"See owner"}):void 0;l.showMoveErrorModal({title:v,content:p,learnMoreLink:C,buttonString:A,onClick:function(){o[0]instanceof m.File&&S.asyncShowShareModal(e.id,o[0],{origin:r.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},(function(e){var t=e.path,o=e.qargs;return f.getStoreForBrowse().dispatch(u.setUrl({path:t,qargs:o}))}))}})}else c&&c()}function R(e){return"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"cant_nest_shared_folder"===e.failure.relocation_error[".tag"]}function B(e,n,r,a,s,d,u,f,m){if(e.isError){if(h.Snackbar.close("browse-action"),f&&f(),m&&"to"===e.error[".tag"]&&"file_system_warnings"===e.error.to[".tag"]){return void l.showFileSystemWarningsModal({fsws:e.error.to.details,onFinalAccept:function(){return D(o.__assign(o.__assign({},m),{checkFSWs:!1}))},confirmText:b.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}return x(n,e.error[".tag"],r,a,(function(){h.Snackbar.fail(s.getFailureSnackbarText(r.length),"browse-action")})),void c.logFileAction({uid:n.id,action:s.failedLogAction,num_files_selected:r.length,num_folders_selected:0,error_summary:e.error_summary,error:e.error[".tag"],jobId:e&&e.jobId,extra:s.extra})}var _=e.result.entries.filter((function(e){return"success"===e[".tag"]})),p=_.length,S=r.length-p,v=U(e,n,s,u);if(t.showBatchCompletedSnackbar(r.length,p,S,s,v,{isNestedNamespaceError:e.result.entries.some(R)}),d){var C=[];_.forEach((function(e){if("file"===e.success[".tag"]||"folder"===e.success[".tag"]){var t=e.success,o=r.find((function(e){return e.file_id===t.id}));if(o){var n=g.fileFromMetadata(o,t);C.push(n)}}})),d([],C)}var M="is_cdm_member"in n&&"cdm_tmf_path"in n?n:E.Viewer.get_viewer().get_user_by_id(n.id),w=!M.is_cdm_member||i.paths_are_equal(M.cdm_tmf_path,null==m?void 0:m.path)||i.inSubDirectory(M.cdm_tmf_path,null==m?void 0:m.path)?"personal":"team",F=!M.is_cdm_member||i.paths_are_equal(M.cdm_tmf_path,a)||i.inSubDirectory(M.cdm_tmf_path,a)?"personal":"team",y=o.__assign(o.__assign({},s.extra),{original_ultimate_parent:w,new_ultimate_parent:F});(function(e,t,o,n,r,a){var s=r,i=0,l=void 0,d=t.entries.filter((function(e){return"success"===e[".tag"]}));d&&(s=d.filter((function(e){return"file"===e.success[".tag"]})).length,i=d.filter((function(e){return"folder"===e.success[".tag"]})).length);var u=t.entries.filter((function(e){return"failure"===e[".tag"]}));u&&u.length>0&&(l=u[0].failure[".tag"]);c.logFileAction({uid:o,action:e,num_files_selected:s,num_folders_selected:i,jobId:n,error_summary:l,extra:a})})(s.successLogAction,e.result,n.id,e.jobId,r.length,y)}function U(e,t,n,r){var a=this;return!e.isError&&e.result.changeset_data&&e.result.changeset_data.length>0?function(){return o.__awaiter(a,void 0,void 0,(function(){return o.__generator(this,(function(o){return h.Snackbar.close("browse-action"),c.logFileAction({uid:t.id,action:n.undoingLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0,extra:n.extra}),p.rollback({changeset_data:e.result.changeset_data,userId:t.id,onSuccess:function(){h.Snackbar.complete(n.undoSuccessSnackbarText,"browse-action"),c.logFileAction({uid:t.id,action:n.undoSuccessLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0}),r&&r(!0)}}),[2]}))}))}:void 0}function H(){w.open_tab("https://help.dropbox.com/files-folders/share/shared-folder-differences#move_shared_folder")}t.copyFiles_v2=T,t.moveFiles_LEGACY=function(e){var n=e.path,r=e.files,a=e.newPath,i=e.checkFSWs,c=e.onSuccess,u=e.onRequestNotSent,f=e.onUndo,m=e.user,_=e.dataApi,g=void 0===_?d:_,p=function(n){var i=n.newFiles,d=n.changesets,u=n.failureDetails;if(u){l.showFileSystemWarningsModal({fsws:u,onFinalAccept:function(){t.moveFiles_LEGACY(o.__assign(o.__assign({},e),{checkFSWs:!1}))},confirmText:b.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}else s.notifyMoveSuccess(r.length,m,d,a,(function(){f&&f()})),c&&c(i)};!g.moveFiles({path:n,files:r,newPath:a,checkFSWs:i,userId:m.id,onSuccess:p,onError:function(e){"This will result in losing ownership of these folders."===e?(M.Notify.clear(),l.showConfirmOwnershipTransferModal((function(){g.moveFiles({path:n,files:r,newPath:a,userId:m.id,onSuccess:p,allowOwnershipTransfer:!0})}))):x(m,e,r,a)},allowOwnershipTransfer:!1})&&u&&u()},t.moveFiles=D,t.getBatchUndoHandler=U,t.nestedNamespaceSnackbars={showPartialSuccess:function(e,t){return t?(v.setHandleUndo(t),h.Snackbar.show(n.default.createElement(h.Snackbar,{title:e,variant:"complete",actionButtonText:b.intl.formatMessage({id:"OfxyEk",defaultMessage:"Undo"}),onActionClick:t,closeButtonText:b.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onCloseClick:H,timeoutDelayMs:5e3,id:"browse-action"}))):h.Snackbar.show(n.default.createElement(h.Snackbar,{closeButtonText:b.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:b.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:H,timeoutDelayMs:5e3,title:e,variant:"complete",id:"browse-action"}))},showFailure:function(e){return h.Snackbar.show(n.default.createElement(h.Snackbar,{closeButtonText:b.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:b.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:H,timeoutDelayMs:5e3,title:e,variant:"fail",id:"browse-action"}))}},t.showBatchCompletedSnackbar=function(e,o,n,r,a,s){if(void 0===s&&(s={}),o>0&&n>0){var i=r.getPartialSuccessSnackbarText(o,e,s);s.isNestedNamespaceError?t.nestedNamespaceSnackbars.showPartialSuccess(i,a):a?(v.setHandleUndo(a),h.Snackbar.completeWithUndo(i,a,"browse-action")):h.Snackbar.complete(i,"browse-action")}else if(o>0){i=r.getSuccessSnackbarText(o);a?(v.setHandleUndo(a),h.Snackbar.completeWithUndo(i,a,"browse-action")):h.Snackbar.complete(i,"browse-action")}else{i=r.getFailureSnackbarText(n,s);s.isNestedNamespaceError?t.nestedNamespaceSnackbars.showFailure(i):h.Snackbar.fail(i,"browse-action")}}})),define("modules/clean/react/folder_dialog/api",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_as_promised_jquery","api_v2/user_client","modules/clean/react/folder_dialog/constants","modules/core/exception"],(function(e,t,o,n,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFolderSuggestion=t.getFolderContentsAPIv2=t.getFolderContents=t.getFolderContentsWithCache=void 0,n=o.__importStar(n);var i={};function l(e,t){var o={folder:t};return n.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:e,data:o,dataType:"json",skipNotifyError:!0})}t.getFolderContentsWithCache=function(e,t){return(!i[t]||Date.now()-i[t].timestamp>a.CACHE_TTL_MS)&&(i[t]={folderContents:l(e,t),timestamp:Date.now()}),i[t].folderContents},t.getFolderContents=l,t.getFolderContentsAPIv2=function(e,t,n){return o.__awaiter(this,void 0,Promise,(function(){var a,i,l,c;return o.__generator(this,(function(o){switch(o.label){case 0:a=new r.UserApiV2Client,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,a.ns("files").rpc("list_subfolders",{path:t,max_height:n},{subjectUserId:e})];case 2:return i=o.sent(),l=[],(i.subfolder_entries||[]).forEach((function(e){var t=e.folder_metadata,o=!1,n=!1,r=0;t.sharing_info&&(o=t.sharing_info.read_only||!!t.sharing_info.no_access,n=!!t.sharing_info.no_access,void 0!==t.sharing_info.shared_folder_id&&(r=parseInt(t.sharing_info.shared_folder_id,10))),l.push({path:t.path_display||"",has_subdirs:e.has_subfolders||!1,icon:t.icon||"",read_only:o||!1,contained_ns:e.contained_ns||0,target_ns:r,no_access:n})})),[2,l];case 3:throw c=o.sent(),s.reportException({err:c.raw?new Error(c.raw.responseBody):c,severity:"non-critical",tags:["js:browse"]}),c;case 4:return[2]}}))}))},t.getFolderSuggestion=function(e,t,o){return(new r.UserApiV2Client).ns("ml").rpc("get_folder_suggestion",{paths:t,action:o},{subjectUserId:e})}})),define("modules/clean/react/folder_dialog/constants",["require","exports","modules/core/i18n"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_TTL_MS=t.DEFAULT_REVISION_ID=t.FOLDER_INPUT_HEIGHT=t.FOLDER_SUGGESTION_HEIGHT=t.LOADING_MIN_TIME=t.DIALOG_BODY_PADDING=t.PATH_BREADCRUMB_HEIGHT=t.DIALOG_ACTIONS_HEIGHT=t.DIALOG_HEAD_HEIGHT=t.errorDialogProps=t.FolderPickerLoadingState=t.Operation=t.ACCESS_LEVEL=t.TEAM_MEMBER=t.MAX_FOLDER_NAME_LENGTH=t.INVALID_FOCUS_INDEX=t.SUGGESTED_LOCATION_KEY_SCOPE=t.KEY_SCOPE=void 0,t.KEY_SCOPE="folder_picker_keyboard_selection",t.SUGGESTED_LOCATION_KEY_SCOPE="suggested_location_keyboard_selection",t.INVALID_FOCUS_INDEX=-1,t.MAX_FOLDER_NAME_LENGTH=20,t.TEAM_MEMBER="team_member",(function(e){e[e.ACCESS=0]="ACCESS",e.LIMITED_ACCESS="locked",e.LIMITED_ACCESS_VAULT="vault",e.NO_ACCESS="no_access"})(t.ACCESS_LEVEL||(t.ACCESS_LEVEL={})),(function(e){e[e.COPY=0]="COPY",e[e.MOVE=1]="MOVE",e[e.UPLOAD=2]="UPLOAD",e[e.EXPORT_LEGAL_HOLD=3]="EXPORT_LEGAL_HOLD"})(t.Operation||(t.Operation={})),(function(e){e[e.LOADING=0]="LOADING",e[e.ERROR=1]="ERROR",e[e.LOADED=2]="LOADED"})(t.FolderPickerLoadingState||(t.FolderPickerLoadingState={})),t.errorDialogProps={primaryAction:o.intl.formatMessage({id:"BCyGLk",defaultMessage:"Try again"}),secondaryAction:o.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),title:o.intl.formatMessage({id:"v3oTv1",defaultMessage:"Something went wrong on our end"}),ariaLabel:"",open:!0,variant:"regular"},t.DIALOG_HEAD_HEIGHT=64,t.DIALOG_ACTIONS_HEIGHT=64,t.PATH_BREADCRUMB_HEIGHT=40,t.DIALOG_BODY_PADDING=26,t.LOADING_MIN_TIME=200,t.FOLDER_SUGGESTION_HEIGHT=89,t.FOLDER_INPUT_HEIGHT=93,t.DEFAULT_REVISION_ID="0000000000000000",t.CACHE_TTL_MS=3e3})),define("modules/clean/react/folder_dialog/folder_picker",["require","exports","tslib","classnames","lodash","keymaster","react","react-dom","spectrum/button/index","spectrum/dimensions/index","spectrum/icon_arrow/index","spectrum/icon_content/index","spectrum/icon_global/index","spectrum/media_table/index","spectrum/table/index","spectrum/table/table_head_cell","spectrum/tooltip/index","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath/filepath","modules/clean/react/components/css","modules/clean/react/folder_dialog/constants","modules/clean/react/icon/folder_icon","modules/clean/react/image","modules/clean/react/path_breadcrumbs","modules/clean/react/selectable_list","modules/clean/static_urls","modules/core/exception","modules/core/i18n"],(function(e,t,o,n,r,a,s,i,l,c,d,u,f,m,_,g,p,h,S,v,E,C,b,M,w,F,y,L,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FolderPicker=t.FolderPickerRow=void 0,n=o.__importDefault(n),r=o.__importStar(r),a=o.__importDefault(a),s=o.__importDefault(s),i=o.__importStar(i),L=o.__importStar(L);var O="",P=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.onClick(t.props.folder,t.props.index)},t.handleMouseOver=function(){t.props.onMouseOver(t.props.folder)},t.handleMouseLeave=function(){t.props.onMouseLeave()},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.folder,r=e.isSelected,a=e.isFocused,i=e.index,l=S.Emstring.em_snippet(v.filename(t.path),C.MAX_FOLDER_NAME_LENGTH),c=[s.default.createElement(m.MediaCell,{key:l,icon:s.default.createElement(u.IconContent,{name:t.icon,disabled:!t.isClickable}),title:l}),s.default.createElement(m.MediaCell,{key:"has_subdirs",className:"folder-picker__right-arrow",icon:t.hasSubfolders&&t.isClickable?s.default.createElement(d.IconArrow,{name:"right"}):void 0})],f={className:n.default({folder_picker_row:!0,read_only:!t.isClickable,focused:a,selected:r}),variant:r?"selected":"default"};t.isClickable&&(f=o.__assign(o.__assign({},f),{onClick:this.handleClick,onMouseOver:this.handleMouseOver,onMouseLeave:this.handleMouseLeave}));f.ref;var _=o.__rest(f,["ref"]),g=r?I.intl.formatMessage({id:"apGvjm",defaultMessage:"{folder} (selected)"},{folder:l}):l;return s.default.createElement(m.MediaRow,o.__assign({role:"option",id:"folder_picker_row_"+i,"aria-label":g,"aria-selected":r},_),c)},t.displayName="FolderPickerRow",t})(s.default.Component);t.FolderPickerRow=P;var A=(function(e){function t(t){var c=e.call(this,t)||this;return c.preloadErrorImages=function(){var e=new Image;e.src=y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working-vfl2QXPxi.png"),e.srcset=y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working@2x-vflkcbmXv.png")+" 2x"},c.setStatus=function(e,t){e!==c.state.loadingState&&(c.cancelStatusTimeout(),t?c.setState({loadingState:e,loadingStateShown:e}):(c.setState({loadingState:e}),c.statusTimeout=setTimeout((function(){c.setState({loadingStateShown:e})}),C.LOADING_MIN_TIME)))},c.cancelStatusTimeout=function(){void 0!==c.statusTimeout&&clearTimeout(c.statusTimeout),c.statusTimeout=void 0},c.unFocusRows=function(){c.setState({focusIndex:C.INVALID_FOCUS_INDEX})},c.setPathWithErrorHandling=function(e){c.setPath(e).catch(c.handleError)},c.handleError=function(e){c.props.onError(e),c.props.onFolderSelected(),c.setStatus(C.FolderPickerLoadingState.ERROR)},c.canInstantlySetPath=function(e){if(c.cachedFolders.has(v.normalize(e).toLowerCase())&&c.cachedFolders.has(v.normalize(v.parent_dir(e)).toLowerCase()))return!0;if(c.cachedFolders.has(v.normalize(v.parent_dir(e)).toLowerCase())){var t=r.find(c.cachedFolders.get(v.normalize(v.parent_dir(e)).toLowerCase()),(function(t){return t.path===e}));if(t&&!t.hasSubfolders)return!0}return!1},c.setPath=function(e,t){return o.__awaiter(c,void 0,void 0,(function(){var n,a,s,i,l,c,d,u,f,m,_,g;return o.__generator(this,(function(o){switch(o.label){case 0:return n=this.props,a=n.onFolderSelected,s=n.onDataLoaded,i=n.user,l=[],c=!1,this.setState({loadingPath:e}),f=this.canInstantlySetPath(e),this.setStatus(C.FolderPickerLoadingState.LOADING,!0),f||a(void 0,void 0,void 0,void 0,!0),v.paths_are_equal(e,"/")?[4,this.fetchFolderContents("/")]:[3,2];case 1:return l=o.sent(),c=this.canSelectRoot(),d=i.root_ns_id,[3,10];case 2:return[4,this.fetchFolderContents(v.parent_dir(e))];case 3:if(m=o.sent(),!(_=r.find(m,(function(t){return v.paths_are_equal(t.path,e)}))))throw new Error("Could not find folder in API response");return u=_.isLockedVaultFolder,d=_.nsId,c=_.isSelectable,_.hasSubfolders?[4,this.fetchFolderContents(e)]:[3,5];case 4:return g=o.sent(),[3,7];case 5:return[4,this.fetchFolderContents(v.parent_dir(e))];case 6:g=o.sent(),o.label=7;case 7:return l=g,_.hasSubfolders&&0===l.length?(_.hasSubfolders=!1,[4,this.fetchFolderContents(v.parent_dir(e))]):[3,10];case 8:return l=o.sent(),[4,this.fetchFolderContents(v.parent_dir(v.parent_dir(e)))];case 9:o.sent(),o.label=10;case 10:return f||s(e),this.setStatus(C.FolderPickerLoadingState.LOADED,f),this.setState({path:e,folders:l,focusIndex:t?C.INVALID_FOCUS_INDEX:this.getFolderIndex(l,e),isFolderSuggestionSelected:!1}),c||this.props.forceFolderSelectedCallback?a(e,d,void 0,u):a(void 0,void 0),[2]}}))}))},c.setupKeyboardShortcuts=function(){(O=a.default.getScope())!==C.KEY_SCOPE&&a.default.setScope(C.KEY_SCOPE),a.default("up",C.KEY_SCOPE,c.handleFocusPrevious),a.default("down",C.KEY_SCOPE,c.handleFocusNext),a.default("left",C.KEY_SCOPE,c.handleSelectParent),a.default("right",C.KEY_SCOPE,c.handleSelectCurrentFolder),a.default("space",C.KEY_SCOPE,c.handleSelectCurrentFolder),a.default("enter",C.KEY_SCOPE,c.handleSelect)},c.cleanupKeyboardShortcuts=function(){a.default.clearScope(C.KEY_SCOPE),O&&a.default.setScope(O),a.default.resetFilter()},c.setupSuggestedLocationKeyboardShortcuts=function(){(O=a.default.getScope())!==C.SUGGESTED_LOCATION_KEY_SCOPE&&a.default.setScope(C.SUGGESTED_LOCATION_KEY_SCOPE);var e=c.state.folderSuggestion;e&&a.default("enter",C.SUGGESTED_LOCATION_KEY_SCOPE,(function(){return c.handleFolderSuggestionClick(e)}))},c.cleanupSuggestedLocationKeyboardShortcuts=function(){a.default.clearScope(C.SUGGESTED_LOCATION_KEY_SCOPE),O&&a.default.setScope(O),a.default.resetFilter()},c.getUrlForBreadcrumb=function(){return"#"},c.getAccessLevel=function(e){return e.icon.endsWith(C.ACCESS_LEVEL.NO_ACCESS)?C.ACCESS_LEVEL.NO_ACCESS:e.icon.endsWith(C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT)?C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT:e.icon.endsWith(C.ACCESS_LEVEL.LIMITED_ACCESS)||e.read_only?C.ACCESS_LEVEL.LIMITED_ACCESS:C.ACCESS_LEVEL.ACCESS},c.convertJsonFolderToFolder=function(e){var t=c.props.canSelectReadonly,o=e.path,n=e.icon,r=e.has_subdirs,a=e.contained_ns,s=c.getAccessLevel(e);return{path:o,icon:b.convertLegacyFolderIconToSpectrum(n,"small"),hasSubfolders:r,isSelectable:s===C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT||s===C.ACCESS_LEVEL.ACCESS||s===C.ACCESS_LEVEL.LIMITED_ACCESS&&t,isClickable:s===C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT||s===C.ACCESS_LEVEL.ACCESS||s===C.ACCESS_LEVEL.LIMITED_ACCESS&&(t||r),nsId:a,isLockedVaultFolder:s===C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT&&e.read_only}},c.fetchFolderSuggestion=function(){return o.__awaiter(c,void 0,void 0,(function(){var e,t,n,r,a,s,i,l,c,d,u;return o.__generator(this,(function(o){switch(o.label){case 0:e=this.props,t=e.apiClient,n=e.user,r=e.onFetchFolderSuggestionSuccess,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.fetchFolderSuggestion(n.id)];case 2:return a=o.sent(),s=a.path,i=a.prediction_id,l=a.suggest_id,s?(r([c={path:s,predictionId:i}],l),this.setState({folderSuggestion:c})):r([],l),this.setState({isFolderSuggestionLoading:!1}),[3,4];case 3:return d=o.sent(),u=d.raw?d.raw.responseBody:"Received error response from folder suggestion API",L.reportException({err:new Error(u),tags:["folder_suggestion"],severity:L.SEVERITY.NONCRITICAL}),this.setState({isFolderSuggestionLoading:!1}),[3,4];case 4:return[2]}}))}))},c.handleFolderHover=function(e){var t=c.state,o=t.folders,n=t.focusIndex,r=c.getFolderIndex(o,e.path);r!==n&&c.setState({focusIndex:r})},c.handleFolderClick=function(e,t,o){c.props.onRowClicked(e.path,t,!!o),c.setPathWithErrorHandling(e.path)},c.handleBreadcrumbClick=function(e){var t=e.path;c.props.onBreadcrumbClicked(t),c.setPathWithErrorHandling(t)},c.handleFocusPrevious=function(){c.hasNotLoaded||c.focusNeighboringItem(F.SelectDirection.PREV)},c.handleFocusNext=function(){c.hasNotLoaded||c.focusNeighboringItem(F.SelectDirection.NEXT)},c.handleSelectParent=function(){c.hasNotLoaded||c.setPathWithErrorHandling(v.parent_dir(c.state.path))},c.handleSelectCurrentFolder=function(){var e=c.state,t=e.focusIndex,o=e.folders,n=e.path,r=c.getFolderIndex(o,n);c.hasNotLoaded||t===r||c.handleSelect()},c.handleSelect=function(){if(!c.hasNotLoaded){var e=c.state,t=e.focusIndex,o=e.folders,n=e.path;c.getFolderIndex(o,n)===t?c.props.onSuccess():c.handleFolderClick(o[t],t,!0)}},c.handleTryAgainClick=function(){c.cachedFolders.delete(v.normalize(c.state.loadingPath).toLowerCase()),c.cachedFolders.delete(v.parent_dir(c.state.loadingPath).toLowerCase()),c.setPathWithErrorHandling(c.state.loadingPath)},c.setTableRef=function(e){c.table=e?i.findDOMNode(e):void 0},c.handleFolderSuggestionClick=function(e){c.props.onFolderSuggestionClick(e),c.setState({isFolderSuggestionSelected:!0}),c.props.onFolderSelected(e.path,void 0,e.predictionId)},c.handleFolderSuggestionLocationClick=function(e,t){c.props.onFolderSuggestionLocationClick(t),c.setPathWithErrorHandling(e)},c.renderErrorMessage=function(){return c.state.loadingStateShown!==C.FolderPickerLoadingState.ERROR?null:s.default.createElement("div",{className:"folder-picker__error"},s.default.createElement(M.Image,{src:y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working-vfl2QXPxi.png"),srcHiRes:y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working@2x-vflkcbmXv.png"),alt:""}),s.default.createElement("span",null,I.intl.formatMessage({id:"zD5i93",defaultMessage:"Something went wrong on our end."})),s.default.createElement(l.Button,{variant:"primary",onClick:c.handleTryAgainClick},I.intl.formatMessage({id:"BCyGLk",defaultMessage:"Try again"})))},c.renderLoadingMessage=function(){return c.state.loadingStateShown===C.FolderPickerLoadingState.LOADING||c.state.isFolderSuggestionLoading?s.default.createElement("tr",{className:"folder-picker-loading"},s.default.createElement("td",null,s.default.createElement("span",{className:"folder-picker-view__loading-label"},I.intl.formatMessage({id:"9fef95",defaultMessage:"Loading your folders…"})))):null},c.renderFolders=function(){if(c.hasNotLoaded)return null;var e=c.state,t=e.focusIndex,o=e.loadingStateShown,n=e.isFolderSuggestionSelected;return c.state.folders.map((function(e,r){return s.default.createElement(P,{key:e.path,folder:e,index:r,isSelected:v.paths_are_equal(c.state.path,e.path)&&o===C.FolderPickerLoadingState.LOADED&&!n,isFocused:r===t,onClick:c.handleFolderClick,onMouseOver:c.handleFolderHover,onMouseLeave:c.unFocusRows})}))},c.renderEmptyMessage=function(){return c.hasNotLoaded?null:c.state.folders.length||!v.paths_are_equal(c.state.path,"/")?null:s.default.createElement("tr",{className:"folder-picker__empty-message"},s.default.createElement("td",{className:"u-font-center u-pad-top-xl"},s.default.createElement(M.Image,{src:y.static_url("/static/images/empty_states/folder-picker-vfl3_Hwxf.png"),srcHiRes:y.static_url("/static/images/empty_states/folder-picker@2x-vfl7Aum9o.png"),alt:""}),s.default.createElement("h2",{className:"u-pad-top-l"},I.intl.formatMessage({id:"wUZqfd",defaultMessage:"This is the only folder there is."}))))},c.renderFolderSuggestion=function(){var e=c.state.folderSuggestion;return c.state.loadingStateShown!==C.FolderPickerLoadingState.ERROR&&e&&e.path?c.renderFolderSuggestionTable(e):null},c.renderFolderSuggestionTable=function(e){var t=c.state.isFolderSuggestionSelected,o=n.default("brws-file-row folder-suggestion-row",{"brws-file-row-selected":t}),r=v.filename(e.path),a=t?I.intl.formatMessage({id:"hJeUi9",defaultMessage:"Suggested location: {folder} (selected)"},{folder:r}):I.intl.formatMessage({id:"N0ElEH",defaultMessage:"Suggested location: {folder}"},{folder:r});return s.default.createElement(_.Table,{className:"brws-files-view-list folder-suggestion-table",role:"presentation"},s.default.createElement(_.TableHead,null,s.default.createElement(g.TableHeadCell,{className:"brws-column-header-table-cell",role:"columnheader",scope:"col",tabIndex:0},c.renderFolderSuggestionHeadText(),c.renderFolderSuggestionHeadInfoIcon())),s.default.createElement(_.TableBody,{role:"listbox",onFocus:c.setupSuggestedLocationKeyboardShortcuts,onBlur:c.cleanupSuggestedLocationKeyboardShortcuts},s.default.createElement(m.CulledMediaRow,{className:o,topOffset:0,onClick:function(){return c.handleFolderSuggestionClick(e)},role:"option","aria-label":a,"aria-selected":t,tabIndex:0},(function(t){var o=t.isHovered;return c.renderFolderSuggestionRow(e,o)}))))},c.renderFolderSuggestionHeadText=function(){var e=I.intl.formatMessage({id:"h/hLSy",defaultMessage:"Suggested location"});return s.default.createElement("span",null,e," ")},c.renderFolderSuggestionHeadInfoIcon=function(){var e=I.intl.formatMessage({id:"5hFsVX",defaultMessage:"Based on previous activity and file type"});return s.default.createElement(p.Tooltip,{positioning:"above",tooltipContent:e},s.default.createElement(f.IconGlobal,{name:"help",className:"icon-help","aria-label":e}))},c.renderFolderSuggestionRow=function(e,t){return s.default.createElement(m.MediaCell,{className:"brws-file-name-cell folder-suggestion-name-cell",icon:c.renderFolderSuggestionIcon()},s.default.createElement("div",{className:"brws-file-name-cell-text brws-vertically-center"},c.renderFolderSuggestionTitle(e,t),c.renderFolderSuggestionSubtitle(e)))},c.renderFolderSuggestionIcon=function(){return s.default.createElement(u.IconContent,{className:"brws-file-name-cell-icon",name:"folder-small"})},c.renderFolderSuggestionTitle=function(e,t){var o=v.filename(e.path);return s.default.createElement(m.MediaCellText,{key:"title",highlight:t},s.default.createElement("div",{className:"brws-file-name-element"},s.default.createElement("span",null,o)))},c.renderFolderSuggestionSubtitle=function(e){var t=c.props.user,o=v.parent_dir(e.path),n=v.paths_are_equal(o,"/")?h.get_browse_root_name(t):o.slice(1),r=I.intl.formatMessage({id:"R7F8Tb",defaultMessage:"in {location}"},{location:n});return s.default.createElement(m.MediaCellText,{key:"subtitle",variant:"subtitle"},s.default.createElement("a",{role:"button",className:"brws-file-name-cell-location folder-suggestion-location",href:"#",onClick:function(t){t.stopPropagation(),t.preventDefault(),c.handleFolderSuggestionLocationClick(o,e)}},r))},c.cachedFolders=new Map,c.state={folders:[],focusIndex:C.INVALID_FOCUS_INDEX,loadingState:C.FolderPickerLoadingState.LOADING,loadingStateShown:C.FolderPickerLoadingState.LOADING,path:t.initialPath,loadingPath:t.initialPath,folderSuggestion:void 0,isFolderSuggestionLoading:!!t.showFolderSuggestion&&!!t.apiClient.fetchFolderSuggestion,isFolderSuggestionSelected:!1},c}return o.__extends(t,e),t.prototype.componentDidMount=function(){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.setPath(v.normalize(this.props.initialPath),this.props.skipFocusOnMount)];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),this.handleError(e),[3,3];case 3:return this.state.isFolderSuggestionLoading?[4,this.fetchFolderSuggestion()]:[3,5];case 4:t.sent(),t.label=5;case 5:return this.preloadErrorImages(),[2]}}))}))},t.prototype.componentWillUnmount=function(){this.cancelStatusTimeout()},t.prototype.componentDidUpdate=function(e,t){if(this.state.loadingState!==C.FolderPickerLoadingState.LOADING&&t.loadingState===C.FolderPickerLoadingState.LOADING){var o=document.querySelector(".folder-picker-view");o&&!this.props.skipFocusOnMount&&o.focus()}},Object.defineProperty(t.prototype,"hasNotLoaded",{get:function(){return this.state.loadingStateShown!==C.FolderPickerLoadingState.LOADED||this.state.isFolderSuggestionLoading},enumerable:!1,configurable:!0}),t.prototype.canSelectRoot=function(){var e=this.props,t=e.user;return e.canSelectReadonly||!t.is_cdm_member||t.is_cdm_member&&"edit"===t.user_root_permissions},t.prototype.getFolderIndex=function(e,t){return r.findIndex(e,(function(e){return v.paths_are_equal(e.path,t)}))},t.prototype.focusNeighboringItem=function(e){var t=this,o=this.state,n=o.folders,r=o.focusIndex,a=n.length,s=r;e===F.SelectDirection.PREV&&r===C.INVALID_FOCUS_INDEX&&s++;for(var i=0;i<a;i++)if(e===F.SelectDirection.PREV?s=(s+a-1)%a:e===F.SelectDirection.NEXT&&(s=(s+1)%a),n[s].isClickable){this.setState({focusIndex:s});break}setTimeout((function(){return t.scrollToFocused()}))},t.prototype.scrollToFocused=function(){if(this.table){var e=this.table.getElementsByTagName("tbody").item(0);if(e){var t=this.table.getElementsByClassName("focused").item(0);if(t){var o=t.getBoundingClientRect().top,n=t.getBoundingClientRect().bottom,r=e.getBoundingClientRect().top,a=e.getBoundingClientRect().bottom;o<r||o>a?e.scrollTop+=o-r:n>a&&(e.scrollTop+=n-a)}}}},t.prototype.fetchFolderData=function(e){return o.__awaiter(this,void 0,Promise,(function(){var t,n,r,a,s,i;return o.__generator(this,(function(l){switch(l.label){case 0:return t=this.props,n=t.apiClient,r=t.user,[4,n.getFolderContents(r.id,e)];case 1:return a=l.sent(),s=a.map(this.convertJsonFolderToFolder),i=r.cdm_tmf_path&&v.paths_are_equal(e,"/")?o.__spreadArrays(s.filter((function(e){return v.paths_are_equal(e.path,r.cdm_tmf_path)})),s.filter((function(e){return!v.paths_are_equal(e.path,r.cdm_tmf_path)}))):s,this.cachedFolders.set(v.normalize(e).toLowerCase(),i),[2,i]}}))}))},t.prototype.fetchFolderContents=function(e){return o.__awaiter(this,void 0,Promise,(function(){var t;return o.__generator(this,(function(o){return t=v.normalize(e),[2,this.cachedFolders.get(t.toLowerCase())||this.fetchFolderData(t)]}))}))},t.prototype.renderTable=function(e){var t=this.props.rootName,o=this.state,n=o.path,r=o.focusIndex;if(!e||this.state.loadingStateShown===C.FolderPickerLoadingState.ERROR)return null;var a=e-C.PATH_BREADCRUMB_HEIGHT-(this.state.folderSuggestion?C.FOLDER_SUGGESTION_HEIGHT:0);return s.default.createElement(_.Table,{columnFlex:[9,1],className:"folder-picker-table",ref:this.setTableRef,role:"presentation"},s.default.createElement(_.TableHead,null,s.default.createElement(g.TableHeadCell,{className:"folder-picker__breadcrumbs"},s.default.createElement(w.PathBreadcrumbs,{firstBreadcrumbName:t,firstBreadcrumbAlt:t,getUrlForPath:this.getUrlForBreadcrumb,setUrl:this.handleBreadcrumbClick,path:n,size:w.PathBreadcrumbsSize.SMALL}))),s.default.createElement(_.TableBody,{tabIndex:0,role:"listbox","aria-activedescendant":"folder_picker_row_"+r,className:"folder-picker-view",style:{height:a},onFocus:this.setupKeyboardShortcuts,onBlur:this.cleanupKeyboardShortcuts},this.renderLoadingMessage(),this.renderFolders(),this.renderEmptyMessage()))},t.prototype.render=function(){var e=this;return s.default.createElement(c.Dimensions,{className:"folder-picker-container"},(function(t){var o=t.height;return s.default.createElement("div",{className:"folder-picker"},e.renderErrorMessage(),e.renderFolderSuggestion(),e.renderTable(o))}))},t.defaultProps={initialPath:"/",onSuccess:r.noop,onError:r.noop,onDataLoaded:r.noop,onRowClicked:r.noop,onBreadcrumbClicked:r.noop,onFetchFolderSuggestionSuccess:r.noop,onFolderSuggestionClick:r.noop,onFolderSuggestionLocationClick:r.noop},t.displayName="FolderPickerWithoutCSS",t})(s.default.Component);t.FolderPicker=E.requireCssWithComponent(A,["/static/css/browse/browse-vflZDvS0a.css","/static/css/react/folder_picker-vflqf-mgm.css","/static/css/scooter/scooter-scoped-vflpl9JSl.css","/static/css/dig-components/index.web-vflfsfj-g.css"])})),define("modules/clean/react/folder_dialog/folder_dialog",["require","exports","tslib","react","dig-components/buttons","dig-components/typography","dig-components/modal","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/folder_dialog/api","modules/clean/react/folder_dialog/folder_picker","modules/clean/ux_analytics/utils","modules/clean/viewer","modules/clean/web_modal_activity_logger","modules/clean/web_timing_logger","modules/core/i18n"],(function(e,t,o,n,r,a,s,i,l,c,d,u,f,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FolderDialog=void 0,n=o.__importDefault(n),m=o.__importStar(m);var g=(function(e){function t(t){var o=e.call(this,t)||this;return o.close=function(){o.setState({isOpen:!1}),d.dispatchModalClosed()},o.handleError=function(e){o.logger.log(i.ModalEventName.ERROR,{error:e.message}),o.props.onError(e)},o.handleSuccess=function(){void 0!==o.state.path&&(o.logger.log(i.ModalEventName.SUCCESS),o.props.onSuccess(o.state.path,o.state.nsid),o.close())},o.handleCancel=function(){o.props.onCancel(),o.close()},o.handleDataLoaded=function(e){o.logger.log(i.ModalEventName.DATA_LOADED,{path:e})},o.handleBreadcrumbClicked=function(e){o.logger.log(i.ModalEventName.BREADCRUMB_CLICKED,{path:e})},o.handleRowClicked=function(e,t,n){o.logger.log(i.ModalEventName.ROW_CLICKED,{path:e,index:t,is_keyboard:n})},o.handleReady=function(){o.logger.log(i.ModalEventName.READY),d.dispatchModalOpened()},o.handleRequestClose=function(){o.logger.log(i.ModalEventName.CLOSE),o.close()},o.handlePrimaryButtonClick=function(e){o.logger.log(i.ModalEventName.PRIMARY_CLICK,{path:e})},o.handleSecondaryButtonClick=function(){o.logger.log(i.ModalEventName.SECONDARY_CLICK)},o.handleFolderSelected=function(e,t){o.setState({path:e,nsid:t})},o.handlePrimaryAction=function(){o.handlePrimaryButtonClick(),o.handleSuccess()},o.handleSecondaryAction=function(){o.handleSecondaryButtonClick(),o.handleCancel()},o.handleTertiaryAction=function(){o.props.handleClickNewFolder&&o.props.handleClickNewFolder(o.state.path)},o.state={isOpen:!0},o}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.logger=new f.WebModalActivityLogger(this.props.modalName),this.logger.log(i.ModalEventName.SHOW)},t.prototype.render=function(){var e=this.props,t=e.title,o=e.user,i=e.initialPath,d=e.canSelectReadonly,f=e.handleClickNewFolder,g=e.useApiV2,p={getFolderContents:this.props.getFolderContents?this.props.getFolderContents:g?l.getFolderContentsAPIv2:l.getFolderContents};return n.default.createElement(s.Modal,{onAfterOpen:this.handleReady,open:this.state.isOpen,onRequestClose:this.handleRequestClose,className:"folder-picker-modal"},n.default.createElement(s.Modal.Header,{hasBottomSpacing:"title-small"},n.default.createElement(a.Title,{size:"small"},t)),n.default.createElement(s.Modal.Body,{className:"folder-picker-container__fixed-height",id:this.props.modalId},n.default.createElement(c.FolderPicker,{apiClient:p,user:o,canSelectReadonly:!!d,rootName:u.Viewer.get_role_title(o)||_.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),onFolderSelected:this.handleFolderSelected,onSuccess:this.handleSuccess,onError:this.handleError,onRowClicked:this.handleRowClicked,onBreadcrumbClicked:this.handleBreadcrumbClicked,onDataLoaded:this.handleDataLoaded,initialPath:i,webTimer:m.get_timer()})),n.default.createElement(s.Modal.Footer,null,f&&n.default.createElement(r.Button,{variant:"transparent",size:"small",onClick:this.handleTertiaryAction},_.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"})),n.default.createElement(r.Button,{variant:"opacity",onClick:this.handleSecondaryAction},_.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),n.default.createElement(r.Button,{variant:"primary",onClick:this.handlePrimaryAction,disabled:void 0===this.state.path},this.props.primaryActionLabel)))},t.defaultProps={onError:function(){},onCancel:function(){}},t.displayName="FolderDialog",t})(n.default.PureComponent);t.FolderDialog=g})),define("modules/clean/react/folder_dialog/move_dialog",["require","exports","tslib","lodash","react","dig-components/buttons","dig-components/modal","dig-components/typography","spectrum/button/index","spectrum/dimensions/index","modules/clean/filepath/filepath","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/components/css","modules/clean/react/folder_dialog/constants","modules/clean/react/folder_dialog/folder_picker","modules/clean/react/folder_dialog/utils","modules/clean/sharing/browse_exports","modules/clean/viewer","modules/core/i18n","modules/clean/react/dropins_v3/shared/search_input","modules/clean/react/dropins_v3/shared/culled_list","modules/clean/react/dropins_v3/shared/item_row","modules/clean/react/dropins_v3/file_browser/loading"],(function(e,t,o,n,r,a,s,i,l,c,d,u,f,m,_,g,p,h,S,v,E,C,b,M,w){"use strict";var F;Object.defineProperty(t,"__esModule",{value:!0}),t.MoveDialog=t.MoveDialogComponent=t.MoverUiState=void 0,n=o.__importStar(n),r=o.__importDefault(r),(function(e){e[e.Browse=1]="Browse",e[e.Search=2]="Search",e[e.SearchLoading=3]="SearchLoading"})(F=t.MoverUiState||(t.MoverUiState={}));var y=(function(e){function t(t){var a=e.call(this,t)||this;return a.handleSuccess=function(){var e=a.state.selectedPath,t=a.state.containedNsID,o=a.state.selectedPredictionId;if(!a.isPrimaryButtonDisabled()){var n=a.props,r=n.onSuccess,s=n.apiClient,i=n.onError;(0,n.onPrimaryButtonClick)(e,o),s.moveToFolder(e,t,a.state.isLockedVaultFolder).then(r,i)}},a.handleCancelClick=function(){var e=a.props,t=e.onCancel;(0,e.onSecondaryButtonClick)(),t()},a.handleFolderSelected=function(e,t,o,n,r){var s=a.props.onFolderSelected;s&&s(e,!!r),a.setState({selectedPath:e,containedNsID:t,selectedPredictionId:o,isLockedVaultFolder:n})},a.shouldShowFolderSuggestion=function(){var e=a.props,t=e.apiClient,o=e.entries,n=e.operation;return!!e.showFolderSuggestion&&!!t.getFolderSuggestion&&(n===g.Operation.COPY||n===g.Operation.MOVE)&&!!o&&o.length>0},a.fetchFolderSuggestion=function(e){return o.__awaiter(a,void 0,void 0,(function(){var t,n,r,a,s,i;return o.__generator(this,(function(o){switch(o.label){case 0:return t=this.props,n=t.apiClient,r=t.entries,a=t.operation,s=r.map((function(e){return e.fq_path})),i=a===g.Operation.MOVE?"MOVE":"COPY",[4,n.getFolderSuggestion(e,s,i)];case 1:return[2,o.sent()]}}))}))},a.handleCreateNewFolderClick=function(){var e=a.state.selectedPath;if(void 0!==e){a.handleCancelClick();var t=a.props.user,o=function(e){a.showMoveDialog(e)},n=function(){a.showMoveDialog(e)};S.asyncShowCdmNewFolderModal({handleCreateFolder:function(r){var a=r.folderName;f.browseActions.createFolderInNewFolderModal({folderName:a,isConfidential:!1,user:t,context:null,redirectOnSuccess:o,redirectOnCancel:n,fqPath:e,selectCreatedFolder:!1,origin:m.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_MOVE_DIALOG})},user:t,context:null,shouldSyncDefault:!1,shouldDisplaySyncSettings:!1,shouldDisplayAudienceInput:!1,redirectOnCancel:n})}},a.showMoveDialog=function(e){var t=a.props,o=t.operation,n=t.user,r=t.apiClient,s=t.entries,i=t.initialFolderSelection,l=t.onSuccess,c=t.onCancel,d=t.showFolderSuggestion,f=t.createNewFolderInMoveDialog,m=t.showMoveDialogOnRedirect;m&&m({operation:o,modalName:o===g.Operation.MOVE?u.ModalName.MOVE:u.ModalName.COPY,user:n,apiClient:r,entries:s,initialFolderSelection:i,onSuccess:l,onCancel:c,showFolderSuggestion:d,createNewFolderInMoveDialog:f,initialFolderSelectionOnRedirect:e})},a.isPrimaryButtonDisabled=function(){return void 0===a.state.selectedPath||a.props.operation===g.Operation.MOVE&&!!n.filter(a.props.entries,(function(e){return"fq_path"in e&&(!(!e.is_dir||a.props.operation!==g.Operation.MOVE||!d.paths_are_equal(e.fq_path,a.state.selectedPath))||d.paths_are_equal(d.parent_dir(e.fq_path),a.state.selectedPath))})).length},a.handleSearchQueryChange=n.debounce((function(e){""===e?a.setState({moverUiState:F.Browse,searchText:e,selectedSearchResult:""}):(a.setState({moverUiState:F.SearchLoading,searchText:e}),a.props.apiClient.search(a.props.user.id,e).then((function(e){a.setState({moverUiState:F.Search,searchResults:e.file_info})})))}),1e3),a.renderSearchResultItem=function(e){var t=a.state.selectedSearchResult===e.fq_path,o=!!e.mount_access_perms&&0===e.mount_access_perms.length;return r.default.createElement("li",{key:e.fq_path,className:"dropins-mover-files-list-item"},r.default.createElement(M.ItemRow,{item:e,selected:t,disabled:o,showPath:!0,onClick:a.handleSearchResultSelected(e)}))},a.state={moverUiState:F.Browse,searchText:"",searchResults:[],selectedSearchResult:""},a}return o.__extends(t,e),t.prototype.handleSearchResultSelected=function(e){var t=this;return function(){t.setState({moverUiState:F.Browse,selectedSearchResult:e.fq_path})}},t.prototype.renderContent=function(){var e=this.props,t=e.user,n=e.initialFolderSelection,a=e.webTimer,s=e.apiClient,i=e.onError,l=e.onDataLoaded,c=e.onBreadcrumbClicked,d=e.onRowClicked,u=e.onFetchFolderSuggestionSuccess,f=e.onFolderSuggestionClick,m=e.onFolderSuggestionLocationClick,_=this.state.moverUiState,g=o.__assign(o.__assign({},s),{fetchFolderSuggestion:this.shouldShowFolderSuggestion()?this.fetchFolderSuggestion:void 0});return _===F.SearchLoading?r.default.createElement("div",{className:"dropins-mover-content"},r.default.createElement("div",{className:"dropins-mover-loading-container"},r.default.createElement(w.Loading,null))):_===F.Search?r.default.createElement(b.CulledList,{containerClassName:"dropins-mover-content",className:"dropins-mover-files-list",items:this.state.searchResults,listItemHeights:this.state.searchResults.map((function(){return 60})),renderRow:this.renderSearchResultItem,webTimer:a}):r.default.createElement(p.FolderPicker,{user:t,apiClient:g,webTimer:a,initialPath:this.state.selectedSearchResult||n,rootName:v.Viewer.get_role_title(t)||E.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),canSelectReadonly:!1,onFolderSelected:this.handleFolderSelected,onSuccess:this.handleSuccess,onError:i,showFolderSuggestion:this.shouldShowFolderSuggestion(),onFetchFolderSuggestionSuccess:u,onFolderSuggestionClick:f,onFolderSuggestionLocationClick:m,onDataLoaded:l,onBreadcrumbClicked:c,onRowClicked:d})},t.prototype.render=function(){var e=this,t=this.props,o=t.apiClient,n=t.entries,d=t.operation,u=t.modalTitle,f=t.createNewFolderInMoveDialog,m=t.showFoldersOnly,_=t.useDigModal,p=t.showSearchBar,S=this.state.selectedPath;if(_)return r.default.createElement(r.default.Fragment,null,!m&&r.default.createElement(s.Modal.Header,{hasBottomSpacing:"title-small"},r.default.createElement(i.Title,{size:"small"},h.createFolderPickerDialogTitle(n,d,u))),r.default.createElement(s.Modal.Body,{className:"folder-picker-container__fixed-height uxa-modal",id:this.props.modalId},this.renderContent()),!m&&r.default.createElement(s.Modal.Footer,null,f&&void 0!==S?r.default.createElement(a.Button,{onClick:this.handleCreateNewFolderClick,variant:"transparent",size:"small",id:"create-new-folder"},E.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"})):null,r.default.createElement(a.Button,{variant:"opacity",onClick:this.handleCancelClick},E.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),r.default.createElement(a.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},h.createFolderPickerDialogButtonLabel(d))));var v=r.default.createElement("div",{key:"header",className:"move_dialog-header mc-util-modal-header"},h.createFolderPickerDialogTitle(n,d,u)),b=r.default.createElement("div",{key:"footer",className:"move_dialog-actions mc-util-modal-actions"},f&&void 0!==S?r.default.createElement("div",null,r.default.createElement("a",{role:"button",href:"#",onClick:this.handleCreateNewFolderClick,id:"create-new-folder"},E.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"}))):r.default.createElement("div",null),r.default.createElement("div",{className:"mc-util-modal-actions-buttons"},r.default.createElement(l.Button,{variant:"secondary",onClick:this.handleCancelClick},E.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),r.default.createElement(l.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},h.createFolderPickerDialogButtonLabel(d))));return r.default.createElement(c.Dimensions,{className:"move_dialog mc-util-modal"},(function(t){var n=t.height;return[m?null:v,p&&o.search?r.default.createElement("div",{key:"search-input",className:"dropins-mover-search-input-container"},r.default.createElement(C.SearchInput,{onQueryChange:e.handleSearchQueryChange})):null,n&&r.default.createElement("div",{key:"body",className:"move_dialog-body mc-util-modal-body",style:{height:n-(g.DIALOG_HEAD_HEIGHT+g.DIALOG_ACTIONS_HEIGHT+g.DIALOG_BODY_PADDING)}},e.renderContent()),m?null:b]}))},t.defaultProps={onPrimaryButtonClick:n.noop,onSecondaryButtonClick:n.noop,onError:n.noop,showFoldersOnly:!1,showSearchBar:!1},t.displayName="MoveDialogComponent",t})(r.default.Component);t.MoveDialogComponent=y,t.MoveDialog=_.requireCssWithComponent(y,["/static/css/react/move_dialog-vflt84lSc.css"])})),define("modules/clean/react/folder_dialog/utils",["require","exports","modules/core/i18n","modules/clean/react/folder_dialog/constants","modules/clean/filepath/filepath"],(function(e,t,o,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialFolderSelection=t.getModalId=t.createFolderPickerDialogButtonLabel=t.createFolderPickerDialogTitle=void 0,t.createFolderPickerDialogTitle=function(e,t,r){if(void 0!==r)return r;if(!e||0===e.length){if(t===n.Operation.MOVE)return o.intl.formatMessage({id:"wKPvYZ",defaultMessage:"Move to…"});if(t===n.Operation.COPY)return o.intl.formatMessage({id:"TCTlqi",defaultMessage:"Copy to…"});if(t===n.Operation.UPLOAD)return o.intl.formatMessage({id:"dMKLu2",defaultMessage:"Upload to…"});if(t===n.Operation.EXPORT_LEGAL_HOLD)return o.intl.formatMessage({id:"ra1icr",defaultMessage:"Export to…"})}var a="",s=e?e.length:0;return t===n.Operation.MOVE?a=o.intl.formatMessage({id:"qeRA7T",defaultMessage:"{count, plural, one{Move {count} item to…} other{Move {count} items to…}}"},{count:s}):t===n.Operation.COPY?a=o.intl.formatMessage({id:"N4rDe0",defaultMessage:"{count, plural, one{Copy {count} item to…} other{Copy {count} items to…}}"},{count:s}):t===n.Operation.UPLOAD&&(a=o.intl.formatMessage({id:"bWKJBF",defaultMessage:"{count, plural, one{Upload {count} item to…} other{Upload {count} items to…}}"},{count:s})),a},t.createFolderPickerDialogButtonLabel=function(e){return e===n.Operation.COPY?o.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"}):e===n.Operation.EXPORT_LEGAL_HOLD?o.intl.formatMessage({id:"8+T625",defaultMessage:"Export"}):o.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})},t.getModalId=function(e){switch(e){case n.Operation.MOVE:return"move-fileops-modal";case n.Operation.COPY:return"copy-fileops-modal";case n.Operation.UPLOAD:return"upload-fileops-modal";default:return""}},t.getInitialFolderSelection=function(e,t,o){if(void 0!==o)return o;if(e&&0!==e.length){for(var n=r.parent_dir(e[0].fq_path),a=e.length,s=1;s<a;s++)if(n!==r.parent_dir(e[s].fq_path))return t;return n}return t}})),define("modules/clean/react/dropins_v3/mover/api_client",["require","exports","tslib","modules/clean/react/dropins_v3/shared/user_friendly_error","modules/clean/react/fileops_actions","modules/clean/cloud_docs/utils","modules/clean/react/dropins_v3/shared/ajax_error"],(function(e,t,o,n,r,a,s){"use strict";function i(e){return void 0!==e.cloud_doc_id}function l(e){return void 0!==e.id}function c(){return o.__awaiter(this,void 0,Promise,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,o){e(["api_v2/user_client"],t,o)})).then(o.__importStar)];case 1:return[2,(new(0,t.sent().UserApiV2Client)).ns("cloud_docs")]}}))}))}function d(){return o.__awaiter(this,void 0,Promise,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,o){e(["api_v2/user_client"],t,o)})).then(o.__importStar)];case 1:return[2,(new(0,t.sent().UserApiV2Client)).ns("files")]}}))}))}function u(e,t,n){return Promise.all(t.map((function(t){return(function(e,t,n){return o.__awaiter(this,void 0,Promise,(function(){var r;return o.__generator(this,(function(o){switch(o.label){case 0:return r=a.replaceInvalidFilenameChars(t.name),[4,c()];case 1:return[2,o.sent().rpc("alpha/dropin_move",{cloud_doc_id:t.cloud_doc_id,to_path:n+"/"+r},{subjectUserId:e.id})]}}))}))})(e,t,n)})))}function f(e,t,a){return o.__awaiter(this,void 0,Promise,(function(){var s,i;return o.__generator(this,(function(l){switch(l.label){case 0:return 0===t.length?[2,Promise.resolve([])]:[4,(function(e,t){return o.__awaiter(this,void 0,Promise,(function(){var n;return o.__generator(this,(function(o){switch(o.label){case 0:return n={"Dropbox-API-Path-Root":'{".tag": "root", "root": "'+e.root_ns_id+'"}'},[4,d()];case 1:return[2,o.sent().rpc("get_metadata_batch",{paths:t.map((function(e){return e.id}))},{subjectUserId:e.id,headers:n})]}}))}))})(e,t).then((function(e){return e.entries.map((function(e,o){if(void 0!==e.path_lower)return{fq_path:e.path_lower,is_dir:t[o].is_dir};throw new n.UserFriendlyError("path_lower is undefined","Oops! Seems like the file does not exist!")}))}))];case 1:return s=l.sent(),i={user:e,path:"",files:s,newPath:a,checkFSWs:!0},[2,new Promise((function(e,t){r.moveFiles_LEGACY(o.__assign(o.__assign({},i),{onSuccess:e,onRequestNotSent:t}))}))]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.search=t.moveEntriesToFolder=t.entryIsFile=t.entryIsCloudDoc=void 0,r=o.__importStar(r),t.entryIsCloudDoc=i,t.entryIsFile=l,t.moveEntriesToFolder=function(e,t,o){var n=t.filter((function(e){return i(e)})),r=t.filter((function(e){return l(e)}));return Promise.all([u(e,n,o),f(e,r,o)]).then((function(){}))},t.search=function(t,n){return(function(t,n){return o.__awaiter(this,void 0,Promise,(function(){var r;return o.__generator(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(t,o){e(["modules/clean/deprecated_ajax/ajax_jquery"],t,o)})).then(o.__importStar)];case 1:return r=a.sent(),[2,new Promise((function(e,o){r.WebRequest({url:"/dropins/search",data:{query:n,include_files:!1},subject_user:t,success:e,error:function(e,t,n){o(n)}})})).then(JSON.parse,(function(e){return Promise.reject(new s.AjaxError(e))}))]}}))}))})(t,n)}})),define("modules/clean/react/dropins_v3/mover/host_site",["require","exports","tslib","modules/clean/react/dropins_v3/shared/host_site"],(function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostSite=void 0;var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.onSuccess=function(){this.sendMessage("success"),this.closeDialog()},t.prototype.onCancel=function(){this.sendMessage("cancel"),this.closeDialog()},t.prototype.onError=function(e){this.sendMessage("error",e.message),this.closeDialog()},t.prototype.onFolderSelected=function(e){this.sendMessage("folder_selected",{path:e})},t})(n.BaseHostSite);t.HostSite=r})),define("modules/clean/react/dropins_v3/mover/mover_page",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/folder_dialog/api","modules/clean/react/dropins_v3/mover/api_client","modules/clean/react/dropins_v3/mover/host_site","modules/clean/web_timing_logger","modules/core/notify","modules/clean/react/dropins_v3/mover/mover_parent","modules/clean/react/dropins_v3/shared/vortex_logger","modules/clean/react/dropins_v3/shared/timeout","modules/clean/viewer"],(function(e,t,o,n,r,a,s,i,l,c,d,u,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverPage=void 0;var _=(function(e){function t(t){var o=e.call(this,t)||this;return o.state={accountId:t.accountId,initialFolderSelection:t.initialFolderSelection,entries:null,showFoldersOnly:!!t.showFoldersOnly,showSearchBar:!!t.showSearchBar},o.vortexLogger=new u.VortexLogger(t.appKey,t.statPrefix),o.hostSite=new i.HostSite(t.origin,c.Notify),o.hostSite.listen({onState:function(e){return o.setState(e)},onClose:function(){return window.close()}}),o.hostSite.ready(),o}return o.__extends(t,e),t.prototype.render=function(){var e={moveEntriesToFolder:s.moveEntriesToFolder,getFolderContents:a.getFolderContents,search:s.search};return n.default.createElement("div",{className:"dropins-mover-page"},n.default.createElement(d.MoverParent,{viewer:m.Viewer.get_viewer(),hostSite:this.hostSite,apiClient:e,webTimer:l.get_timer(),vortexLogger:this.vortexLogger,timeout:f.timeout,accountId:this.state.accountId,entries:this.state.entries,initialFolderSelection:this.state.initialFolderSelection,showFoldersOnly:this.state.showFoldersOnly,showSearchBar:this.state.showSearchBar}))},t.displayName="MoverPage",t})((n=o.__importDefault(n)).default.Component);t.MoverPage=r.requireCssWithComponent(_,["/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/css/foundation-vfl4TNsHm.css","/static/css/notify-vflZVEumu.css"])})),define("modules/clean/react/dropins_v3/mover/mover_parent",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/dropins_v3/shared/vortex_logger","modules/clean/react/folder_dialog/move_dialog","modules/clean/react/folder_dialog/constants","modules/clean/react/dropins_v3/mover/api_client"],(function(e,t,o,n,r,a,s,i,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverParent=void 0;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSuccess=function(){var e=t.props,o=e.hostSite,n=e.timeout,r=e.vortexLogger;a.logRateBeforeCallback(r,n,"move_success",(function(){o.onSuccess()}))},t.handleCancel=function(){var e=t.props,o=e.hostSite,n=e.timeout,r=e.vortexLogger;a.logRateBeforeCallback(r,n,"move_cancel",(function(){o.onCancel()}))},t.handleError=function(e){var o=t.props,n=o.hostSite,r=o.timeout,s=o.vortexLogger;a.logRateBeforeCallback(s,r,"move_error",(function(){n.onError(e)}))},t.handleFolderSelected=function(e,o){var n=t.props,r=n.hostSite,s=n.timeout,i=n.vortexLogger;o||a.logRateBeforeCallback(i,s,"move_folder_selection",(function(){r.onFolderSelected(e)}))},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.webTimer.waitForTTI().then((function(){e.props.vortexLogger&&e.props.vortexLogger.logRate("page_start",1)}))},t.prototype.getDialogProps=function(e){var t=this.props,o=t.apiClient,n=t.entries,r=t.showFoldersOnly,a=t.initialFolderSelection,s=t.webTimer,c=t.showSearchBar,d=n&&n.map((function(e){return l.entryIsCloudDoc(e)?{is_dir:!1}:{is_dir:e.is_dir}})),u={getFolderContents:o.getFolderContents,moveToFolder:function(){return Promise.resolve()},search:o.search};if(n&&n.length>0){var f=n;u.moveToFolder=function(t){return o.moveEntriesToFolder(e,f,t)}}return{apiClient:u,user:e,initialFolderSelection:a,operation:i.Operation.MOVE,entries:d,webTimer:s,onSuccess:this.handleSuccess,onCancel:this.handleCancel,onError:this.handleError,onFolderSelected:this.handleFolderSelected,showFoldersOnly:r,showSearchBar:c}},t.prototype.render=function(){var e=this.props,t=e.accountId,r=e.hostSite,a=e.viewer,i=(function(e){if("string"!=typeof e.accountId)return new Error("accountId must be provided, and it must be a string");if(null!==e.entries){if(!(e.entries instanceof Array))return new Error("entries must be provided, and they must be an array");for(var t=0,o=e.entries;t<o.length;t++){var n=o[t];if(l.entryIsCloudDoc(n)){if("string"!=typeof n.cloud_doc_id)return new Error("cloud doc must have a cloud_doc_id of type string");if("string"!=typeof n.name)return new Error("cloud doc must have a name of type string")}else{if(!l.entryIsFile(n))return new Error("entry must be a file with field id or cloud doc with field cloud_doc_id");if("string"!=typeof n.id)return new Error("entry must have an id of type string");if("boolean"!=typeof n.is_dir)return new Error("file must have field is_dir of type boolean")}}}if("string"!=typeof e.initialFolderSelection)return new Error("initialFolderSelection must be provided, and it must be a string");return null})(this.props);if(i)return this.props.hostSite.onError(i),null;var c=(function(e,t){for(var o=t.get_users(!1),n=0,r=o;n<r.length;n++){var a=r[n];if(e===a.account_id)return a}return null})(t,a);return c?n.default.createElement("div",{className:"dropins-mover-parent"},n.default.createElement(s.MoveDialog,o.__assign({},this.getDialogProps(c)))):(r.onError(new Error("user with given accountId is not logged in")),null)},t.displayName="Mover",t})((n=o.__importDefault(n)).default.Component);t.MoverParent=r.requireCssWithComponent(c,["/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/css/foundation-vfl4TNsHm.css","/static/css/notify-vflZVEumu.css"])})),define("modules/clean/avatar/list",["require","exports","tslib","classnames","react","modules/clean/avatar/overflow_count_pill","modules/clean/react/components/css"],(function(e,t,o,n,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o.__importDefault(n),r=o.__importDefault(r),a=o.__importDefault(a);var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._defaultRenderOverflowCount=function(e){var o=e.overflowCount;return r.default.createElement(a.default,{count:o,dimension:t.props.avatarDimension,key:"overflow_pill:"+o,onClick:t.props.onOverflowCountClick})},t.getClassName=function(){return n.default(["horizontal-avatar-list",t.props.className,t.props.animation?["animation","is-animated"]:null])},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.avatars,t=this.props.maxVisible,o=0;if(this.props.undisplayableCount&&(o+=this.props.undisplayableCount),(this.props.undisplayableCount||e.length>t)&&(t--,o+=e.length-t,e=e.slice(0,t)),o){var n=null!=this.props.overflowCountRenderer?this.props.overflowCountRenderer:this._defaultRenderOverflowCount;e.push(n({overflowCount:o,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onOverflowCountClick,titleButtonDirection:"south"}}))}return r.default.createElement("div",{className:"c-facepile"},r.default.createElement("div",{className:this.getClassName()},e))},t.displayName="HorizontalAvatarList",t.defaultProps={className:""},t})(r.default.Component);t.default=s.requireCssWithComponent(i,["/static/css/avatar_list-vflw5ujnY.css"])})),define("modules/clean/sharing/avatar_info",["require","exports","tslib","modules/core/user_i18n"],(function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiInviteeMemberToAvatarInfo=t.apiGroupMemberToAvatarInfo=t.apiUserMemberToAvatarInfo=void 0,n=o.__importStar(n);var r=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}};t.apiUserMemberToAvatarInfo=function(e){var t=e.displayName()||"",o=e.email()||"";return{access_type:r(e.access_type),display_name:t,familiar_name:null!=e.account?e.account.familiar_name:void 0,initials:null!=e.initials?e.initials:n.getInitials(t),photo_url:null!=e.account?e.account.profile_photo_url:void 0,user_id:e.memberId(),email:o,account_id:e.account_id,is_inherited:e.is_inherited,same_team:e.same_team}},t.apiGroupMemberToAvatarInfo=function(e){return{access_type:r(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count,is_inherited:e.is_inherited}},t.apiInviteeMemberToAvatarInfo=function(e){return{access_type:r(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName(),is_inherited:e.is_inherited}}})),define("modules/clean/web_modal_activity_logger",["require","exports","tslib","modules/clean/logging/telemetry","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/search/store_helpers"],(function(e,t,o,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebModalActivityLogger=void 0,n=o.__importStar(n);var s=(function(){function e(e){this.modalName=e,this.modalSessionId=a.generateRandomId(),this.logger=new n.HiveLogger}return e.prototype.log=function(e,t){this.logger.log(new r.WebModalActivityRow(o.__assign({modal_name:this.modalName,modal_session_id:this.modalSessionId,event_name:e},t)))},e})();t.WebModalActivityLogger=s})),define("modules/clean/react/folder_overview/placeholder",["require","exports","tslib","react","spectrum/button/index","modules/clean/react/folder_overview/constants"],(function(e,t,o,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedFolderOverviewPlaceholder=t.FolderOverviewPlaceholderExample=t.FolderOverviewPlaceholder=void 0,n=o.__importDefault(n),t.FolderOverviewPlaceholder=function(e){if(e.isReadOnly&&e.isInRightRail)return null;var o=e.isReadOnly?a.DESCRIPTION_PLACEHOLDER_READ_ONLY:e.isInRightRail?a.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL:e.isSpace?a.DESCRIPTION_PLACEHOLDER_FOR_SPACE:a.DESCRIPTION_PLACEHOLDER;return n.default.createElement("div",{className:"folder-overview__description--placeholder",onClick:e.onClick},n.default.createElement("span",null,o),e.showExamples&&n.default.createElement(t.FolderOverviewPlaceholderExample,{showExamplesAsButton:e.showExamplesAsButton,onExampleButtonClick:e.onExampleButtonClick}))},t.FolderOverviewPlaceholder.displayName="FolderOverviewPlaceholder",t.FolderOverviewPlaceholderExample=function(e){return e.showExamplesAsButton?n.default.createElement(r.Button,{"aria-label":a.FOLDER_EXAMPLES_LINK_LABEL,onClick:e.onExampleButtonClick,className:"folder_overview__examples-button",variant:"secondary"},a.DESCRIPTION_PLACEHOLDER_EXAMPLES_BUTTON):n.default.createElement("a",{"aria-label":a.FOLDER_EXAMPLES_LINK_LABEL,href:a.FOLDER_EXAMPLES_LINK_URI,target:"_blank",rel:"noreferrer"},a.DESCRIPTION_PLACEHOLDER_EXAMPLES_BUTTON)},t.FolderOverviewPlaceholderExample.displayName="FolderOverviewPlaceholderExample",t.WrappedFolderOverviewPlaceholder=function(e){return n.default.createElement("div",{className:"folder-overview__description folder-overview__placeholder folder-overview__fixed-toolbar"},n.default.createElement(t.FolderOverviewPlaceholder,{showExamples:e.showExamples,isReadOnly:e.isReadOnly,showExamplesAsButton:e.showExamplesAsButton,onClick:e.onClick}))},t.WrappedFolderOverviewPlaceholder.displayName="WrappedFolderOverviewPlaceholder"}));
//# sourceMappingURL=pkg-mover.min.js-vfl4Li4Hf.map