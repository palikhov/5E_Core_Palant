define("dropbox/proto/js_init_data/chat/chat",["require","exports","tslib","protobufjs/minimal"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.chat=void 0;var i,o,r,s=(n=a.__importStar(n)).Reader,c=n.Writer,p=n.util,u=n.roots.default||(n.roots.default={});t.default=u,t.chat=u.chat=((i=u.chat||{}).ChatProviderType=(o={},(r=Object.create(o))[o[0]="SNAPENGAGE"]=0,r[o[1]="DIALOGUE_CHAT"]=1,r),i.ProactiveMessageType=(function(){var e={},t=Object.create(e);return t[e[0]="DEFAULT"]=0,t[e[1]="MINIMIZED_PROACTIVE"]=1,t})(),i.ChatInitialState=(function(){var e={},t=Object.create(e);return t[e[0]="HIDDEN"]=0,t[e[1]="SHOW_PROVIDER_REACTIVE_BUTTON"]=1,t})(),i.ChatMetadata=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.cookieDomain="",e.prototype.cookieCampaignName="",e.prototype.legacyCookieCampaignName="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.cookieDomain&&Object.hasOwnProperty.call(e,"cookieDomain")&&t.uint32(10).string(e.cookieDomain),null!=e.cookieCampaignName&&Object.hasOwnProperty.call(e,"cookieCampaignName")&&t.uint32(18).string(e.cookieCampaignName),null!=e.legacyCookieCampaignName&&Object.hasOwnProperty.call(e,"legacyCookieCampaignName")&&t.uint32(26).string(e.legacyCookieCampaignName),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.ChatMetadata;e.pos<a;){var i=e.uint32();switch(i>>>3){case 1:n.cookieDomain=e.string();break;case 2:n.cookieCampaignName=e.string();break;case 3:n.legacyCookieCampaignName=e.string();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.ChatMetadata"},e})(i.ChatMetadata||{}),i.SnapengageChatMetadata=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.snapengageIframeOrigin="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.snapengageIframeOrigin&&Object.hasOwnProperty.call(e,"snapengageIframeOrigin")&&t.uint32(34).string(e.snapengageIframeOrigin),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.SnapengageChatMetadata;e.pos<a;){var i=e.uint32();switch(i>>>3){case 4:n.snapengageIframeOrigin=e.string();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.SnapengageChatMetadata"},e})(i.SnapengageChatMetadata||{}),i.UserProperties=(function(e){function e(e){if(this.pricings=[],this.experiments={},e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.chatHmac="",e.prototype.email="",e.prototype.firstName="",e.prototype.lastName="",e.prototype.pageLoadTs="",e.prototype.pricings=p.emptyArray,e.prototype.sessionId="",e.prototype.userId="",e.prototype.serviceTier="",e.prototype.experiments=p.emptyObject,e.prototype.locale="",e.prototype.countryCode="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=c.create()),null!=e.chatHmac&&Object.hasOwnProperty.call(e,"chatHmac")&&t.uint32(10).string(e.chatHmac),null!=e.email&&Object.hasOwnProperty.call(e,"email")&&t.uint32(18).string(e.email),null!=e.firstName&&Object.hasOwnProperty.call(e,"firstName")&&t.uint32(26).string(e.firstName),null!=e.lastName&&Object.hasOwnProperty.call(e,"lastName")&&t.uint32(34).string(e.lastName),null!=e.pageLoadTs&&Object.hasOwnProperty.call(e,"pageLoadTs")&&t.uint32(42).string(e.pageLoadTs),null!=e.pricings&&e.pricings.length)for(var a=0;a<e.pricings.length;++a)t.uint32(50).string(e.pricings[a]);if(null!=e.sessionId&&Object.hasOwnProperty.call(e,"sessionId")&&t.uint32(58).string(e.sessionId),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(66).string(e.userId),null!=e.serviceTier&&Object.hasOwnProperty.call(e,"serviceTier")&&t.uint32(74).string(e.serviceTier),null!=e.experiments&&Object.hasOwnProperty.call(e,"experiments")){var n=Object.keys(e.experiments);for(a=0;a<n.length;++a)t.uint32(82).fork().uint32(10).string(n[a]).uint32(18).string(e.experiments[n[a]]).ldelim()}return null!=e.locale&&Object.hasOwnProperty.call(e,"locale")&&t.uint32(90).string(e.locale),null!=e.countryCode&&Object.hasOwnProperty.call(e,"countryCode")&&t.uint32(98).string(e.countryCode),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a,n,i=void 0===t?e.len:e.pos+t,o=new u.chat.UserProperties;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:o.chatHmac=e.string();break;case 2:o.email=e.string();break;case 3:o.firstName=e.string();break;case 4:o.lastName=e.string();break;case 5:o.pageLoadTs=e.string();break;case 6:o.pricings&&o.pricings.length||(o.pricings=[]),o.pricings.push(e.string());break;case 7:o.sessionId=e.string();break;case 8:o.userId=e.string();break;case 9:o.serviceTier=e.string();break;case 10:o.experiments===p.emptyObject&&(o.experiments={});var c=e.uint32()+e.pos;for(a="",n="";e.pos<c;){var d=e.uint32();switch(d>>>3){case 1:a=e.string();break;case 2:n=e.string();break;default:e.skipType(7&d)}}o.experiments[a]=n;break;case 11:o.locale=e.string();break;case 12:o.countryCode=e.string();break;default:e.skipType(7&r)}}return o},e.getTypeUrl=function(){return"type.googleapis.com/chat.UserProperties"},e})(i.UserProperties||{}),i.SnapengageChatSystemSettings=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.widgetId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.widgetId&&Object.hasOwnProperty.call(e,"widgetId")&&t.uint32(10).string(e.widgetId),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.SnapengageChatSystemSettings;e.pos<a;){var i=e.uint32();switch(i>>>3){case 1:n.widgetId=e.string();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.SnapengageChatSystemSettings"},e})(i.SnapengageChatSystemSettings||{}),i.DialogueBotProvider=(function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="LEX"]=1,t[e[2]="RASA"]=2,t})(),i.DialogueBotType=(function(){var e={},t=Object.create(e);return t[e[0]="CX_SUPPORT"]=0,t[e[1]="BUSINESS"]=1,t[e[2]="CX_SPECIALIZED"]=2,t})(),i.DialogueExperiment=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.name="",e.prototype.active=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.name&&Object.hasOwnProperty.call(e,"name")&&t.uint32(10).string(e.name),null!=e.active&&Object.hasOwnProperty.call(e,"active")&&t.uint32(16).bool(e.active),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.DialogueExperiment;e.pos<a;){var i=e.uint32();switch(i>>>3){case 1:n.name=e.string();break;case 2:n.active=e.bool();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.DialogueExperiment"},e})(i.DialogueExperiment||{}),i.DialogueChatSystemSettings=(function(e){function e(e){if(this.experiments=[],e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.botProvider=0,e.prototype.environment="",e.prototype.settingsHmac="",e.prototype.experiments=p.emptyArray,e.prototype.botType=0,e.prototype.proactiveIntent="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=c.create()),null!=e.botProvider&&Object.hasOwnProperty.call(e,"botProvider")&&t.uint32(16).int32(e.botProvider),null!=e.environment&&Object.hasOwnProperty.call(e,"environment")&&t.uint32(26).string(e.environment),null!=e.settingsHmac&&Object.hasOwnProperty.call(e,"settingsHmac")&&t.uint32(34).string(e.settingsHmac),null!=e.experiments&&e.experiments.length)for(var a=0;a<e.experiments.length;++a)u.chat.DialogueExperiment.encode(e.experiments[a],t.uint32(42).fork()).ldelim();return null!=e.botType&&Object.hasOwnProperty.call(e,"botType")&&t.uint32(48).int32(e.botType),null!=e.proactiveIntent&&Object.hasOwnProperty.call(e,"proactiveIntent")&&t.uint32(58).string(e.proactiveIntent),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.DialogueChatSystemSettings;e.pos<a;){var i=e.uint32();switch(i>>>3){case 2:n.botProvider=e.int32();break;case 3:n.environment=e.string();break;case 4:n.settingsHmac=e.string();break;case 5:n.experiments&&n.experiments.length||(n.experiments=[]),n.experiments.push(u.chat.DialogueExperiment.decode(e,e.uint32()));break;case 6:n.botType=e.int32();break;case 7:n.proactiveIntent=e.string();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.DialogueChatSystemSettings"},e})(i.DialogueChatSystemSettings||{}),i.ProactiveSettings=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.proactiveType=0,e.prototype.whenToShowControlledByProvider=!1,e.prototype.secondsUntilShown=0,e.prototype.coolOffPeriodMinutes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.proactiveType&&Object.hasOwnProperty.call(e,"proactiveType")&&t.uint32(8).int32(e.proactiveType),null!=e.whenToShowControlledByProvider&&Object.hasOwnProperty.call(e,"whenToShowControlledByProvider")&&t.uint32(16).bool(e.whenToShowControlledByProvider),null!=e.secondsUntilShown&&Object.hasOwnProperty.call(e,"secondsUntilShown")&&t.uint32(24).uint64(e.secondsUntilShown),null!=e.coolOffPeriodMinutes&&Object.hasOwnProperty.call(e,"coolOffPeriodMinutes")&&t.uint32(32).uint64(e.coolOffPeriodMinutes),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.ProactiveSettings;e.pos<a;){var i=e.uint32();switch(i>>>3){case 1:n.proactiveType=e.int32();break;case 2:n.whenToShowControlledByProvider=e.bool();break;case 3:n.secondsUntilShown=e.uint64();break;case 4:n.coolOffPeriodMinutes=e.uint64();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.ProactiveSettings"},e})(i.ProactiveSettings||{}),i.CampaignResult=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}var t;return e.prototype.campaignId=0,e.prototype.versionId=0,e.prototype.campaignName="",e.prototype.versionName="",e.prototype.snapengageChatSystemSettings=null,e.prototype.dialogueChatSystemSettings=null,e.prototype.mustHaveAvailableAgents=!1,e.prototype.proactiveSettings=null,e.prototype.greetingMessage="",e.prototype.chatInitialState=0,e.prototype.persistenceCookie="",e.prototype.deprecatedExperimentNameToLog="",e.prototype.deprecatedExperimentVariantToLog="",e.prototype.isControl=!1,Object.defineProperty(e.prototype,"systemSettings",{get:p.oneOfGetter(t=["snapengageChatSystemSettings","dialogueChatSystemSettings"]),set:p.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.campaignId&&Object.hasOwnProperty.call(e,"campaignId")&&t.uint32(8).uint64(e.campaignId),null!=e.versionId&&Object.hasOwnProperty.call(e,"versionId")&&t.uint32(16).uint64(e.versionId),null!=e.campaignName&&Object.hasOwnProperty.call(e,"campaignName")&&t.uint32(26).string(e.campaignName),null!=e.versionName&&Object.hasOwnProperty.call(e,"versionName")&&t.uint32(34).string(e.versionName),null!=e.snapengageChatSystemSettings&&Object.hasOwnProperty.call(e,"snapengageChatSystemSettings")&&u.chat.SnapengageChatSystemSettings.encode(e.snapengageChatSystemSettings,t.uint32(42).fork()).ldelim(),null!=e.mustHaveAvailableAgents&&Object.hasOwnProperty.call(e,"mustHaveAvailableAgents")&&t.uint32(48).bool(e.mustHaveAvailableAgents),null!=e.proactiveSettings&&Object.hasOwnProperty.call(e,"proactiveSettings")&&u.chat.ProactiveSettings.encode(e.proactiveSettings,t.uint32(58).fork()).ldelim(),null!=e.greetingMessage&&Object.hasOwnProperty.call(e,"greetingMessage")&&t.uint32(66).string(e.greetingMessage),null!=e.chatInitialState&&Object.hasOwnProperty.call(e,"chatInitialState")&&t.uint32(72).int32(e.chatInitialState),null!=e.persistenceCookie&&Object.hasOwnProperty.call(e,"persistenceCookie")&&t.uint32(82).string(e.persistenceCookie),null!=e.deprecatedExperimentNameToLog&&Object.hasOwnProperty.call(e,"deprecatedExperimentNameToLog")&&t.uint32(90).string(e.deprecatedExperimentNameToLog),null!=e.deprecatedExperimentVariantToLog&&Object.hasOwnProperty.call(e,"deprecatedExperimentVariantToLog")&&t.uint32(98).string(e.deprecatedExperimentVariantToLog),null!=e.isControl&&Object.hasOwnProperty.call(e,"isControl")&&t.uint32(104).bool(e.isControl),null!=e.dialogueChatSystemSettings&&Object.hasOwnProperty.call(e,"dialogueChatSystemSettings")&&u.chat.DialogueChatSystemSettings.encode(e.dialogueChatSystemSettings,t.uint32(114).fork()).ldelim(),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.CampaignResult;e.pos<a;){var i=e.uint32();switch(i>>>3){case 1:n.campaignId=e.uint64();break;case 2:n.versionId=e.uint64();break;case 3:n.campaignName=e.string();break;case 4:n.versionName=e.string();break;case 5:n.snapengageChatSystemSettings=u.chat.SnapengageChatSystemSettings.decode(e,e.uint32());break;case 14:n.dialogueChatSystemSettings=u.chat.DialogueChatSystemSettings.decode(e,e.uint32());break;case 6:n.mustHaveAvailableAgents=e.bool();break;case 7:n.proactiveSettings=u.chat.ProactiveSettings.decode(e,e.uint32());break;case 8:n.greetingMessage=e.string();break;case 9:n.chatInitialState=e.int32();break;case 10:n.persistenceCookie=e.string();break;case 11:n.deprecatedExperimentNameToLog=e.string();break;case 12:n.deprecatedExperimentVariantToLog=e.string();break;case 13:n.isControl=e.bool();break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.CampaignResult"},e})(i.CampaignResult||{}),i.ChatProviderMetadata=(function(e){function e(e){if(e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.snapengage=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=c.create()),null!=e.snapengage&&Object.hasOwnProperty.call(e,"snapengage")&&u.chat.SnapengageChatMetadata.encode(e.snapengage,t.uint32(10).fork()).ldelim(),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a=void 0===t?e.len:e.pos+t,n=new u.chat.ChatProviderMetadata;e.pos<a;){var i=e.uint32();switch(i>>>3){case 1:n.snapengage=u.chat.SnapengageChatMetadata.decode(e,e.uint32());break;default:e.skipType(7&i)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/chat.ChatProviderMetadata"},e})(i.ChatProviderMetadata||{}),i.ChatInitializerProperties=(function(e){function e(e){if(this.featureGates={},e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}var t;return e.prototype.chatMetadata=null,e.prototype.userProperties=null,e.prototype.campaignResult=null,e.prototype.resume=!1,e.prototype.chatProviderType=0,e.prototype.snapengageChatMetadata=null,e.prototype.loggingCorrelationId="",e.prototype.featureGates=p.emptyObject,e.prototype.providerMetadata=null,Object.defineProperty(e.prototype,"chatProviderMetadata",{get:p.oneOfGetter(t=["snapengageChatMetadata"]),set:p.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=c.create()),null!=e.chatMetadata&&Object.hasOwnProperty.call(e,"chatMetadata")&&u.chat.ChatMetadata.encode(e.chatMetadata,t.uint32(10).fork()).ldelim(),null!=e.userProperties&&Object.hasOwnProperty.call(e,"userProperties")&&u.chat.UserProperties.encode(e.userProperties,t.uint32(18).fork()).ldelim(),null!=e.campaignResult&&Object.hasOwnProperty.call(e,"campaignResult")&&u.chat.CampaignResult.encode(e.campaignResult,t.uint32(26).fork()).ldelim(),null!=e.resume&&Object.hasOwnProperty.call(e,"resume")&&t.uint32(32).bool(e.resume),null!=e.chatProviderType&&Object.hasOwnProperty.call(e,"chatProviderType")&&t.uint32(40).int32(e.chatProviderType),null!=e.snapengageChatMetadata&&Object.hasOwnProperty.call(e,"snapengageChatMetadata")&&u.chat.SnapengageChatMetadata.encode(e.snapengageChatMetadata,t.uint32(50).fork()).ldelim(),null!=e.loggingCorrelationId&&Object.hasOwnProperty.call(e,"loggingCorrelationId")&&t.uint32(58).string(e.loggingCorrelationId),null!=e.featureGates&&Object.hasOwnProperty.call(e,"featureGates"))for(var a=Object.keys(e.featureGates),n=0;n<a.length;++n)t.uint32(66).fork().uint32(10).string(a[n]).uint32(16).bool(e.featureGates[a[n]]).ldelim();return null!=e.providerMetadata&&Object.hasOwnProperty.call(e,"providerMetadata")&&u.chat.ChatProviderMetadata.encode(e.providerMetadata,t.uint32(74).fork()).ldelim(),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var a,n,i=void 0===t?e.len:e.pos+t,o=new u.chat.ChatInitializerProperties;e.pos<i;){var r=e.uint32();switch(r>>>3){case 1:o.chatMetadata=u.chat.ChatMetadata.decode(e,e.uint32());break;case 2:o.userProperties=u.chat.UserProperties.decode(e,e.uint32());break;case 3:o.campaignResult=u.chat.CampaignResult.decode(e,e.uint32());break;case 4:o.resume=e.bool();break;case 5:o.chatProviderType=e.int32();break;case 6:o.snapengageChatMetadata=u.chat.SnapengageChatMetadata.decode(e,e.uint32());break;case 7:o.loggingCorrelationId=e.string();break;case 8:o.featureGates===p.emptyObject&&(o.featureGates={});var c=e.uint32()+e.pos;for(a="",n=!1;e.pos<c;){var d=e.uint32();switch(d>>>3){case 1:a=e.string();break;case 2:n=e.bool();break;default:e.skipType(7&d)}}o.featureGates[a]=n;break;case 9:o.providerMetadata=u.chat.ChatProviderMetadata.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},e.getTypeUrl=function(){return"type.googleapis.com/chat.ChatInitializerProperties"},e})(i.ChatInitializerProperties||{}),i)})),define("modules/clean/chat/chat_client",["require","exports","tslib","dropbox/proto/js_init_data/chat/chat","modules/core/cookies","modules/clean/chat/chat_identifier","modules/clean/chat/chat_provider_api","modules/clean/chat/chat_client_api","modules/clean/chat/chat_provider_factory","proto_utils/unpack","modules/core/browser","modules/clean/analytics","modules/clean/amp_web_logger","modules/clean/ncct/manual_assist_util","modules/clean/deprecated_ajax/ajax","modules/clean/stormcrow/stormcrow_exposure_logger","modules/clean/chat/chat_logger_api","modules/clean/chat/chat_logger_factory"],(function(e,t,a,n,i,o,r,s,c,p,u,d,g,l,h,m,C,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moduleInit=t.ChatClientSingleton=t._ChatClientSingleton=t.ChatStartSourceType=void 0,u=a.__importStar(u);var v,f;(function(e){e[e.NOT_SHOWN=0]="NOT_SHOWN",e[e.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD=1]="TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD",e[e.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE=2]="TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE",e[e.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON=3]="REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON",e[e.SHOWING_PROVIDER_REACTIVE_BUTTON=4]="SHOWING_PROVIDER_REACTIVE_BUTTON",e[e.SHOWING_CHAT=5]="SHOWING_CHAT",e[e.TO_START_ON_LOAD=6]="TO_START_ON_LOAD",e[e.TO_START_ON_AGENT_STATUS_UPDATE=7]="TO_START_ON_AGENT_STATUS_UPDATE",e[e.REQUESTED_PROVIDER_TO_START_CHAT=8]="REQUESTED_PROVIDER_TO_START_CHAT",e[e.CHAT_ONGOING=9]="CHAT_ONGOING"})(v||(v={})),(function(e){e[e.REACTIVE=0]="REACTIVE",e[e.PROACTIVE=1]="PROACTIVE",e[e.RESUME=2]="RESUME",e[e.TRANSFER=3]="TRANSFER",e[e.PROVIDER_DRIVEN_PROACTIVE=4]="PROVIDER_DRIVEN_PROACTIVE"})(f=t.ChatStartSourceType||(t.ChatStartSourceType={}));var S=(function(e){function t(t,a,s){var c=e.call(this,t,a)||this;return c.setupChatEnvironment=function(e){if(!c._isSetup&&(e.featureGates.enable_vortex_logger&&(c.logger=c.loggerFactory.getChatLogger(C.LoggerType.HIVE_VORTEX_COMBO)),c.shouldAllowChat())){if(c.initProperties=e,c.setupTime=new Date,c.hasFirstLoadOccured=!1,c.state={lifecycleState:v.NOT_SHOWN,hasShownAChat:!1,interactedWithChat:!1,cookieBannerState:{isVisible:!1,height:0}},!e.chatMetadata)throw new Error("Did not provide chat metadata.");if(c.metadata=e.chatMetadata,!e.userProperties)throw new Error("Did not provide user properties.");var t=c.getChatProviderMetadata(e),a=e.campaignResult;if(c.setupProvider(a,t,e.userProperties,e.chatProviderType),a&&a.isControl)c.setupControlLogging(a);else{var i=a&&a.chatInitialState===n.chat.ChatInitialState.SHOW_PROVIDER_REACTIVE_BUTTON;if(e.resume){var r=c.chatCampaignWrapper||c.defaultChatWrapper;c.deprecatedLogChatAction("chat_persistence",o.getSnapengageWidgetId(r.chatCampaign)),c.intializeStartingChat(r,f.RESUME)}else c.setupProactivePropertiesIfNeeded(),i&&(c.attemptToShowProviderReactiveChatButton(),c.deprecatedMaybeLogExperiment(a))}window.addEventListener("beforeunload",(function(){c.maybeLogImpressionFailedOnUnload()}))}},c.startReactiveChat=function(){if(c.logEvent(C.ChatEvent.CLICK,{source:"startReactiveChat"}),c.shouldAllowChat()){if(c.logAndRaiseIfNotSetup(),c.canStartChat()){var e=c.chatCampaignWrapper,t=e&&o.isCampaignResult(e.chatCampaign)&&e.chatCampaign.isControl;if(!c.chatCampaignWrapper||t)return e=c.defaultChatWrapper,c.deprecatedLogChatAction("chat_initiated",o.getSnapengageWidgetId(e.chatCampaign)),void c.intializeStartingChat(e,f.REACTIVE);c.deprecatedLogChatAction("chat_initiated",o.getSnapengageWidgetId(e.chatCampaign)),c.intializeStartingChat(c.chatCampaignWrapper,f.REACTIVE)}}else c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.CHAT_IS_NOT_ALLOWED})},c.startSupportChat=function(e){c.logEvent(C.ChatEvent.CLICK,{source:"startSupportChat",widgetOverride:e}),c.shouldAllowChat()?(c.logAndRaiseIfNotSetup(),c.canStartChat()&&(c.supportChatWrapper={chatCampaign:e,chatCampaignState:c.getInitialChatCampaignState()},l.isNCCTChat(e)&&h.WebRequest({url:"/team/admin/engaged_chat",data:{chatId:e}}),c.deprecatedLogChatAction("support_chat_initiated",e),c.intializeStartingChat(c.supportChatWrapper,f.REACTIVE))):c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.CHAT_IS_NOT_ALLOWED,widgetOverride:e})},c.isSetup=function(){return c._isSetup},c.setCookieBannerInfo=function(e,t){c.state.cookieBannerState={isVisible:e,height:t},c.adjustProviderMarginOnStateChange()},c.adjustProviderMarginOnStateChange=function(){c.state.cookieBannerState.isVisible?c.state.lifecycleState===v.CHAT_ONGOING||c.state.lifecycleState===v.SHOWING_CHAT?c.provider.removeBottomMargin():c.provider.addBottomMargin(c.state.cookieBannerState.height):c.provider.removeBottomMargin()},c.modifyLifecycleState=function(e){c.state.lifecycleState=e,c.adjustProviderMarginOnStateChange()},c.logAndRaiseIfNotSetup=function(){if(!c._isSetup)throw c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.CHAT_IS_NOT_INITIALIZED}),c.logError(C.ErrorType.ATTEMPT_TO_START_UNINITIALIZED_CHAT),new Error("Started chat without being initialized")},c.setupProvider=function(e,t,a,n){var i={chatCampaign:e,metadata:t,userProperties:a,onAgentStatusUpdate:c.onAgentStatusUpdate,onChatLoadStatusUpdate:c.onChatLoadStatusUpdate,onChatShown:c.onChatShown,onChatStarted:c.onChatStarted,onChatClosed:c.onChatClosed,onChatMinimized:c.onChatMinimized,onChatMaximized:c.onChatMaximized,onProviderDrivenOpenProactive:c.onProviderDrivenOpenProactive,onProviderReactiveButtonShown:c.onProviderReactiveButtonShown,onSwitchProviderWithNewCampaign:c.onSwitchProviderWithNewCampaign};e&&(c.chatCampaignWrapper={chatCampaign:e,chatCampaignState:c.getInitialChatCampaignState()}),c.provider=c.getChatProvider(n,i),c.defaultChatWrapper={chatCampaign:c.provider.getDefaultChatIdentifier(),chatCampaignState:c.getInitialChatCampaignState()},c._isSetup=!0},c.attemptToShowProviderReactiveChatButton=function(){var e=c.chatCampaignWrapper;e&&o.isCampaignResult(e.chatCampaign)&&(c.state.campaign=e.chatCampaign,c.state.source_type=f.REACTIVE,e.chatCampaignState.isLoaded?o.isCampaignResult(e.chatCampaign)&&e.chatCampaign.mustHaveAvailableAgents?c.attemptToShowReactiveButtonChatThatMustHaveAgents(e):c.requestProviderToShowProviderReactiveButton():c.requestProviderToLoadChatToShowProviderReactiveButton(e))},c.requestProviderToShowProviderReactiveButton=function(){c.modifyLifecycleState(v.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON),c.provider.showProviderReactiveChatButton();var e=c.chatCampaignWrapper||c.defaultChatWrapper;c.deprecatedLogChatAction("minimized_chat_initiated",o.getSnapengageWidgetId(e.chatCampaign))},c.requestProviderToGetAgentStatusUpdateToShowProviderReactiveButton=function(e){c.modifyLifecycleState(v.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE),c.provider.requestAgentStatusUpdate(e.chatCampaign)},c.requestProviderToLoadChatToShowProviderReactiveButton=function(e){c.modifyLifecycleState(v.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD),c.provider.requestAgentStatusUpdate(e.chatCampaign)},c.canStartChat=function(){var e=c.state.lifecycleState;return e===v.NOT_SHOWN||e===v.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD||e===v.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE||e===v.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON||e===v.SHOWING_PROVIDER_REACTIVE_BUTTON},c.intializeStartingChat=function(e,t){c.state.source_type=t,c.state.campaign=e.chatCampaign,c.attemptToStartChat(e)},c.attemptToStartChat=function(e){var t=c.state.source_type,a=t===f.PROACTIVE||t===f.PROVIDER_DRIVEN_PROACTIVE;e.chatCampaignState.isLoaded?a&&o.isCampaignResult(e.chatCampaign)&&e.chatCampaign.mustHaveAvailableAgents?c.attemptToStartChatThatMustHaveAgents(e,t===f.PROVIDER_DRIVEN_PROACTIVE):t===f.PROVIDER_DRIVEN_PROACTIVE?c.requestProviderToHandleProviderDrivenOpen():c.requestProviderToStartChat(e):c.requestProviderToLoadChatToStartChat(e)},c.requestProviderToHandleProviderDrivenOpen=function(){c.provider.handleProviderDrivenOpen(),c.modifyLifecycleState(v.SHOWING_CHAT)},c.requestProviderToStartChat=function(e){c.modifyLifecycleState(v.REQUESTED_PROVIDER_TO_START_CHAT),c.provider.startChat(e.chatCampaign,c.state.source_type===f.PROACTIVE)},c.requestProviderToGetAgentStatusUpdateToStartChat=function(e){c.modifyLifecycleState(v.TO_START_ON_AGENT_STATUS_UPDATE),c.provider.requestAgentStatusUpdate(e.chatCampaign)},c.setupProactivePropertiesIfNeeded=function(){var e=c.chatCampaignWrapper;if(e&&o.isCampaignResult(e.chatCampaign)){var t=e.chatCampaign,a=t.proactiveSettings;if(a&&!a.whenToShowControlledByProvider&&!t.isControl)if(t.greetingMessage){var n=c.readProactiveChatCooloffCookie();if(n)c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.COOLOFF_PERIOD,debug_info:n},t);else{var i=1e3*a.secondsUntilShown;setTimeout((function(){c.state.hasShownAChat||c.state.campaign&&c.state.campaign!==t?c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.ANOTHER_CHAT_STARTED},t):c.intializeStartingChat(e,f.PROACTIVE)}),i)}}else c.logError(C.ErrorType.ATTEMPT_START_PROACTIVE_CHAT_WITHOUT_MESSAGE)}},c.setupControlLogging=function(e){var t=e.proactiveSettings,a=function(){var t=C.FailedReason.CONTROL_VERSION;c.readProactiveChatCooloffCookie()?t=C.FailedReason.COOLOFF_PERIOD:c.state.campaign&&c.state.campaign!==e?t=C.FailedReason.ANOTHER_CHAT_STARTED:c.chatCampaignWrapper&&c.chatCampaignWrapper.chatCampaignState.agentStatus!==r.AgentStatus.ONLINE&&o.isCampaignResult(c.chatCampaignWrapper.chatCampaign)&&c.chatCampaignWrapper.chatCampaign.mustHaveAvailableAgents&&(t=C.FailedReason.NO_ONLINE_AGENTS),c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:t},e)};if(t){var n=1e3*t.secondsUntilShown;setTimeout(a,n),setTimeout((function(){return c.deprecatedMaybeLogExperiment(e)}),n)}else a()},c.getPersistenceCookie=function(e){return o.isCampaignResult(e)?e.persistenceCookie:"SNAPENGAGE:"+e},c.setChatVisibleCookie=function(e){if(c.metadata){var t=c.getPersistenceCookie(e),a=c.getLegacyCampaignIdentifierToCookieStr(e);a&&i.Cookies.create(c.metadata.legacyCookieCampaignName,a,1,c.metadata.cookieDomain),i.Cookies.create(c.metadata.cookieCampaignName,t,1,c.metadata.cookieDomain)}},c.maybeSetProactiveChatCooloffCookie=function(e,t){if(c.metadata&&e===f.PROACTIVE&&t&&o.isCampaignResult(t.chatCampaign)&&t.chatCampaign.proactiveSettings&&t.chatCampaign.proactiveSettings.coolOffPeriodMinutes){var a=t.chatCampaign,n=(new Date).getTime(),r=a.campaignId+":"+a.versionId+":"+n,s=a.proactiveSettings.coolOffPeriodMinutes/1440;i.Cookies.create("MegaphoneChatCooloff",r,s,c.metadata.cookieDomain)}},c.readProactiveChatCooloffCookie=function(){return i.Cookies.read("MegaphoneChatCooloff")},c.getInitialChatCampaignState=function(){return{isLoaded:!1,agentStatus:r.AgentStatus.UNKNOWN}},c.getWrapperFromIdentifier=function(e){return c.chatCampaignWrapper&&o.areChatCampaignsEqual(c.chatCampaignWrapper.chatCampaign,e)?c.chatCampaignWrapper:o.areChatCampaignsEqual(c.defaultChatWrapper.chatCampaign,e)?c.defaultChatWrapper:c.supportChatWrapper&&o.areChatCampaignsEqual(c.supportChatWrapper.chatCampaign,e)?c.supportChatWrapper:void 0},c.getLegacyCampaignIdentifierToCookieStr=function(e){return o.isCampaignResult(e)?e.snapengageChatSystemSettings?e.snapengageChatSystemSettings.widgetId:null:e},c.legacyToggleOutsideChatVisibilityOnAgentStatusUpdate=function(e){c.modifyVisibility("[data-snap-engage-visibility]",!1),e===r.AgentStatus.ONLINE?c.modifyVisibility('[data-snap-engage-visibility="online"]',!0):c.modifyVisibility('[data-snap-engage-visibility="offline"]',!0)},c.modifyVisibility=function(e,t){for(var a=t?"inline":"none",n=document.querySelectorAll(e),i=0;i<n.length;i++){var o=n[i];o instanceof HTMLElement&&(o.style.display=a)}},c.onAgentStatusUpdate=function(e,t){var a=o.areChatCampaignsEqual(c.state.campaign,e),n=c.state.lifecycleState,i=n===v.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE&&a,r=n===v.TO_START_ON_AGENT_STATUS_UPDATE&&a,s=c.getWrapperFromIdentifier(e);void 0!==s&&(s.chatCampaignState.agentStatus=t,c.legacyToggleOutsideChatVisibilityOnAgentStatusUpdate(t),i?c.attemptToShowProviderReactiveChatButton():r&&c.attemptToStartChat(s))},c.onChatLoadStatusUpdate=function(e,t){if(!c.hasFirstLoadOccured&&t){c.hasFirstLoadOccured=!0;var a=((new Date).valueOf()-c.setupTime.valueOf()).toString();c.logEvent(C.ChatEvent.INITIALIZED,{init_latency_ms:a}),c.deprecatedLogChatAction("snapengage_loaded",o.getSnapengageWidgetId(e),{total_time:a})}var n=o.areChatCampaignsEqual(c.state.campaign,e),i=c.state.lifecycleState,r=i===v.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD&&n,s=i===v.TO_START_ON_LOAD&&n,p=c.getWrapperFromIdentifier(e);void 0!==p&&(p.chatCampaignState.isLoaded=t,t&&c.provider.requestAgentStatusUpdate(e),r?c.attemptToShowProviderReactiveChatButton():s&&c.attemptToStartChat(p))},c.onProviderReactiveButtonShown=function(){c.state.lifecycleState===v.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON&&(c.modifyLifecycleState(v.SHOWING_PROVIDER_REACTIVE_BUTTON),c.logEvent(C.ChatEvent.IMPRESSION,{impression_type:C.ImpressionType.CHAT_ICON}))},c.onProviderDrivenOpenProactive=function(e){c.chatCampaignWrapper&&o.areChatCampaignsEqual(c.chatCampaignWrapper.chatCampaign,e)&&(c.state.hasShownAChat||(c.logEvent(C.ChatEvent.IMPRESSION,{impression_type:C.ImpressionType.PROACTIVE_CHAT}),c.deprecatedMaybeLogExperiment(e),c.deprecatedLogChatAction("proactive_chat_opened",o.getSnapengageWidgetId(e)),c.canStartChat()&&c.intializeStartingChat(c.chatCampaignWrapper,f.PROVIDER_DRIVEN_PROACTIVE)))},c.onChatShown=function(e){c.state.lifecycleState!==v.SHOWING_PROVIDER_REACTIVE_BUTTON&&c.state.lifecycleState!==v.REQUESTED_PROVIDER_TO_START_CHAT||o.areChatCampaignsEqual(c.state.campaign,e),c.modifyLifecycleState(v.SHOWING_CHAT),c.state.campaign=e,c.state.hasShownAChat=!0,c.state.source_type===f.RESUME?(c.provider.updateHmac(),c.state.interactedWithChat=!0,c.logEvent(C.ChatEvent.IMPRESSION,{impression_type:C.ImpressionType.RESUMED_CHAT})):c.state.source_type!==f.REACTIVE||c.impressionLogged||c.logEvent(C.ChatEvent.IMPRESSION,{impression_type:C.ImpressionType.REACTIVE_CHAT})},c.onChatStarted=function(e){var t=c.state.source_type;if(void 0!==t){c.state.interactedWithChat=!0;var a=void 0,n=C.InteractionType.UNKNOWN;t===f.RESUME?(a="chat_persistence_init",n=C.InteractionType.RESUMED_CHAT):t===f.PROACTIVE||t===f.PROVIDER_DRIVEN_PROACTIVE?(a="proactive_chat_initiated",n=C.InteractionType.PROACTIVE_CHAT,l.isNCCTChat(o.getSnapengageWidgetId(e))&&h.WebRequest({url:"/team/admin/engaged_chat",data:{chatId:o.getSnapengageWidgetId(e)}})):t===f.REACTIVE?(a="reactive_chat_initiated",n=C.InteractionType.REACTIVE_CHAT):t===f.TRANSFER&&(n=C.InteractionType.TRANSFERRED_CHAT),c.logEvent(C.ChatEvent.INTERACT,{interaction_type:n}),void 0!==a&&c.deprecatedLogChatAction(a,o.getSnapengageWidgetId(e))}else c.logError(C.ErrorType.CHAT_STARTED_FROM_UNKNOWN_SOURCE);c.setChatVisibleCookie(e),c.modifyLifecycleState(v.CHAT_ONGOING)},c.onChatClosed=function(e,t){c.handleCookieOnClosed(c.state.source_type,c.chatCampaignWrapper);var a=void 0,n=r.AgentStatus.UNKNOWN;void 0!==t.agentStatus&&(a=t.agentStatus===r.AgentStatus.ONLINE?"online":"offline",n=t.agentStatus===r.AgentStatus.ONLINE?r.AgentStatus.ONLINE:r.AgentStatus.OFFLINE),c.deprecatedLogChatAction("snapengage_chat_close",o.getSnapengageWidgetId(e),{type:t.chatType,agent_status:a});var i=c.state.interactedWithChat?C.ChatEvent.CLOSE:C.ChatEvent.DISMISSED;c.logEvent(i,{agents_status:n,chat_form_type:t.chatType}),c.resetChatState()},c.onChatMinimized=function(e){c.modifyLifecycleState(v.SHOWING_PROVIDER_REACTIVE_BUTTON)},c.onChatMaximized=function(e){c.modifyLifecycleState(v.SHOWING_CHAT)},c.onSwitchProviderWithNewCampaign=function(e,t){var a,n=c.provider;n.handleTransferEvent(r.TransferEvent.START_TRANSFER);try{var i=c.getChatProviderMetadata(e);if(!e.userProperties)throw new Error("User properties cannot be empty");c.setupProvider(e.campaignResult,i,e.userProperties,e.chatProviderType),a=e.campaignResult}catch(e){return void n.handleTransferEvent(r.TransferEvent.ERROR_ON_TRANSFER)}c.logEvent(C.ChatEvent.TRANSFER,{},a),c.onChatLoadStatusUpdate(t,!1),c.onAgentStatusUpdate(t,r.AgentStatus.UNKNOWN),c.resetChatState(),c.provider.requestAgentStatusUpdate(a),n.handleTransferEvent(r.TransferEvent.END_TRANSFER),c.setChatVisibleCookie(a),c.intializeStartingChat(c.chatCampaignWrapper,f.TRANSFER)},c.getChatProviderMetadata=function(e){var t;if("snapengageChatMetadata"===e.chatProviderMetadata)t=e.snapengageChatMetadata;else if(e.chatProviderType!==n.chat.ChatProviderType.DIALOGUE_CHAT)throw new Error("No provider metadata provided");return t},c.maybeLogImpressionFailedOnUnload=function(){if(!c.impressionLogged){var e=(new Date).valueOf()-c.setupTime.valueOf();c.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.NOT_ENOUGH_TIME_ON_PAGE,time_on_page_ms:e.toString()})}},c.logEvent=function(e,t,a){e!==C.ChatEvent.IMPRESSION&&e!==C.ChatEvent.IMPRESSION_FAILED||(c.impressionLogged=!0),c.logger.logEvent(e,c.createEventData(t,a))},c.logError=function(e){c.logEvent(C.ChatEvent.ERROR,{error_type:e})},c.createEventData=function(e,t){var a,n="-1",r=-1,s=-1,p="";if(c.initProperties.userProperties&&(n=c.initProperties.userProperties.userId),t)r=t.campaignId,s=t.versionId,p=(null===(a=t.snapengageChatSystemSettings)||void 0===a?void 0:a.widgetId)||"";else{var u=c.chatCampaignWrapper||c.defaultChatWrapper;u&&(p=o.getSnapengageWidgetId(u.chatCampaign)||"",o.isCampaignResult(u.chatCampaign)&&(r=u.chatCampaign.campaignId,s=u.chatCampaign.versionId))}return e.chat_session_id||(e.chat_session_id=i.Cookies.read("SnapABugChatSession")||""),{userId:n,campaignId:r,versionId:s,widgetId:p,correlationId:c.initProperties.loggingCorrelationId,platform:"WEB",eventDetails:e}},c.loggerFactory=s,c.logger=s.getChatLogger(),c.getChatProvider=t,c.shouldAllowChat=a,c._isSetup=!1,c}return a.__extends(t,e),t.prototype.attemptToShowReactiveButtonChatThatMustHaveAgents=function(e){var t=e.chatCampaignState.agentStatus;t===r.AgentStatus.UNKNOWN?this.requestProviderToGetAgentStatusUpdateToShowProviderReactiveButton(e):t===r.AgentStatus.OFFLINE?(this.deprecatedLogChatAction("chat_agent_must_be_online_but_was_offline",o.getSnapengageWidgetId(e.chatCampaign)),this.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.NO_ONLINE_AGENTS}),this.resetChatState()):this.requestProviderToShowProviderReactiveButton()},t.prototype.attemptToStartChatThatMustHaveAgents=function(e,t){var a=e.chatCampaignState.agentStatus;a===r.AgentStatus.UNKNOWN?this.requestProviderToGetAgentStatusUpdateToStartChat(e):a===r.AgentStatus.OFFLINE?(this.logEvent(C.ChatEvent.IMPRESSION_FAILED,{failed_reason:C.FailedReason.NO_ONLINE_AGENTS}),this.resetChatState()):t?this.requestProviderToHandleProviderDrivenOpen():this.requestProviderToStartChat(e)},t.prototype.requestProviderToLoadChatToStartChat=function(e){this.modifyLifecycleState(v.TO_START_ON_LOAD),this.provider.loadChatIfNecessary(e.chatCampaign)},t.prototype.handleCookieOnClosed=function(e,t){this.metadata&&(i.Cookies.delete(this.metadata.cookieCampaignName),i.Cookies.delete(this.metadata.legacyCookieCampaignName),this.maybeSetProactiveChatCooloffCookie(e,t))},t.prototype.deprecatedLogChatAction=function(e,t,n){if(t){var i={chat_widget_id:t,url:u.get_href()},o=a.__assign(a.__assign({},i),n);d.TeamsWebActionsLogger.log(e,o),g.AMPWebLogger.logEventCount("chat_events",e,{chat_widget_id:t})}},t.prototype.deprecatedMaybeLogExperiment=function(e){if(o.isCampaignResult(e)){var t=e.deprecatedExperimentNameToLog,a=e.deprecatedExperimentVariantToLog;if(t&&a)(new m.StormcrowExposureLogger).logExposure(t,a)}},t.prototype.resetChatState=function(){this.modifyLifecycleState(v.NOT_SHOWN),this.state.campaign=void 0,this.state.source_type=void 0,this.state.interactedWithChat=!1},t})(s.ChatClient);t._ChatClientSingleton=S;t.ChatClientSingleton=new S(c.ChatProviderFactorySingleton.getChatProvider,(function(){return top===window}),_.ChatLoggerFactorySingleton),t.moduleInit=function(e){var a=p.unpackProto(e,n.chat.ChatInitializerProperties);t.ChatClientSingleton.setupChatEnvironment(a)}})),define("modules/clean/chat/chat_client_api",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatClient=void 0;var a=function(e,t){this.setupChatEnvironment=function(e){},this.startReactiveChat=function(){},this.startSupportChat=function(e){},this.setCookieBannerInfo=function(e,t){}};t.ChatClient=a})),define("modules/clean/chat/chat_client_factory",["require","exports","modules/clean/chat/chat_wrapper"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatClientFactory=void 0;var n=function(){this.getClient=function(){return a.ChatWrapperSingleton}};t.ChatClientFactory=new n}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("modules/clean/chat/chat_client_loader",["require","exports","modules/clean/web_timing_logger"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initialize_module=t.ChatClientLoaderSingleton=t._ChatClientLoaderDoNotUseDirectly=void 0;var n=function(){var t=this;this.loadClient=function(e,t){if(e){var a=t.chatStoneToProtoModule.chatStoneToProto(e);t.chatClientModule.ChatClientSingleton.setupChatEnvironment(a)}},this.getBestChatCampaignAndLoadChatClient=function(e,a,n){var i={url:e};return n?(new a.userClientModule.UserApiV2Client).ns("megaphone_chat").rpc("get_best_chat_campaigns",i,{subjectUserId:n}).then((function(e){return t.loadClient(e.props,a)})):(new a.noAuthClientModule.NoAuthApiV2Client).ns("megaphone_chat").rpc("get_best_chat_campaigns",i,{}).then((function(e){return t.loadClient(e.props,a)}))},this.getChatCampaignByIdAndLoadClient=function(e,a,n,i){var o={url:e,campaign_id:a,locale:window.navigator.language?window.navigator.language:window.navigator.browserLanguage};return i?(new n.userClientModule.UserApiV2Client).ns("megaphone_chat").rpc("get_chat_campaign_by_id",o,{subjectUserId:i}).then((function(e){return t.loadClient(e.props,n)})):(new n.noAuthClientModule.NoAuthApiV2Client).ns("megaphone_chat").rpc("get_chat_campaign_by_id",o,{}).then((function(e){return t.loadClient(e.props,n)}))},this.resumeOrGetBestChatCampaignAndLoadClient=function(e,a,n,i){return e?Promise.resolve(t.loadClient(e,a)):t.getBestChatCampaignAndLoadChatClient(n,a,i)},this.getResumedChatCampaignAndLoadClient=function(e,a,n,i,o){var r={url:e,legacy_persistence_cookie:a||"",chat_persistence_cookie:n||""};return o?(new i.userClientModule.UserApiV2Client).ns("megaphone_chat").rpc("get_resumed_chat_campaign",r,{subjectUserId:o}).then((function(a){return t.resumeOrGetBestChatCampaignAndLoadClient(a.props,i,e,o)})):(new i.noAuthClientModule.NoAuthApiV2Client).ns("megaphone_chat").rpc("get_resumed_chat_campaign",r,{}).then((function(a){return t.resumeOrGetBestChatCampaignAndLoadClient(a.props,i,e,o)}))},this.importDependencies=function(){return Promise.all([new Promise((function(t,a){e(["api_v2/user_client"],t,a)})).then(__importStar),new Promise((function(t,a){e(["api_v2/noauth_client"],t,a)})).then(__importStar),new Promise((function(t,a){e(["modules/clean/chat/chat_stone_to_proto"],t,a)})).then(__importStar),new Promise((function(t,a){e(["modules/clean/chat/chat_client"],t,a)})).then(__importStar),new Promise((function(t,a){e(["modules/core/cookies"],t,a)})).then(__importStar),new Promise((function(t,a){e(["modules/clean/chat/chat_constants"],t,a)})).then(__importStar)])},this.getCookies=function(e,t){var a=e.Cookies,n=t.SNAPENGAGE_CHAT_VISIBLE_COOKIE,i=t.CHAT_CAMPAIGN_VISIBLE_COOKIE;return{legacy_persistence_cookie:a.read(n),chat_persistence_cookie:a.read(i)}},this.getCampaignFromChatServiceWithDependencies=function(e,a,n){var i=e[0],o=e[1],r=e[2],s=e[3],c=e[4],p=e[5],u={userClientModule:i,noAuthClientModule:o,chatStoneToProtoModule:r,chatClientModule:s,cookiesModule:c,chatConstantsModule:p},d=t.getCookies(c,p);return d.legacy_persistence_cookie||d.chat_persistence_cookie?t.getResumedChatCampaignAndLoadClient(a,d.legacy_persistence_cookie,d.chat_persistence_cookie,u,n):t.getBestChatCampaignAndLoadChatClient(a,u,n)},this.getChatCampaignIDFromChatServiceWithDependencies=function(e,a,n,i){var o=e[0],r=e[1],s=e[2],c=e[3],p=e[4],u=e[5],d={userClientModule:o,noAuthClientModule:r,chatStoneToProtoModule:s,chatClientModule:c,cookiesModule:p,chatConstantsModule:u},g=t.getCookies(p,u);return g.legacy_persistence_cookie||g.chat_persistence_cookie?t.getResumedChatCampaignAndLoadClient(a,g.legacy_persistence_cookie,g.chat_persistence_cookie,d,i):t.getChatCampaignByIdAndLoadClient(a,n,d,i)},this.loadChatClientWithBestCampaign=function(e,n,i){if(t.loadPromise)return t.loadPromise;var o=i?Promise.resolve():a.waitForTTI({timeoutMS:5e3});return t.loadPromise=o.then((function(){return t.importDependencies()})).then((function(a){return t.getCampaignFromChatServiceWithDependencies(a,e,n)})),t.loadPromise},this.loadCampaignByID=function(e,n,i){return t.loadPromise?t.loadPromise:(t.loadPromise=a.waitForTTI({timeoutMS:5e3}).then((function(){return t.importDependencies()})).then((function(a){return t.getChatCampaignIDFromChatServiceWithDependencies(a,e,n,i)})),t.loadPromise)}};t._ChatClientLoaderDoNotUseDirectly=n,t.ChatClientLoaderSingleton=new n,t.initialize_module=function(e){t.ChatClientLoaderSingleton.loadChatClientWithBestCampaign(e.url,e.userId,e.bypassWaitForTTI)}})),define("modules/clean/chat/chat_constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SNAPENGAGE_CHAT_VISIBLE_COOKIE=t.CHAT_CAMPAIGN_VISIBLE_COOKIE=void 0,t.CHAT_CAMPAIGN_VISIBLE_COOKIE="chat-campaign-visible",t.SNAPENGAGE_CHAT_VISIBLE_COOKIE="db-snapengage-visible"})),define("modules/clean/chat/chat_identifier",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSnapengageWidgetId=t.areChatCampaignsEqual=t.isSnapengageWidgetId=t.isCampaignResult=void 0,t.isCampaignResult=function(e){return void 0!==e.campaignId},t.isSnapengageWidgetId=function(e){return"string"==typeof e},t.areChatCampaignsEqual=function(e,a){return!!e&&(t.isCampaignResult(e)&&t.isCampaignResult(a)?e.campaignId===a.campaignId:!(!t.isSnapengageWidgetId(e)||!t.isSnapengageWidgetId(a))&&e===a)},t.getSnapengageWidgetId=function(e){return t.isCampaignResult(e)?e.snapengageChatSystemSettings?e.snapengageChatSystemSettings.widgetId:null:e}})),define("modules/clean/chat/chat_logger",["require","exports","tslib","modules/clean/logging/hive/schemas/megaphone-events"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryChatLogger=void 0;var i=(function(){function e(e){this.logger=e}return e.prototype.logEvent=function(e,t,a){var i={entity_type:"chat",event_name:e,correlation_id:t.correlationId,event_id:a,user_id:this.toNumber(t.userId),entity_id:this.toNumber(t.campaignId),version_id:this.toNumber(t.versionId),platform:t.platform,event_details:this.getEventDetails(e,t)};this.logger.log(new n.MegaphoneEventsRow(i))},e.prototype.toNumber=function(e,t){return void 0===t&&(t=-1),null==e||""===e?t:"string"==typeof e?parseInt(e,10):"number"==typeof e?e:e.toNumber()},e.prototype.getEventDetails=function(e,t){var n=a.__assign({},t.eventDetails),i=t.widgetId;return t.eventDetails.widgetOverride&&(i=t.eventDetails.widgetOverride),n.widget_id=i,n},e})();t.TelemetryChatLogger=i})),define("modules/clean/chat/chat_logger_api",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerType=t.ErrorType=t.InteractionType=t.ImpressionType=t.FailedReason=t.ChatEvent=void 0,(function(e){e.INITIALIZED="initialized",e.IMPRESSION_FAILED="impression_failed",e.CLICK="click",e.IMPRESSION="impression",e.INTERACT="interact",e.DISMISSED="dismissed",e.CLOSE="close",e.ERROR="error",e.TRANSFER="transfer"})(t.ChatEvent||(t.ChatEvent={})),(function(e){e.CONTROL_VERSION="control_version",e.NO_ONLINE_AGENTS="no_online_agents",e.NOT_ENOUGH_TIME_ON_PAGE="not_enough_time_on_page",e.CHAT_IS_NOT_ALLOWED="chat_is_not_allowed",e.CHAT_IS_NOT_INITIALIZED="chat_is_not_initialized",e.ANOTHER_CHAT_STARTED="another_chat_started",e.COOLOFF_PERIOD="COOLOFF_PERIOD"})(t.FailedReason||(t.FailedReason={})),(function(e){e.CHAT_ICON="chat_icon",e.PROACTIVE_CHAT="proactive_chat",e.RESUMED_CHAT="resumed_chat",e.REACTIVE_CHAT="reactive_chat"})(t.ImpressionType||(t.ImpressionType={})),(function(e){e.UNKNOWN="unknown",e.RESUMED_CHAT="resumed_chat",e.PROACTIVE_CHAT="proactive_chat",e.REACTIVE_CHAT="reactive_chat",e.TRANSFERRED_CHAT="transferred_chat"})(t.InteractionType||(t.InteractionType={})),(function(e){e.ATTEMPT_TO_START_UNINITIALIZED_CHAT="attempt_to_start_uninitialized_chat",e.CHAT_STARTED_FROM_UNKNOWN_SOURCE="chat_started_from_unknown_source",e.ATTEMPT_START_PROACTIVE_CHAT_WITHOUT_MESSAGE="attempt_start_proactive_chat_without_message"})(t.ErrorType||(t.ErrorType={})),(function(e){e.DEFAULT="default",e.HIVE_VORTEX_COMBO="hive_vortex_combo"})(t.LoggerType||(t.LoggerType={}))})),define("modules/clean/chat/chat_logger_factory",["require","exports","tslib","modules/clean/chat/chat_logger_api","modules/clean/chat/chat_logger","modules/clean/logging/telemetry"],(function(e,t,a,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatLoggerFactorySingleton=void 0;var r=new((o=a.__importStar(o)).HiveLogger),s=new o.VortexComboLogger,c=(function(){function e(){}return e.prototype.getChatLogger=function(e){void 0===e&&(e=n.LoggerType.DEFAULT);var t=e===n.LoggerType.HIVE_VORTEX_COMBO?s:r;return new i.TelemetryChatLogger(t)},e})();t.ChatLoggerFactorySingleton=new c})),define("modules/clean/chat/chat_provider_api",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProvider=t.TransferEvent=t.AgentStatus=void 0,(function(e){e.UNKNOWN="unknown",e.OFFLINE="offline",e.ONLINE="online"})(t.AgentStatus||(t.AgentStatus={})),(function(e){e.START_TRANSFER="startTransfer",e.END_TRANSFER="endTransfer",e.ERROR_ON_TRANSFER="errorOnTransfer"})(t.TransferEvent||(t.TransferEvent={}));var a=function(e){this.addBottomMargin=function(e){},this.removeBottomMargin=function(){}};t.ChatProvider=a})),define("modules/clean/chat/chat_provider_factory",["require","exports","dropbox/proto/js_init_data/chat/chat","modules/clean/chat/snapengage_chat_provider","modules/clean/chat/dialogue/dialogue_chat_provider"],(function(e,t,a,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProviderFactorySingleton=void 0;var o=function(){this.getChatProvider=function(e,t){if(e===a.chat.ChatProviderType.SNAPENGAGE)return new n.SnapengageChatProvider(t);if(e===a.chat.ChatProviderType.DIALOGUE_CHAT)return new i.DialogueChatProvider(t);throw new Error("Unknown chat provider type "+e)}};t.ChatProviderFactorySingleton=new o})),define("modules/clean/chat/chat_stone_to_proto",["require","exports","dropbox/proto/js_init_data/chat/chat","modules/clean/chat/dialogue/dialogue_stone_proto_transformer"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatStoneToProto=void 0;var i=function(e){if(void 0!==e)return new a.chat.ChatMetadata({cookieDomain:e.cookie_domain,cookieCampaignName:e.cookie_campaign_name,legacyCookieCampaignName:e.legacy_cookie_campaign_name})},o=function(e){if(void 0!==e)return new a.chat.UserProperties({chatHmac:e.chat_hmac,email:e.email,firstName:e.first_name,lastName:e.last_name,pageLoadTs:e.page_load_ts,pricings:e.pricings,sessionId:e.session_id,userId:e.user_id,serviceTier:e.service_tier,locale:e.locale,countryCode:e.country_code})},r=function(e){var t=e.proactive_type;if(void 0===t)throw new Error("Proactive Message Type undefined");var n=t[".tag"];if("default"===n)return a.chat.ProactiveMessageType.DEFAULT;if("minimized_proactive"===n)return a.chat.ProactiveMessageType.MINIMIZED_PROACTIVE;throw new Error("Unknown tag for proactive message type "+n)},s=function(e){if(void 0!==e)return new a.chat.ProactiveSettings({proactiveType:r(e),whenToShowControlledByProvider:e.when_to_show_controlled_by_provider,secondsUntilShown:e.seconds_until_shown})},c=function(e){if(void 0!==e){var t=e[".tag"];if("hidden"===t)return a.chat.ChatInitialState.HIDDEN;if("show_provider_reactive_button"===t)return a.chat.ChatInitialState.SHOW_PROVIDER_REACTIVE_BUTTON;throw new Error("Unknown tag for chat initial state "+t)}},p=function(e){if(void 0!==e){var t=(function(e){var t=e.system_settings,i=void 0,o=void 0;return t&&(function(e){return"snapengage_chat_system_settings"===e[".tag"]})(t)?i=new a.chat.SnapengageChatSystemSettings({widgetId:t.widget_id}):t&&(function(e){return"dialogue_chat_system_settings"===e[".tag"]})(t)&&(o=n.convertStoneSettingsToProto(t)),{snapengageSettings:i,dialogueSettings:o}})(e);return new a.chat.CampaignResult({campaignId:e.campaign_id,versionId:e.version_id,campaignName:e.campaign_name,versionName:e.version_name,snapengageChatSystemSettings:t.snapengageSettings,dialogueChatSystemSettings:t.dialogueSettings,mustHaveAvailableAgents:e.must_have_available_agents,proactiveSettings:s(e.proactive_settings),greetingMessage:e.greeting_message,chatInitialState:c(e.chat_initial_state),persistenceCookie:e.persistence_cookie,deprecatedExperimentNameToLog:e.deprecated_experiment_name_to_log,deprecatedExperimentVariantToLog:e.deprecated_experiment_variant_to_log,isControl:e.is_control})}},u=function(e){if(void 0!==e){var t=e[".tag"];if("snapengage"===t)return a.chat.ChatProviderType.SNAPENGAGE;if("dialogue_chat"===t)return a.chat.ChatProviderType.DIALOGUE_CHAT;throw new Error("Unknown tag for chat provider type "+t)}},d=function(e){if(void 0!==e)return"snapengage_chat_metadata"===e[".tag"]?new a.chat.SnapengageChatMetadata({snapengageIframeOrigin:e.snapengage_iframe_origin}):void 0};t.chatStoneToProto=function(e){return new a.chat.ChatInitializerProperties({chatMetadata:i(e.chat_metadata),userProperties:o(e.user_properties),campaignResult:p(e.campaign_result),resume:e.resume,chatProviderType:u(e.chat_provider_type),snapengageChatMetadata:d(e.chat_provider_metadata),loggingCorrelationId:e.logging_correlation_id})}})),define("modules/clean/chat/chat_wrapper",["require","exports","modules/clean/chat/chat_client","modules/clean/chat/snapengage"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatWrapperSingleton=t.ChatWrapper=void 0;var i=function(){var e=this;this.startReactiveChat=function(){e.getClient().startReactiveChat()},this.startSupportChat=function(t){var i=e.getClient();void 0===t?a.ChatClientSingleton.isSetup()?a.ChatClientSingleton.startReactiveChat():n.DropboxSnapEngage.startSupportChat(t):i.startSupportChat(t)},this.disableDropboxSnapEngageUpdateChatStatus=function(){n.DropboxSnapEngage.updateChatStatus=function(){}},this.getClient=function(){return a.ChatClientSingleton.isSetup()?a.ChatClientSingleton:n.DropboxSnapEngage}};t.ChatWrapper=i,t.ChatWrapperSingleton=new i})),define("modules/clean/chat/snapengage_chat_instance_handler",["require","exports","tslib","modules/clean/chat/chat_identifier","dropbox/proto/js_init_data/chat/chat","modules/clean/css","modules/core/browser","modules/core/uri","modules/core/i18n","modules/clean/chat/snapengage_tags","modules/clean/chat/snapengage_chat_instance_handler_api","modules/clean/chat/chat_provider_api"],(function(e,t,a,n,i,o,r,s,c,p,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnapengageChatHandlerImpl=void 0,r=a.__importStar(r);var g=i.chat.ProactiveMessageType,l=(function(e){function t(t){var a=e.call(this,t)||this;return a.isLoaded=function(){return a._isLoaded},a.requestAgentStatusUpdate=function(){a.checkChatStatus()},a.showReactiveButton=function(){a.showSnapEngageIframe(),a.minimizeSnapEngageIframe(),a.onProviderReactiveButtonShownListener(a.chatCampaign)},a.startChat=function(){a.showSnapEngageIframe(),a.sendMessage("startChatV2")},a.startProactiveChat=function(){a.showSnapEngageIframe(),a.sendMessage("startProactiveChat")},a.handleProviderDrivenOpen=function(){a.showSnapEngageIframe()},a.switchCampaign=function(e){a.chatCampaign=e,a.chatId=n.getSnapengageWidgetId(a.chatCampaign),a.sendMessage("switchCampaign")},a.updateHmac=function(){a.sendMessage("updateHmac")},a.addBottomMargin=function(e){if(a.iframe){a.iframe.style.removeProperty("margin-bottom");var t=parseInt(window.getComputedStyle(a.iframe).marginBottom,10)||0;a.iframe.style.marginBottom=e+t+"px"}},a.removeBottomMargin=function(){a.iframe&&a.iframe.style.removeProperty("margin-bottom")},a.initialize=function(){window.addEventListener("message",a.receiveMessage,!1),o.require_css("/static/css/business/components/snap_engage-vfldJUS6n.css",(function(){a.createIframe()}))},a.createIframe=function(){var e=r.get_uri(),t=s.URI.parse(a.metadata.snapengageIframeOrigin);a.iframe=document.createElement("iframe"),e.setScheme(t.getScheme()),e.setAuthority(t.getAuthority()),a.iframe.src=e.toString(),a.iframe.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms"),a.iframe.setAttribute("class","snapengage-iframe"),a.iframe.setAttribute("id",a.iframeId),a.iframe.setAttribute("allowTransparency","true"),a.iframe.setAttribute("title",c.intl.formatMessage({id:"/nsbvt",defaultMessage:"Live chat box"})),a.iframe.addEventListener("load",a.handleIframeLoad);var n=document.querySelector("main");null!==n?n.insertBefore(a.iframe,n.firstChild):(a.iframe.setAttribute("tabindex","1"),document.body.insertBefore(a.iframe,document.body.childNodes[0])),setInterval(a.checkChatStatus,13e4)},a.handleIframeLoad=function(){a.iFrameLeftStyle=a.iframe&&a.iframe.style.left,a.sendMessage("createSnapEngageScriptV2")},a.showSnapEngageIframe=function(e){void 0===e&&(e=!1),a.iframe&&(a.iframe.style.display="inline",a.iframe.style.left=a.iFrameLeftStyle,a.isVisible=!0)},a.onCloseChat=function(e){var t,n;a.iframe&&(a.iframe.style.display="none"),a.isVisible=!1,e&&(n=e.type,t="online"===e.agentStatus?d.AgentStatus.ONLINE:d.AgentStatus.OFFLINE),a.onChatClosedListener(a.chatCampaign,{agentStatus:t,chatType:n})},a.onMinimized=function(e){a.onChatMinimizedListener(a.chatCampaign),a.minimizeSnapEngageIframe(e)},a.onMaximized=function(e){a.onChatMaximizedListener(a.chatCampaign),a.maximizeSnapEngageIframe(e)},a.minimizeSnapEngageIframe=function(e){var t=e?Math.max(e.width,80):80,n=e?Math.max(e.height,80):80;a.iframe&&a.isVisible&&(a.iframe.style.width=t+"px",a.iframe.style.height=n+"px")},a.maximizeSnapEngageIframe=function(e){if(a.iframe){var t=(e||{}).width,n=(e||{}).height;a.iframe.style.width=t?t+"px":"",a.iframe.style.height=n?n+"px":""}},a.checkChatStatus=function(){a.sendMessage("checkChatStatusV2")},a.onOpenProactive=function(){a.onProviderDrivenOpenProactiveListener(a.chatCampaign)},a.onAgentStatusUpdate=function(e){a.onAgentStatusUpdateListener(a.chatCampaign,e)},a.isValidSource=function(e){return e.origin===a.metadata.snapengageIframeOrigin},a.onOpen=function(){a.onChatShownListener(a.chatCampaign)},a.onChatMessageReceived=function(){},a.onStartChat=function(){a.onChatStartedListener(a.chatCampaign)},a.onSwitchCampaign=function(){a.onSwitchCampaignListener(a.chatCampaign)},a.onSnapEngageInitialized=function(){a._isLoaded=!0,a.onChatLoadListener(a.chatCampaign,!0)},a.buildChatData=function(){var e=p.getSnapengageTags(a.userProperties.locale,a.userProperties.countryCode),t=n.isCampaignResult(a.chatCampaign)&&!a.chatCampaign.isControl&&void 0!==a.chatCampaign.proactiveSettings&&null!==a.chatCampaign.proactiveSettings&&a.chatCampaign.proactiveSettings.whenToShowControlledByProvider,i=void 0,o=!1;return n.isCampaignResult(a.chatCampaign)&&(i=a.chatCampaign.greetingMessage,a.chatCampaign.proactiveSettings&&(o=a.chatCampaign.proactiveSettings.proactiveType===g.MINIMIZED_PROACTIVE)),{FirstName:a.userProperties.firstName,LastName:a.userProperties.lastName,Email:a.userProperties.email,locale:a.userProperties.locale,SessionID:a.userProperties.sessionId,Country:a.userProperties.countryCode,pricing:a.userProperties.pricings.join(),user_id:a.userProperties.userId,pageLoadTs:a.userProperties.pageLoadTs,chatHmac:a.userProperties.chatHmac,ncct:"",serviceTier:a.userProperties.serviceTier,tags:e,phoneSupportForPlusUsers:a.userProperties.experiments.phoneSupportForPlusUsers,supportExperimentShowOnboardingNumber:a.userProperties.experiments.supportExperimentShowOnboardingNumber,supportExperimentHideEmailOption:a.userProperties.experiments.supportExperimentHideEmailOption,supportExperimentBasic36HourSla:a.userProperties.experiments.supportExperimentBasic36HourSla,phoneSupportForProfessionalUsers:a.userProperties.experiments.phoneSupportForProfessionalUsers,supportExperimentProfessionalPhoneSupportedLanguages:a.userProperties.experiments.supportExperimentProfessionalPhoneSupportedLanguages,cxChatbotName:"",allowProactive:t,greetingMessage:i,minimizedProactive:o}},a.receiveMessage=function(e){a.isValidSource(e)&&("SnapEngageInitialized"===e.data.message_type?a.onSnapEngageInitialized():"UpdateChatStatus"===e.data.message_type?a.onAgentStatusUpdate(e.data.online):"Close"===e.data.message_type?a.onCloseChat(e.data):"Minimize"===e.data.message_type?a.onMinimized(e.data.rect):"Maximize"===e.data.message_type?a.onMaximized(e.data.rect):"OpenProactive"===e.data.message_type?a.onOpenProactive():"StartChat"===e.data.message_type?a.onStartChat():"Open"===e.data.message_type?a.onOpen():"EndProactiveChat"===e.data.message_type?a.onCloseChat():"ChatMessageReceived"===e.data.message_type?a.onChatMessageReceived():"onSwitchCampaign"===e.data.message_type&&a.onSwitchCampaign())},a.sendMessage=function(e){var t={message_type:e,chatId:a.chatId,chatData:a.chatData};a.iframe&&a.iframe.contentWindow&&a.iframe.contentWindow.postMessage(t,a.metadata.snapengageIframeOrigin)},a._isLoaded=!1,a.chatCampaign=t.campaignResult,a.metadata=t.metadata,a.userProperties=t.userProperties,a.onAgentStatusUpdateListener=t.onAgentStatusUpdate,a.onChatLoadListener=t.onChatLoadStatusUpdate,a.onChatShownListener=t.onChatShown,a.onChatStartedListener=t.onChatStarted,a.onChatClosedListener=t.onChatClosed,a.onSwitchCampaignListener=t.onSwitchCampaign,a.onProviderDrivenOpenProactiveListener=t.onProviderDrivenOpenProactive,a.onProviderReactiveButtonShownListener=t.onProviderReactiveButtonShown,a.onChatMinimizedListener=t.onChatMinimized,a.onChatMaximizedListener=t.onChatMaximized,a.isVisible=!1,a.iframeId="snapengage-iframe",a.chatData=a.buildChatData(),a.chatId=n.getSnapengageWidgetId(a.chatCampaign),a.initialize(),a}return a.__extends(t,e),t})(u.SnapengageChatInstanceHandler);t.SnapengageChatHandlerImpl=l})),define("modules/clean/chat/snapengage_chat_instance_handler_api",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnapengageChatInstanceHandler=void 0;var a=function(e){this.addBottomMargin=function(e){},this.removeBottomMargin=function(){}};t.SnapengageChatInstanceHandler=a})),define("modules/clean/chat/snapengage_chat_provider",["require","exports","tslib","modules/clean/chat/chat_identifier","modules/clean/chat/chat_provider_api","modules/clean/chat/snapengage_chat_instance_handler"],(function(e,t,a,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnapengageChatProvider=void 0;var r=(function(e){function t(t){var a=e.call(this,t)||this;return a.DEFAULT_WIDGET_ID="d5c1efed-d0ef-4fca-8c7d-faff398ad272",a.getDefaultChatIdentifier=function(){return a.DEFAULT_WIDGET_ID},a.loadChatIfNecessary=function(e){n.areChatCampaignsEqual(a.currentChatCampaign,e)?a.handler.isLoaded()&&a.onChatLoadStatusUpdate(a.currentChatCampaign,!0):a.handler.switchCampaign(e)},a.onSwitchCampaign=function(e){var t=a.currentChatCampaign;a.currentChatCampaign=e,a.onChatLoadStatusUpdate(t,!1),a.onAgentStatusUpdateListener(t,i.AgentStatus.UNKNOWN),a.onChatLoadStatusUpdate(e,!0),a.handler.requestAgentStatusUpdate()},a.requestAgentStatusUpdate=function(e){if(!n.areChatCampaignsEqual(a.currentChatCampaign,e))throw new Error("Requesting agent status for a chat campaign that is not loaded");a.handler.requestAgentStatusUpdate()},a.showProviderReactiveChatButton=function(){a.handler.showReactiveButton()},a.handleProviderDrivenOpen=function(){a.handler.handleProviderDrivenOpen()},a.startChat=function(e,t){if(!n.areChatCampaignsEqual(a.currentChatCampaign,e))throw new Error("Requesting to start chat for a chat campaign that is not loaded");t?a.handler.startProactiveChat():a.handler.startChat()},a.updateHmac=function(){a.handler.updateHmac()},a.addBottomMargin=function(e){a.handler.addBottomMargin(e)},a.removeBottomMargin=function(){a.handler.removeBottomMargin()},a.onAgentStatusUpdate=function(e,t){a.onAgentStatusUpdateListener(e,t?i.AgentStatus.ONLINE:i.AgentStatus.OFFLINE)},a.handleTransferEvent=function(e){},a.onAgentStatusUpdateListener=t.onAgentStatusUpdate,a.onChatLoadStatusUpdate=t.onChatLoadStatusUpdate,a.onChatShown=t.onChatShown,a.onChatStarted=t.onChatStarted,a.onChatClosed=t.onChatClosed,a.onProviderDrivenOpenProactive=t.onProviderDrivenOpenProactive,a.onProviderReactiveButtonShown=t.onProviderReactiveButtonShown,a.metadata=t.metadata,a.userProperties=t.userProperties,a.onChatMinimized=t.onChatMinimized,a.onChatMaximized=t.onChatMaximized,t.chatCampaign?(a.currentChatCampaign=t.chatCampaign,a.handler=a.createHandler(t.chatCampaign)):(a.currentChatCampaign=a.DEFAULT_WIDGET_ID,a.handler=a.createHandler(a.DEFAULT_WIDGET_ID)),a}return a.__extends(t,e),t.prototype.createHandler=function(e){return new o.SnapengageChatHandlerImpl({campaignResult:e,metadata:this.metadata,userProperties:this.userProperties,onAgentStatusUpdate:this.onAgentStatusUpdate,onChatLoadStatusUpdate:this.onChatLoadStatusUpdate,onChatShown:this.onChatShown,onChatStarted:this.onChatStarted,onChatClosed:this.onChatClosed,onProviderDrivenOpenProactive:this.onProviderDrivenOpenProactive,onProviderReactiveButtonShown:this.onProviderReactiveButtonShown,onSwitchCampaign:this.onSwitchCampaign,onChatMinimized:this.onChatMinimized,onChatMaximized:this.onChatMaximized})},t})(i.ChatProvider);t.SnapengageChatProvider=r})),define("modules/clean/chat/snapengage_tags",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSnapengageTags=void 0;var a={NAMER:["US","CA"],APAC:["AU","BD","KH","C2","FJ","GU","HK","IN","ID","JP","MY","MV","NP","NZ","PK","PH","SG","KR","LK","TW","TH","VN"],EMEA:["AL","DZ","AO","AT","AZ","BH","BY","BE","BA","BW","BG","CM","HR","CY","CZ","DK","EG","EE","ET","FI","FR","GE","DE","GH","GI","GR","HU","IS","IQ","IE","IL","IT","CI","JO","KE","KW","LV","LB","LT","LU","MK","MG","MT","MQ","MU","MD","MC","MA","MZ","NA","NL","NG","NO","OM","PS","PL","PT","QA","RO","RU","RW","SA","SN","RS","SK","SI","ZA","ES","SE","CH","TZ","TN","TR","UG","UA","AE","GB","YE","ZM","ZW"],LATAM:["AG","AN","AR","AW","BB","BO","BR","BS","BZ","CL","CO","CR","CU","DM","DO","EC","GT","GY","HN","HT","JM","KN","LC","MX","NI","PA","PE","PR","PY","SR","SV","TT","UY","VC","VE"]},n={en:"",en_GB:"",da_DK:"dutch",de:"german",es:"spanish, spanish-la",es_ES:"spanish, spanish-es",fr:"french",id:"",it:"italian",ja:"japanese",ko:"korean",ms:"",nb_NO:"norwegian",nl_NL:"dutch",pl:"",pt_BR:"portuguese",ru:"russian",sv_SE:"swedish",th_TH:"thai",zh_CN:"chinese, chinese-sim",zh_TW:"chinese, chinese-trad"};t.getSnapengageTags=function(e,t){var a=[],o=n[e],r=i(t);return void 0!==o&&a.push(o),void 0!==r&&a.push(r),a.join(", ")};var i=function(e){if(void 0!==e)return a.NAMER.indexOf(e)>=0?"namer":a.APAC.indexOf(e)>=0?"apac":a.EMEA.indexOf(e)>=0?"emea":a.LATAM.indexOf(e)>=0?"latam":void 0}})),define("modules/clean/logging/hive/schemas/megaphone-events",["require","exports","modules/clean/uuid/insecure_uuid"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MegaphoneEventsRow=void 0;var n=function(e,t){var n=this;this.category="megaphone-events_v0_5",this.user_id=-1,this.team_id=-1,this.entity_id=-1,this.version_id=-1,this.node_id="-1",this.parent_correlation_id="none",this.parent_event_id="none",this.external_tag="none",this.location="none",this.platform="WEB",this.surface_screen_height=-1,this.surface_screen_width=-1,this.event_details={},t&&(this.category=t),["user_id","team_id","entity_type","entity_id","version_id","node_id","event_id","event_name","correlation_id","parent_correlation_id","parent_event_id","external_tag","location","platform","surface_screen_height","surface_screen_width","event_details"].map((function(t){e.hasOwnProperty(t)&&void 0!==e[t]&&(n[t]=e[t])})),this.event_id||(this.event_id=a.InsecureUUID.v4()),Object.seal(this)};t.MegaphoneEventsRow=n})),define("modules/clean/chat/dialogue/dialogue_chat_provider",["require","exports","tslib","modules/clean/chat/chat_provider_api","modules/clean/chat/dialogue/actions/action_types","react-dom","react","dropbox/proto/js_init_data/chat/chat","modules/clean/chat/dialogue/dialogue_stone_proto_transformer","modules/clean/chat/dialogue/experiments","modules/clean/chat/dialogue/components/async_dialogue"],(function(e,t,a,n,i,o,r,s,c,p,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DialogueChatProvider=void 0,o=a.__importStar(o),r=a.__importDefault(r);var d=(function(t){function d(o){var r,u=t.call(this,o)||this;return u.DEFAULT_ID="chatbot",u.setup=function(){return a.__awaiter(u,void 0,void 0,(function(){var t,n,i=this;return a.__generator(this,(function(o){switch(o.label){case 0:return new Promise((function(t,a){e(["modules/clean/chat/dialogue/store/index"],t,a)})).then(a.__importStar).then((function(e){var t=e.createAppRootStore;i.initialiseReduxStore(t),i.loadChat()})),t=this,[4,new Promise((function(t,a){e(["modules/clean/chat/dialogue/actions/chat_actions"],t,a)})).then(a.__importStar)];case 1:return t.chatActions=o.sent(),n={text:this.campaign.greetingMessage,sender:"bot"},this.chatActions.getChat(this.stoneSettings,n)(this.dispatch),[2]}}))}))},u.initialiseReduxStore=function(e){u.store=e(u),u.actionQueue.forEach((function(e){return u.dispatch(e)}));var t=p.getExperiments(u.settings.experiments);u.store.dispatch({type:i.DialogueActionType.INIT_PROVIDER,settings:u.stoneSettings,userProperties:u.userProperties,experiments:t})},u.dispatch=function(e){void 0!==u.store?u.store.dispatch(e):u.actionQueue.push(e)},u.transferToNewCampaign=function(e){e.chatProviderType===s.chat.ChatProviderType.SNAPENGAGE&&u.onSwitchProviderWithNewCampaign(e,u.campaign)},u.handleTransferEvent=function(e){var t;if(e===n.TransferEvent.START_TRANSFER);else if(e===n.TransferEvent.END_TRANSFER){var a=null===(t=u.store.getState().providerState.savedTransferProps)||void 0===t?void 0:t.campaignResult,i=void 0;if(a){var o=a.campaignName,r=a.versionName,s=a.campaignId;i="chatbot_transfer_"+s,u.logAsync("transfer",{campaignName:o,versionName:r,campaignId:s})}u.chatActions.endChat({},u.stoneSettings,!1,i)(u.dispatch)}else e===n.TransferEvent.ERROR_ON_TRANSFER&&u.addMessage({text:"Sorry, I wasn't able to transfer you.",sender:"bot"})},u.addMessage=function(e,t){void 0===t&&(t=!1),u.dispatch({type:i.DialogueActionType.ADD_MESSAGE,message:e,awaitingResponse:t})},u.addBottomMargin=function(e){var t=document.getElementById("dialog_chat_container");if(t){t.style.removeProperty("margin-bottom");var a=parseInt(window.getComputedStyle(t).marginBottom,10)||0;t.style.marginBottom=e+a+"px"}},u.removeBottomMargin=function(){var e=document.getElementById("dialog_chat_container");e&&e.style.removeProperty("margin-bottom")},u.getLogger=function(){return a.__awaiter(u,void 0,void 0,(function(){var t;return a.__generator(this,(function(n){switch(n.label){case 0:return this.logger?[2,this.logger]:[4,new Promise((function(t,a){e(["modules/clean/chat/dialogue/logging"],t,a)})).then(a.__importStar)];case 1:return t=n.sent().DialogueEventsLogger,this.logger=new t,[2,this.logger]}}))}))},u.logAsync=function(e,t){return void 0===t&&(t={}),a.__awaiter(u,void 0,void 0,(function(){return a.__generator(this,(function(a){switch(a.label){case 0:return[4,this.getLogger()];case 1:return a.sent().logEvent(e,t),[2]}}))}))},u.settings=null===(r=o.chatCampaign)||void 0===r?void 0:r.dialogueChatSystemSettings,u.stoneSettings=c.convertProtoSettingsToStone(u.settings),u.campaign=o.chatCampaign,u.userProperties=o.userProperties,u.actionQueue=[],u.onAgentStatusUpdateListener=o.onAgentStatusUpdate,u.onChatLoadStatusListener=o.onChatLoadStatusUpdate,u.onChatShownListener=o.onChatShown,u.onChatStartedListener=o.onChatStarted,u.onChatClosedListener=o.onChatClosed,u.onChatMinimizedListener=o.onChatMinimized,u.onChatMaximizedListener=o.onChatMaximized,u.onProviderDrivenOpenProactive=o.onProviderDrivenOpenProactive,u.onProviderReactiveButtonShown=o.onProviderReactiveButtonShown,u.onSwitchProviderWithNewCampaign=o.onSwitchProviderWithNewCampaign,u.hasLoaded=!1,u.setup().catch((function(e){return a.__awaiter(u,void 0,void 0,(function(){var t;return a.__generator(this,(function(a){switch(a.label){case 0:return[4,this.getLogger()];case 1:return a.sent().logError("provider_init",{userId:null===(t=o.userProperties)||void 0===t?void 0:t.userId,error:e.toString()}),[2]}}))}))})),u}return a.__extends(d,t),d.prototype.getDefaultChatIdentifier=function(){return this.DEFAULT_ID},d.prototype.loadChatIfNecessary=function(e){this.onChatLoadStatusListener(e,!0)},d.prototype.requestAgentStatusUpdate=function(e){this.onAgentStatusUpdateListener(e,n.AgentStatus.ONLINE)},d.prototype.showProviderReactiveChatButton=function(){this.dispatch({type:i.DialogueActionType.SHOW_REACTIVE_BUTTON_WHEN_MINIMIZED})},d.prototype.handleProviderDrivenOpen=function(){},d.prototype.startChat=function(e){this.dispatch({type:i.DialogueActionType.OPEN_CHAT})},d.prototype.updateHmac=function(){},d.prototype.onChatStarted=function(){this.onChatStartedListener(this.campaign)},d.prototype.onChatClosed=function(){this.onChatClosedListener(this.campaign,{})},d.prototype.onChatMinimized=function(){this.onChatMinimizedListener(this.campaign)},d.prototype.onChatMaximized=function(){this.onChatMaximizedListener(this.campaign)},d.prototype.onChatShown=function(e){this.onChatShownListener(e||this.campaign)},d.prototype.loadChat=function(){return a.__awaiter(this,void 0,void 0,(function(){var e;return a.__generator(this,(function(t){return document.getElementById("dialogue-chat-root")||((e=document.createElement("div")).setAttribute("id","dialogue-chat-root"),document.body.appendChild(e)),this.hasLoaded||(o.render(r.default.createElement(u.AsyncDialogue,{store:this.store}),document.getElementById("dialogue-chat-root")),this.hasLoaded=!0),this.onChatLoadStatusListener(this.campaign,!0),[2]}))}))},d})(n.ChatProvider);t.DialogueChatProvider=d})),define("modules/clean/chat/dialogue/actions/action_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DialogueActionType=void 0,(function(e){e.INIT_PROVIDER="DIALOGUE/INIT_PROVIDER",e.SET_TRANSFER_PROPS="DIALOGUE/SET_TRANSFER_PROPS",e.START_TRANSFER="DIALOGUE/START_TRANSFER",e.END_CHAT="DIALOGUE/END_CHAT",e.GET_CHAT="DIALOGUE/GET_CHAT",e.MINIMIZE_CHAT="DIALOGUE/MINIMIZE_CHAT",e.SHOW_REACTIVE_BUTTON_WHEN_MINIMIZED="DIALOGUE/SHOW_REACTIVE_BUTTON_WHEN_MINIMIZED",e.TOGGLE_REACTIVE_BUTTON="DIALOGUE/TOGGLE_REACTIVE_BUTTON",e.OPEN_CHAT="DIALOGUE/OPEN_CHAT",e.TOGGLE_END_CHAT_MODAL="DIALOGUE/TOGGLE_END_CHAT_MODAL",e.TOGGLE_TRANSFER_MODAL="DIALOGUE/TOGGLE_TRANSFER_MODAL",e.SET_LOGGING_ID="DIALOGUE/SET_LOGGING_ID",e.SET_GREETING_MESSAGE="DIALOGUE/SET_GREETING_MESSAGE",e.ADD_MESSAGE="DIALOGUE/ADD_MESSAGE",e.UPDATE_CURRENT_MESSAGE="DIALOGUE/UPDATE_CURRENT_MESSAGE",e.UPDATE_SURVEY_RESPONSE="DIALOGUE/UPDATE_SURVEY_RESPONSE",e.CLICK_LINK="DIALOGUE/CLICK_LINK",e.LOAD_GROMIT_SUGGESTED_ARTICLES="DIALOGUE/LOAD_GROMIT_SUGGESTED_ARTICLES",e.MARK_ARTICLE_AS_VIEWED="DIALOGUE/MARK_ARTICLE_AS_VIEWED",e.TOGGLE_CONFIRM_PASSWORD_MODAL="DIALOGUE/TOGGLE_CONFIRM_PASSWORD_MODAL",e.SAVE_ENCRYPTION_OPTIONS="DIALOGUE/SAVE_ENCRYPTION_OPTIONS"})(t.DialogueActionType||(t.DialogueActionType={}))})),define("modules/clean/chat/dialogue/dialogue_stone_proto_transformer",["require","exports","dropbox/proto/js_init_data/chat/chat"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertProtoSettingsToStone=t.convertProtoBotProviderToStone=t.convertProtoBotTypeToStone=t.convertStoneSettingsToProto=t.convertStoneBotProviderToProto=t.convertStoneBotTypeToProto=void 0;var n={cx_support:a.chat.DialogueBotType.CX_SUPPORT,cx_specialized:a.chat.DialogueBotType.CX_SPECIALIZED,business:a.chat.DialogueBotType.BUSINESS};t.convertStoneBotTypeToProto=function(e){return n[e[".tag"]]},t.convertStoneBotProviderToProto=function(e){switch(e[".tag"]){case"lex":return a.chat.DialogueBotProvider.LEX;case"rasa":return a.chat.DialogueBotProvider.RASA;default:return a.chat.DialogueBotProvider.UNKNOWN}},t.convertStoneSettingsToProto=function(e){var n=(e.experiments||[]).map((function(e){return new a.chat.DialogueExperiment(e)}));return new a.chat.DialogueChatSystemSettings({botProvider:t.convertStoneBotProviderToProto(e.bot_provider),botType:t.convertStoneBotTypeToProto(e.bot_type),environment:e.environment,settingsHmac:e.settings_hmac,experiments:n,proactiveIntent:e.proactive_intent})},t.convertProtoBotTypeToStone=function(e){var t=Object.keys(n).find((function(t){return n[t]===e}));if(!t)throw new Error("invalid bot type");return{".tag":t}},t.convertProtoBotProviderToStone=function(e){switch(e){case a.chat.DialogueBotProvider.LEX:return{".tag":"lex"};case a.chat.DialogueBotProvider.RASA:return{".tag":"rasa"};default:return{".tag":"unknown"}}},t.convertProtoSettingsToStone=function(e){return{bot_provider:t.convertProtoBotProviderToStone(e.botProvider),bot_type:t.convertProtoBotTypeToStone(e.botType),environment:e.environment,settings_hmac:e.settingsHmac,proactive_intent:e.proactiveIntent}}})),define("modules/clean/chat/dialogue/experiments",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getExperiments=void 0,t.getExperiments=function(e){var t={};return e.forEach((function(e){var a=e.name;t[a]=e.active})),t}})),define("modules/clean/chat/dialogue/components/async_dialogue",["require","exports","tslib","react"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncDialogue=void 0;var i=(n=a.__importDefault(n)).default.lazy((function(){return a.__awaiter(void 0,void 0,void 0,(function(){return a.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,a){e(["modules/clean/chat/dialogue/dialogue"],t,a)})).then(a.__importStar)];case 1:return[2,{default:t.sent().Dialogue}]}}))}))})),o=function(){return n.default.createElement(n.default.Fragment,null)};t.AsyncDialogue=function(e){return n.default.createElement(n.default.Suspense,{fallback:n.default.createElement(o,null)},n.default.createElement(i,a.__assign({},e)))}}));
//# sourceMappingURL=pkg-chat.min.js-vflTHb9zU.map