define(["require","exports","tslib","react","react-dom","classnames","dig-components/icons","dig-components/icons/src","dig-components/buttons","file-viewer/preview_audio_video/helper/thumbnails_helper","file-viewer/hooks/useStabilizedCallback"],(function(e,t,a,n,i,r,o,l,u,d,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoThumbnails=t.VideoThumbnailsComponent=t.formatTime=t.getTimeForThread=void 0,n=a.__importStar(n),r=a.__importDefault(r);var m="regular-button__28jcjT_GOB__toolbar_v2",c="thumbnail-holder__3kblCtOCSZ__toolbar_v2",f="thumbnail-wrapper__2k4177nvsp__toolbar_v2",_="thumbnail-holder-comment__1RUX0fnhci__toolbar_v2",h="comment-icon-holder__9uR8F69jlB__toolbar_v2",v="thumbnail-time__2ZZcIWUJCC__toolbar_v2",b="thumbnail-load-error__1vznVzV1n3__toolbar_v2",g="thumbnail-image__34hV8y3oyS__toolbar_v2",p="time-line__2Nv9jQhc_H__toolbar_v2";function T(e){var t;switch(null===(t=e.annotation)||void 0===t?void 0:t.type){case"audio":case"video":return e.annotation.time/100;default:return}}function S(e){var t=isNaN(e)||!isFinite(e)?0:e,a=Math.round(t%60),n=Math.floor(t/60)%60,i=Math.floor(t/3600);return{hours:0!==i?""+i:"",minutes:0!==i||0!==n?""+n:"",seconds:""+a}}function C(e,t){var a=S(e),n=S(t),i=n.hours,r=a.hours.padStart(n.hours.length,"0"),o=""===n.minutes?"0":n.minutes.padStart(2,"0"),l=a.minutes.padStart(o.length,"0"),u=n.seconds.padStart(2,"0"),d=a.seconds.padStart(2,"0");return i?{formattedTime:r+":"+l+":"+d,formattedDuration:i+":"+o+":"+u}:{formattedTime:l+":"+d,formattedDuration:o+":"+u}}t.getTimeForThread=T,t.formatTime=C;var E;(function(e){e.Requesting="requesting",e.Failed="failed",e.ImageLoaded="image_loaded"})(E||(E={})),t.VideoThumbnailsComponent=function(e){var t,a=e.vttUrl,i=e.onScrubberThumbnailsLoaded,S=e.duration,E=e.lastHighlightedThread,N=e.openThreadInRightRail,V=n.useRef([]),M=n.useState("requesting"),k=M[0],y=M[1],w=n.useState(0),R=w[0],I=w[1],j=n.useState(0),z=j[0],q=j[1],x=n.useState(),F=x[0],L=x[1],U=n.useState(0),B=U[0],O=U[1],X=n.useRef(null),D=E&&T(E),H=void 0!==D&&Math.abs(B-D)<.5,P=s.useStabilizedCallback((function(e){E&&H&&(null==N||N(E),e.stopPropagation())}));n.useEffect((function(){d.loadVtt(a).then((function(e){V.current=e,e&&e.length>0&&d.preloadThumbImage(e[0]).then((function(){y("image_loaded"),null==i||i(!0)})).catch((function(){null==i||i(!1),y("failed")}))})).catch((function(){null==i||i(!1),y("failed")}))}),[a,i]);var Z=s.useStabilizedCallback((function(e){var t=e.currentTarget.getBoundingClientRect(),a=t.width,n=e.clientX-t.left,i=Math.min(Math.max(n,0),a)/a*S;if(q(t.width),I(e.clientX-t.left),O(i),V.current){var r=V.current.find((function(e){return e.startTime<=i&&e.endTime>=i}));r&&L(d.parseVttCue(r))}}));n.useEffect((function(){var e=X.current;if(e)return e.addEventListener("click",P),function(){return e.removeEventListener("click",P)}}),[P,X]);var W=F||{},G=W.imageUrl,J=W.imageX,Q=W.imageY,Y=W.imageWidth,A=W.imageHeight,K="failed"===k?80:128,$="image_loaded"===k?{background:'url("'+G+'") no-repeat -'+J+"px -"+Q+"px",width:Y,height:A}:"failed"===k?{display:"none"}:{},ee=Math.min(Math.max(0,R-K/2),z-K),te={left:ee},ae={left:R-(ee+K/2)},ne=C(B,S).formattedTime;return n.default.createElement("div",{className:c,onMouseMove:Z},n.default.createElement("div",{className:r.default(f,(t={},t[_]=H,t[b]="failed"===k,t)),style:te,ref:X},n.default.createElement("div",{className:g,style:$},"requesting"===k?n.default.createElement("div",{className:"c-loader"}):null),H&&n.default.createElement("div",{className:h},n.default.createElement(u.IconButton,{className:r.default(m),variant:"transparent",size:"small",inverse:!0},n.default.createElement(o.UIIcon,{src:l.CommentLine}))),n.default.createElement("div",{className:v}," ",ne," "),n.default.createElement("div",{className:p,style:ae})))},t.VideoThumbnailsComponent.displayName="VideoThumbnailsComponent",t.VideoThumbnails=function(e){var r=e.container,o=a.__rest(e,["container"]);return i.createPortal(n.default.createElement(t.VideoThumbnailsComponent,Object.assign({},o)),r)}}));
//# sourceMappingURL=video_thumbnails_v2.min.js-vflREtwx5.map