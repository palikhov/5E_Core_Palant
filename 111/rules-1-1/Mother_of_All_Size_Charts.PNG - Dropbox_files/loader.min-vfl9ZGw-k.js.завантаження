define(["require","exports","tslib","react","react-intl","react-redux","modules/clean/react/action_bar/file_actions/portable/utils","modules/core/i18n","dig-components/icons/src","dig-components/buttons","dig-components/tooltips","dig-components/icons","dig-components/menu","modules/core/browser_detection","modules/clean/react/extensions/split_share_button_component","modules/clean/react/extensions/data/store","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer/share_helpers","modules/clean/react/file_viewer/constants","file-viewer/app","modules/clean/file_store/utils","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/utils","modules/clean/sharing/api/client","modules/clean/sharing/access_level","modules/clean/react/file_viewer/sdk_file_viewer/utils","modules/clean/integrations/zoom_share_dialog/async_modal","modules/clean/react/action_bar/action_bar_strings","typescript/component_libraries/retrieval-components/src/simple-action-bar/action_bar_types"],(function(e,t,i,n,a,r,o,s,l,c,u,d,f,_,S,h,p,m,v,E,I,w,g,b,D,A,R,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeShareMetaserverLoader=t.DisabledShareButton=t.SHARE_PLUGIN_ID=void 0,n=i.__importDefault(n),m=i.__importStar(m),t.SHARE_PLUGIN_ID="SHARE";var y=a.defineMessage({id:"VzQ1nj",defaultMessage:"Ask the owner of this file for permission to share it with others"}),T=a.defineMessage({id:"JDi0M8",defaultMessage:"Share"});t.DisabledShareButton=function(){var e=a.useIntl(),t=e.formatMessage(T),r=e.formatMessage(y),o=n.default.createElement(d.UIIcon,{src:l.ShareArrowLine});return n.default.createElement(u.Tooltip,{title:r,placement:"left"},n.default.createElement("span",{style:{display:"inline-block"},tabIndex:0},n.default.createElement(c.SplitButton,{variant:"primary",disabled:!0,renderMenu:function(e){var t=e.buttonProps;return n.default.createElement(f.Menu.Wrapper,null,(function(e){var a=e.getTriggerProps,r=e.getContentProps;return n.default.createElement(n.default.Fragment,null,n.default.createElement(c.Button,i.__assign({"aria-label":"Show options"},t,a(),{disabled:!0})),n.default.createElement(f.Menu.Content,i.__assign({},r(),{placement:"bottom-end"})))}))}},o,t)))},t.DisabledShareButton.displayName="DisabledShareButton";t.makeShareMetaserverLoader=function(e,a,c){return function(){var u=h.getStore(),f=c&&new g.FileShareApiClient({userId:c.id}),T=(function(){function h(o){var s=this;this.identifier=t.SHARE_PLUGIN_ID,this.lifecycle={previewDidInitialize:function(){return i.__awaiter(s,void 0,void 0,(function(){var t,n,r,o,s,l=this;return i.__generator(this,(function(i){switch(i.label){case 0:return t=e().file,n=I.isSharedFile(t),801,r=_.is_supported_mobile_browser(),this.isMobile=r||window.innerWidth<801,o=a===D.SDKPreviewSurface.SHARED_CONTENT_LINK||a===D.SDKPreviewSurface.SHARED_LINK,n&&!o&&f&&t.file_id!==(null===(s=this.metadata)||void 0===s?void 0:s.id)&&t.file_id!==this.lastFailedId?[4,f.getMetadataAlpha({contentId:t.file_id}).then((function(e){return l.metadata=e})).catch((function(){return l.lastFailedId=t.file_id}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.actionDefinitions.alwaysInOverflow=[this.actionToDisplay()],[2]}}))}))}},this.titleBarUI={Component:function(){var o=n.default.useState(void 0),l=o[0],d=o[1],_=n.default.useState(void 0),h=_[0],g=_[1],R=(function(){var e=function(){return E.calcResponsiveSize(window.innerWidth)},t=n.default.useState(e()),i=t[0],a=t[1];return n.default.useEffect((function(){var t=function(){return a(e())};return window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[]),i})();if(!c||a===D.SDKPreviewSurface.VERSION_HISTORY)return null;var y=e().file,T=I.isSharedFile(y),N=a===D.SDKPreviewSurface.SHARED_CONTENT_LINK||a===D.SDKPreviewSurface.SHARED_LINK;T&&!N&&f&&y.file_id!==(null==l?void 0:l.id)&&y.file_id!==h&&f.getMetadataAlpha({contentId:y.file_id}).then((function(e){return d(e)})).catch((function(){return g(y.file_id)}));var M=!!l&&l.access_type!==b.ACCESS_LEVEL.WRITER;if(N||T&&M)return n.default.createElement(t.DisabledShareButton,null);var L=I.isBrowseFile(y)?y.fq_path:"",C=I.isBrowseFile(y)?y.icon:"",O=w.isCloudDoc(y),H=w.getType(y),K=i.__assign(i.__assign({},y),{icon:C,fq_path:L,is_cloud_doc:O,type:H});return n.default.createElement(r.Provider,{store:u},n.default.createElement(S.SplitShareButton,{files:[K],user:c,variant:"primary",onShowShare:function(){m.share(y,c,null,p.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE),s.context.logUserAction({action:v.UserAction.Share,context:v.UserActionContext.TitleBarMain})},onPresentInZoom:function(){return(function(e,t){A.asyncShowModal(t.id,e,"file-viewer-modal-overlay")})(y.file_id,c)},showLeftDigIcon:R===P.ResponsiveSize.DESKTOP}))}},this.context=o}return Object.defineProperty(h.prototype,"actionDefinitions",{get:function(){return{alwaysInOverflow:[this.actionToDisplay()]}},enumerable:!1,configurable:!0}),h.prototype.shareDefinition=function(e){var t=this,i=e.file,r=a===D.SDKPreviewSurface.SHARED_CONTENT_LINK||a===D.SDKPreviewSurface.SHARED_LINK,u=I.isSharedFile(i),f=!!this.metadata&&this.metadata.access_type!==b.ACCESS_LEVEL.WRITER,_=r||u&&f;return o.makePluginActionDefinition({label:s.intl.formatMessage(R.SHARE_ACTION_STRING),disabled:_?{disabled:!0,tooltipMessage:s.intl.formatMessage(y)}:{disabled:!1},icon:n.default.createElement(d.UIIcon,{src:l.ShareArrowLine}),action:function(){c&&(m.share(i,c,null,p.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE),t.context.logUserAction({action:v.UserAction.Share,context:v.UserActionContext.TitleBarMain}))}})},h.prototype.actionToDisplay=function(){return c&&this.isMobile&&a!==D.SDKPreviewSurface.VERSION_HISTORY?[this.shareDefinition(e())]:[]},h})();return Promise.resolve(T)}}}));
//# sourceMappingURL=loader.min.js-vflAzQ6qV.map