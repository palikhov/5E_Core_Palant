define(["require","exports","tslib","react","classnames","react-redux","file-viewer/core/data/actions","file-viewer/core/data/selectors","file-viewer/core/index","file-viewer/renderer","file-viewer/titlebar/index","file-viewer/modes/index","file-viewer/modes/sidebar/sidebar","file-viewer/keyboard/index","react-intl","file-viewer/plugins/types","file-viewer/plugins/selectors/index","dig-components/layer","dig-components/progress_indicators","file-viewer/plugins/props","file-viewer/plugins/data","file-viewer/preview_error/index","file-viewer/modes/render_sidebar_pass","file-viewer/sidebar/index","file-viewer/modes/sidebar/utils","file-viewer/title_bar_v2/index","file-viewer/preview_archive/breadcrumbs","file-viewer/sidebar_v2/index","file-viewer/utils","file-viewer/mobile_web/footer","file-viewer/mobile_web/meatball_menu","file-viewer/toolbar/toolbar_v2","typescript/component_libraries/retrieval-components/src/simple-action-bar/action_bar_types","file-viewer/preview_audio_video/helper/browser_detection","file-viewer/sidebar_v2/edit_plugin_sidebar","file-viewer/preview_error/error_boundary","file-viewer/plugins/edit_fullscreen_plugin_action"],(function(e,i,r,n,t,a,l,o,s,d,p,c,u,v,f,g,w,_,b,I,h,m,S,E,P,y,F,T,R,A,C,V,D,M,B,K,O){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AppWithProvider=i.App=i.calcResponsiveSize=void 0,n=r.__importStar(n),t=r.__importDefault(t);var x="containerV2__OvbEQAIKCr__app",N="contentContainer__2Huk-vru58__app",k="contentWrapper__1kc_TlcqgD__app",z="editMode__-VmQB3Zn4d__app",L="loadingSpinnerWrapper__szEgATVSBO__app",U="isFullScreen__kqYJLQMHul__app is-full-screen__SKI98YOBk1__preview-core",H="editPluginFullscreenContainer__3qWxNU7cFt__app";function W(e){return M.is_mobile_or_tablet()?e>1026?D.ResponsiveSize.DESKTOP:e<=736?D.ResponsiveSize.MOBILE:D.ResponsiveSize.TABLET:e>736?D.ResponsiveSize.DESKTOP:e<=428?D.ResponsiveSize.MOBILE:D.ResponsiveSize.TABLET}i.calcResponsiveSize=W;var j=n.memo((function(e){var i=e.id,t=e.previewKey,a=e.isFileFlippingEnabled,o=e.isPreviewZoomed,s=e.enableFullscreen,d=e.dispatch,p=s?v.getKeyboardBinding({callback:function(){return d(l.enterFullScreen({previewKey:t,fileViewerId:i,sourceContext:"keyboard"}))},keyCode:v.Key.F}):[];if(!a)return n.createElement(v.KeyboardBindingConnector,{keyboardBindings:p});var c=v.getFileFlippingBindings({dispatch:d,previewKey:t,fileViewerId:i,requireCommandKey:o});return n.createElement(v.KeyboardBindingConnector,{keyboardBindings:r.__spreadArrays(c,p)})})),Q=(function(e){function i(i){var r=e.call(this,i)||this;return r.renderSidebarPASSFn=function(e){var i=r.props,n=i.config,t=i.fileMetadata;if(t){var a=t.fileConfig,l=S.renderSidebarPASSFn(n,a);if(l)return l(e)}return[]},r.renderSidebarCallToActionsFn=function(e){var i=r.props,n=i.renderSidebarCallToActionsFn,t=i.fileMetadata;if(n)return n(e);if(t){var a=t.fileConfig;return E.renderSidebarCallToActionsFn(a)(e)}return[]},r.onRenderSucceeded=function(e){var i;r.props.dispatch(s.logSessionEvent({event:"render_succeeded",fileViewerId:r.props.id,previewSessionId:e})),(null===(i=r.props.callbacks)||void 0===i?void 0:i.onRenderSucceeded)&&r.props.callbacks.onRenderSucceeded()},r.onRenderFailed=function(e){r.props.dispatch(s.logSessionEvent({event:"render_failed",fileViewerId:r.props.id,previewSessionId:e}))},r.logTTI=function(){r.props.dispatch(s.logTTI(r.props.id))},r.logTTV=function(){r.props.dispatch(s.logTTV(r.props.id))},r.state={openInAppInterstitialShown:!1},r}return r.__extends(i,e),i.prototype.componentDidMount=function(){this.props.dispatch(l.subscribeNetworkState()),this.props.onMount&&this.props.onMount();var e=document.getSelection();e&&e.removeAllRanges()},i.prototype.componentWillUnmount=function(){this.props.dispatch(l.unsubscribeNetworkState()),this.props.onDestroy&&this.props.onDestroy()},i.prototype.render=function(){var e,i,r,a=this,l=this.props,o=l.activePluginInstance,v=l.config,f=l.coreFileViewerUiData,w=l.dispatch,_=l.fileInfo,I=l.fileMetadata,h=l.filePreviewUiData,S=l.id,E=l.intl,M=l.previewMetadata,O=l.rivieraData,Q=l.registerSidebarPanesFn,q=l.renderSidebarControlsFn,Z=l.currentMode,G=l.loggingSession.file_preview_session_id,Y=l.loggingSession,J=l.pluginQueryBus,X=l.shouldShowSidebar,$=l.shouldShowTitlebar,ee=l.viewport,ie=l.pluginProps,re=l.rightRailPluginInstances,ne=l.pluginNavigation,te=l.sharedLinkInfo,ae=l.archiveFiles,le=l.fullFilePreviewUi,oe=l.fullRivieraData,se=l.isFullScreen,de=l.account,pe=l.isPreviewZoomed,ce=l.pluginInstances,ue=l.children,ve=o&&"mode"in o&&o.mode||{type:"default"},fe=void 0;"edit"===ve.type&&(fe=ve.titlePrefix);var ge=_.file_id,we=_.previewKey,_e=_.bootstrap,be=null!==(i=null==I?void 0:I.file_name)&&void 0!==i?i:"",Ie=null!==(r=null==I?void 0:I.file_path)&&void 0!==r?r:"",he=v.preview_page_revamp,me=v.mobile_web_fvsdk_variant,Se=v.preview_page_revamp,Ee=v.preview_content_only,Pe=R.extractToolbarComponentsFromPlugins(this.props.pluginInstances),ye=o&&g.isEditPluginOverlayInstance(o);if(o&&g.isEditPluginFullscreenInstance(o)){if(ie){var Fe=o.fullscreenLayer;return n.createElement("div",{className:H},n.createElement(Fe,Object.assign({},ie)))}return null}var Te=Object.values(ce).filter(g.isOpenInAppPluginInstance);if(Te.length>1)throw new Error("More than one Open-in-app plugin is not allowed");var Re=Te?Te[0]:void 0;if(ie&&Re&&!this.state.openInAppInterstitialShown){var Ae=Re.getInterstitial();if(Ae)return n.createElement(Ae,Object.assign({},ie,{onHide:function(){return a.setState({openInAppInterstitialShown:!0})}}))}return n.createElement(n.Fragment,null,ue,n.createElement(d.FileViewer,{className:t.default((e={},e[x]=he,e)),intl:E,viewport:ee},(function(e){var i,r,l,x,H,ee,ce,ue=e.width,Fe=e.height,Te=W(ue),Ae=(function(e,i,r,n){if(void 0===r&&(r=!0),void 0===n&&(n=!1),!r)return e;var t=n?c.SIDEBAR_OPEN_WIDTH_RIGHT_RAIL:c.SIDEBAR_OPEN_WIDTH,a=n?c.SIDEBAR_CLOSED_WIDTH_RIGHT_RAIL:c.SIDEBAR_CLOSED_WIDTH;return e<=(n?c.RIGHT_RAIL_RESPONSIVE_BREAKPOINT:c.SIDEBAR_RESPONSIVE_BREAKPOINT)?e:e-(i===s.SidebarVisibility.Open?t:a)})(ue,ye?s.SidebarVisibility.Open:Z.sidebar.visibility,X&&!Ee,Se),Ce=(function(e,i,r){var n=r?y.TITLE_BAR_V2_HEIGHT:p.TITLE_BAR_HEIGHT;return e-(i?n:0)})(Fe,$&&!Ee,he),Ve=he?ue-y.TITLE_BAR_BACK_AND_HELP_ICONS+32:Ae,De="archive"===(null===(x=null===(l=a.props.previewMetadata)||void 0===l?void 0:l.content)||void 0===x?void 0:x[".tag"])?{canExtract:!0,rootInfo:a.props.rootInfo,filePreviewUiData:h}:{canExtract:!1};ce=h.currentPath&&h.currentPath.length>0?n.createElement(F.ArchiveFileBreadcrumbs,{archiveName:be,currentPath:h.currentPath,fileViewerId:S,previewKey:we,dispatch:w,isMobile:Te===D.ResponsiveSize.MOBILE}):n.createElement(p.TruncatedTitle,{width:Ve,fileName:be,filePath:Ie});var Me,Be={downloadConfig:null==I?void 0:I.fileConfig.download_button,extractConfig:De,fileId:ge,dispatch:w,intl:E,fileViewerId:S,previewKey:we},Ke=$&&!Ee&&(he?n.createElement(y.TitleBarV2,{previewKey:we,dispatch:w,title:ce,mobileWebVariant:me,baseUrl:v.titlebar_logo_config.base_url,canCloseViewer:a.props.pluginNavigation.canCloseViewer,intl:E,fileViewerId:S,config:null==I?void 0:I.fileConfig,actions:R.extractActionsFromPlugins(a.props.pluginInstances,a.props.enabledEditPluginFullscreenActionDefinitions),responsiveSize:Te,width:ue,components:R.extractTitlebarComponentsFromPlugins(a.props.pluginInstances)}):n.createElement(p.Titlebar,{downloadButtonProps:Be,icon:v.titlebar_logo_config.show_logo?n.createElement(p.TitleBarLogo,{baseUrl:v.titlebar_logo_config.base_url,dispatch:w,previewKey:we,fileViewerId:S}):null,title:ce,isInverse:P.isPluginEditMode(ve),prefix:fe})),Oe=(function(){var e,i={fileViewerId:S,width:Ae,height:Ce,onRenderSucceeded:function(){return a.onRenderSucceeded(G)},onRenderFailed:function(){return a.onRenderFailed(G)},intl:E,dispatch:w,onInteractive:a.logTTI,onViewable:a.logTTV,config:v,currentMode:Z,filePreviewUiData:h,fileMetadata:I,fileInfo:_,previewMetadata:M,data:void 0,coreFileViewerUiData:f,activePluginInstance:o,pluginProps:ie,pluginQueryBus:J,extractConfig:De,sharedLinkInfo:te,previewKey:we,archiveFiles:ae,fullFilePreviewUi:le,fullRivieraData:oe,loggingSession:Y,account:de,fileConfig:null==I?void 0:I.fileConfig,toolbarPlugins:Pe,responsiveSize:Te,openInAppPluginInstance:Re};switch(_e.state){case"initializing":return n.createElement("div",{className:t.default(L,(e={},e[U]=se,e))},n.createElement(b.Spinner,{"aria-valuetext":E.formatMessage({id:"zqXonC",defaultMessage:"Your preview is loading"}),"aria-label":"preview-loading-spinner",inverse:se||P.isPluginEditMode(ve)}),v.preview_page_revamp&&n.createElement(V.ConfigurableToolbarV2,{featureConfig:v,previewKey:we,previewType:"loading",intl:E,filePreviewUi:h,fileMetadata:I,fileViewerUi:f,fileViewerId:S,plugins:Pe,previewWidth:Ae,responsiveSize:Te}));case"ready":return n.createElement(d.PreviewRenderer,Object.assign({rivieraData:O},i));case"errored":return n.createElement(m.PreviewError,Object.assign({error:_e.error},i))}})();Ee||se||(Se?Me=o&&g.isEditPluginOverlayInstance(o)?n.createElement(B.EditPluginSidebar,{fileViewerId:S,pluginNavigation:ne,pluginQueryBus:J,plugin:o}):n.createElement(T.PreviewRightRail,{previewKey:we,fileName:be,fileViewerId:S,intl:E,pluginInstances:re,pluginNavigation:ne,pluginQueryBus:J,height:he?Ce:void 0}):X&&Q&&q&&(Me=n.createElement(u.Sidebar,{registerSidebarPanesFn:Q,renderSidebarControlsFn:q,renderSidebarPASSFn:a.renderSidebarPASSFn,renderSidebarCallToActionsFn:a.renderSidebarCallToActionsFn,dispatch:w,fileId:ge,previewKey:we,fileViewerUiData:{currentMode:Z.mode,sidebar:Z.sidebar},pluginMode:ve,fileViewerId:S,intl:E,extractConfig:De})));var xe=n.createElement(j,{id:S,previewKey:we,enableFullscreen:v.enable_fullscreen,isFileFlippingEnabled:null!=I&&!!I.file_collection_context&&!ye,isPreviewZoomed:pe,dispatch:w});return he?n.createElement(n.Fragment,null,Ke,n.createElement("div",{className:N},n.createElement("div",{className:t.default(k,(i={},i[z]=P.isPluginEditMode(ve),i)),style:{width:Ae}},n.createElement(K.ErrorBoundary,Object.assign({},a.props,{activePluginInstance:o,previewKey:a.props.fileInfo.previewKey,key:we.serialized,fileViewerId:a.props.id,rivieraData:void 0,data:void 0,onRenderSucceeded:function(){return a.onRenderSucceeded(G)},fileConfig:null===(H=a.props.fileMetadata)||void 0===H?void 0:H.fileConfig,onRenderFailed:function(){return a.onRenderFailed(G)},width:Ae,height:Ce,onInteractive:a.logTTI}),Oe)),Me,xe,me&&n.createElement(A.Footer,{showAuthModal:a.props.pluginNavigation.showAuthModal,fileViewerId:a.props.id,previewKey:a.props.fileInfo.previewKey,variant:me})),me&&n.createElement(C.MeatballMenu,{previewKey:we,fileViewerId:S,sharedLinkInfo:te,size:null==I?void 0:I.size,showAuthModal:a.props.pluginNavigation.showAuthModal})):n.createElement(n.Fragment,null,n.createElement("div",{className:t.default(k,(r={},r[z]=P.isPluginEditMode(ve),r)),style:{width:Ve}},Ke,n.createElement(K.ErrorBoundary,Object.assign({},a.props,{activePluginInstance:o,previewKey:a.props.fileInfo.previewKey,key:we.serialized,fileViewerId:a.props.id,rivieraData:void 0,data:void 0,onRenderSucceeded:function(){return a.onRenderSucceeded(G)},fileConfig:null===(ee=a.props.fileMetadata)||void 0===ee?void 0:ee.fileConfig,onRenderFailed:function(){return a.onRenderFailed(G)},width:Ae,height:Ce,onInteractive:a.logTTI}),Oe)),Me,xe)})))},i})(n.PureComponent);i.App=Q;var q=a.connect((function(e,i){var r,n=i.config,t=i.id,a=i.pluginNavigation,l=i.pluginQueryBus,s=i.registerSidebarPanesFn,d=i.renderSidebarControlsFn,p=o.getCurrentFile(e,t),c=p.previewKey,u=e.previewData[c.serialized],v=w.getActivePluginId(e,{fileViewerId:t});if(null==v)r=null;else{var f=i.pluginInstances[v];r=f&&(g.parseEditPluginOverlayInstance(f)||g.parseEditPluginFullscreenInstance(f)||g.parseRightRailPluginInstance(f))}var _=I.makePluginProps(e,t,h.getPluginData(e,{fileViewerId:t,navigation:a}),l),b=w.getRuntimeDisabledPlugins(e,{fileViewerId:t}),m=o.getIsFullScreen(e,t),S=!m&&void 0!==s&&void 0!==d,E=!m&&n.show_titlebar&&!g.isEditPluginOverlayInstance(r),P=O.getEditPluginFullscreenActionDefinitions(i.pluginInstances,b,c,t);return{account:o.getLoadableCurrentUser(e),activePluginInstance:r,coreFileViewerUiData:e.fileViewerUi[t]||{},currentMode:e.modes[t],fileInfo:p,fileMetadata:e.fileMetadata[c.serialized],filePreviewUiData:(e.filePreviewUi[t]||{})[c.serialized]||{},isPreviewZoomed:o.isPreviewZoomed(e,{fileViewerId:t}),loggingSession:e.loggingSession[t],pluginProps:_,previewMetadata:u,rivieraData:e.rivieraData[c.serialized],sharedLinkInfo:e.sharedLinkInfo[c.serialized],shouldShowSidebar:S,shouldShowTitlebar:E,unstable_runtimeDisabledPluginsUsedOnlyToTriggerUpdate:b,rootInfo:e.rootInfo,archiveFiles:e.archiveFiles,fullFilePreviewUi:e.filePreviewUi[t]||{},fullRivieraData:e.rivieraData||{},isFullScreen:m,enabledEditPluginFullscreenActionDefinitions:P}}),(function(e){return{dispatch:e}}))(Q),Z=(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(i,e),i.prototype.render=function(){var e=this.props,i=e.store,t=e.intl,l=e.osModifierKey,o=r.__rest(e,["store","intl","osModifierKey"]),s=o.config;return n.createElement(a.Provider,{store:i},n.createElement(f.RawIntlProvider,{value:t},n.createElement(v.KeyboardBindingProvider,{disableBindings:!s.keyboard_shortcuts,osModifierKey:l},n.createElement(_.LayerContext.Provider,{value:501},n.createElement(q,Object.assign({intl:t},o))))))},i})(n.PureComponent);i.AppWithProvider=Z}));
//# sourceMappingURL=app.min.js-vfleUhfLD.map