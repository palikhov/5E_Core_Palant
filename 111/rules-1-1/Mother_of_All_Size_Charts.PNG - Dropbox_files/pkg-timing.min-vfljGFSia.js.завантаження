define("modules/clean/metrics/coin",["require","exports","tslib","apex-metrics/index","dropbox/proto/apex_metrics_web/apex_metrics_web","google/protobuf/timestamp","google/protobuf/empty"],(function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.observeCoin=t.APIv2CoinToProtobufCoin=t.protobufCoinToAPIv2Coin=t.newCoinState=void 0,t.newCoinState=function(){return r.apex_metrics_web.ApexMetricsCacheData.CoinState.create({lastFlipTime:null,lastResult:!1,numTimesChecked:0})},t.protobufCoinToAPIv2Coin=function(e){var t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit){case"independent":t={".tag":"independent"};break;case"permanent":t={".tag":"permanent"};break;case"nResults":t={".tag":"n_results",n_results:e.stickiness.nResults};break;case"nSeconds":t={".tag":"n_seconds",n_seconds:e.stickiness.nSeconds}}return{fraction:null!==e.fraction?e.fraction:void 0,stickiness:t?{limit:t}:void 0}},t.APIv2CoinToProtobufCoin=function(e){var t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit[".tag"]){case"independent":t={independent:a.google.protobuf.Empty.create()};break;case"permanent":t={permanent:a.google.protobuf.Empty.create()};break;case"n_results":t={nResults:e.stickiness.limit.n_results};break;case"n_seconds":t={nSeconds:e.stickiness.limit.n_seconds}}return r.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.create({fraction:e.fraction,stickiness:t?r.apex_metrics_web.RecordNamespace.StickinessV2.create(t):void 0})},t.observeCoin=function(e,t,r){if(!t.stickiness||!t.stickiness.limit)return{nextState:r,result:!1};var a,s,c=Date.now()/1e3,u=r.lastFlipTime,l=void 0===u?o.google.protobuf.Timestamp.create({seconds:0,nanos:0}):u,p=r.lastResult,d=r.numTimesChecked,m=void 0===d?0:d,_=!1;switch(t.stickiness.limit[".tag"]){case"n_results":_=null===m||m%t.stickiness.limit.n_results==0;break;case"n_seconds":if(!l){_=!0;break}_=i.Instant.toMilliseconds({value:(a=c,s=l.seconds,"number"!=typeof a?a.sub(s).toNumber():"number"==typeof s?a-s:s.sub(a).negate().toNumber()),unit:i.TimeUnit.SECONDS})>i.Instant.toMilliseconds({value:t.stickiness.limit.n_seconds,unit:i.TimeUnit.SECONDS});break;case"permanent":_=0===m;break;case"independent":_=!0;break;case"other":default:return{nextState:r,result:!1}}if(_){var f=e()<(t.fraction||0);return{nextState:{lastFlipTime:o.google.protobuf.Timestamp.create({seconds:c,nanos:0}),lastResult:f,numTimesChecked:m?m+1:1},result:f}}return{nextState:n.__assign(n.__assign({},r),{numTimesChecked:m?m+1:1}),result:!!p}}})),define("modules/clean/metrics/database",["require","exports","tslib","modules/clean/metrics/instrumentation"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadInstrumentation=t.storeInstrumentation=t.storeIncomingSpans=t.checkAndSetPublishTime=t.getDatabase=t.getNamespaceRange=t.INSTRUMENTATION_STORE_KEY=t.INSTRUMENTATION_STORE=t.CONTROL_VALUE_LASTPUBLISHTIME=t.CONTROL_VALUE_STORE=t.NAMESPACE_INDEX=t.SPAN_STORE=t.DATABASE_VERSION=void 0;function r(e,n,i){var r=e.result,o=function(e){r.removeEventListener("error",o),i(e)};r.addEventListener("error",o),e.transaction.addEventListener("complete",(function(){r.removeEventListener("error",o)})),e.transaction.addEventListener("error",(function(e){r.removeEventListener("error",o),i(e)}));var a=function(e,t){return e.oldVersion<t&&(null===e.newVersion||e.newVersion&&e.newVersion>=t)};if(a(n,1))try{r.createObjectStore(t.SPAN_STORE,{keyPath:["namespace","tagNames","tagValues"]}).createIndex(t.NAMESPACE_INDEX,"namespace",{unique:!1}),r.createObjectStore(t.CONTROL_VALUE_STORE,{keyPath:"name"})}catch(e){return void o(e)}if(a(n,2)){var s=e.transaction.objectStore(t.SPAN_STORE).openCursor();s.addEventListener("success",(function(e){var t=s.result;if(t){var n=!1;for(var i in t.value.spans)t.value.spans.hasOwnProperty(i)&&(n=!0,t.value.spans[i]={spanCount:0,samples:t.value.spans[i]});n&&t.update(t.value),t.continue()}}))}if(a(n,3))try{r.createObjectStore(t.INSTRUMENTATION_STORE,{keyPath:"name"})}catch(e){return void o(e)}if(a(n,4))try{e.transaction.objectStore(t.SPAN_STORE).clear(),e.transaction.objectStore(t.INSTRUMENTATION_STORE).clear()}catch(e){return void o(e)}}function o(e,t,n){try{return e.transaction(t,n)}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return null;throw e}}function a(e,t){return new Promise((function(n,i){var r=e.get(t);r.addEventListener("success",(function(e){n(r.result)})),r.addEventListener("error",(function(e){i(e)}))}))}function s(e,t){return new Promise((function(n,i){var r=e.put(t);r.addEventListener("success",(function(e){n()})),r.addEventListener("error",(function(e){i(e)}))}))}t.DATABASE_VERSION=4,t.SPAN_STORE="spans",t.NAMESPACE_INDEX="namespace",t.CONTROL_VALUE_STORE="controlValues",t.CONTROL_VALUE_LASTPUBLISHTIME="lastPublishTime",t.INSTRUMENTATION_STORE="selfInstrumentation",t.INSTRUMENTATION_STORE_KEY="instrumentation",t.getNamespaceRange=function(e,n){return new Promise((function(i,r){var o=e.index(t.NAMESPACE_INDEX).getKey(IDBKeyRange.lowerBound(n,!0));o.addEventListener("success",(function(e){if(o.result){var t=o.result[0];i(IDBKeyRange.bound([n],[t],!1,!0))}else i(IDBKeyRange.lowerBound([n]))})),o.addEventListener("error",(function(e){r(e)}))}))},t.getDatabase=function(e){return void 0===e&&(e=t.DATABASE_VERSION),n.__awaiter(this,void 0,Promise,(function(){var t,i;return n.__generator(this,(function(n){switch(n.label){case 0:if(t=null,"undefined"==typeof indexedDB)return[2,t];n.label=1;case 1:return n.trys.push([1,3,,7]),[4,new Promise((function(t,n){indexedDB.open("unused",1);var i=indexedDB.open("apexMetrics",e);i.addEventListener("success",(function(){t(i.result)})),i.addEventListener("error",(function(e){n(e)})),i.addEventListener("upgradeneeded",(function(e){try{r(i,e,n)}catch(e){n(e)}}))}))];case 2:return t=n.sent(),[3,7];case 3:return(i=n.sent()).target&&i.target.error&&i.target.error.name&&"VersionError"===i.target.error.name?[4,new Promise((function(e,t){var n=indexedDB.deleteDatabase("apexMetrics");n.addEventListener("success",(function(){return e()})),n.addEventListener("error",(function(e){return t(e)}))}))]:[3,6];case 4:return n.sent(),[4,new Promise((function(t,n){var i=indexedDB.open("apexMetrics",e);i.addEventListener("success",(function(){return t(i.result)})),i.addEventListener("error",(function(e){return n(e)})),i.addEventListener("upgradeneeded",(function(e){try{r(i,e,n)}catch(e){n(e)}}))}))];case 5:t=n.sent(),n.label=6;case 6:return[3,7];case 7:return[2,t]}}))}))},t.checkAndSetPublishTime=function(e,i,r){var o=this;return new Promise((function(a,s){return n.__awaiter(o,void 0,void 0,(function(){var o,c;return n.__generator(this,(function(n){try{o=e.transaction(t.CONTROL_VALUE_STORE,"readwrite").objectStore(t.CONTROL_VALUE_STORE)}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return a(!1),[2];throw e}return(c=o.get(t.CONTROL_VALUE_LASTPUBLISHTIME)).addEventListener("success",(function(e){var n=c.result;if(n&&i-+n.value<r)a(!1);else{var u=o.put({name:t.CONTROL_VALUE_LASTPUBLISHTIME,value:i});u.addEventListener("success",(function(){a(!0)})),u.addEventListener("error",(function(e){s(e)}))}})),c.addEventListener("error",(function(e){s(e)})),[2]}))}))}))},t.storeIncomingSpans=function(e,n){return Promise.all(n.map((function(n){return new Promise((function(i,r){var o;try{o=e.transaction(t.SPAN_STORE,"readwrite")}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void i();throw e}var a=o.objectStore(t.SPAN_STORE);o.addEventListener("complete",(function(e){return i()})),o.addEventListener("error",(function(e){return r(e)}));var s=[],c=[];for(var u in n.tags)n.tags.hasOwnProperty(u)&&(s.push(u),c.push(n.tags[u]));var l=a.get([n.namespace,s,c]);l.addEventListener("success",(function(e){var t=l.result?l.result:{namespace:n.namespace,tagNames:s,tagValues:c,spans:{}};t.spans[n.metricName]||(t.spans[n.metricName]={spanCount:0,samples:[]}),t.spans[n.metricName].spanCount++,t.spans[n.metricName].samples=t.spans[n.metricName].samples.concat(n.samples),t.spans[n.metricName].samples.sort(),a.put(t)}))}))})))},t.storeInstrumentation=function(e,r){var c=this;return new Promise((function(u,l){return n.__awaiter(c,void 0,void 0,(function(){var c,p,d,m,_,f;return n.__generator(this,(function(n){switch(n.label){case 0:return null===(c=o(e,t.INSTRUMENTATION_STORE,"readwrite"))?(u(),[2]):(p=c.objectStore(t.INSTRUMENTATION_STORE),c.addEventListener("complete",(function(){u()})),c.addEventListener("error",l),[4,a(p,t.INSTRUMENTATION_STORE_KEY)]);case 1:return d=null!==(f=null===(_=n.sent())||void 0===_?void 0:_.value)&&void 0!==f?f:i.Instrumentation.empty(),m=i.Instrumentation.merge(r,d),[4,s(p,{name:t.INSTRUMENTATION_STORE_KEY,value:m})];case 2:return n.sent(),[2]}}))}))}))},t.loadInstrumentation=function(e,r){var s=this;return new Promise((function(c,u){return n.__awaiter(s,void 0,void 0,(function(){var s,l,p,d,m;return n.__generator(this,(function(n){switch(n.label){case 0:return null===(s=o(e,t.INSTRUMENTATION_STORE,"readwrite"))?(c(r),[2]):(s.addEventListener("error",u),[4,a(l=s.objectStore(t.INSTRUMENTATION_STORE),t.INSTRUMENTATION_STORE_KEY)]);case 1:return p=null!==(m=null===(d=n.sent())||void 0===d?void 0:d.value)&&void 0!==m?m:i.Instrumentation.empty(),s.addEventListener("complete",(function(){c(i.Instrumentation.merge(r,p))})),(function(e,t){new Promise((function(n,i){var r=e.delete(t);r.addEventListener("success",(function(e){n()})),r.addEventListener("error",(function(e){i(e)}))}))})(l,t.INSTRUMENTATION_STORE_KEY),[2]}}))}))}))}})),define("modules/clean/metrics/filter",["require","exports","tslib","modules/clean/metrics/coin","modules/clean/metrics/database","modules/clean/metrics/serialization"],(function(e,t,n,i,r,o){"use strict";function a(e,t){return n.__awaiter(this,void 0,Promise,(function(){var i,r,o,a;return n.__generator(this,(function(n){switch(n.label){case 0:return i=null,crypto.subtle&&window.TextEncoder?(r=new TextEncoder,[4,crypto.subtle.digest("SHA-256",r.encode(t))]):[3,2];case 1:o=n.sent(),a=new Uint32Array(o),i=a.reduce((function(e,t){return e^t})),n.label=2;case 2:return null===i?[2,0]:[2,((i^e)>>>0)/4294967296]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.SpanGroupFilter=t.makeNamespaceMap=void 0,t.makeNamespaceMap=function(e,t){for(var n={},r=0,o=e;r<o.length;r++){var a=o[r],s=a.metric_namespace;n[s]={dropFractionOfHostsPerMetric:a.drop_fraction_of_hosts_per_metric||null,dropPeriodCoin:a.drop_periods?{config:a.drop_periods,state:t.namespaceCoinState&&t.namespaceCoinState[s]&&t.namespaceCoinState[s].dropPeriodCoin||i.newCoinState()}:null,dropSamplesCoin:a.drop_samples?{config:a.drop_samples,state:t.namespaceCoinState&&t.namespaceCoinState[s]&&t.namespaceCoinState[s].dropSamplesCoin||i.newCoinState()}:null}}return n};var s=(function(){function e(e,t,n,i,r,o){this.filterID=e,this.randomEngine=t,this.clock=n,this.maxScopes=i,this.namespaceMap=r,this.configuredNamespaces=o}return e.prototype.extend=function(t,i,r){return new e(this.filterID,this.randomEngine,this.clock,t||this.maxScopes,n.__assign(n.__assign({},this.namespaceMap),i),r)},e.prototype.getState=function(){var e={filterID:this.filterID,namespaceCoinState:{}};for(var t in this.namespaceMap)this.namespaceMap.hasOwnProperty(t)&&(e.namespaceCoinState[t]={dropPeriodCoin:this.namespaceMap[t].dropPeriodCoin?n.__assign({},this.namespaceMap[t].dropPeriodCoin.state):null,dropSamplesCoin:this.namespaceMap[t].dropSamplesCoin?n.__assign({},this.namespaceMap[t].dropSamplesCoin.state):null});return e},e.prototype.getConfiguredNamespaces=function(){return this.configuredNamespaces},e.prototype.partitionAndSerializeSpans=function(e,t,s,c){return n.__awaiter(this,void 0,Promise,(function(){var u=this;return n.__generator(this,(function(l){return[2,new Promise((function(l,p){var d,m=[],_=0,f=new Map,h=new Set;try{d=e.transaction(r.SPAN_STORE,"readwrite")}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void l([[],h,0,new Map]);throw e}d.addEventListener("complete",(function(){return l([m,h,_,f])})),d.addEventListener("error",(function(e){return p(e)}));var v,g=d.objectStore(r.SPAN_STORE);try{v=g.index(r.NAMESPACE_INDEX)}catch(e){return void p(e)}var S=v.openKeyCursor(null,"nextunique");S.addEventListener("success",(function(){return n.__awaiter(u,void 0,void 0,(function(){var e,u,l,d,v,w,b,T,y,E,O,I,C,N=this;return n.__generator(this,(function(A){switch(A.label){case 0:if(!(e=S.result))return[2];if(0!==this.maxScopes&&m.length===this.maxScopes)return[2];if(u=e.key,h.add(u),!this.configuredNamespaces.has(u))return e.continue(),[2];l=this.namespaceMap[u]||{},d=l.dropPeriodCoin,v=l.dropSamplesCoin,w=l.dropFractionOfHostsPerMetric,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,r.getNamespaceRange(g,u)];case 2:return b=A.sent(),[3,4];case 3:return T=A.sent(),p(T),[2];case 4:return d&&(y=i.observeCoin(this.randomEngine,d.config,d.state),E=y.result,O=y.nextState,d.state=O,E)?(g.delete(b),e.continue(),[2]):(I={metric_namespace:u,timestamp_sec:s,tags:o.formatTags(t),descendants:[]},(C=g.openCursor(b)).addEventListener("success",(function(){return n.__awaiter(N,void 0,void 0,(function(){var t,r,s,l,p,d,h,g,S,b=this;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(t=C.result))return I.descendants.length>0&&m.push(I),e.continue(),[2];for(p in r={tags:o.zipTags(t.value.tagNames,t.value.tagValues),metrics:[]},s=t.value.spans,l=[],s)l.push(p);d=0,n.label=1;case 1:return d<l.length?(h=l[d],s.hasOwnProperty(h)?w?[4,a(this.filterID,h)]:[3,3]:[3,4]):[3,5];case 2:if(n.sent()<w)return[3,4];n.label=3;case 3:if(g=s[h].samples,v&&(g=g.filter((function(e){var t=i.observeCoin(b.randomEngine,v.config,v.state),n=t.result,r=t.nextState;return v.state=r,!n}))),0===g.length)return[3,4];c.includes(u)||(_+=s[h].spanCount,f.set(u,(null!==(S=f.get(u))&&void 0!==S?S:0)+g.length)),r.metrics.push({name:{value:{".tag":"string_value",string_value:h}},data:{".tag":"numerical_data",samples:g}}),n.label=4;case 4:return d++,[3,1];case 5:return r.metrics.length>0&&I.descendants.push(r),t.delete(),t.continue(),[2]}}))}))})),[2])}}))}))}))}))]}))}))},e})();t.SpanGroupFilter=s})),define("modules/clean/metrics/index",["require","exports","tslib","apex-metrics/index","api_v2/noauth_client","modules/clean/metrics/database","modules/clean/metrics/apiv2_sink","modules/clean/metrics/unload","modules/clean/metrics/server_view_sink","modules/core/browser_detection","modules/core/exception"],(function(e,t,n,i,r,o,a,s,c,u,l){"use strict";function p(){return new i.BrowserPerformanceClock}function d(){for(var e=0,t=[[!!u.chrome,"chrome"],[!!u.edge,"edge"],[!!u.mozilla,"firefox"],[!!u.msie,"msie"],[!!u.safari,"safari"]];e<t.length;e++){var n=t[e];if(n[0])return n[1]}return"other"}function m(){return u.mac?{name:{".tag":"mac"},version:"unknown"}:u.windows?{name:{".tag":"windows"},version:(e=u.windowsInfo,e.windowsXP||e.windowsXPx64?"XP":e.windowsVista?"Vista":e.windows7?"7":e.windows8?"8":e.windows8_1?"8.1":e.windows10?"10 Unknown":"unknown")}:u.is_android()?{name:{".tag":"android"},version:"unknown"}:u.iOS?{name:{".tag":"ios"},version:"unknown"}:{name:{".tag":"unknown_os"},version:"unknown"};var e}Object.defineProperty(t,"__esModule",{value:!0}),t.getUnloadMetricsReporter=t.getMetricsReporter=void 0,u=n.__importStar(u),l=n.__importStar(l);var _=new r.NoAuthApiV2Client,f=a.makeDefaultCacheFactory(),h={detectBrowser:d,detectOS:m},v=new a.Apiv2MetricsSink(_,p(),a.makeDefaultInitialization(_,h,l),f,new i.SetTimeoutExecutor((function(){return{value:5*Math.random(),unit:i.TimeUnit.SECONDS}})),Math.random,o.getDatabase,h,l),g=new s.UnloadSink(f,v),S=new c.ServerViewMetricsSink;t.getMetricsReporter=function(){return void 0!==window._clientBridge?i.MetricsReporterImpl.root(S,p()):i.MetricsReporterImpl.root(v,p())},t.getUnloadMetricsReporter=function(){return i.MetricsReporterImpl.root(g,p())}})),define("modules/clean/metrics/instrumentation",["require","exports","tslib","modules/clean/metrics/serialization"],(function(e,t,n,i){"use strict";function r(e,t,n){n("samples_sink/submitted_spans",e.submittedSpans),n("samples_sink/submitted_samples",e.submittedSamples);for(var i=0,r=Object.entries(e.submittedSamplesByNs);i<r.length;i++){var o=r[i],a=o[0];n("samples_sink/submitted_samples_by_ns",o[1],{namespace:a})}n("samples_sink/retained_spans",e.retainedSpans),n("samples_sink/retained_samples",e.retainedSamples);for(var s=0,c=Object.entries(e.retainedSamplesByNs);s<c.length;s++){var u=c[s];a=u[0];n("samples_sink/retained_samples_by_ns",u[1],{namespace:a})}n("samples_sink/request/dropped_samples",e.requestDroppedSamples),n("samples_sink/request/dropped_spans",e.requestDroppedSpans),n("samples_sink/request/attempts",e.requestAttempts),n("samples_sink/request/latency",t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Instrumentation=t.SELF_INSTRUMENTATION_NAMESPACE=void 0,t.SELF_INSTRUMENTATION_NAMESPACE="amp_client",(function(e){function o(e,t){for(var i,r=n.__assign({},e),o=0,a=Object.entries(t);o<a.length;o++){var s=a[o],c=s[0],u=s[1];r[c]=(null!==(i=r[c])&&void 0!==i?i:0)+u}return r}e.empty=function(){return{submittedSpans:0,submittedSamples:0,submittedSamplesByNs:{},retainedSpans:0,retainedSamples:0,retainedSamplesByNs:{},requestDroppedSamples:0,requestDroppedSpans:0,requestAttempts:0}},e.incrementSubmittedSamples=function(e,t,n){e.submittedSamples+=n;var i=e.submittedSamplesByNs[t];e.submittedSamplesByNs[t]=(null!=i?i:0)+n},e.incrementRetainedSamples=function(e,t,n){e.retainedSamples+=n;var i=e.retainedSamplesByNs[t];e.retainedSamplesByNs[t]=(null!=i?i:0)+n},e.report=function(n,i,o,a){if(0===n.retainedSamples)return n.requestAttempts=0,n;var s=i.child({client_version:a.toString()});return r(n,o,(function(e,n,i){s.createStats({ns:t.SELF_INSTRUMENTATION_NAMESPACE,name:e},i).record(n)})),e.empty()},e.toScope=function(e,n,o){var a=[];return r(e,n,(function(e,t,n){a.push({tags:n?i.formatTags(n):[],metrics:[{name:{value:{".tag":"string_value",string_value:e}},data:{".tag":"numerical_data",samples:[t]}}]})})),{metric_namespace:t.SELF_INSTRUMENTATION_NAMESPACE,timestamp_sec:Math.floor(Date.now()/1e3),tags:i.formatTags(o),descendants:a}},e.merge=function(e,t){var n,i,r,a,s,c,u,l,p;return{submittedSpans:e.submittedSpans+(null!==(n=t.submittedSpans)&&void 0!==n?n:0),submittedSamples:e.submittedSamples+(null!==(i=t.submittedSamples)&&void 0!==i?i:0),submittedSamplesByNs:o(e.submittedSamplesByNs,null!==(r=t.submittedSamplesByNs)&&void 0!==r?r:{}),retainedSpans:e.retainedSpans+(null!==(a=t.retainedSpans)&&void 0!==a?a:0),retainedSamples:e.retainedSamples+(null!==(s=t.retainedSamples)&&void 0!==s?s:0),retainedSamplesByNs:o(e.retainedSamplesByNs,null!==(c=t.retainedSamplesByNs)&&void 0!==c?c:{}),requestDroppedSamples:e.requestDroppedSamples+(null!==(u=t.requestDroppedSamples)&&void 0!==u?u:0),requestDroppedSpans:e.requestDroppedSpans+(null!==(l=t.requestDroppedSpans)&&void 0!==l?l:0),requestAttempts:e.requestAttempts+(null!==(p=t.requestAttempts)&&void 0!==p?p:0)}}})(t.Instrumentation||(t.Instrumentation={}))})),define("modules/clean/metrics/serialization",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zipTags=t.formatTags=void 0,t.formatTags=function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t.push({name:{value:{".tag":"string_value",string_value:n}},value:{value:{".tag":"string_value",string_value:i}}})}return t},t.zipTags=function(e,t){if(e.length!==t.length)throw new Error("Cannot zip values of different dimensions!");return e.map((function(e,n){return{name:{value:{".tag":"string_value",string_value:e}},value:{value:{".tag":"string_value",string_value:t[n]}}}}))}})),define("modules/clean/metrics/apiv2_sink",["require","exports","tslib","apex-metrics/index","eventemitter3","modules/clean/metrics/coin","modules/clean/metrics/database","modules/clean/metrics/filter","modules/clean/metrics/instrumentation","google/protobuf/timestamp","dropbox/proto/apex_metrics_web/apex_metrics_web","proto_utils/unpack"],(function(e,t,n,i,r,o,a,s,c,u,l,p){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.Apiv2MetricsSink=t.makeDefaultCacheFactory=t._PERSISTENTCACHE_KEY=t.makeDefaultInitialization=t.makeNopPlatformDetector=t.CLIENT_VERSION=t.PublishType=void 0,r=n.__importDefault(r),(function(e){e.ALLOWED="allowed",e.DENIED="denied"})(d=t.PublishType||(t.PublishType={}));var m={".tag":"trigger_heartbeat"},_={".tag":"trigger_publish"};t.CLIENT_VERSION=17;function f(e,n,i,r){var o=[];return n.forEach((function(e){return o.push(e)})),{scopes:e,known_namespaces:o,environment:"prod",artifact_name:"dropbox-web",artifact_version:"0000000000000000000000000000000000000000",client_metadata:{client_version:t.CLIENT_VERSION,implementation:{".tag":"typescript"}},trigger:i,os:r}}t.makeNopPlatformDetector=function(){return{detectBrowser:function(){return"other"},detectOS:function(){return{name:{".tag":"unknown_os"},version:"unknown"}}}},t.makeDefaultInitialization=function(e,i,r){var a=this;return function(s){return n.__awaiter(a,void 0,void 0,(function(){var a,c,u,d,_,h,v;return n.__generator(this,(function(n){switch(n.label){case 0:return a=[],!s||!(c=(function(e,n){var i=e.getItem(t._PERSISTENTCACHE_KEY);if(null===i)return null;var r,a=Date.now()/1e3,s=[];try{r=p.unpackProto(i,l.apex_metrics_web.ApexMetricsCacheData)}catch(e){return n.reportException({err:e,tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],severity:"non-critical"}),null}if(!r.config||!r.state||!r.timeStored)return n.reportStack("Sink cache was missing data",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;var c=(function(e,t){if("number"!=typeof e)return e.sub(t).toNumber();if("number"==typeof t)return e-t;return t.sub(e).negate().toNumber()})(a,r.timeStored.seconds);if(c<0)return n.reportStack("Sink cache was stored in the future instead of the past",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],exc_extra:{cacheDataAge:c}}),null;var u={};r.config&&(s=r.config.reportingConfigs.map((function(e){return e.metricNamespace})),u.reporting_configs=r.config.reportingConfigs?r.config.reportingConfigs.filter((function(e){return c<e.maxTimeUntilRefreshSeconds})).map((function(e){return{metric_namespace:e.metricNamespace,max_time_until_refresh_seconds:e.maxTimeUntilRefreshSeconds,stop_publication_for_seconds:e.stopPublicationForSeconds,drop_samples:e.dropSamples?o.protobufCoinToAPIv2Coin(e.dropSamples):void 0,drop_periods:e.dropPeriods?o.protobufCoinToAPIv2Coin(e.dropPeriods):void 0,drop_fraction_of_hosts_per_metric:e.dropFractionOfHostsPerMetric,aggregation_interval_seconds:e.aggregationIntervalSeconds}})):[],u.publication_interval_seconds=r.config.publicationIntervalSeconds,u.max_scopes_per_request=r.config.maxScopesPerRequest,u.stop_publication_for_seconds=r.config.stopPublicationForSeconds,u.debug_infos=r.config.debugInfos);return{config:u,state:r.state,knownNamespaces:s}})(s,r))||(a=c.knownNamespaces,u=new Set,c.config.reporting_configs.forEach((function(e){return u.add(e.metric_namespace)})),a.some((function(e){return!u.has(e)})))?(d=new Set,a.forEach((function(e){return d.add(e)})),_=i.detectOS(),[4,e.ns("client_metrics").rpc("record",f([],d,m,_),{})]):[2,c];case 1:return h=n.sent(),v=Math.floor(4294967296*Math.random())>>>0,[2,{knownNamespaces:a,config:h,state:{filterID:v,namespaceCoinState:{}}}]}}))}))}},t._PERSISTENTCACHE_KEY="amp-sink-cache",t.makeDefaultCacheFactory=function(){return function(){try{return window.localStorage||null}catch(e){return null}}};var h=(function(){function e(e,t,n,i,o,a,s,u,l){var p=this;this.client=e,this.clock=t,this.initializer=n,this.cacheFactory=i,this.executor=o,this.randomEngine=a,this.databaseFactory=s,this.platformDetector=u,this.excReporter=l,this.nextRequest=null,this.knownNamespaces=new Set,this.bufferedSpans=[],this.instrumentation=c.Instrumentation.empty(),this.eventEmitter=new r.default,this.cache=this.cacheFactory(),this.currentRequest=this.initializer(this.cache).then((function(e){return e&&p.updateConfiguration(e.config,e.state),p.eventEmitter.emit("initialized"),e.config||null}))}return e.prototype.updateConfiguration=function(e,n){var r=this,a=e.reporting_configs,s=void 0===a?[]:a,c=e.stop_publication_for_seconds,d=e.publication_interval_seconds,m=new Set;s.forEach((function(e){r.knownNamespaces.add(e.metric_namespace),m.add(e.metric_namespace)})),this.updateBlackoutCallback({value:c,unit:i.TimeUnit.SECONDS}),this.updatePublishTimer({value:d,unit:i.TimeUnit.SECONDS}),this.updateSpanGroupFilter(e,n,m),this.cache&&(function(e,n,i){try{var r=Math.floor(Date.now()/1e3),a=l.apex_metrics_web.ApexMetricsCacheData.create({config:l.apex_metrics_web.RecordNamespace.RecordResponse.create({reportingConfigs:n.reporting_configs?n.reporting_configs.map((function(e){return l.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.create({metricNamespace:e.metric_namespace,maxTimeUntilRefreshSeconds:e.max_time_until_refresh_seconds,stopPublicationForSeconds:e.stop_publication_for_seconds,dropSamples:e.drop_samples?o.APIv2CoinToProtobufCoin(e.drop_samples):void 0,dropPeriods:e.drop_periods?o.APIv2CoinToProtobufCoin(e.drop_periods):void 0,dropFractionOfHostsPerMetric:e.drop_fraction_of_hosts_per_metric,aggregationIntervalSeconds:e.aggregation_interval_seconds})})):[],publicationIntervalSeconds:n.publication_interval_seconds,maxScopesPerRequest:n.max_scopes_per_request,stopPublicationForSeconds:n.stop_publication_for_seconds,debugInfos:n.debug_infos||[]}),timeStored:u.google.protobuf.Timestamp.create({seconds:r,nanos:0}),state:i});e.setItem(t._PERSISTENTCACHE_KEY,p.packProto(a))}catch(e){}})(this.cache,e,n)},e.prototype.updateSpanGroupFilter=function(e,t,n){for(var i=e.reporting_configs,r=void 0===i?[]:i,o=e.max_scopes_per_request,a=new Set,c=n.values(),u=c.next();!u.done;u=c.next())a.add(u.value);var l=s.makeNamespaceMap(r,t);this.spanGroupFilter=this.spanGroupFilter?this.spanGroupFilter.extend(o,l,a):new s.SpanGroupFilter(t.filterID,this.randomEngine,this.clock,o,l,a)},e.prototype.updateBlackoutCallback=function(e){var t=this;0!==e.value?(this.blackoutCallback=function(){return t.blackoutCallback=null,t.eventEmitter.emit("publicationResumed"),!1},this.eventEmitter.emit("publicationPaused"),this.executor.executeEvery(e,this.blackoutCallback)):this.blackoutCallback=null},e.prototype.updatePublishTimer=function(e){var t=this,r=e.unit===i.TimeUnit.SECONDS?e.value:i.Instant.toMilliseconds(e)/1e3;if(0!==e.value){if(!this.publishTimer||i.Instant.toMilliseconds(this.publishTimer.period)!==i.Instant.toMilliseconds(e)){var o={period:e,callback:function(){return t.publishTimer===o&&(t.nextRequest=t.currentRequest.then((function(){return n.__awaiter(t,void 0,void 0,(function(){var e,t,i;return n.__generator(this,(function(n){switch(n.label){case 0:return this.nextRequest=null,e=Math.floor(Date.now()/1e3),[4,this.getDB()];case 1:if(!(t=n.sent()))return[2];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,a.checkAndSetPublishTime(t,e,r)];case 3:return n.sent()&&(this.currentRequest=this.send()),[3,5];case 4:return i=n.sent(),this.excReporter.reportException({err:i,tags:["js:web:amp-sink"],severity:"operational"}),[3,5];case 5:return[2]}}))}))})),!0)}};this.publishTimer=o,this.executor.executeEvery(this.publishTimer.period,this.publishTimer.callback)}}else this.publishTimer=null},e.prototype.send=function(){return n.__awaiter(this,void 0,Promise,(function(){var e,t,i,r,o,s,u,l,p,m,h,v,g,S,w,b,T,y,E;return n.__generator(this,(function(n){switch(n.label){case 0:return this.blackoutCallback?(this.eventEmitter.emit("publish",d.DENIED),[2,null]):(e=Math.floor(Date.now()/1e3),t={browser:this.platformDetector.detectBrowser()},[4,this.getDB()]);case 1:if(!(i=n.sent()))return[2,null];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this.spanGroupFilter.partitionAndSerializeSpans(i,t,e,[c.SELF_INSTRUMENTATION_NAMESPACE])];case 3:return E=n.sent(),r=E[0],o=E[1],s=E[2],u=E[3],[3,5];case 4:return l=n.sent(),this.excReporter.reportException({err:l,tags:["js:web:amp-sink"],severity:"operational"}),[2,null];case 5:if((p=c.Instrumentation.empty()).retainedSpans+=s,m=0,u.forEach((function(e,t){c.Instrumentation.incrementRetainedSamples(p,t,e),m+=e})),h=r.length>0,this.knownNamespaces.forEach((function(e){return o.add(e)})),!h)for(v=this.spanGroupFilter.getConfiguredNamespaces(),g=o.values(),S=g.next();!S.done;S=g.next())if(!v.has(S.value)){h=!0;break}return w=null,h?[4,a.loadInstrumentation(i,p)]:[3,12];case 6:p=n.sent(),b=this.platformDetector.detectOS(),T=f(r,o,_,b),y=this.clock.now(),p.requestAttempts++,n.label=7;case 7:return n.trys.push([7,10,,11]),[4,this.client.ns("client_metrics").rpc("record",T,{})];case 8:return w=n.sent(),[4,this.reportInstrumentation(b,p,y,t)];case 9:return p=n.sent(),[3,11];case 10:return n.sent(),p.requestDroppedSpans+=s,p.requestDroppedSamples+=m,[3,11];case 11:w&&this.updateConfiguration(w,this.spanGroupFilter.getState()),n.label=12;case 12:return[4,a.storeInstrumentation(i,p)];case 13:return n.sent(),this.eventEmitter.emit("publish",d.ALLOWED),[2,w]}}))}))},e.prototype.reportInstrumentation=function(e,r,o,a){return n.__awaiter(this,void 0,Promise,(function(){var s,u,l,p,d;return n.__generator(this,(function(m){switch(m.label){case 0:if(s=i.Instant.toMilliseconds(this.clock.now())-i.Instant.toMilliseconds(o),!(function(e){return!!e.name&&("android"===e.name[".tag"]||"ios"===e.name[".tag"])})(e))return[3,4];m.label=1;case 1:return m.trys.push([1,3,,4]),u=n.__assign({client_version:t.CLIENT_VERSION.toString()},a),l=c.Instrumentation.toScope(r,s,u),p=new Set([c.SELF_INSTRUMENTATION_NAMESPACE]),d=f([l],p,_,e),[4,this.client.ns("client_metrics").rpc("record",d,{})];case 2:return m.sent(),[2,c.Instrumentation.empty()];case 3:return m.sent(),[2,r];case 4:return[2,c.Instrumentation.report(r,i.MetricsReporterImpl.root(this,this.clock),s,t.CLIENT_VERSION)]}}))}))},e.prototype.getDB=function(){return n.__awaiter(this,void 0,Promise,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return this.database?[3,2]:(e=this,[4,this.databaseFactory()]);case 1:e.database=t.sent(),t.label=2;case 2:return[2,this.database]}}))}))},e.prototype.recordSpan=function(e){var t=this;if(e.namespace!==c.SELF_INSTRUMENTATION_NAMESPACE){var i="UNCONFIGURED";this.spanGroupFilter&&this.spanGroupFilter.getConfiguredNamespaces().has(e.namespace)&&(i=e.namespace),this.instrumentation.submittedSpans++,c.Instrumentation.incrementSubmittedSamples(this.instrumentation,i,e.samples.length)}this.knownNamespaces.add(e.namespace),this.bufferedSpans.push(e),this.nextRequest||(this.nextRequest=this.currentRequest.then((function(){return n.__awaiter(t,void 0,void 0,(function(){var e,t,i,r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.getDB()];case 1:if(!(e=n.sent()))return[2];t=this.bufferedSpans,this.bufferedSpans=[],i=this.instrumentation,this.instrumentation=c.Instrumentation.empty(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,Promise.all([a.storeIncomingSpans(e,t),a.storeInstrumentation(e,i)])];case 3:return n.sent(),[3,5];case 4:return r=n.sent(),this.excReporter.reportException({err:r,tags:["js:web:amp-sink"],severity:"operational"}),[3,5];case 5:return this.publishTimer||(this.currentRequest=this.send()),this.nextRequest=null,[2]}}))}))})))},e})();t.Apiv2MetricsSink=h})),define("modules/clean/metrics/server_view_sink",["require","exports","tslib"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerViewMetricsSink=void 0;var i=(function(){function t(){this.spans=[],this.bridgeInitialized=!1}return t.prototype.recordSpan=function(e){this.spans.push(e),this.bridgeInitialized||this.initializeBridgeSink()},t.prototype.initializeBridgeSink=function(){return n.__awaiter(this,void 0,Promise,(function(){var t,i=this;return n.__generator(this,(function(r){switch(r.label){case 0:return this.bridgeInitialized=!0,[4,new Promise((function(t,n){e(["modules/clean/server_side_client_view_bridge"],t,n)})).then(n.__importStar)];case 1:return[4,(t=r.sent()).IsBridgeFunctionSupported("reportMetricsV2")];case 2:return r.sent()?(setInterval((function(){i.spans.length>0&&(t.ReportMetrics(i.spans),i.spans=[])}),5e3),window.addEventListener("beforeunload",(function(){i.spans.length>0&&(console.log("Attempting to send "+i.spans.length+" pending AMP spans"),t.ReportMetrics(i.spans),i.spans=[])}))):setInterval((function(){this.spans=[]}),6e4),[2]}}))}))},t})();t.ServerViewMetricsSink=i})),define("modules/clean/metrics/unload",["require","exports","tslib","eventemitter3"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnloadSink=void 0,i=n.__importDefault(i);var r=(function(){function e(e,t){var n=this;this.cacheFactory=e,this.innerSink=t,this.eventEmitter=new i.default,this.onUnloadChange=function(){n.isUnload()||n.flushToInner()},this.persistor=new a(this.cacheFactory()),this.listener=new o(this.onUnloadChange),this.onUnloadChange()}return e.prototype.flushToInner=function(){var e=this;this.persistor.getAllAndClear().forEach((function(t){e.recordSpanToInner(t)}))},e.prototype.isUnload=function(){return Boolean(this.listener.isUnload)},e.prototype.recordSpan=function(e){if(this.isUnload())return this.persistor.persistSpans([e]),void this.eventEmitter.emit("spansPersistedInUnload");this.recordSpanToInner(e)},e.prototype.recordSpanToInner=function(e){var t=n.__assign(n.__assign({},e),{fromUnloadSink:!0});this.innerSink.recordSpan(t)},e})();t.UnloadSink=r;var o=(function(){function e(e){this.onUnloadChange=e,this._isUnload=!1,this.listenForNavigationChanges()}return Object.defineProperty(e.prototype,"isUnload",{get:function(){return this._isUnload},set:function(e){this._isUnload!==e&&(this._isUnload=e,this.onUnloadChange())},enumerable:!1,configurable:!0}),e.prototype.listenForNavigationChanges=function(){var e=this;if("undefined"!=typeof window&&"function"==typeof window.addEventListener&&"function"==typeof document.addEventListener){var t=function(){"hidden"===document.visibilityState?e.isUnload=!0:"visible"===document.visibilityState&&(e.isUnload=!1)},n=function(){e.isUnload=!0,window.removeEventListener("pagehide",n),document.removeEventListener("visibilitychange",t)};window.addEventListener("pagehide",n),document.addEventListener("visibilitychange",t)}},e})(),a=(function(){function e(e){this.cache=e,this.CACHE_KEY="amp-persisted-spans-v2",this.OLD_CACHE_KEY="amp-persisted-spans"}return e.prototype.getAllAndClear=function(){if(!this.cache)return[];var e=this.retrieveSpans();try{this.cache.setItem(this.CACHE_KEY,JSON.stringify([])),this.cache.removeItem(this.OLD_CACHE_KEY)}catch(e){}return e},e.prototype.persistSpans=function(e){if(this.cache&&e){var t=this.retrieveSpans();t.push.apply(t,e);try{this.cache.setItem(this.CACHE_KEY,JSON.stringify(t))}catch(e){}}},e.prototype.retrieveSpans=function(){var e=[];try{e=JSON.parse(this.cache.getItem(this.CACHE_KEY))}catch(e){}return e||[]},e})()})),define("modules/clean/perf_tools/resource_utils",["require","exports","tslib","modules/core/browser","modules/clean/js_client_stopwatch","modules/clean/perf_tools/cpu_utils"],(function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.summarizePerformanceResourceTimings=t.logResourceTiming=t.logResourcesData=void 0,i=n.__importStar(i),o=n.__importStar(o),t.logResourcesData=function(e){(function(e){var t=window.requireContexts;if(!t)return;var n=o.listExecutionPerfMeasurementsForRequireContexts(t),i=r.JSStopwatch.createDetachedStopwatch("resource_init_timeline",e);n.forEach((function(e){var t=i.startSpan(e.name,{startTime:e.startTime});i.addSpanAnnotation(e.name,"totalTimeNs",Math.round(1e6*e.totalTime).toString(),t),i.endSpan(e.name,{endTime:e.startTime+e.totalTime,spanId:t})})),i.logData()})(e),(function(e){var t=i.performance();if(!t||!t.getEntriesByType)return;var n=r.JSStopwatch.createDetachedStopwatch("resource_timeline",e),o={},a=t.getEntriesByType("resource");if(a instanceof Array)for(var u=0,l=a;u<l.length;u++){var p=l[u],d=s(p);if(d){var m=o[d]||0;o[d]=m+1,m>0&&(d=d+"-"+m);var _=n.startSpan(d,{startTime:p.startTime,async:!0}),f=c(p);n.addSpanAnnotation(d,"type",f,_),0===p.transferSize?n.addSpanAnnotation(d,"cached","true",_):void 0===p.transferSize?n.addSpanAnnotation(d,"cached","unknown",_):n.addSpanAnnotation(d,"cached","false",_),p.responseEnd<p.startTime?(n.addSpanAnnotation(d,"negativeSpanLength",(p.responseEnd-p.startTime).toString(),_),n.endSpan(d,{endTime:p.startTime,spanId:_})):n.endSpan(d,{endTime:p.responseEnd,spanId:_})}}n.logData()})(e)};var a=document&&document.createElement?document.createElement("a"):null;function s(e){if(a){if(a.href=e.name,a.host.match(/dropboxstatic.com$/)&&a.pathname.match(/^\/static/)){var t=a.pathname,n=t.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);n&&n.index&&(t=t.substring(0,n.index-1));for(var i=0,r=["/static/js/","/static/"];i<r.length;i++){var o=r[i];t.startsWith(o)&&(t=t.substring(o.length))}return t}return a.host.match(/photos-[0-9]+.dropbox.com$/)&&a.pathname.match(/^\/t\/2/)?"/thumbnail":void 0}}function c(e){var t=e.name,n=e.initiatorType,i=t.lastIndexOf(".");if(i>0){var r=t.substring(i);if([".png",".gif",".jpg",".svg"].indexOf(r)>-1)return"img";if(".js"===r)return"script";if(".css"===r)return"css"}return-1===["css","img","script","link"].indexOf(n)?"xmlhttprequest"===n?"ajax":"other":n}t.logResourceTiming=function(e){var t=i.performance();if(t&&t.getEntriesByType){var n=t.getEntriesByType("resource").filter((function(t){return-1!==t.name.indexOf(e)}))[0];if(n&&n.responseEnd){var o="resource_response_end_"+e;return r.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),r.JSStopwatch.recordTrace(o,{stopwatchName:"resource_timing",traceTime:n.responseEnd}),n}}},t.summarizePerformanceResourceTimings=function(e,t){void 0===t&&(t=void 0);var n={pre:{},total:{}};if(r.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),e instanceof Array)for(var i=function(e){var i=c(e),r=[];t&&e.responseEnd<=t&&(i in n.pre||(n.pre[i]={count:0,total_time:0,last_transfer_end:0}),r.push(n.pre[i])),i in n.total||(n.total[i]={count:0,total_time:0,last_transfer_end:0}),r.push(n.total[i]),r.forEach((function(t){var n;t.count++,t.total_time+=e.duration,t.last_transfer_end=Math.max(t.last_transfer_end,e.responseEnd),"css"!==(n=i)&&"script"!==n&&"img"!==n||void 0===e.transferSize||void 0===e.encodedBodySize||(t.total_size=t.total_size||0,t.transfer_size=t.transfer_size||0,0!==e.transferSize&&(t.transfer_size+=e.encodedBodySize),t.total_size=t.total_size||0,t.total_size+=e.encodedBodySize)}))},o=0,a=e;o<a.length;o++){i(a[o])}return n}})),define("modules/clean/perf_tools/cpu_utils",["require","exports","modules/clean/js_client_stopwatch"],(function(e,t,n){"use strict";var i;function r(e){if(e.require&&e.require.perfMeasurements){var t=0;return e.require.perfMeasurements.map((function(e){var n=e.name,i=e.startTime,r=e.totalTime;return n.endsWith("anon")&&(n+="-"+t++),{jsExecutionType:c(n),name:n,startTime:i,totalTime:r}}))}var n=e.module_callback_times;return Object.keys(n).filter((function(e){return n[e].callbackDuration&&n[e].callbackTime})).map((function(e){return{jsExecutionType:c(e),name:e,startTime:n[e].callbackTime,totalTime:n[e].callbackDuration}}))}function o(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t=t.concat(r(i))}return t}function a(e){return Object.keys(e).map((function(t){var n=e[t];return{measurement:{jsExecutionType:s(t),name:t,startTime:n.start,totalTime:n.end-n.start},annotations:n.annotations}}))}function s(e){return e.startsWith("dws-processChunk")?i.DWS:i.UNKNOWN}function c(e){return e.startsWith("execCb.anon")||e.startsWith("overhead.anon")||e.startsWith("execCb.require-tier")||e.startsWith("overhead.require-tier")?i.OTHER:e.startsWith("execCb")||e.startsWith("overhead")?i.MODULE:i.UNKNOWN}Object.defineProperty(t,"__esModule",{value:!0}),t.logCumulativeExecutionTimes=t.cumulativeExecutionTimesBefore=t.listAnnotatedExecutionPerfMeasurementsForEnsemble=t.listExecutionPerfMeasurementsForRequireContexts=t.getAllGlobalExecutionPerfMeasurements=t.ALL_JS_EXECUTION_TYPES=t.JSExecutionType=void 0,(function(e){e.DWS="dws",e.MODULE="module",e.OTHER="other",e.UNKNOWN="unknown"})(i=t.JSExecutionType||(t.JSExecutionType={})),t.ALL_JS_EXECUTION_TYPES=[i.DWS,i.MODULE,i.OTHER,i.UNKNOWN],t.getAllGlobalExecutionPerfMeasurements=function(){var e=[];return window.ensemble&&window.ensemble.getJSStopwatchData&&(e=e.concat(a(window.ensemble.getJSStopwatchData()).map((function(e){return e.measurement})))),window.requireContexts&&(e=e.concat(o(window.requireContexts))),e},t.listExecutionPerfMeasurementsForRequireContexts=o,t.listAnnotatedExecutionPerfMeasurementsForEnsemble=a,t.cumulativeExecutionTimesBefore=function(e,t){var n={},i=function(i){if(e.hasOwnProperty(i)){var r=e[i];n[i]={},t.forEach((function(e){0<e.startTime&&e.startTime<r&&(n[i][e.jsExecutionType]=n[i][e.jsExecutionType]||0,n[i][e.jsExecutionType]+=e.totalTime)}))}};for(var r in e)i(r);return n},t.logCumulativeExecutionTimes=function(e,i){var r=n.JSStopwatch.createDetachedStopwatch("cumulative_cpu_time",e),o=function(e){i.hasOwnProperty(e)&&t.ALL_JS_EXECUTION_TYPES.forEach((function(t){r.recordTrace("cpu_before_"+e+"_due_to_"+t,i[e][t]||0)}))};for(var a in i)o(a);r.logData()}})),define("modules/clean/perf_tools/browser_perf_utils",["require","exports","tslib","modules/core/browser","modules/core/xhr","modules/constants/request","modules/clean/js_client_stopwatch","modules/constants/webtiming"],(function(e,t,n,i,r,o,a,s){"use strict";function c(e){var t=i.performance();if(t&&t.timing){var n=t.timing,c={navigation_start:n.navigationStart,unload_event_start:n.unloadEventStart,unload_event_end:n.unloadEventEnd,redirect_start:n.redirectStart,redirect_end:n.redirectEnd,fetch_start:n.fetchStart,domain_lookup_start:n.domainLookupStart,domain_lookup_end:n.domainLookupEnd,connect_start:n.connectStart,secure_connect_start:n.secureConnectionStart,connect_end:n.connectEnd,request_start:n.requestStart,response_start:n.responseStart,response_end:n.responseEnd,dom_loading:n.domLoading,dom_interactive:n.domInteractive,dom_content_loaded_event_start:n.domContentLoadedEventStart,dom_content_loded_event_end:n.domContentLoadedEventEnd,dom_complete:n.domComplete,load_event_start:n.loadEventStart,load_event_end:n.loadEventEnd},u={};u.request_id=o.REQUEST_ID,u.referrer=document.referrer;var l=a.JSStopwatch.createDetachedStopwatch("browser_perf",e);for(var p in c)c.hasOwnProperty(p)&&(u[p]=c[p],c[p]&&l.recordTrace(p,c[p]-n.navigationStart));l.logData(),s.LOG_BROWSER_PERFORMANCE_INFO&&r.sendXhr("/alternate_wtl_browser_performance_info",u)}}Object.defineProperty(t,"__esModule",{value:!0}),t.logBrowserPerformanceInfo=t.logBrowserPerfData=void 0,i=n.__importStar(i),r=n.__importStar(r),o=n.__importStar(o),s=n.__importStar(s),t.logBrowserPerfData=function(e){(function(e){var t=i.performance();if(!t||!t.getEntriesByType)return;var n=a.JSStopwatch.createDetachedStopwatch("performance_marks",e),r=t.getEntriesByType("mark");if(r instanceof Array)for(var o=0,s=r;o<s.length;o++){var c=s[o];n.recordTrace(c.name,c.startTime)}n.logData()})(e),c(e)},t.logBrowserPerformanceInfo=c})),define("modules/clean/perf_tools/web_timing_logger_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTimerEvent=t.NavigationType=void 0;var n=(function(){function e(){}return e.getFromNavigation=function(t){switch(t.type){case t.TYPE_NAVIGATE:return e.NAVIGATE;case t.TYPE_RELOAD:return e.RELOAD;case t.TYPE_BACK_FORWARD:return e.BACK_FORWARD}},e.NAVIGATE="navigate",e.RELOAD="reload",e.BACK_FORWARD="back_forward",e})();t.NavigationType=n;var i=(function(){function e(t,n,i,r,o){void 0===i&&(i=!1),void 0===r&&(r=!0),this.name=t,this.flag=1<<n,this.triggersLogging=i,this.timestampPrefix=o||t,this.ordered=r,e.allEvents.push(this)}return e.allEvents=[],e.APPLICATION_START=new e("application_code_start",1),e.LOAD_END=new e("load_end",2,!0,!1),e.MARK_TIME_TO_VIEW=new e("mark_time_to_view",3,!0,!0,"TTV"),e.FETCHED_DATA_FOR_TTI=new e("fetched_data_required_for_tti",4),e.MARK_TIME_TO_INTERACTIVE=new e("mark_time_to_interactive",5),e.TIME_TO_INTERACTIVE=new e("time_to_interactive",6,!0,!0,"TTI"),e})();t.WebTimerEvent=i})),define("modules/clean/perf_tools/web_timing_utils",["require","exports","tslib","modules/core/browser"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellableCallback=t.WebTimingUtil=void 0,i=n.__importStar(i);var r=(function(){function e(){}return e.generateCorrelationId=function(){return Math.random().toString(36).substring(2)},e.getNow=function(){var e=i.performance();if(e&&e.timing&&e.now){var t=e.timing;return(t.navigationStart||t.fetchStart)+Math.floor(e.now())}return Date.now()},e.newContext=function(t,n){var r;if(void 0===n&&(n="unnamed_timer"),t)r=e.getNow();else{var o=i.performance();if(o&&o.timing){var a=o.timing;r=a.navigationStart||a.fetchStart}else r=e.getNow()}return{initialized:!1,is_pagelet:!1,is_dws:!1,is_dws2:!1,is_early_ensemble:!1,log_time_to_view:!1,log_time_to_interactive:!1,ttv_at_dom_interactive:!1,tti_at_dom_interactive:!1,source_type:"web",subtypes:{},tti_exclusion_flow:"",have_logged_web_timing:!1,delayed_tti_for_css:!1,timing_results:null,start_time:r,time_to_view:null,time_to_interactive:null,correlation_id:e.generateCorrelationId(),timesStagesWereReached:{},context_name:n}},e})();t.WebTimingUtil=r;var o=(function(){function e(e){this.canceled=!1,this.callback=e}return e.prototype.exec=function(){this.canceled||this.callback()},e.prototype.cancel=function(){this.canceled=!0},e.prototype.isCanceled=function(){return this.canceled},e})();t.CancellableCallback=o})),define("modules/clean/visibility_logging",["require","exports","modules/clean/js_client_stopwatch","modules/clean/js_basic_stopwatch"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logVisibilityChangeEvents=t.logPaintPerformance=void 0,t.logPaintPerformance=function(e){if(window.performance&&window.performance.getEntriesByType){var t=window.performance.getEntriesByType("paint").map((function(e){return{type:i.TimingDataType.Trace,name:e.name,endTime:e.startTime}}));if(t.length>0){var r=n.JSStopwatch.createDetachedStopwatch("paint",e);r.recordEntries(t),r.logData()}}},t.logVisibilityChangeEvents=function(e,t){if(window.performance&&window.performance.getEntriesByType){var r=Number.MAX_VALUE;e.time_to_interactive&&(r=e.time_to_interactive-e.start_time);var o,a=window.performance.getEntriesByType("mark").filter((function(e){return e.name.startsWith("VisibilityState.")})).map((function(e){return{visibility:e.name,time:e.startTime}})),s={"VisibilityState.visible":0,"VisibilityState.hidden":0},c=function(e){o&&o.time<r&&(s[o.visibility]=(s[o.visibility]||0)+Math.min(e,r)-o.time)},u=[];for(var l in a.forEach((function(e,t){c(e.time),u.push({type:i.TimingDataType.Trace,name:"visibility-change-"+t,endTime:e.time,annotations:{visibility:e.visibility}}),o=0===t?{visibility:e.visibility,time:0}:e})),c(window.performance.now()),s)s.hasOwnProperty(l)&&u.push({type:i.TimingDataType.Trace,name:"total-"+l+"-time",endTime:s[l]});var p=n.JSStopwatch.createDetachedStopwatch("visibility",t);p.recordEntries(u),p.logData()}}})),define("modules/clean/web_module_timing",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.add_module=t.get_module_times=void 0,t.get_module_times=function(){var e=[];for(var t in window.requireContexts){var n=window.requireContexts[t].module_callback_times;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];if(null!=r.loadTime){var o={load_time:r.loadTime,callback_duration:r.callbackDuration,callback_time:r.callbackTime,name:r.name,url:r.url,parent:r.parent};e.push(o)}}}return e},t.add_module=function(){}})),define("modules/clean/web_timing_logger",["require","exports","tslib","apex-metrics/index","modules/clean/active_user","modules/clean/metrics/index","modules/clean/devtools/panels/performance/perf_hub_actions","modules/clean/event_load","modules/clean/web_module_timing","modules/clean/window_util","modules/clean/perf_tools/resource_utils","modules/clean/perf_tools/web_timing_logger_types","modules/clean/perf_tools/web_timing_utils","modules/clean/js_client_stopwatch","modules/clean/perf_tools/browser_perf_utils","modules/clean/init_react","modules/clean/perf_tools/cpu_utils","modules/clean/js_basic_stopwatch","modules/constants/request","modules/constants/webtiming","modules/constants/page_load","modules/core/assert","modules/core/browser","modules/core/exception","modules/core/xhr","dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","modules/clean/visibility_logging","modules/clean/user_centric_perf_metrics/metrics_logger"],(function(e,t,n,i,r,o,a,s,c,u,l,p,d,m,_,f,h,v,g,S,w,b,T,y,E,O,I,C){"use strict";var N;Object.defineProperty(t,"__esModule",{value:!0}),t.log_js_modules_fetched_data_required_for_tti=t.log_js_modules_application_code_start=t.waitForTTI=t.mark_time_to_interactive=t.mark_time_to_view=t.set_tti_exclusion_flow=t.time_since_start=t.start_time=t.reset=t.initialize=t.initialize_module=t.time_to_interactive=t.time_to_view=t.delete_timer=t.get_timer=t.perfHubClassName=void 0,s=n.__importStar(s),u=n.__importStar(u),g=n.__importStar(g),S=n.__importStar(S),w=n.__importStar(w),T=n.__importStar(T),y=n.__importStar(y),E=n.__importStar(E),(function(e){e[e.NEW=1]="NEW",e[e.RUNNING=2]="RUNNING",e[e.ABORTED=3]="ABORTED",e[e.CLOSED=4]="CLOSED"})(N||(N={})),t.perfHubClassName="perf-hub-link-container";var A=["navigation_type","referrer","repo_rev","source_type","active_user_id"],x=["tti_flow","tti_exclusion_flow","is_dws2"];function M(){return"hidden"===window.document.visibilityState}var D=[[p.WebTimerEvent.APPLICATION_START,p.WebTimerEvent.MARK_TIME_TO_VIEW,p.WebTimerEvent.FETCHED_DATA_FOR_TTI,p.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[p.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse(),R=1;var k=["requirejs_start","ensemble_payload_start","body_start"];var L=["craft_fast_prefetch_done","dws_core_externals_loaded","dws_ensemble_init","dws-processChunk-embedded-app-done-1","dws-processChunk-embedded-app-require_config-1","ensemble_init","module_init","last_js_const_end","pagelet_render_on_page_embedded-app","pagelet_css_loaded_embedded-app"];var P,U=(function(){function e(){m.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),this.shouldLogJsModuleTimes=function(){return Math.random()<.001}}return e.prototype.buildBaseParams=function(e,t,n){void 0===n&&(n={});var i=e.start_time,o=e.subtypes||{};e.tti_flow&&(o.tti_flow=e.tti_flow);var a,s,c={log_source:t.name,subtypes:JSON.stringify(o),correlation_id:e.correlation_id};e.extra_columns&&Object.keys(e.extra_columns).forEach((function(t){var n=e.extra_columns[t];n&&(c[t]=n)})),Object.keys(n).forEach((function(e){var t=n[e];t&&(c[e]=t)})),g.IS_HTTP2&&(c.is_spdy=!0),e.is_pagelet&&(c.is_pagelet=!0),e.is_dws&&(c.is_dws=!0),e.is_early_ensemble&&(c.is_early_ensemble=!0),c.delayed_tti_for_css=e.delayed_tti_for_css,""!==e.tti_exclusion_flow&&(c.tti_exclusion_flow=e.tti_exclusion_flow),a=e.log_time_to_view&&null!=e.time_to_view?e.time_to_view-i:null,s=e.log_time_to_interactive&&null!=e.time_to_interactive?e.time_to_interactive-i:null;var u={navigation_type:this.get_navigation_type(),server_request_start_time:g.REQUEST_START_TIME,extra_columns:JSON.stringify(c),subtypes:JSON.stringify(o),source_type:e.source_type,page_load_time:e.end_time-e.start_time,repo_rev:w.REPO_REV};return this.shouldLogJsModuleTimes()&&$(u),e.log_time_to_view&&(u.time_to_view=a),e.log_time_to_interactive&&(u.time_to_interactive=s),u.url=T.get_href(),0===u.url.indexOf("/dws2/")&&(u.url=u.url.substring("/dws2/".length-1)),u.active_user_id=r.getActiveUserId(),u.referrer=document.referrer,u.request_id=e.request_id||g.REQUEST_ID,u.request_tracing_enabled=g.REQUEST_TRACING_ENABLED,window.ensemble&&window.ensemble.viewer&&(u.dws_page_name=window.ensemble.getPageName()),window.EDISON_PAGE_NAME&&(u.edison_page_name=window.EDISON_PAGE_NAME),u},e.prototype.get_navigation_type=function(){var e=T.performance();if(e&&e.navigation){var t=e.navigation;return p.NavigationType.getFromNavigation(t)}},e.prototype.log=function(e,n,i){void 0===i&&(i=!1);var r=m.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});m.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",n.navigation_type,{stopwatchName:"web_timing_logger",spanId:r});var o=E.sendXhr("/alternate_wtl",n);o.onreadystatechange=function(e){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){m.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:r});var n=document.getElementsByClassName(t.perfHubClassName);if(i&&n.length){var s=JSON.parse(o.responseText);s.status&&a.PerfHubActions.add_web_timing_details(s)}}}},e})(),j=(function(e){function t(){return e.call(this)||this}return n.__extends(t,e),t.prototype.shouldLog=function(e){return e.initialized&&!e.have_logged_web_timing&&void 0!==e.end_time&&(!e.log_time_to_view||null!=e.time_to_view)&&(!e.log_time_to_interactive||null!=e.time_to_interactive)},t.prototype.logTiming=function(e,t){e.have_logged_web_timing=!0;var n=this.buildBaseParams(e,t),i=z(e,n);return this.log(e,n,!1),i},t.prototype.get_navigation_type=function(){return"ajax"},t})(U),V=(function(e){function t(){var t=e.call(this)||this;return t.metricsReporter=o.getMetricsReporter(),t}return n.__extends(t,e),t.prototype.shouldLog=function(e){if(!e.initialized||e.have_logged_web_timing)return!1;var t=T.performance();if(!t||!t.timing)return!1;var n=t.timing,i=e.start_time,r=e.end_time;return!(!i||!r)&&(!(e.log_time_to_view&&!(e.ttv_at_dom_interactive&&n.domInteractive||null!=e.time_to_view))&&!(e.log_time_to_interactive&&!(e.tti_at_dom_interactive&&n.domInteractive||null!=e.time_to_interactive)))},t.prototype.logTiming=function(e,t){var n=T.performance(),r=n.timing,a=h.getAllGlobalExecutionPerfMeasurements(),s=e.timesStagesWereReached["dws_embedded-app_require_config_callback"];void 0===s?s=e.timesStagesWereReached.application_code_start:e.timesStagesWereReached.hasOwnProperty("application_code_start")&&(s=Math.min(s,e.timesStagesWereReached.application_code_start)),m.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});var c=this.buildBaseParams(e,t,{}),u=z(e,c),d=window.ensemble&&window.ensemble.getJSStopwatchData?window.ensemble.getJSStopwatchData():{},v="function"==typeof n.getEntriesByType?l.summarizePerformanceResourceTimings(n.getEntriesByType("resource"),s):{pre:{},total:{}};c.browser_time=(r.redirectStart||r.fetchStart)-e.start_time,c.redirect_time=r.fetchStart-e.start_time,c.dns_time=r.domainLookupEnd-e.start_time,c.tcp_connect_time=(r.secureConnectionStart||r.requestStart)-e.start_time,c.ssl_connect_time=r.requestStart-e.start_time,c.time_to_first_byte=r.responseStart-e.start_time,c.time_to_last_byte=r.responseEnd-e.start_time,c.dom_load_time=r.domContentLoadedEventEnd-e.start_time,c.idle_cpu_time=e.timing_results?Math.round(e.timing_results.idleCPUTime):void 0,c.total_tracked_cpu_time=e.timing_results?Math.round(e.timing_results.totalTrackedCPUTime):void 0,c.untracked_time_after_first_byte=e.timing_results&&null!=e.timing_results.untrackedTimeAfterFirstByte?Math.round(e.timing_results.untrackedTimeAfterFirstByte):void 0,T.performance().getEntriesByType&&((function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t["resource_"+n+"_count"]=e[n].count,t["resource_"+n+"_avg_time"]=e[n].total_time/e[n].count||1,void 0!==e[n].total_size&&(t["resource_"+n+"_total_size"]=e[n].total_size),void 0!==e[n].transfer_size&&(t["resource_"+n+"_transfer_size"]=e[n].transfer_size))})(v.total,c),(function(e,t){var n;for(n in e)if(e.hasOwnProperty(n)){var i=e[n];for(var r in i)if(i.hasOwnProperty(r)){var o=i[r].transfer_size,a=i[r].total_size,s=i[r].count,c=i[r].total_time;if(t.recordTrace(n+"_"+r+"_count",s),t.recordTrace(n+"_"+r+"_total_time",c),void 0!==o&&void 0!==a&&a>0){var u=o/a;t.recordTrace(n+"_"+r+"_transferred_size",o),t.recordTrace(n+"_"+r+"_total_size",a),t.recordTrace(n+"_percent_"+r+"_transferred",100*u)}t.recordTrace(n+"_last_"+r+"_transfer_end",i[r].last_transfer_end)}}t.logData()})(v,m.JSStopwatch.createDetachedStopwatch("resources_percent_transferred",u)),m.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"})),this.shouldLogJsModuleTimes()&&$(c),m.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),m.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),e.is_pagelet&&Object.getOwnPropertyNames(d).length>0&&(function(e,t,n){var i=(function(e,t){var n=h.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),i=m.JSStopwatch.createDetachedStopwatch("ensemble",e),r=n.map((function(e){var t=e.measurement,n=e.annotations;return{name:t.name,startTime:t.startTime,endTime:t.startTime+t.totalTime,annotations:n}}));return X(i,r),i})(n,t),r=void 0,o=void 0;for(var a in t)t.hasOwnProperty(a)&&(Q.includes(a)&&(e.timesStagesWereReached[a]=t[a].start),["ensemble_init","dws_embedded-app_require_config_callback"].includes(a)&&(r=r?Math.min(r,t[a].end):t[a].end),Z.test(a)&&(o=o?Math.max(o,t[a].end):t[a].end));o&&i.recordTrace("last_js_const_end",o);r&&i.recordTrace("module_init",r)})(e,d,u),_.logBrowserPerfData(u),(function(e,t,n){h.logCumulativeExecutionTimes(e,h.cumulativeExecutionTimesBefore(t,n))})(u,e.timesStagesWereReached,a),this.get_navigation_type()===p.NavigationType.NAVIGATE&&((function(e){var t=f.getReactInitData();X(m.JSStopwatch.createDetachedStopwatch("init_react",e),t)})(u),l.logResourcesData(u)),m.JSStopwatch.log_stored_results();var g=(function(e,t){var n={is_dws:String(e.is_dws),source_type:String(e.source_type)},i="";return e.subtypes.amp_tti_flow?i=e.subtypes.amp_tti_flow:t.dws_page_name?i="dws_page_name:"+t.dws_page_name:t.edison_page_name&&(i="edison_page_name:"+t.edison_page_name),""!==i&&(n.product=i),t.navigation_type&&(n.navigation_type=t.navigation_type),n})(e,c),S=this.metricsReporter.child(g),w=(function(e,t){return t.navigation_type===p.NavigationType.NAVIGATE||"ajax"===t.navigation_type})(0,c),b=o.getUnloadMetricsReporter().child(g);return C.logUserCentricPerfMetrics(b,w),w&&((function(e,t){e.time_to_interactive&&t.createStats({ns:"web_timing",name:"temp/time-to-interactive"}).recordDuration(e.time_to_interactive,i.TimeUnit.MILLISECONDS)})(c,S),(function(e,t){var n;for(n in e)if(e.hasOwnProperty(n)){var r=e[n];for(var o in r)if(r.hasOwnProperty(o)){var a=r[o],s=a.transfer_size,c=a.total_size,u=a.count,l=a.total_time,p=a.last_transfer_end;t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/count"}).record(u),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/total-time"}).recordDuration(l,i.TimeUnit.MILLISECONDS),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/last-transfer-end"}).recordDuration(p,i.TimeUnit.MILLISECONDS),void 0!==s&&void 0!==c&&c>0&&(t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/transferred-size"}).record(s),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+o+"/total-size"}).record(c))}}})(v,S),e.is_pagelet&&Object.getOwnPropertyNames(d).length>0&&(function(e,t,n){var r=h.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),o=void 0,a=void 0;r.forEach((function(t){var r=t.measurement,s=r.startTime+r.totalTime;-1!==L.indexOf(r.name)&&n.createStats({ns:"web_timing",name:"temp/ensemble-timing/"+r.name}).recordDuration(s,i.TimeUnit.MILLISECONDS),Q.includes(r.name)&&(e.timesStagesWereReached[r.name]=r.startTime),["ensemble_init","dws_embedded-app_require_config_callback"].includes(r.name)&&(o=o?Math.min(o,s):s),Z.test(r.name)&&(a=a?Math.max(a,s):s)})),void 0!==a&&n.createStats({ns:"web_timing",name:"temp/last-js-const-end"}).recordDuration(a,i.TimeUnit.MILLISECONDS),void 0!==o&&n.createStats({ns:"web_timing",name:"temp/module-init"}).recordDuration(o,i.TimeUnit.MILLISECONDS)})(e,d,S),n&&n.getEntriesByType&&((function(e,t){e.getEntriesByType("mark").filter((function(e){return k.indexOf(e.name)>-1})).forEach((function(e){t.createStats({ns:"web_timing",name:"temp/browser-perf/marks/"+e.name}).recordDuration(e.startTime,i.TimeUnit.MILLISECONDS)}))})(n,S),(function(e,t){var n=e.getEntriesByType("navigation")[0],r=void 0===n?null:n;r&&([["temp/browser-perf/navigation/unload-event-start",r.unloadEventStart],["temp/browser-perf/navigation/unload-event-end",r.unloadEventEnd],["temp/browser-perf/navigation/dom-interactive",r.domInteractive],["temp/browser-perf/navigation/dom-content-loaded-event-start",r.domContentLoadedEventStart],["temp/browser-perf/navigation/dom-content-loaded-event-end",r.domContentLoadedEventEnd],["temp/browser-perf/navigation/dom-complete",r.domComplete],["temp/browser-perf/navigation/load-event-start",r.loadEventStart],["temp/browser-perf/navigation/load-event-end",r.loadEventEnd],["temp/browser-perf/navigation/redirect-count",r.redirectCount],["temp/browser-perf/navigation/worker-start",r.workerStart],["temp/browser-perf/navigation/redirect-start",r.redirectStart],["temp/browser-perf/navigation/redirect-end",r.redirectEnd],["temp/browser-perf/navigation/fetch-start",r.fetchStart],["temp/browser-perf/navigation/domain-lookup-start",r.domainLookupStart],["temp/browser-perf/navigation/domain-lookup-end",r.domainLookupEnd],["temp/browser-perf/navigation/connect-start",r.connectStart],["temp/browser-perf/navigation/connect-end",r.connectEnd],["temp/browser-perf/navigation/secure-connect-start",r.secureConnectionStart],["temp/browser-perf/navigation/request-start",r.requestStart],["temp/browser-perf/navigation/response-start",r.responseStart],["temp/browser-perf/navigation/response-end",r.responseEnd],["temp/browser-perf/navigation/transfer-size",r.transferSize]].forEach((function(e){var n=e[0],r=e[1];"number"==typeof r&&t.createStats({ns:"web_timing",name:n}).recordDuration(r,i.TimeUnit.MILLISECONDS)})),[["temp/browser-perf/navigation/encoded-body-size",r.encodedBodySize],["temp/browser-perf/navigation/decoded-body-size",r.decodedBodySize]].forEach((function(e){var n=e[0],i=e[1];"number"==typeof i&&t.createStats({ns:"web_timing",name:n}).record(i)})))})(n,S))),I.logPaintPerformance(u),I.logVisibilityChangeEvents(e,u),e.have_logged_web_timing=!0,this.log(e,c,!0),u},t.prototype.log=function(t,n,i){void 0===i&&(i=!1),e.prototype.log.call(this,t,n,i)},t})(U),q=(function(){function e(e,t,n,i){this.childSpans=[],this.spanName=e,this.startTime=void 0!==n?n:d.WebTimingUtil.getNow(),this.originTs=t,this.startTimeOffsetMS=this.startTime-t,this.endCallback=i}return e.prototype.startSpan=function(t){var n=new e(t,this.originTs);return this.childSpans.push(n),n},e.prototype.markSpan=function(t,n){var i=new e(t,this.originTs,this.startTime);this.childSpans.push(i),i.endSpan(n)},e.prototype.endSpan=function(e){var t=this;this.endTime=void 0!==e?e:d.WebTimingUtil.getNow(),this.childSpans.forEach((function(e){e.hasEnded()||e.endSpan(t.endTime)})),this.endCallback&&this.endCallback(this)},e.prototype.getEndTimeOffsetMS=function(){return void 0!==this.endTime?this.endTime-this.originTs:void 0},e.prototype.hasEnded=function(){return void 0!==this.endTime},e})(),B=(function(){function e(e,t,n,i){void 0===i&&(i=!1),this.timerState=N.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=e,this.timingStopwatch=t,this.userStopwatch=n,this.id=R++,this.strictAssert=i}return e.prototype.startSpan=function(e){var t=this,n=new q(e,this.context.start_time,void 0,(function(e){t.endSpan(e)}));return this.activeSpans.push(n),n},e.prototype.markSpan=function(e,t){if(void 0===t&&(t={}),this.userStopwatch){var n=void 0===t.startTime?0:t.startTime,i=this.timeSinceStart(t.endTime),r=this.userStopwatch.startSpan(e,{startTime:n});this.userStopwatch.endSpan(e,{spanId:r,endTime:i})}else{var o=new q(e,this.context.start_time,t.startTime);o.endSpan(t.endTime),this.endedSpans.push(o)}},e.prototype.endSpan=function(e){var t=this.activeSpans.indexOf(e);t>=0&&(delete this.activeSpans[t],this.userStopwatch?this.recordSpan(e):this.endedSpans.push(e))},e.prototype.recordSpan=function(e){var t=this,n=this.userStopwatch.startSpan(e.spanName,{startTime:e.startTimeOffsetMS});e.childSpans.forEach((function(e){t.recordSpan(e)})),this.userStopwatch.endSpan(e.spanName,{spanId:n,endTime:e.getEndTimeOffsetMS()})},e.prototype.getContextName=function(){return this.context.context_name},e.prototype.applicationStart=function(){this.logEvent(p.WebTimerEvent.APPLICATION_START)},e.prototype.fetchedDataRequiredForTTI=function(){this.logEvent(p.WebTimerEvent.FETCHED_DATA_FOR_TTI)},e.prototype.startTime=function(){return this.context.start_time},e.prototype.timeSinceStart=function(e){return(e||d.WebTimingUtil.getNow())-this.context.start_time},e.prototype.timeToView=function(){return this.context.time_to_view},e.prototype.timeToInteractive=function(){return this.context.time_to_interactive},e.prototype.reportTTIAfterPaint=function(){var e=this,t=new d.CancellableCallback((function(){e.reportTTI()}));return window.requestAnimationFrame((function(){window.requestAnimationFrame((function(){t.exec()}))})),t},e.prototype.setExtraColumns=function(e){this.context.extra_columns=e},e.prototype.excludeFromTTI=function(e){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+e},e.prototype.logEvent=function(e,t){this.logEventInternal(e,!0,t)},e.prototype.logSilentEvent=function(e,t){this.logEventInternal(e,!1,t)},e.prototype.logEventInternal=function(e,t,n){this.loggedEvents|=e.flag,e.ordered&&this.validateEventOrder(e);var i=this.timeSinceStart(n);this.context.timesStagesWereReached[e.name]=i,this.timingStopwatch.recordTrace(e.name,i),console.timeStamp&&console.timeStamp(e.timestampPrefix);var r=T.performance();r&&"function"==typeof r.mark&&r.mark(e.name),t&&e.triggersLogging&&this.logIfReady(e)},e.prototype.validateEventOrder=function(e){for(var t=0,n=0,i=D;n<i.length;n++){var r=i[n];if(r.includes(e))break;for(var o=0,a=r;o<a.length;o++){t|=a[o].flag}}var s=t&this.loggedEvents;if(s>0){var c=p.WebTimerEvent.allEvents.filter((function(e){return(e.flag&s)>0})).map((function(e){return e.name}));this.reportSwMisuse("Received "+e.name+" after ["+c.join(",")+"]")}},e.prototype.logIfReady=function(e){if(this.logger.shouldLog(this.context)){this.addEventBasedTiming();var t=this.logger.logTiming(this.context,e);G(this.timingStopwatch,t),G(this.userStopwatch,t),this.timingStopwatch.logData(),this.userStopwatch.logData(),this.timerState=N.CLOSED}},e.prototype.addEventBasedTiming=function(){var e=T.performance().timing;this.context.ttv_at_dom_interactive&&(this.context.is_pagelet&&window.ensemble?this.context.time_to_view=window.ensemble.getEmbeddedAppDOMInteractive():this.context.time_to_view=e.domInteractive,this.logSilentEvent(p.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),this.context.tti_at_dom_interactive&&(this.context.time_to_interactive=e.domInteractive,this.logSilentEvent(p.WebTimerEvent.MARK_TIME_TO_INTERACTIVE,this.context.time_to_interactive),this.logSilentEvent(p.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive))},e.prototype.reportSwMisuse=function(e){e="WebTimer: "+e,this.strictAssert?b.assert(!1,e):y.reportStack(e,{severity:y.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})},e})(),W=(function(e){function t(t){var n=e.call(this,t,m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:t.correlation_id}),m.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:t.correlation_id}),!1)||this;return n.logger=new j,n}return n.__extends(t,e),t.prototype.initialize=function(e){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.tti_flow=e.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)},t.prototype.start=function(){this.isUsable()&&this.timerState===N.NEW&&(this.context.start_time=d.WebTimingUtil.getNow(),this.timerState=N.RUNNING)},t.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.have_logged_web_timing=!1,this.context.correlation_id=d.WebTimingUtil.generateCorrelationId(),this.context.start_time=d.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=N.RUNNING,m.JSStopwatch.deleteStopwatch(this.timingStopwatch),this.timingStopwatch=m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id}),m.JSStopwatch.deleteStopwatch(this.userStopwatch),this.userStopwatch=m.JSStopwatch.createDetachedStopwatch("user_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id})},t.prototype.abort=function(){this.timerState!==N.CLOSED&&(this.timerState=N.ABORTED)},t.prototype.markTimeToView=function(){this.isUsable()&&(null==this.context.time_to_view&&(this.context.time_to_view=d.WebTimingUtil.getNow()),this.logEvent(p.WebTimerEvent.MARK_TIME_TO_VIEW))},t.prototype.markTimeToInteractive=function(){this.isUsable()&&(this.logEvent(p.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),M()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},t.prototype.reportTTI=function(){null==this.context.time_to_interactive&&(this.context.time_to_interactive=d.WebTimingUtil.getNow(),this.logEvent(p.WebTimerEvent.TIME_TO_INTERACTIVE),ee(this.id))},t.prototype.end=function(e){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=d.WebTimingUtil.getNow()),this.context.request_id=e,this.timingStopwatch.request_id=e,this.userStopwatch.request_id=e,this.logEvent(p.WebTimerEvent.LOAD_END))},t.prototype.waitForTTI=function(e){var t=this;return new Promise((function(n,i){if(null==t.context.time_to_interactive){var r,o=function(e){window.removeEventListener("TTI."+t.id,o),clearTimeout(r),n()};window.addEventListener("TTI."+t.id,o),e&&void 0!==e.timeoutMS&&(r=setTimeout(o,e.timeoutMS))}else n()}))},t.prototype.isUsable=function(){return this.timerState===N.NEW||this.timerState===N.RUNNING},t})(B),F=(function(t){function i(e){var n=t.call(this,e,m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),m.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return n.logger=new V,n}return n.__extends(i,t),i.prototype.initialize=function(e){var t=this;if(!this.context.initialized){if(!T.performance())return;this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.is_pagelet=!!e.is_pagelet,this.context.is_dws=!!e.is_dws,this.context.is_dws2=!!e.is_dws2,this.context.is_early_ensemble=!!e.is_early_ensemble,this.context.ttv_at_dom_interactive=!!e.ttv_at_dom_interactive,this.context.tti_at_dom_interactive=!!e.tti_at_dom_interactive,this.context.source_type=null!=e.source_type?e.source_type:"web",this.context.subtypes=null!=e.subtypes?e.subtypes:{},this.context.tti_exclusion_flow=null!=e.tti_exclusion_flow?e.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.initialized=!0,e.url&&(this.context.tti_flow=e.url,this.timingStopwatch.url=e.url,this.userStopwatch.url=e.url),this.context.subtypes.tti_flow&&(this.context.tti_flow=this.context.subtypes.tti_flow);var n=0;S.LOG_TIMING_DELAY&&(n=600),m.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),s.window_load((function(){setTimeout((function(){return t.end()}),n)})),u.onPageRestore((function(e){var n=m.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:t.context.correlation_id});n.recordTrace("page_restore"),n.logData()})),!this.context.ttv_at_dom_interactive&&window._timingData&&(null!=window._timingData.ttv&&(this.context.time_to_view=window._timingData.ttv.getTime(),this.logEvent(p.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),null!=window._timingData.tti&&(this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(p.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),ee()))}},i.prototype.start=function(){this.isUsable()&&this.timerState===N.NEW&&(this.timerState=N.RUNNING)},i.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.correlation_id=d.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=N.RUNNING,this.timingStopwatch=m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=m.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})},i.prototype.abort=function(){this.timerState!==N.CLOSED&&(this.timerState=N.ABORTED)},i.prototype.markTimeToView=function(){this.isUsable()&&(null!=this.context.time_to_view||this.context.ttv_at_dom_interactive||(window._timingData&&null!=window._timingData.ttv?this.context.time_to_view=window._timingData.ttv.getTime():this.context.time_to_view=d.WebTimingUtil.getNow(),this.logEvent(p.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)))},i.prototype.markTimeToInteractive=function(){var e=this;if(window.ensemble&&window.ensemble.waitingForCss)return this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=function(){e.markTimeToInteractive()});null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(p.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),M()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},i.prototype.reportTTI=function(){var t=this;null==this.context.time_to_interactive&&(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=d.WebTimingUtil.getNow(),console.timeStamp&&console.timeStamp("TTI"),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),window.RUNNING_IN_EDISON?new Promise((function(t,n){e(["modules/clean/edison/edison"],t,n)})).then(n.__importStar).then((function(e){for(var i=e.Edison.getPrefetchCounts(),r={},o=0,a=Object.keys(i);o<a.length;o++){var s=a[o];r[s]=i[s].toString()}t.context.subtypes=n.__assign(n.__assign({},r),t.context.subtypes),t.logEvent(p.WebTimerEvent.TIME_TO_INTERACTIVE,t.context.time_to_interactive),ee()})):(this.logEvent(p.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),ee()))},i.prototype.end=function(e){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=d.WebTimingUtil.getNow(),this.logEvent(p.WebTimerEvent.LOAD_END),this.context.tti_at_dom_interactive&&ee())},i.prototype.waitForTTI=function(e){var t=this;return new Promise((function(n,i){if(window.ensemble){if(window.ensemble.ttiMarked)return void n()}else if(null!=t.context.time_to_interactive)return void n();var r,o=function(e){window.removeEventListener("TTI",o),clearTimeout(r),n()};window.addEventListener("TTI",o),e&&void 0!==e.timeoutMS&&(r=setTimeout(o,e.timeoutMS))}))},i.prototype.isUsable=function(){return this.timerState===N.NEW||this.timerState===N.RUNNING},i})(B),H={};function z(e,t){for(var n={},i=0,r=A;i<r.length;i++){(u=t[c=r[i]])&&(n[c]=String(u))}for(var o=e,a=0,s=x;a<s.length;a++){var c,u;(u=o[c=s[a]])&&(n[c]=String(u))}return{correlation_id:e.correlation_id,request_id:t.request_id,annotations:n}}function G(e,t){if(t.annotations)for(var n in t.annotations)if(t.annotations.hasOwnProperty(n)){var i=t.annotations[n];i&&e.addAnnotation(n,String(i))}t.correlation_id&&e.addAnnotation(m.ReservedAnnotationKey.CORRELATION_ID.id,t.correlation_id),t.request_id&&e.addAnnotation(m.ReservedAnnotationKey.REQUEST_ID.id,t.request_id),t.url&&e.addAnnotation(m.ReservedAnnotationKey.URL.id,t.url)}function J(e){return e?(function(e){var t=e;return H[t]||(H[t]=new W(d.WebTimingUtil.newContext(!0,e))),H[t]})(e):(P||Y(),P)}function K(e){void 0===e&&(e={}),J().initialize({requireTTV:!!e.log_time_to_view,requireTTI:!!e.log_time_to_interactive,is_pagelet:e.is_pagelet,is_dws:e.is_dws,is_dws2:e.is_dws2,is_early_ensemble:e.is_early_ensemble,ttv_at_dom_interactive:e.ttv_at_dom_interactive,tti_at_dom_interactive:e.tti_at_dom_interactive,source_type:e.source_type,subtypes:e.subtypes,tti_exclusion_flow:e.tti_exclusion_flow,url:e.url})}function Y(){P=new F(d.WebTimingUtil.newContext(!1,"default_timer"))}function X(e,t){e.recordEntries(t.map((function(e){return{type:0!==e.startTime?v.TimingDataType.Span:v.TimingDataType.Trace,name:e.name,startTime:e.startTime,endTime:e.endTime,annotations:e.annotations}}))),e.logData()}Y(),t.get_timer=J,t.delete_timer=function(e){delete H[e]},t.time_to_view=function(){return J().timeToView()},t.time_to_interactive=function(){return J().timeToInteractive()},t.initialize_module=K,t.initialize=function(e,t){var i,r=t.dwsOpts;switch(t.sourceType){case O.web_timing_logger.WebTimingLoggerServerContext.SourceType.UNKNOWN:i="unknown";break;case O.web_timing_logger.WebTimingLoggerServerContext.SourceType.MOBILE_WEB:i="mobile";break;case O.web_timing_logger.WebTimingLoggerServerContext.SourceType.DESKTOP_WEB:i="web"}var o={is_pagelet:t.isDws,is_dws:t.isDws,is_dws2:null!=r&&r.isDws2,is_early_ensemble:null!=r&&r.isEarlyEnsemble,subtypes:n.__assign(n.__assign({},t.subtypes),{js_preloading:null!=r&&r.jsPreloading?"true":"false"}),source_type:i,url:t.url};K(n.__assign(n.__assign({},o),e))},t.reset=Y,t.start_time=function(){return J().startTime()},t.time_since_start=function(){return J().timeSinceStart()},t.set_tti_exclusion_flow=function(e){J().excludeFromTTI(e)};var Q=["ensemble_init","dws_ensemble_init","dws_embedded-app_require_config_callback","dws-processChunk-embedded-app-require_config-1"],Z=new RegExp("dws-processChunk-embedded-app-const_module.*");function $(e){var t=T.performance();if(t&&t.getEntriesByName){for(var n=[],i=0,r=c.get_module_times();i<r.length;i++){var o=r[i],a=o.url;if(void 0===a&&o.name&&-1===o.name.indexOf("!"))y.reportStack("Module "+o.name+" with invalid map object fetched by requirejs",{severity:y.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});else{var s=[];if(a&&(s=t.getEntriesByName(a,"resource")),0!==s.length)o.start_time=s[0].startTime+s[0].duration;else{if(!("callback_duration"in o))continue;o.start_time=0}n.push(o)}}e.js_module_times=JSON.stringify(n)}}function ee(e){if(window.ensemble&&window.ensemble.markTTI)window.ensemble.markTTI();else{var t=document.createEvent("Event");null!=e?t.initEvent("TTI."+e,!0,!0):t.initEvent("TTI",!0,!0),window.dispatchEvent(t)}}t.mark_time_to_view=function(){J().markTimeToView()},t.mark_time_to_interactive=function(e){void 0===e&&(e={});var t=J();t.setExtraColumns(e),t.markTimeToInteractive()},t.waitForTTI=function(e){return J().waitForTTI(e)},t.log_js_modules_application_code_start=function(){J().applicationStart()},t.log_js_modules_fetched_data_required_for_tti=function(){J().fetchedDataRequiredForTTI()}})),define("modules/clean/window_util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onPageRestore=t.onBeforeUnload=void 0,t.onBeforeUnload=function(e){window.addEventListener("beforeunload",(function t(){e(),window.removeEventListener("beforeunload",t)}))},t.onPageRestore=function(e){window.addEventListener("pageshow",(function t(n){n.persisted&&(e(),window.removeEventListener("pageshow",t))}))}})),define("modules/clean/js_basic_stopwatch",["require","exports","tslib","modules/core/assert","modules/core/exception"],(function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStopwatch=t.NoopStopwatchInstance=t.JSBasicStopwatchImpl=t.TimingDataType=void 0;var o,a=!(!window.performance||!window.performance.now),s=0;(function(e){e[e.Span=1]="Span",e[e.AsyncSpan=2]="AsyncSpan",e[e.Trace=3]="Trace"})(o=t.TimingDataType||(t.TimingDataType={}));var c=(function(){function e(e,t,i,r,o){void 0===r&&(r=!1),this.name=e,this.strictAssert=t,this.activeSpans={},this.aggregateSpans={},this._annotations=n.__assign({},o),this.spanStack=[],this.stopwatchTags=i||[],this.detached=r}return e.prototype.reset=function(){this.activeSpans={},this.spanStack=[],this.aggregateSpans={},this._annotations={}},Object.defineProperty(e.prototype,"annotations",{get:function(){return this._annotations},enumerable:!1,configurable:!0}),e.prototype.addAnnotation=function(e,t){this._annotations[e]=t},e.prototype.removeAnnotation=function(e){delete this._annotations[e]},e.prototype.popResolvedSpans=function(){if(this.detached)return{};var e=this.aggregateSpans;return this.aggregateSpans={},e},e.prototype.peekResolvedSpans=function(){return this.detached?{}:this.aggregateSpans},e.newSpanID=function(){var e=String(s);return s++,e},e.resolveTime=function(e){return void 0===e&&(e=window.performance.now()),Math.round(e)},e.prototype._resolveParent=function(e){if(e.type===o.Span){var t=this.spanStack[this.spanStack.length-1];if(t)if(t!==e.name)this._report_sw_misuse("Closing "+t+" while the latest open span is "+e.name+".\n        You are either mixing sync and async spans or closing sync spans out of order.");else{this.spanStack.pop();for(var n="",i=0,r=this.spanStack;i<r.length;i++){n+=r[i]+"#"}e.parent=n}else this._report_sw_misuse(e.name+' isn\'t a synchronous span and has to be started with "async:true".')}else e.parent=""},e.prototype.recordTrace=function(t,i){void 0===i&&(i={});var r=e.resolveTime(i.traceTime),a=e.newSpanID(),s={name:t,span_id:a,start_time:0,end_time:r,annotations:n.__assign({},i.annotations),type:o.Trace,parent:""};return this.recordSpan(this.stopwatchTags,s),a},e.prototype.start=function(t,i){void 0===i&&(i={}),t||this._report_sw_misuse("Reporting a span without a name");var r=e.resolveTime(i.startTime);i.async||this.spanStack.push(t);var a=e.newSpanID(),s={name:t,span_id:a,start_time:r||0,annotations:n.__assign({},i.annotations),type:i.async?o.AsyncSpan:o.Span};return t in this.activeSpans||(this.activeSpans[t]=[]),this.activeSpans[t].push(s),a},e.prototype.end=function(t,n){void 0===n&&(n={});var i=this.findTimerDataIndex(t,n.spanId);if(-1!==i){var r=this.activeSpans[t],o=r[i];r.splice(i,1),this._resolveParent(o);var a=e.resolveTime(n.endTime);if(!(a<o.start_time))return o.end_time=a,this.recordSpan(this.stopwatchTags,o),o.span_id;this._report_sw_misuse("span "+t+" has set an endTime earlier than start_time")}},e.prototype.addSpanAnnotation=function(e,t,n,i){var r=this.findTimerDataIndex(e,i);-1!==r&&(this.activeSpans[e][r].annotations[t]=n)},e.prototype.attach=function(){this.detached=!1},e.prototype.findTimerDataIndex=function(e,t){if(!(e in this.activeSpans)||0===this.activeSpans[e].length)return this._report_sw_misuse("tried to find "+e+" but that span doesn't exist"),-1;var n=-1,i=this.activeSpans[e];if(void 0===t)n=0;else for(var r=0;r<i.length;r++)if(i[r].span_id===t){n=r;break}return-1===n&&this._report_sw_misuse("tried to find "+e+" with id "+t+" but that span doesn't exist"),n},e.prototype._report_sw_misuse=function(e){e="JSBasicStopwatch "+this.name+": "+e,this.strictAssert?i.assert(!1,e):r.reportStack(e,{severity:r.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},e.prototype.recordSpan=function(e,t){var n=""+t.parent+t.name;n in this.aggregateSpans||(this.aggregateSpans[n]={name:t.name,start_time:t.start_time,total_time:0,num_calls:0,annotations:Object.keys(t.annotations).length>0?t.annotations:void 0,parent:t.parent||"",stopwatch_tags:e.length>0?e:void 0,type:t.type});var i=this.aggregateSpans[n];if(void 0!==t.end_time){if(i.type===o.Trace?(i.total_time=t.end_time-t.start_time,i.num_calls=1):(i.total_time+=t.end_time-t.start_time,i.num_calls+=1),Object.keys(t.annotations).length>0)if(i.annotations)for(var r in t.annotations)t.annotations.hasOwnProperty(r)&&(i.annotations[r]=t.annotations[r]);else i.annotations=t.annotations}else this._report_sw_misuse("Span "+n+" reported with undefined end_time")},e})();t.JSBasicStopwatchImpl=c;var u=(function(){function e(){this.name="",this.annotations={}}return e.prototype.reset=function(){},e.prototype.attach=function(){},e.prototype.addAnnotation=function(e,t){},e.prototype.removeAnnotation=function(e){},e.prototype.popResolvedSpans=function(){return{}},e.prototype.peekResolvedSpans=function(){return{}},e.prototype.start=function(e,t){},e.prototype.end=function(e,t){},e.prototype.recordTrace=function(e,t){},e.prototype.addSpanAnnotation=function(e,t,n,i){},e})();t.NoopStopwatchInstance=new u,t.createStopwatch=function(e,n,i,r,o){return void 0===r&&(r=!1),a?new c(e,n,i,r,o):t.NoopStopwatchInstance}})),define("modules/clean/js_client_stopwatch",["require","exports","tslib","modules/core/xhr","modules/clean/js_basic_stopwatch","modules/constants/request","modules/core/assert","modules/core/browser","modules/core/exception"],(function(e,t,n,i,r,o,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSStopwatch=t.ReservedAnnotationKey=void 0,o=n.__importStar(o),s=n.__importStar(s);var u=(function(){function e(e){this.id=e}return e.REQUEST_ID=new e("dropbox.js_client_stopwatch.request_id"),e.CORRELATION_ID=new e("dropbox.js_client_stopwatch.correlation_id"),e.URL=new e("dropbox.js_client_stopwatch.url"),e})();t.ReservedAnnotationKey=u;var l=(function(){function e(){this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.debugEnabled=!0,this.strictAssert=!1,this.intervalId=null,this.clientStopwatchCounter=1,this.reset()}return e.prototype.reset=function(){this.globalStopwatches={},this.clientStopwatches={},this.clientStopwatchCounter=1,this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null},e.prototype.reset_individual_stopwatch=function(e){this.stopwatch_exists(e)?this.globalStopwatches[e].reset():this._report_sw_misuse("tried to reset the stopwatch "+e+" but it does not exist")},e.prototype.stopwatch_exists=function(e){return e in this.globalStopwatches},e.prototype.create_stopwatch=function(e,t){this.stopwatch_exists(e)?this._report_sw_misuse("tried to create a new stopwatch "+e+" but it already exists"):this.globalStopwatches[e]=r.createStopwatch(e,this.strictAssert,t)},e.prototype.createDetachedStopwatch=function(e,t){void 0===t&&(t={});var n=r.createStopwatch(e,this.strictAssert,t.tags,!0,t.annotations),i=new p(this.clientStopwatchCounter++,e,n,t.request_id,t.correlation_id,t.url);return this.clientStopwatches[i.id]=i,i},e.prototype.deleteStopwatch=function(e){delete this.clientStopwatches[e.id]},e.prototype.create_stopwatch_if_not_exist=function(e,t){this.stopwatch_exists(e)||this.create_stopwatch(e,t)},e.prototype.getStopwatch=function(e){return this.stopwatch_exists(e)?this.globalStopwatches[e]:(this._report_sw_misuse(e+" doesn't exist"),null)},e.prototype.recordTrace=function(e,t){void 0===t&&(t={});var n=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){var i={traceTime:t.traceTime};return n.recordTrace(e,i)}},e.prototype.startSpan=function(e,t){void 0===t&&(t={});var n=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){var i={startTime:t.startTime,async:t.async};return n.start(e,i)}},e.prototype.endSpan=function(e,t){void 0===t&&(t={});var n=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n)return n.end(e,{spanId:t.spanId,endTime:t.endTime})},e.prototype.addSpanAnnotation=function(e,t,n,i){void 0===i&&(i={});var r=this.getStopwatch(i.stopwatchName||this.GLOBAL_SW_NAME);null!=r&&r.addSpanAnnotation(e,t,n,i.spanId)},e.prototype.log_stored_results=function(){this.sentInitialData?this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval))},e.prototype._report_sw_misuse=function(e){e="ClientStopwatch: "+e,this.strictAssert?a.assert(!1,e):c.reportStack(e,{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},e.prototype.flush_current_data=function(){for(var t in this.globalStopwatches)this.globalStopwatches.hasOwnProperty(t)&&e.logStopwatchData(this.globalStopwatches[t]);for(var t in this.clientStopwatches)this.clientStopwatches.hasOwnProperty(t)&&e.logStopwatchData(this.clientStopwatches[t].stopwatch)},e.logStopwatchData=function(t){var n=t.popResolvedSpans(),i=t.name,r={};if(Object.keys(n).length>e.MAXSPANS){var o=0;for(var a in r[i]={},n)n.hasOwnProperty(a)&&(r[i][a]=n[a],o===e.MAXSPANS&&(r[i].annotations=t.annotations,e.send_spans(r),o=0,r[i]={}),o++)}else r[i]=n;0!==Object.keys(r[i]).length&&(r[i].annotations=t.annotations,e.send_spans(r))},e.send_spans=function(e){var t=JSON.stringify(e),n={request_id:o.REQUEST_ID,url:s.get_href().replace("/dws2",""),aggregated_sw_data:t};i.sendXhr("/log_js_sw_data",n)},e.prototype.print_stopwatches_debug=function(){var e=this.get_debug_data();console.table&&console.groupCollapsed&&console.groupEnd&&e&&e.length>0&&(console.groupCollapsed("Request timeline"),console.table(e),console.groupEnd())},e.prototype.get_debug_data=function(){var e=[];for(var t in this.globalStopwatches)if(this.globalStopwatches.hasOwnProperty(t)){var n=this.globalStopwatches[t].peekResolvedSpans();for(var i in n)if(n.hasOwnProperty(i)){var o=n[i],a={stopwatchName:t,spanName:o.name,time:o.start_time+o.total_time};o.type!==r.TimingDataType.AsyncSpan&&o.type!==r.TimingDataType.Span||(a.startTime=o.start_time),o.type===r.TimingDataType.Span&&(a.info="Total time: "+o.total_time+"ms"),e.push(a)}}return e.sort((function(e,t){return e.time-t.time})),e},e.MAXSPANS=2e3,e})();t.JSStopwatch=new l;var p=(function(){function e(e,t,n,i,r,o){this.sentInitialData=!1,this.strictAssert=!1,this.id=e,this.stopwatch=n,this._request_id=i,this._correlation_id=r,this._url=o,this._request_id&&this.stopwatch.addAnnotation(u.REQUEST_ID.id,this._request_id),this._correlation_id&&this.stopwatch.addAnnotation(u.CORRELATION_ID.id,this._correlation_id),this._url&&this.stopwatch.addAnnotation(u.URL.id,this._url)}return Object.defineProperty(e.prototype,"request_id",{set:function(e){this._request_id=e,this._request_id?this.stopwatch.addAnnotation(u.REQUEST_ID.id,this._request_id):this.stopwatch.removeAnnotation(u.REQUEST_ID.id)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"correlation_id",{set:function(e){this._correlation_id=e,this._correlation_id?this.stopwatch.addAnnotation(u.CORRELATION_ID.id,this._correlation_id):this.stopwatch.removeAnnotation(u.CORRELATION_ID.id)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{set:function(e){this._url=e,this._url?this.stopwatch.addAnnotation(u.URL.id,this._url):this.stopwatch.removeAnnotation(u.URL.id)},enumerable:!1,configurable:!0}),e.prototype.startSpan=function(e,t){return this.stopwatch.start(e,t)},e.prototype.endSpan=function(e,t){return this.stopwatch.end(e,t)},e.prototype.addSpanAnnotation=function(e,t,n,i){this.stopwatch.addSpanAnnotation(e,t,n,i)},e.prototype.recordTrace=function(e,t,n){this.stopwatch.recordTrace(e,{traceTime:t,annotations:n})},e.prototype.recordEntries=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];if(i.type===r.TimingDataType.Trace)this.recordTrace(i.name,i.endTime,i.annotations);else{var o=i.startTime||0,a=this.startSpan(i.name,{startTime:Math.min(o,i.endTime),async:i.type===r.TimingDataType.AsyncSpan,annotations:i.annotations});i.endTime<o&&this.addSpanAnnotation(i.name,"negativeSpanLength",(i.endTime-o).toString(),a),this.endSpan(i.name,{spanId:a,endTime:Math.max(o,i.endTime)})}}},e.prototype.logData=function(){this.sentInitialData?this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.stopwatch.attach(),this.sentInitialData=!0,setTimeout((function(){t.JSStopwatch.flush_current_data()}),0))},e.prototype.addAnnotation=function(e,t){this.stopwatch.addAnnotation(e,t)},e.prototype.removeAnnotation=function(e){this.stopwatch.removeAnnotation(e)},e.prototype.reportMisuse=function(e){e="ClientStopwatch: "+e,this.strictAssert?a.assert(!1,e):c.reportStack(e,{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},e})()})),define("apex-metrics/index",["require","exports","tslib","apex-metrics/clock","apex-metrics/executor","apex-metrics/instant","apex-metrics/internal","apex-metrics/metrics","apex-metrics/metrics_reporter","apex-metrics/no_op","apex-metrics/types","apex-metrics/validate"],(function(e,t,n,i,r,o,a,s,c,u,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(i,t),n.__exportStar(r,t),n.__exportStar(o,t),n.__exportStar(a,t),n.__exportStar(s,t),n.__exportStar(c,t),n.__exportStar(u,t),n.__exportStar(l,t),n.__exportStar(p,t)})),define("apex-metrics/clock",["require","exports","apex-metrics/types"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserPerformanceClock=void 0;var i=(function(){function e(){}return e.prototype.now=function(){return{value:performance.now(),unit:n.TimeUnit.MILLISECONDS}},e})();t.BrowserPerformanceClock=i})),define("apex-metrics/executor",["require","exports","apex-metrics/instant"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetTimeoutExecutor=void 0;var i=(function(){function e(e){this.jitterStrategy=e}return e.prototype.executeEvery=function(e,t){var i=this,r=n.Instant.toMilliseconds(e),o=n.Instant.toMilliseconds(this.jitterStrategy());setTimeout((function(){t()&&i.executeEvery(e,t)}),r+o)},e})();t.SetTimeoutExecutor=i})),define("apex-metrics/instant",["require","exports","apex-metrics/types"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Instant=void 0;var i=(function(){function e(){}return e.toMilliseconds=function(e){switch(e.unit){case n.TimeUnit.NANOSECONDS:return e.value/1e6;case n.TimeUnit.MILLISECONDS:return e.value;case n.TimeUnit.SECONDS:return 1e3*e.value;case n.TimeUnit.MINUTES:return 6e4*e.value;case n.TimeUnit.HOURS:return 36e5*e.value;case n.TimeUnit.DAYS:return 24*e.value*36e5}},e})();t.Instant=i})),define("apex-metrics/internal",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("apex-metrics/metrics",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("apex-metrics/metrics_reporter",["require","exports","apex-metrics/instant","apex-metrics/validate"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsReporterImpl=void 0;var r=(function(){function e(e,t,n){void 0===n&&(n={}),this.sink=e,this.clock=t,this.tags=n}return e.root=function(t,n){return new e(t,n)},e.prototype.child=function(t){return new e(this.sink,this.clock,Object.assign(Object.assign({},this.tags),i.validateTags(t)))},e.prototype.createStats=function(e,t){return void 0===t&&(t={}),new o(i.validateMetric(e),Object.assign(Object.assign({},this.tags),i.validateTags(t)),this.sink)},e.prototype.createCounter=function(e,t){return void 0===t&&(t={}),new a(i.validateMetric(e),Object.assign(Object.assign({},this.tags),i.validateTags(t)),this.sink)},e.prototype.createTimer=function(e,t){return void 0===t&&(t={}),new s(i.validateMetric(e),Object.assign(Object.assign({},this.tags),i.validateTags(t)),this.sink,this.clock)},e})();t.MetricsReporterImpl=r;var o=(function(){function e(e,t,n){this.metric=e,this.tags=t,this.sink=n}return e.prototype.record=function(e){c(e,this.metric,this.tags,this.sink)},e.prototype.recordDuration=function(e,t){c(n.Instant.toMilliseconds({value:e,unit:t}),this.metric,this.tags,this.sink)},e})(),a=(function(){function e(e,t,n,i){void 0===i&&(i=0),this.metric=e,this.tags=t,this.sink=n,this.value=i}return e.prototype.decrement=function(e){void 0===e&&(e=1),this.value-=e},e.prototype.increment=function(e){void 0===e&&(e=1),this.value+=e},e.prototype.reset=function(e){void 0===e&&(e=0),this.value=e},e.prototype.record=function(){c(this.value,this.metric,this.tags,this.sink),this.reset()},e})(),s=(function(){function e(e,t,i,r,o){void 0===o&&(o=0),this.metric=e,this.tags=t,this.sink=i,this.clock=r,this.value=o,this.value=n.Instant.toMilliseconds(this.clock.now())}return e.prototype.record=function(){c(n.Instant.toMilliseconds(this.clock.now())-this.value,this.metric,this.tags,this.sink),this.reset()},e.prototype.reset=function(){this.value=n.Instant.toMilliseconds(this.clock.now())},e})();function c(e,t,n,i){if("number"!=typeof e)throw new Error("value must be a number");i.recordSpan({namespace:t.ns,metricName:t.name,tags:n,samples:[e]})}})),define("apex-metrics/no_op",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoOpExecutor=t.NoOpSink=void 0;var n=(function(){function e(){}return e.prototype.recordSpan=function(){},e})();t.NoOpSink=n;var i=(function(){function e(){}return e.prototype.executeEvery=function(){},e})();t.NoOpExecutor=i})),define("apex-metrics/types",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TimeUnit=void 0,(n=t.TimeUnit||(t.TimeUnit={}))[n.NANOSECONDS=0]="NANOSECONDS",n[n.MILLISECONDS=1]="MILLISECONDS",n[n.SECONDS=2]="SECONDS",n[n.MINUTES=3]="MINUTES",n[n.HOURS=4]="HOURS",n[n.DAYS=5]="DAYS"})),define("apex-metrics/validate",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateMetricName=t.validateNamespace=t.validateTags=t.validateMetric=void 0;var n=new RegExp("^[^0-9a-zA-Z]+"),i=new RegExp("[^0-9a-zA-Z._-]","g"),r=i,o=new RegExp("[^0-9a-zA-Z/._-]","g"),a=i;function s(e){return u(e,"namespace",256,n,r)}function c(e){return u(e,"metric name",256,n,o)}function u(e,t,n,i,r){var o=[];if("string"!=typeof e&&o.push("identifier is not a string"),i&&i.test(e)&&o.push("invalid prefix"),r&&r.test(e)&&o.push("invalid characters"),e.length>n&&o.push("exceeds "+n+" characters"),0===e.length&&o.push("is empty"),0!==o.length)throw new Error(t+" identifier '"+e+"' is invalid: "+o);return e}t.validateMetric=function(e){return{ns:s(e.ns),name:c(e.name)}},t.validateTags=function(e){var t={};for(var i in e){if(e.hasOwnProperty(i))t[u(i,"tag name",256,n,a)]=u(e[i],"tag value",256)}return t},t.validateNamespace=s,t.validateMetricName=c})),define("dropbox/proto/js_init_data/web_timing_logger/web_timing_logger",["require","exports","tslib","protobufjs/minimal"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.web_timing_logger=void 0;var r,o=(i=n.__importStar(i)).Reader,a=i.Writer,s=i.util,c=i.roots.default||(i.roots.default={});t.default=c,t.web_timing_logger=c.web_timing_logger=((r=c.web_timing_logger||{}).WebTimingLoggerServerContext=(function(e){function e(e){if(this.subtypes={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.isDws=!1,e.prototype.dwsOpts=null,e.prototype.sourceType=0,e.prototype.subtypes=s.emptyObject,e.prototype.url="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.isDws&&Object.hasOwnProperty.call(e,"isDws")&&t.uint32(8).bool(e.isDws),null!=e.dwsOpts&&Object.hasOwnProperty.call(e,"dwsOpts")&&c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.encode(e.dwsOpts,t.uint32(18).fork()).ldelim(),null!=e.sourceType&&Object.hasOwnProperty.call(e,"sourceType")&&t.uint32(24).int32(e.sourceType),null!=e.subtypes&&Object.hasOwnProperty.call(e,"subtypes"))for(var n=Object.keys(e.subtypes),i=0;i<n.length;++i)t.uint32(34).fork().uint32(10).string(n[i]).uint32(18).string(e.subtypes[n[i]]).ldelim();return null!=e.url&&Object.hasOwnProperty.call(e,"url")&&t.uint32(42).string(e.url),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n,i,r=void 0===t?e.len:e.pos+t,a=new c.web_timing_logger.WebTimingLoggerServerContext;e.pos<r;){var u=e.uint32();switch(u>>>3){case 1:a.isDws=e.bool();break;case 2:a.dwsOpts=c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.decode(e,e.uint32());break;case 3:a.sourceType=e.int32();break;case 4:a.subtypes===s.emptyObject&&(a.subtypes={});var l=e.uint32()+e.pos;for(n="",i="";e.pos<l;){var p=e.uint32();switch(p>>>3){case 1:n=e.string();break;case 2:i=e.string();break;default:e.skipType(7&p)}}a.subtypes[n]=i;break;case 5:a.url=e.string();break;default:e.skipType(7&u)}}return a},e.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext"},e.DWSOptions=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.isDws2=!1,e.prototype.isEarlyEnsemble=!1,e.prototype.jsPreloading=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.isDws2&&Object.hasOwnProperty.call(e,"isDws2")&&t.uint32(8).bool(e.isDws2),null!=e.isEarlyEnsemble&&Object.hasOwnProperty.call(e,"isEarlyEnsemble")&&t.uint32(16).bool(e.isEarlyEnsemble),null!=e.jsPreloading&&Object.hasOwnProperty.call(e,"jsPreloading")&&t.uint32(24).bool(e.jsPreloading),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.isDws2=e.bool();break;case 2:i.isEarlyEnsemble=e.bool();break;case 3:i.jsPreloading=e.bool();break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext.DWSOptions"},e})(e.DWSOptions||{}),e.SourceType=(t={},(n=Object.create(t))[t[0]="UNKNOWN"]=0,n[t[1]="DESKTOP_WEB"]=1,n[t[2]="MOBILE_WEB"]=2,n),e})(r.WebTimingLoggerServerContext||{}),r)})),define("dropbox/proto/apex_metrics_web/apex_metrics_web",["require","exports","tslib","protobufjs/minimal","google/protobuf/empty","google/protobuf/timestamp"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.apex_metrics_web=void 0;var r,o=(i=n.__importStar(i)).Reader,a=i.Writer,s=i.util,c=i.roots.default||(i.roots.default={});t.default=c,t.apex_metrics_web=c.apex_metrics_web=((r=c.apex_metrics_web||{}).RecordNamespace=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace;e.pos<n;){var r=e.uint32();e.skipType(7&r)}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace"},e.MetricReportingConfigV2=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.metricNamespace="",e.prototype.maxTimeUntilRefreshSeconds=0,e.prototype.stopPublicationForSeconds=0,e.prototype.dropSamples=null,e.prototype.dropPeriods=null,e.prototype.dropFractionOfHostsPerMetric=0,e.prototype.aggregationIntervalSeconds=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.metricNamespace&&Object.hasOwnProperty.call(e,"metricNamespace")&&t.uint32(10).string(e.metricNamespace),null!=e.maxTimeUntilRefreshSeconds&&Object.hasOwnProperty.call(e,"maxTimeUntilRefreshSeconds")&&t.uint32(16).uint32(e.maxTimeUntilRefreshSeconds),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(24).uint32(e.stopPublicationForSeconds),null!=e.dropSamples&&Object.hasOwnProperty.call(e,"dropSamples")&&c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropSamples,t.uint32(34).fork()).ldelim(),null!=e.dropPeriods&&Object.hasOwnProperty.call(e,"dropPeriods")&&c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropPeriods,t.uint32(42).fork()).ldelim(),null!=e.dropFractionOfHostsPerMetric&&Object.hasOwnProperty.call(e,"dropFractionOfHostsPerMetric")&&t.uint32(49).double(e.dropFractionOfHostsPerMetric),null!=e.aggregationIntervalSeconds&&Object.hasOwnProperty.call(e,"aggregationIntervalSeconds")&&t.uint32(56).uint32(e.aggregationIntervalSeconds),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.MetricReportingConfigV2;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.metricNamespace=e.string();break;case 2:i.maxTimeUntilRefreshSeconds=e.uint32();break;case 3:i.stopPublicationForSeconds=e.uint32();break;case 4:i.dropSamples=c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 5:i.dropPeriods=c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 6:i.dropFractionOfHostsPerMetric=e.double();break;case 7:i.aggregationIntervalSeconds=e.uint32();break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.MetricReportingConfigV2"},e})(e.MetricReportingConfigV2||{}),e.StickyBiasedCoinV2=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.fraction=0,e.prototype.stickiness=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.fraction&&Object.hasOwnProperty.call(e,"fraction")&&t.uint32(9).double(e.fraction),null!=e.stickiness&&Object.hasOwnProperty.call(e,"stickiness")&&c.apex_metrics_web.RecordNamespace.StickinessV2.encode(e.stickiness,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.fraction=e.double();break;case 2:i.stickiness=c.apex_metrics_web.RecordNamespace.StickinessV2.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickyBiasedCoinV2"},e})(e.StickyBiasedCoinV2||{}),e.StickinessV2=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.independent=null,e.prototype.permanent=null,e.prototype.nResults=0,e.prototype.nSeconds=0,Object.defineProperty(e.prototype,"limit",{get:s.oneOfGetter(t=["independent","permanent","nResults","nSeconds"]),set:s.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.independent&&Object.hasOwnProperty.call(e,"independent")&&c.google.protobuf.Empty.encode(e.independent,t.uint32(10).fork()).ldelim(),null!=e.permanent&&Object.hasOwnProperty.call(e,"permanent")&&c.google.protobuf.Empty.encode(e.permanent,t.uint32(18).fork()).ldelim(),null!=e.nResults&&Object.hasOwnProperty.call(e,"nResults")&&t.uint32(24).uint32(e.nResults),null!=e.nSeconds&&Object.hasOwnProperty.call(e,"nSeconds")&&t.uint32(37).float(e.nSeconds),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.StickinessV2;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.independent=c.google.protobuf.Empty.decode(e,e.uint32());break;case 2:i.permanent=c.google.protobuf.Empty.decode(e,e.uint32());break;case 3:i.nResults=e.uint32();break;case 4:i.nSeconds=e.float();break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickinessV2"},e})(e.StickinessV2||{}),e.RecordResponse=(function(e){function e(e){if(this.reportingConfigs=[],this.debugInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.reportingConfigs=s.emptyArray,e.prototype.publicationIntervalSeconds=0,e.prototype.maxScopesPerRequest=0,e.prototype.stopPublicationForSeconds=0,e.prototype.debugInfos=s.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.reportingConfigs&&e.reportingConfigs.length)for(var n=0;n<e.reportingConfigs.length;++n)c.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.encode(e.reportingConfigs[n],t.uint32(10).fork()).ldelim();if(null!=e.publicationIntervalSeconds&&Object.hasOwnProperty.call(e,"publicationIntervalSeconds")&&t.uint32(24).uint32(e.publicationIntervalSeconds),null!=e.maxScopesPerRequest&&Object.hasOwnProperty.call(e,"maxScopesPerRequest")&&t.uint32(32).uint32(e.maxScopesPerRequest),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(40).uint32(e.stopPublicationForSeconds),null!=e.debugInfos&&e.debugInfos.length)for(n=0;n<e.debugInfos.length;++n)t.uint32(50).string(e.debugInfos[n]);return t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.RecordResponse;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.reportingConfigs&&i.reportingConfigs.length||(i.reportingConfigs=[]),i.reportingConfigs.push(c.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.decode(e,e.uint32()));break;case 3:i.publicationIntervalSeconds=e.uint32();break;case 4:i.maxScopesPerRequest=e.uint32();break;case 5:i.stopPublicationForSeconds=e.uint32();break;case 6:i.debugInfos&&i.debugInfos.length||(i.debugInfos=[]),i.debugInfos.push(e.string());break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.RecordResponse"},e})(e.RecordResponse||{}),e})(r.RecordNamespace||{}),r.ApexMetricsCacheData=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.config=null,e.prototype.timeStored=null,e.prototype.state=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.config&&Object.hasOwnProperty.call(e,"config")&&c.apex_metrics_web.RecordNamespace.RecordResponse.encode(e.config,t.uint32(10).fork()).ldelim(),null!=e.timeStored&&Object.hasOwnProperty.call(e,"timeStored")&&c.google.protobuf.Timestamp.encode(e.timeStored,t.uint32(18).fork()).ldelim(),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&c.apex_metrics_web.ApexMetricsCacheData.FilterState.encode(e.state,t.uint32(26).fork()).ldelim(),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.ApexMetricsCacheData;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.config=c.apex_metrics_web.RecordNamespace.RecordResponse.decode(e,e.uint32());break;case 2:i.timeStored=c.google.protobuf.Timestamp.decode(e,e.uint32());break;case 3:i.state=c.apex_metrics_web.ApexMetricsCacheData.FilterState.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData"},e.CoinState=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lastFlipTime=null,e.prototype.lastResult=!1,e.prototype.numTimesChecked=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.lastFlipTime&&Object.hasOwnProperty.call(e,"lastFlipTime")&&c.google.protobuf.Timestamp.encode(e.lastFlipTime,t.uint32(10).fork()).ldelim(),null!=e.lastResult&&Object.hasOwnProperty.call(e,"lastResult")&&t.uint32(16).bool(e.lastResult),null!=e.numTimesChecked&&Object.hasOwnProperty.call(e,"numTimesChecked")&&t.uint32(24).uint32(e.numTimesChecked),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.ApexMetricsCacheData.CoinState;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.lastFlipTime=c.google.protobuf.Timestamp.decode(e,e.uint32());break;case 2:i.lastResult=e.bool();break;case 3:i.numTimesChecked=e.uint32();break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.CoinState"},e})(e.CoinState||{}),e.NamespaceCoinState=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dropPeriodCoin=null,e.prototype.dropSamplesCoin=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.dropPeriodCoin&&Object.hasOwnProperty.call(e,"dropPeriodCoin")&&c.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropPeriodCoin,t.uint32(10).fork()).ldelim(),null!=e.dropSamplesCoin&&Object.hasOwnProperty.call(e,"dropSamplesCoin")&&c.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropSamplesCoin,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.dropPeriodCoin=c.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;case 2:i.dropSamplesCoin=c.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState"},e})(e.NamespaceCoinState||{}),e.FilterState=(function(e){function e(e){if(this.namespaceCoinState={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.filterID=0,e.prototype.namespaceCoinState=s.emptyObject,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.filterID&&Object.hasOwnProperty.call(e,"filterID")&&t.uint32(8).uint32(e.filterID),null!=e.namespaceCoinState&&Object.hasOwnProperty.call(e,"namespaceCoinState"))for(var n=Object.keys(e.namespaceCoinState),i=0;i<n.length;++i)t.uint32(18).fork().uint32(10).string(n[i]),c.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.encode(e.namespaceCoinState[n[i]],t.uint32(18).fork()).ldelim().ldelim();return t},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n,i,r=void 0===t?e.len:e.pos+t,a=new c.apex_metrics_web.ApexMetricsCacheData.FilterState;e.pos<r;){var u=e.uint32();switch(u>>>3){case 1:a.filterID=e.uint32();break;case 2:a.namespaceCoinState===s.emptyObject&&(a.namespaceCoinState={});var l=e.uint32()+e.pos;for(n="",i=null;e.pos<l;){var p=e.uint32();switch(p>>>3){case 1:n=e.string();break;case 2:i=c.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.decode(e,e.uint32());break;default:e.skipType(7&p)}}a.namespaceCoinState[n]=i;break;default:e.skipType(7&u)}}return a},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.FilterState"},e})(e.FilterState||{}),e})(r.ApexMetricsCacheData||{}),r)})),define("modules/clean/user_centric_perf_metrics/utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitForPageHidden=t.waitForPageLoad=void 0,t.waitForPageLoad=function(){return"complete"===document.readyState?Promise.resolve():new Promise((function(e,t){window.addEventListener("load",(function(){e()}))}))},t.waitForPageHidden=function(){return new Promise((function(e,t){var n=function(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||(document.removeEventListener("visibilitychange",n,!0),window.removeEventListener("pagehide",n,!0),e())};document.addEventListener("visibilitychange",n,!0),window.addEventListener("pagehide",n,!0)}))}})),define("modules/clean/user_centric_perf_metrics/annotations",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationNameEnum=void 0,(function(e){e.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS="long_input_delay_callback_latency_overhead_ms",e.AVG_LONG_INPUT_DELAY_MS="long_input_delay_ms",e.HAS_USER_INTERACTED_WITH_PAGE="has_user_interacted_with_page",e.WAS_DOCUMENT_HIDDEN_AT_SOME_POINT="was_document_hidden_at_some_point",e.VC_IN_VIEWPORT_MUTATION_OBSERVED_COUNT="vc_in_viewport_mutation_observed_count",e.VC_INTERSECTIONS_SCHEDULED_COUNT="vc_intersections_scheduled_count",e.VC_MUTATIONS_OBSERVED_COUNT="vc_mutations_observed_count",e.VC_INTERSECTIONS_OBSERVED_COUNT="vc_intersections_observed_count",e.VC_TOTAL_MUTATION_CALLBACK_LATENCY_OVERHEAD_MS="vc_total_mutation_callback_latency_overhead_ms",e.VC_TOTAL_INTERSECTION_CALLBACK_LATENCY_OVERHEAD_MS="vc_total_intersection_callback_latency_overhead_ms",e.VC_TOTAL_CALLBACK_LATENCY_OVERHEAD_MS="vc_total_callback_latency_overhead_ms",e.VC_ELEMENTS_SCHEDULED_FOR_OBSERVATION_BUT_NOT_OBSERVED_COUNT="vc_elements_scheduled_for_observation_but_not_observed_count"})(t.AnnotationNameEnum||(t.AnnotationNameEnum={}))})),define("modules/clean/user_centric_perf_metrics/in_viewport_mutation_observer",["require","exports","tslib","modules/clean/user_centric_perf_metrics/annotations"],(function(e,t,n,i){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ElementWrapperFactory=t.Mutation=t.InViewportMutationRecordToMutationsProcessor=t.InViewportMutationObserver=t.HTMLAttribute=t.MutationReason=void 0,(function(e){e.STYLE_ATTRIBUTE_MODIFIED="STYLE_ATTRIBUTE_MODIFIED",e.HIDDEN_ATTRIBUTE_MODIFIED="HIDDEN_ATTRIBUTE_MODIFIED",e.DOM_NODE_ADDED="DOM_NODE_ADDED",e.IMAGE_ATTRIBUTE_MODIFIED="IMAGE_ATTRIBUTE_MODIFIED",e.IMAGE_DOM_NODE_ADDED="IMAGE_DOM_NODE_ADDED"})(r=t.MutationReason||(t.MutationReason={})),(function(e){e.ATTRIBUTE_NAME="data-visuallycomplete",e.IGNORE_VALUE="IGNORE"})(o=t.HTMLAttribute||(t.HTMLAttribute={}));var a=(function(){function e(e){var t,n,i,r=this;this.pendingMutations=new Map,this.mutationObserverConfig={attributeFilter:["hidden","style","src"],attributeOldValue:!0,attributes:!0,characterData:!0,childList:!0,subtree:!0},this.isObserving=!1,this.intersectionsScheduledCount=0,this.mutatationsObservedCount=0,this.intersectionsObservedCount=0,this.wasDocumentHiddenAtSomePoint=!1,this.totalMutationCallbackLatencyOverhead=0,this.totalIntersectionCallbackLatencyOverhead=0,this.mutationObserverCallback=function(e){var t=performance.now();r.mutatationsObservedCount+=e.length,s.processMutationRecords(e).forEach((function(e){r.isDocumentHidden()?r.callback(e):r.scheduleIntersectionObservation(e)})),r.totalMutationCallbackLatencyOverhead+=performance.now()-t},this.intersectionObserverCallback=function(e){var t=performance.now();r.intersectionsObservedCount+=e.length,e.forEach((function(e){var t=e.target;if(e.isIntersecting&&(r.intersectionObserver.unobserve(t),t instanceof HTMLElement&&r.pendingMutations.get(t))){var n=r.pendingMutations.get(t);n.intersectionObserverEntry=e,r.pendingMutations.delete(t),r.callback(n)}})),r.totalIntersectionCallbackLatencyOverhead+=performance.now()-t},this.callback=e.callback;var o=null!==(t=e.MutationObserverClass)&&void 0!==t?t:MutationObserver,a=null!==(n=e.IntersectionObserverClass)&&void 0!==n?n:IntersectionObserver;this.mutationObserver=new o(this.mutationObserverCallback),this.intersectionObserver=new a(this.intersectionObserverCallback),this.supportsVisibilityState=void 0!==document.visibilityState||void 0!==document.hidden,this.addAnnotation=null!==(i=e.addAnnotation)&&void 0!==i?i:function(){}}return e.prototype.observe=function(e){this.isObserving=!0,this.mutationObserver.observe(e,this.mutationObserverConfig)},e.prototype.disconnect=function(){this.isObserving&&(this.isObserving=!1,this.addAnnotations(),this.mutationObserver.disconnect(),this.intersectionObserver.disconnect(),this.pendingMutations.clear())},e.prototype.scheduleIntersectionObservation=function(e){this.intersectionsScheduledCount++,this.pendingMutations.set(e.target,e),this.intersectionObserver.observe(e.target)},e.prototype.addAnnotations=function(){this.addAnnotation(i.AnnotationNameEnum.VC_INTERSECTIONS_SCHEDULED_COUNT,this.intersectionsScheduledCount),this.addAnnotation(i.AnnotationNameEnum.VC_MUTATIONS_OBSERVED_COUNT,this.mutatationsObservedCount),this.addAnnotation(i.AnnotationNameEnum.VC_INTERSECTIONS_OBSERVED_COUNT,this.intersectionsObservedCount),this.addAnnotation(i.AnnotationNameEnum.VC_TOTAL_MUTATION_CALLBACK_LATENCY_OVERHEAD_MS,this.totalMutationCallbackLatencyOverhead),this.addAnnotation(i.AnnotationNameEnum.VC_TOTAL_INTERSECTION_CALLBACK_LATENCY_OVERHEAD_MS,this.totalIntersectionCallbackLatencyOverhead),this.addAnnotation(i.AnnotationNameEnum.VC_TOTAL_CALLBACK_LATENCY_OVERHEAD_MS,this.totalMutationCallbackLatencyOverhead+this.totalIntersectionCallbackLatencyOverhead),this.addAnnotation(i.AnnotationNameEnum.VC_ELEMENTS_SCHEDULED_FOR_OBSERVATION_BUT_NOT_OBSERVED_COUNT,this.pendingMutations.size)},e.prototype.isDocumentHidden=function(){var e=this.supportsVisibilityState&&void 0!==document.visibilityState?"hidden"===document.visibilityState:document.hidden;return e&&!this.wasDocumentHiddenAtSomePoint&&(this.wasDocumentHiddenAtSomePoint=!0,this.addAnnotation(i.AnnotationNameEnum.WAS_DOCUMENT_HIDDEN_AT_SOME_POINT,!0)),e},e})();t.InViewportMutationObserver=a;var s=(function(){function e(e){this.mutationRecord=e,this.elementWrapper=d.makeElementWrapper(e.target)}return e.processMutationRecords=function(t){for(var n=[],i=0,r=t;i<r.length;i++){var o=r[i];n.push.apply(n,new e(o).toMutations())}return n},e.prototype.toMutations=function(){return this.elementWrapper.isInRenderTree()?this.didAddNodes()?this.findMutationsWithinNodeList(this.mutationRecord.addedNodes):this.didModifyHiddenAttribute()?[this.toMutation(r.HIDDEN_ATTRIBUTE_MODIFIED)]:this.didModifyStyleAttribute()?[this.toMutation(r.STYLE_ATTRIBUTE_MODIFIED)]:this.didModifyImageAttributes()?[this.toMutation(r.IMAGE_ATTRIBUTE_MODIFIED)]:[]:[]},e.prototype.toMutation=function(e){return new c(this.elementWrapper,e)},e.prototype.didAddNodes=function(){var e;return"childList"===this.mutationRecord.type&&(null===(e=this.mutationRecord.addedNodes)||void 0===e?void 0:e.length)},e.prototype.didModifyHiddenAttribute=function(){return"hidden"===this.mutationRecord.attributeName&&!this.elementWrapper.isHidden},e.prototype.didModifyStyleAttribute=function(){return"style"===this.mutationRecord.attributeName&&this.elementWrapper.doesStyleHideElement(this.mutationRecord.oldValue)&&!this.elementWrapper.doesStyleHideElement()},e.prototype.didModifyImageAttributes=function(){return"IMG"===this.elementWrapper.element.tagName&&"src"===this.mutationRecord.attributeName},e.prototype.findMutationsWithinNodeList=function(e){var t=[];return d.fromNodeList(e).forEach((function(e){e.findImagesInChildNodes().forEach((function(e){t.push(new c(e,r.IMAGE_DOM_NODE_ADDED))})),t.push(new c(e,e instanceof p?r.IMAGE_DOM_NODE_ADDED:r.DOM_NODE_ADDED))})),t},e})();t.InViewportMutationRecordToMutationsProcessor=s;var c=(function(){function e(e,t){this.reason=t,this.timestamp=Date.now(),this.targetWrapper=e,this.target=e.element}return e.prototype.waitForLoadingResources=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return this.targetWrapper instanceof l?[4,this.targetWrapper.waitForLoad()]:[3,2];case 1:e.sent(),this.timestamp=Date.now(),e.label=2;case 2:return[2]}}))}))},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this.targetWrapper instanceof l&&this.targetWrapper.isLoading()},enumerable:!1,configurable:!0}),e})();t.Mutation=c;var u=(function(){function e(e){this.element=e}return Object.defineProperty(e.prototype,"isIgnored",{get:function(){return(this.element.getAttribute(o.ATTRIBUTE_NAME)||"").toLowerCase()===o.IGNORE_VALUE.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return this.doesStyleHideElement()||this.element.hasAttribute("hidden")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHTMLElement",{get:function(){return this.element instanceof HTMLElement},enumerable:!1,configurable:!0}),e.prototype.isInRenderTree=function(){for(var e=this.element;e;){var t=d.makeElementWrapper(e);if(!t.isHTMLElement||t.isHidden||t.isIgnored)return!1;e=e.parentElement}return!0},e.prototype.doesStyleHideElement=function(e){return void 0===e&&(e=void 0),void 0===e&&(e=this.element.getAttribute("style")),null!==e&&""!==e&&((e=e.replace(/ /g,"")).includes("visibility:hidden")||e.includes("display:none")||e.includes("content-visibility:hidden"))},e.prototype.findImagesInChildNodes=function(){return"function"!=typeof this.element.querySelectorAll?[]:d.fromNodeList(this.element.querySelectorAll("img"))},e})(),l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(u),p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.isImage=function(e){return"IMG"===e.tagName&&e instanceof HTMLImageElement},t.prototype.isLoading=function(){return!this.element.complete},t.prototype.waitForLoad=function(){return n.__awaiter(this,void 0,void 0,(function(){var e=this;return n.__generator(this,(function(t){return this.element.complete?[2,Promise.resolve()]:[2,new Promise((function(t,n){e.element.addEventListener("load",(function(){t()})),e.element.addEventListener("error",(function(){n()}))}))]}))}))},t})(l),d=(function(){function e(){}return e.fromNodeList=function(e){var t=this;return Array.from(e).map((function(e){return t.makeElementWrapper(e)})).filter((function(e){return e.isInRenderTree()}))},e.makeElementWrapper=function(e){return p.isImage(e)?new p(e):new u(e)},e})();t.ElementWrapperFactory=d})),define("modules/clean/user_centric_perf_metrics/visually_complete_calculator",["require","exports","tslib","modules/clean/user_centric_perf_metrics/in_viewport_mutation_observer","modules/clean/user_centric_perf_metrics/annotations","modules/clean/user_centric_perf_metrics/utils"],(function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageLoadVisuallyCompleteCalculator=t.VisuallyCompleteCalculator=void 0;var a=(function(){function e(t){var n,o,a=this;if(this.hasInitialized=!1,this.hasUserInteractedWithPage=!1,this.mutations=[],this.isSupportedEnvironment=e.isSupportedEnvironment(),this.userInteractionEvents=["click"],this.mutationObserverCallback=function(e){a.mutations.push(e)},this.onUserInteraction=function(){a.hasUserInteractedWithPage||(a.hasUserInteractedWithPage=!0,a.addAnnotation(r.AnnotationNameEnum.HAS_USER_INTERACTED_WITH_PAGE,a.hasUserInteractedWithPage)),a.removeEventListeners()},this.isSupportedEnvironment){this.target=t.target,this.calculationStartTimestamp=null!==(n=t.calculationStartTimestamp)&&void 0!==n?n:Date.now(),this.addAnnotation=t.addAnnotation||function(){};var s=null!==(o=t.InViewportMutationObserverClass)&&void 0!==o?o:i.InViewportMutationObserver;this.inViewportMutationObserver=new s({callback:this.mutationObserverCallback,addAnnotation:this.addAnnotation})}}return e.isSupportedEnvironment=function(){var e;return void 0!==window&&"MutationObserver"in window&&"IntersectionObserver"in window&&"function"==typeof document.querySelectorAll&&(null===(e=window.performance)||void 0===e?void 0:e.timing)},e.prototype.start=function(){this.isSupportedEnvironment&&(this.hasInitialized=!0,this.inViewportMutationObserver.observe(this.target),this.addEventListeners())},e.prototype.attemptMeasurement=function(){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:if(!this.isSupportedEnvironment)return[2,null];if(!this.hasInitialized)throw new Error("Programmer error: must call `start` before `attemptMeasurement`");return this.stopObserving(),this.mutations.length?[4,this.waitForResourceLoadingMutations()]:[2,null];case 1:return e.sent(),this.addAnnotation(r.AnnotationNameEnum.VC_IN_VIEWPORT_MUTATION_OBSERVED_COUNT,this.mutations.length),[2,this.doCalculation()]}}))}))},e.prototype.doCalculation=function(){return this.getLastDOMMutationTimestamp()-this.calculationStartTimestamp},e.prototype.getLastDOMMutationTimestamp=function(){if(!this.mutations.length)throw new Error("Programmer error - getLastDOMMutationTimestamp should only be called if there are mutations");return Math.max.apply(Math,this.mutations.map((function(e){return e.timestamp})))},e.prototype.stopObserving=function(){this.inViewportMutationObserver.disconnect(),this.removeEventListeners()},e.prototype.waitForResourceLoadingMutations=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return(e=this.mutations.filter((function(e){return e.isLoadingResources}))).length?[4,Promise.all(e.map((function(e){return e.waitForLoadingResources()}))).catch((function(){}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.addEventListeners=function(){var e=this;this.userInteractionEvents.forEach((function(t){window.addEventListener(t,e.onUserInteraction)}))},e.prototype.removeEventListeners=function(){var e=this;this.userInteractionEvents.forEach((function(t){window.removeEventListener(t,e.onUserInteraction)}))},e})();t.VisuallyCompleteCalculator=a;var s=(function(e){function t(t){void 0===t&&(t={});return a.isSupportedEnvironment()?e.call(this,n.__assign(n.__assign({},t),{target:document.querySelector("body"),calculationStartTimestamp:performance.timing.navigationStart}))||this:e.call(this,t)||this}return n.__extends(t,e),t.prototype.attemptMeasurement=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,o.waitForPageLoad()];case 1:return t.sent(),[2,e.prototype.attemptMeasurement.call(this)]}}))}))},t})(a);t.PageLoadVisuallyCompleteCalculator=s})),define("modules/clean/user_centric_perf_metrics/long_input_delay_observer",["require","exports","tslib","modules/constants/webtiming","modules/clean/user_centric_perf_metrics/annotations"],(function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LongInputDelayObserver=void 0,i=n.__importStar(i);var o=(function(){function e(t){var n,i=this;if(this.delayThresholdMS=50,this._isSupportedEnvironment=e.isSupportedEnvironment(),this.totalInputDelayCallbackLatencyOverheadMS=0,this.totalInputDelayMS=0,this.totalInputEntryCount=0,this.avgInputDelayMS=0,this.performanceObserverCallback=function(e){for(var t=performance.now(),n=[],o=e.getEntries(),a=o.length,s=0;s<a;s++){var c=o[s],u=c.processingStart-c.startTime;u>=i.delayThresholdMS&&(c.delay=u,n.push(c),i.totalInputDelayMS+=u)}n.length&&(i.totalInputEntryCount+=n.length,i.avgInputDelayMS=i.totalInputDelayMS/i.totalInputEntryCount,i.callback(n)),i.totalInputDelayCallbackLatencyOverheadMS+=performance.now()-t,i.addAnnotation(r.AnnotationNameEnum.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS,i.totalInputDelayCallbackLatencyOverheadMS),i.addAnnotation(r.AnnotationNameEnum.AVG_LONG_INPUT_DELAY_MS,i.avgInputDelayMS)},this._isSupportedEnvironment){var o=null!==(n=t.PerformanceObserverClass)&&void 0!==n?n:window.PerformanceObserver;this.performanceObserver=new o(this.performanceObserverCallback),this.delayThresholdMS=t.delayThresholdMS||this.delayThresholdMS,this.addAnnotation=t.addAnnotation||function(){},this.callback=t.callback}}return e.isSupportedEnvironment=function(e){return void 0===e&&(e=i.LOG_BETA_USER_CENTRIC_PERF_METRICS),void 0!==window&&"PerformanceObserver"in window&&"PerformanceEventTiming"in window&&e},e.prototype.observe=function(){this._isSupportedEnvironment&&this.performanceObserver.observe({entryTypes:["event"]})},e.prototype.disconnect=function(){this.performanceObserver&&this.performanceObserver.disconnect()},e})();t.LongInputDelayObserver=o})),define("modules/clean/user_centric_perf_metrics/metrics_collector",["require","exports","tslib","web-vitals","modules/clean/user_centric_perf_metrics/long_input_delay_observer","modules/clean/user_centric_perf_metrics/visually_complete_calculator","modules/clean/user_centric_perf_metrics/utils"],(function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsCollector=void 0;var s=(function(){function e(e){var t,n,a=this;void 0===e&&(e={}),this.numLongInputDelays=0,this.annotations=new Map,this.getLCP=i.getLCP,this.getCLS=i.getCLS,this.getFID=i.getFID,this.onLongInputDelay=function(e){a.numLongInputDelays+=e.length},this.addAnnotation=function(e,t){a.annotations.set(e,t)};var s=null!==(t=e.LongInputDelayObserverClass)&&void 0!==t?t:r.LongInputDelayObserver;this.longInputDelayObserver=new s({callback:this.onLongInputDelay,addAnnotation:this.addAnnotation});var c=null!==(n=e.VisuallyCompleteCalculatorClass)&&void 0!==n?n:o.PageLoadVisuallyCompleteCalculator;this.visuallyCompleteCalculator=new c({addAnnotation:this.addAnnotation}),this.visuallyCompleteCalculator.start()}return e.prototype.getVC=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.visuallyCompleteCalculator.attemptMeasurement()];case 1:return null!==(t=n.sent())&&e(t),[2]}}))}))},e.prototype.getLongInputDelays=function(e){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,a.waitForPageLoad()];case 1:return t.sent(),this.longInputDelayObserver.observe(),[4,a.waitForPageHidden()];case 2:return t.sent(),this.longInputDelayObserver.disconnect(),e(this.numLongInputDelays),[2]}}))}))},e})();t.MetricsCollector=s})),define("modules/clean/user_centric_perf_metrics/metrics_logger",["require","exports","tslib","apex-metrics/index","modules/clean/user_centric_perf_metrics/metrics_collector","modules/clean/user_centric_perf_metrics/annotations"],(function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUserCentricPerfMetrics=t.MetricsLogger=void 0;var a=(function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=new r.MetricsCollector),this.AMP_NAMESPACE="user_centric_perf",this.shouldLogToAmp=!1,e&&(this._metricsReporter=e),this.metricsCollector=t}return e.getSingleton=function(){return e.instance||(e.instance=new e),e.instance},Object.defineProperty(e.prototype,"metricsReporter",{get:function(){if(!this._metricsReporter)throw new Error("Must set `metricsReporter` on MetricsLogger before deriving metrics");return this._metricsReporter},set:function(e){this._metricsReporter=e},enumerable:!1,configurable:!0}),e.prototype.deriveAndLogAllMetrics=function(){this.deriveAndLogLargestContentfulPaint(),this.deriveAndLogFirstInputDelay(),this.deriveAndLogCumulativeLayoutShift(),this.deriveAndLogTimeToVisuallyComplete(),this.deriveAndLogNumLongInputDelays(),this.deriveAndLogTimeToConsistentlyInteractive(),this.observeRageClicks()},e.prototype.deriveAndLogLargestContentfulPaint=function(){var e=this;this.metricsCollector.getLCP((function(t){e.logMetricToAmp("time_to_largest_contentful_paint_ms",t.value)}))},e.prototype.deriveAndLogFirstInputDelay=function(){var e=this;this.metricsCollector.getFID((function(t){var n=t.entries[0].startTime;e.logMetricToAmp("time_to_first_input_ms",n),e.logMetricToAmp("first_input_delay_ms",t.value)}))},e.prototype.deriveAndLogCumulativeLayoutShift=function(){var e=this;this.metricsCollector.getCLS((function(t){e.logMetricToAmp("cumulative_layout_shift",t.value,null)}))},e.prototype.deriveAndLogTimeToVisuallyComplete=function(){var e=this;this.metricsCollector.getVC((function(t){var n=e.metricsCollector.annotations;e.logMetricToAmp("time_to_visually_complete_ms",t,i.TimeUnit.MILLISECONDS);var r=n.get(o.AnnotationNameEnum.VC_TOTAL_CALLBACK_LATENCY_OVERHEAD_MS);"number"==typeof r&&e.logMetricToAmp("visually_complete_calculation_overhead_ms",r,i.TimeUnit.MILLISECONDS);var a=new CustomEvent("visually_complete",{detail:{value:t}});window.dispatchEvent(a),performance.mark("visually_complete",{startTime:t}),n.forEach((function(e,t){t.startsWith("vc_")&&performance.mark("visually_complete-"+t,{startTime:e})}))}))},e.prototype.deriveAndLogNumLongInputDelays=function(){var e=this;this.metricsCollector.getLongInputDelays((function(t){e.logMetricToAmp("num_long_input_delays",t,null);var n=e.metricsCollector.annotations.get(o.AnnotationNameEnum.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS),i=e.metricsCollector.annotations.get(o.AnnotationNameEnum.AVG_LONG_INPUT_DELAY_MS);"number"==typeof n&&e.logMetricToAmp("long_input_delay_observation_overhead_ms",n),"number"==typeof i&&e.logMetricToAmp("avg_long_input_delay_ms",i)}))},e.prototype.deriveAndLogTimeToConsistentlyInteractive=function(){},e.prototype.observeRageClicks=function(){},e.prototype.logMetricToAmp=function(e,t,r,a){if(void 0===r&&(r=i.TimeUnit.MILLISECONDS),this.shouldLogToAmp){var s=this.metricsCollector.annotations,c=s.get(o.AnnotationNameEnum.WAS_DOCUMENT_HIDDEN_AT_SOME_POINT),u=s.get(o.AnnotationNameEnum.HAS_USER_INTERACTED_WITH_PAGE);a=n.__assign(n.__assign({},a),{was_document_hidden_at_some_point:c?"1":"0",user_interacted_with_page:u?"1":"0"});var l=this.metricsReporter.createStats(this.createAMPMetric(e),a);r?l.recordDuration(t,i.TimeUnit.MILLISECONDS):l.record(t)}},e.prototype.createAMPMetric=function(e){return{ns:this.AMP_NAMESPACE,name:"browser/"+e}},e})();t.MetricsLogger=a,void 0!==window&&a.getSingleton(),t.logUserCentricPerfMetrics=function(e,t){var n=a.getSingleton();n.metricsReporter=e,n.shouldLogToAmp=t,n.deriveAndLogAllMetrics()}})),define("prod_assets_web_modules/web-vitals",["exports"],(function(e){"use strict";var t,n,i,r,o=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},a=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}},s=function(e,t){var n=function n(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(e(i),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},c=function(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)},u=function(e,t,n){var i;return function(r){t.value>=0&&(r||n)&&(t.delta=t.value-(i||0),(t.delta||void 0===i)&&(i=t.value,e(t)))}},l=-1,p=function(){return"hidden"===document.visibilityState?0:1/0},d=function(){s((function(e){var t=e.timeStamp;l=t}),!0)},m=function(){return l<0&&(l=p(),d(),c((function(){setTimeout((function(){l=p(),d()}),0)}))),{get firstHiddenTime(){return l}}},_=function(e,t){var n,i=m(),r=o("FCP"),s=function(e){"first-contentful-paint"===e.name&&(p&&p.disconnect(),e.startTime<i.firstHiddenTime&&(r.value=e.startTime,r.entries.push(e),n(!0)))},l=performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],p=l?null:a("paint",s);(l||p)&&(n=u(e,r,t),l&&s(l),c((function(i){r=o("FCP"),n=u(e,r,t),requestAnimationFrame((function(){requestAnimationFrame((function(){r.value=performance.now()-i.timeStamp,n(!0)}))}))})))},f=!1,h=-1,v={passive:!0,capture:!0},g=new Date,S=function(e,r){t||(t=r,n=e,i=new Date,T(removeEventListener),w())},w=function(){if(n>=0&&n<i-g){var e={entryType:"first-input",name:t.type,target:t.target,cancelable:t.cancelable,startTime:t.timeStamp,processingStart:t.timeStamp+n};r.forEach((function(t){t(e)})),r=[]}},b=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?(function(e,t){var n=function(){S(e,t),r()},i=function(){r()},r=function(){removeEventListener("pointerup",n,v),removeEventListener("pointercancel",i,v)};addEventListener("pointerup",n,v),addEventListener("pointercancel",i,v)})(t,e):S(t,e)}},T=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,b,v)}))},y=new Set;e.getCLS=function(e,t){f||(_((function(e){h=e.value})),f=!0);var n,i=function(t){h>-1&&e(t)},r=o("CLS",0),l=0,p=[],d=function(e){if(!e.hadRecentInput){var t=p[0],i=p[p.length-1];l&&e.startTime-i.startTime<1e3&&e.startTime-t.startTime<5e3?(l+=e.value,p.push(e)):(l=e.value,p=[e]),l>r.value&&(r.value=l,r.entries=p,n())}},m=a("layout-shift",d);m&&(n=u(i,r,t),s((function(){m.takeRecords().map(d),n(!0)})),c((function(){l=0,h=-1,r=o("CLS",0),n=u(i,r,t)})))},e.getFCP=_,e.getFID=function(e,i){var l,p=m(),d=o("FID"),_=function(e){e.startTime<p.firstHiddenTime&&(d.value=e.processingStart-e.startTime,d.entries.push(e),l(!0))},f=a("first-input",_);l=u(e,d,i),f&&s((function(){f.takeRecords().map(_),f.disconnect()}),!0),f&&c((function(){var a;d=o("FID"),l=u(e,d,i),r=[],n=-1,t=null,T(addEventListener),a=_,r.push(a),w()}))},e.getLCP=function(e,t){var n,i=m(),r=o("LCP"),l=function(e){var t=e.startTime;t<i.firstHiddenTime&&(r.value=t,r.entries.push(e)),n()},p=a("largest-contentful-paint",l);if(p){n=u(e,r,t);var d=function(){y.has(r.id)||(p.takeRecords().map(l),p.disconnect(),y.add(r.id),n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,d,{once:!0,capture:!0})})),s(d,!0),c((function(i){r=o("LCP"),n=u(e,r,t),requestAnimationFrame((function(){requestAnimationFrame((function(){r.value=performance.now()-i.timeStamp,y.add(r.id),n(!0)}))}))}))}},e.getTTFB=function(e){var t,n=o("TTFB");t=function(){try{var t=performance.getEntriesByType("navigation")[0]||(function(){var e=performance.timing,t={entryType:"navigation",startTime:0};for(var n in e)"navigationStart"!==n&&"toJSON"!==n&&(t[n]=Math.max(e[n]-e.navigationStart,0));return t})();if(n.value=n.delta=t.responseStart,n.value<0)return;n.entries=[t],e(n)}catch(e){}},"complete"===document.readyState?setTimeout(t,0):addEventListener("pageshow",t)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pkg-timing.min.js-vflSOcxvx.map