define("modules/clean/clipboard_v3",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.copyToClipboard=void 0,t.copyToClipboard=function(e,t,r){var n=document.createElement("input");n.type="text",n.value=e,document.body.appendChild(n),n.select();var a=!1;try{a=document.execCommand("copy")}catch(e){}document.body.removeChild(n),a?null==t||t():null==r||r()}})),define("modules/clean/open_in_mobile_app",["require","exports","tslib","react","dig-components/typography","modules/clean/clipboard_v3","modules/core/i18n","modules/clean/analytics","modules/core/browser","modules/core/browser_detection","modules/core/assert","spectrum-sharing/utils/sharing_constants"],(function(e,t,r,n,a,i,o,s,c,l,u,d){"use strict";function m(){return l.iOS&&(window.location.pathname.startsWith("/s/")||window.location.pathname.startsWith("/sh/")||window.location.pathname.startsWith("/scl/"))}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyUrlLabelText=void 0,n=r.__importDefault(n),s=r.__importStar(s),c=r.__importStar(c),l=r.__importStar(l),t.CopyUrlLabelText=function(e){return m()?n.default.createElement(a.Text,r.__assign({color:"faint",tagName:"div"},e),o.intl.formatMessage({id:"EvntjN",defaultMessage:"Tapping Get the app will copy a link and open the content in the app"})):null},t.CopyUrlLabelText.displayName="CopyUrlLabelText";var g=(function(){function e(){}return e.initClass=function(){var e=this;this.vischange_listener=void 0,this.open_app_mode=!0,this.try_open_ios_9=function(t){((null==t?void 0:t.startsWith("https://itunes.apple.com/"))||(null==t?void 0:t.startsWith("https://app.adjust.com/")))&&(e._onInstallLoggingHandler(),c.unsafeRedirect(t))},this.fallback_will_launch=!1,this.try_open=function(t,r,n){if(e._onOpenLoggingHandler(),!e.fallback_will_launch){var a=!1,i=function(){return a=!0};document.addEventListener("visibilitychange",i);var o,c=!1,l=function(){return c=!0};window.addEventListener("pagehide",l),null!=n&&s.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN",d.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:n}),(o=document.createElement("iframe")).src=t||"",o.style.display="none",document.body.append(o);var u=Date.now();return setTimeout((function(){e.fallback_will_launch=!1,document.removeEventListener("visibilitychange",i),window.removeEventListener("pagehide",l),!c&&!a&&Date.now()<u+4700&&(null!=n&&s.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL",d.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:n}),r&&window.location.replace(r))}),3200),e.fallback_will_launch=!0}}},e._onOpenLoggingHandler=function(){},e._onInstallLoggingHandler=function(){},e.registerLoggingHandlers=function(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t},e.open_on_click=function(e,t,r,n,a,i){var o=this;r&&r.addEventListener("click",(function(r){r.preventDefault(),i?o.open_android_intent(i):o.open_ios(e,t,n)}))},e.open_ios=function(e,t,r){return m()&&i.copyToClipboard(window.location.href),r?this.try_open_ios_9(t):this.try_open(e,t)},e.open_android_intent=function(e){u.assert(e.startsWith("intent://www.dropbox.com/sm/launch_intent_or_fallback_page"),"intentUrl must use intent:// protocol"),this._onOpenLoggingHandler&&this._onOpenLoggingHandler(),window.location.href=e},e.cleanup=function(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)},e})();g.initClass(),t.default=g})),define("modules/clean/react/file_viewer/ml_experiment",["require","exports","api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDocClassification=t.ML_EXPERIMENT_EXTENSIONS=t.ML_ENDPOINT_FETCH_TYPES=t.ML_EXPERIMENT_TYPES=void 0,t.ML_EXPERIMENT_TYPES={contract:"CONTRACT",esign:"ESIGN",control:"CONTROL",file:"FILE"},t.ML_ENDPOINT_FETCH_TYPES=["CONTRACT","ESIGN"],t.ML_EXPERIMENT_EXTENSIONS=["pdf","docx"],t.fetchDocClassification=function(e,t){var n={file_id:t};return(new r.UserApiV2Client).ns("hellosign").rpc("get_classification",n,{subjectUserId:e})}})),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],(function(e,t,r,n,a,i,o,s,c,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=void 0;var m=(n=r.__importStar(n)).combineReducers({app:a.reducer,fileActivity:i.reducer,sidebar:o.reducer});function g(e,t){return"::RESET"===t.type&&(e=void 0),m(e,t)}t.store=u.createStore(g,d.composeEnhancersWithDevTools(n.applyMiddleware(s.thunk(),c.reactor(l.reactors))))})),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","file-viewer/core/index"],(function(e,t,r,n,a,i,o,s,c){"use strict";function l(e){return function(t,r){t({type:s.ActionType.SidebarOpen,payload:{reason:e}})}}function u(){return function(e,t){var r=t(),a=i.getSidebarContext(r).user;i.getSidebarState(r).open&&(e({type:s.ActionType.SidebarClose}),o.logSidebarClosed({num_comments:i.getTabState(r,"comments").extra.commentCount,num_events:n.getVisibleActivityCount(r),viewing_user_id:a?a.id:null}))}}function d(){return{type:s.ActionType.SidebarIndicateNewFileNav}}Object.defineProperty(t,"__esModule",{value:!0}),t.OverrideInitialState=t.setCommentingOnNewFile=t.setComments2ShownState=t.setComments2DisabledState=t.openFile=t.thirdpartyBlueDotOnboard=t.selectTab=t.completeToggleOpen=t.toggle=t.close=t.open=t.reset=void 0,n=r.__importStar(n),a=r.__importStar(a),i=r.__importStar(i),t.reset=function(){return{type:s.ActionType.SidebarReset}},t.open=l,t.close=u,t.toggle=function(){return function(e,t){var r=t();i.getSidebarState(r).open?e(u()):e(l("toggle_button"))}},t.completeToggleOpen=function(){return function(e){e(l("toggle_button_after_transition"))}},t.selectTab=function(e){return{type:s.ActionType.SidebarSelectTab,payload:{tabName:e}}},t.thirdpartyBlueDotOnboard=function(){return{type:s.ActionType.SidebarSetThirdPartyBlueDotOnboardState}},t.openFile=function(e){return function(t,r){var n=r(),o=i.getSidebarContext(n);a.isContextChanged(o,e)&&(t({type:s.ActionType.SidebarOpenFile,payload:e}),t(d()))}},t.setComments2DisabledState=function(){return{type:s.ActionType.SidebarSetComments2DisabledState}},t.setComments2ShownState=function(e){return{type:s.ActionType.SidebarSetComments2ShownState,payload:e}},t.setCommentingOnNewFile=d,t.OverrideInitialState=function(e){var t=e===c.FileViewerMode.Documentation?"metadata":"comments";return{type:s.ActionType.SidebarOverrideInitialState,payload:{open:!0,tab:t}}}})),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/util"],(function(e,t,r,n,a){"use strict";function i(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function o(e){return{actionTypes:i(e),name:e,type:"async"}}function s(e){return{actionType:e,name:e,type:"sync",zero:!1}}function c(e){return{actionType:e,name:e,type:"sync",zero:!0}}function l(){var e=this;return function(t,i){return r.__awaiter(e,void 0,void 0,(function(){var e,o,s,c,l,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return e=i.action,o=i.args,s=i.dispatch,c=i.context,l=i.getState,a.isContextSame(c,n.getContext(l()))?[3,2]:[4,t(i)];case 1:return[2,r.sent()];case 2:s({type:e.actionTypes.request,payload:o,meta:{args:o}}),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,t(i)];case 4:return u=r.sent(),s({type:e.actionTypes.success,payload:u,meta:{args:o}}),[2,u];case 5:throw d=r.sent(),s({type:e.actionTypes.error,error:d,meta:{args:o}}),d;case 6:return[2]}}))}))}}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncHandler=t.thunkHandler=t.dispatchMiddleware=t.createAsyncHandler=t.syncHandler=t.namespacedActions=t.syncAction0=t.syncAction=t.asyncAction=t.asyncActionConstants=t.errorReduxAction=t.successReduxAction=t.requestReduxAction=t.syncReduxAction=void 0,n=r.__importStar(n),t.syncReduxAction=function(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}},t.requestReduxAction=function(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}},t.successReduxAction=function(e,t,r){return{type:e.actionTypes.success,payload:r,meta:{args:t}}},t.errorReduxAction=function(e,t,r){return{type:e.actionTypes.error,error:r,meta:{args:t}}},t.asyncActionConstants=i,t.asyncAction=o,t.syncAction=s,t.syncAction0=c,t.namespacedActions=function(e){return{asyncAction:function(t){return o(e+"/"+t)},syncAction:function(t){return s(e+"/"+t)},syncAction0:function(t){return c(e+"/"+t)}}},t.syncHandler=function(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}},t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,a){return function(i){return function(o,s){return r.__awaiter(void 0,void 0,void 0,(function(){var c,l;return r.__generator(this,(function(u){switch(u.label){case 0:c=n.getContext(s()),l=e.reduceRight((function(e,t){return function(n){return r.__awaiter(void 0,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,t(e,n)];case 1:return[2,r.sent()]}}))}))}}),(function(e){return a(i,e)})),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,l({action:t,args:i,dispatch:o,getState:s,context:c})];case 2:return[2,u.sent()];case 3:return u.sent(),[3,4];case 4:return[2]}}))}))}}}},t.dispatchMiddleware=l,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(l())})),define("modules/clean/react/file_activity_stream/tti_logger",["require","exports","modules/clean/react/file_sidebar/file_sidebar_logger"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.faStreamTTILogger=void 0;var n=(function(){function e(){this.hasLogged=!1}return e.prototype.recordStart=function(e){this.startTs=(new Date).getTime(),this.fileId=e,this.hasLogged=!1},e.prototype.recordInteractive=function(e){if(!this.hasLogged&&e===this.fileId&&this.startTs){var t=(new Date).getTime();r.logActivityStreamInteractivity({time_start:this.startTs,time_interactive:t}),this.hasLogged=!0}},e})();t.faStreamTTILogger=new n})),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],(function(e,t,r,n,a,i){"use strict";function o(e){var t=a.getSidebarState(e),r=t.open,n=t.ready;return r&&n}function s(e){return!o(e)}function c(e){var t=a.getSidebarContext(e).user;n.logSidebarOpened({reason:a.getOpenReason(e),num_comments:a.getTabState(e,"comments").extra.commentCount,num_events:i.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}Object.defineProperty(t,"__esModule",{value:!0}),t.reactors=void 0,a=r.__importStar(a),i=r.__importStar(i),t.reactors=function(e){e({changesFrom:s,changesTo:o},(function(e){c(e.nextState)})),e({changes:function(e,t){if(o(e)&&o(t)){var r=t.sidebar.tabs,n=e.sidebar.tabs;return!(n.activity.ready&&n.comments.ready)&&r.activity.ready&&r.comments.ready}return!1}},(function(e){c(e.nextState)}))}})),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","lodash","reselect","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","typescript/libraries/comments2/src/transforms/index"],(function(e,t,r,n,a,i,o,s,c,l,u,d,m,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getThirdPartySource=t.getIsEditorFocusRequested=t.getDocumentMetadata=t.getStreamSettings=t.getDisplayedThreadsWithNumberedAnnotations=t.getDisplayedThreadsWithImageAnnotations=t.getDisplayedThreadsWithDocumentAnnotationsOnPage=t.getDisplayedThreadsForLayer=t.getVisibleInSidebar=t.getHasPendingNumberedAnnotation=t.getPendingNumberedAnnotation=t.getCurrentPageNumber=t.getPlayerCurrentTimeSec=t.getPlayerCurrentTime=t.getStreamId=t.getStream=t.getIsSubscribed=t.getCanSubscribe=t.getCanEnable=t.getStickers=t.getIsPlayerIntegrationEnabled=t.getStatuses=t.getShowResolved=t.getUnresolvedTimecodeThreads=t.getFocusedThreadId=t.getHoverThreadId=t.getListCommentsError=t.getDocumentRectangleToMakeVisibleIfComments2Ready=t.getActivatedTimecodeThread=t.getActivatedThread=t.getActivatedThreadId=t.getFrameRate=t.getFramePreciseCommentsEnabled=t.getHasShownAnyModalVariant=t.getOnboardingVariants=t.getShowOnboardingOnCommentsPane=t.getShowShareAsCommentOnboarding=t.getShowOnboardingOnVideo=t.getUnmarkedOnboardingKeysRelevantToCurrentFile=t.getCursor=t.getThreads=t.getThreadMap=t.getEditorIsEmpty=t.getSort=t.getRevision=t.getData=t.getIsComments2Ready=t.getPreviewTypeForCurrentFile=t.canCreateAnnotations=t.getViewerId=t.getViewer=t.getFQPath=t.isEnabled=t.getContextStatus=t.getContext=t.getState=t.IMAGE_SENTINEL=void 0,n=r.__importStar(n),l=r.__importStar(l),g=r.__importStar(g);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=function(e){return i.getStateAtNamespace(e,o.COMMENTS2_NAMESPACE_KEY)};t.getContext=function(e){var r=t.getState(e).context;return r?{stream:r.stream,viewer:r.viewer}:void 0},t.getContextStatus=function(e){var r=t.getState(e).context;return r?r.status:void 0};var p=a.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.FullyEnabled})),_=a.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.ReadOnly}));function v(e){return m.getPreviewType(g.getPreviewApiDataForCurrentFile(e))}function h(e){return a.createSelector(t.getData,(function(t){return t[e]}))}t.isEnabled=a.createSelector([p,_],(function(e,t){return e||t})),t.getFQPath=function(e){var r=t.getContext(e);return r?r.stream.fq_path:void 0},t.getViewer=function(e){var r=t.getContext(e);return r?r.viewer:void 0},t.getViewerId=function(e){var r=t.getViewer(e);return r?r.id:void 0},t.canCreateAnnotations=function(e){var r=t.getContext(e);return!(!r||!r.viewer)&&!l.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=v,t.getIsComments2Ready=function(e){var t=e[o.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==s.Comments2ContextStatus.FullyEnabled&&t.context.status!==s.Comments2ContextStatus.ReadOnly)},t.getData=function(e){return t.getState(e).data},t.getRevision=a.createSelector(t.getContext,(function(e){return e&&f.streamToRevision(e.stream)})),t.getSort=a.createSelector(v,(function(e){switch(e){case d.PreviewType.Audio:case d.PreviewType.Video:return s.SortType.VideoTimeCode;default:return s.SortType.Chronological}})),t.getEditorIsEmpty=h("editorIsEmpty"),t.getThreadMap=h("threads");var S=a.createSelector(t.getThreadMap,(function(e){return n.values(e)})),b=a.createSelector(t.getContext,(function(e){return e&&e.stream.isVersionHistoryMode}));function w(e){return t.isEnabled(e)&&!l.isComments2Mobile()&&(function(e){var r=t.getData(e).onboardingVariants;switch(v(e)){case d.PreviewType.Audio:case d.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?r.premium_av_comments_pane_surface:r.non_premium_av_comments_pane_surface;case d.PreviewType.SsrDoc:case d.PreviewType.Image:return r.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return r.not_annotatable_file_comments_pane_surface}})(e)}t.getThreads=a.createSelector([S,t.getSort,b,t.getRevision],(function(e,t,a,i){var o=(function(e,t){switch(t){case s.SortType.Chronological:return n.sortBy(e,[function(e){return e.timestamp.getTime()}]);case s.SortType.VideoTimeCode:var a=n.partition(e,c.isThreadWithTimecodeAnnotation),i=a[0],o=a[1];return r.__spreadArrays(n.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]),n.sortBy(o,[function(e){return e.timestamp.getTime()}]))}})(e,t);return a?(function(e,t){return e.filter((function(e){var r=e.comments[0].revisionInfo;return r.isCurrent||!t||r.revision&&r.revision.nsId===t.ns_id&&r.revision.sjId<=t.sjid}))})(o,i):o})),t.getCursor=h("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=function(e){var r,n=t.getData(e).onboardingVariants;switch(v(e)){case d.PreviewType.SsrDoc:case d.PreviewType.Image:r=["how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Audio:case d.PreviewType.Video:r=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:r=["not_annotatable_file_comments_pane_surface"]}return r.filter((function(e){return n[e]}))},t.getShowOnboardingOnVideo=function(e){var r=t.getData(e).onboardingVariants,n=!u.getIsMediaPlaying(e),a=u.getPauseCount(e);return t.isEnabled(e)&&!l.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&n&&!w(e)&&r.premium_av_preview_surface&&a%5==1&&a<15},t.getShowShareAsCommentOnboarding=function(e){return t.getData(e).onboardingVariants.share_as_comment},t.getShowOnboardingOnCommentsPane=w,t.getOnboardingVariants=function(e){return t.getData(e).onboardingVariants},t.getHasShownAnyModalVariant=function(e){var r=t.getData(e).modalVariantsShown;return r[s.ModalVariant.EmailVerifyModal]||r[s.ModalVariant.SignUpModal]},t.getFramePreciseCommentsEnabled=function(e){return t.getData(e).framePreciseCommentsEnabled},t.getFrameRate=function(e){return t.getData(e).frameRate},t.getActivatedThreadId=h("activatedThreadId"),t.getActivatedThread=a.createSelector(t.getActivatedThreadId,t.getThreadMap,(function(e,t){return e&&t[e]})),t.getActivatedTimecodeThread=function(e){var r=t.getActivatedThread(e);return r&&c.isThreadWithTimecodeAnnotation(r)?r:void 0};var y=h("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=function(e){return t.getIsComments2Ready(e)?y(e):void 0},t.getListCommentsError=h("listCommentsError"),t.getHoverThreadId=h("hoverThreadId"),t.getFocusedThreadId=h("focusedThreadId"),t.getUnresolvedTimecodeThreads=function(e){return(function(e){return t.getThreads(e).filter((function(e){return!e.resolvedInfo}))})(e).filter((function(e){var t=e.annotation;return t&&("video"===t.type||"audio"===t.type)}))},t.getShowResolved=h("showResolved"),t.getStatuses=function(e){return t.getState(e).statuses},t.getIsPlayerIntegrationEnabled=h("playerIntegrationEnabled"),t.getStickers=function(e){return t.getData(e).stickers},t.getCanEnable=function(e){return t.getData(e).enabledStatus.canEnable},t.getCanSubscribe=function(e){return t.getData(e).subscriptionStatus.canSubscribe},t.getIsSubscribed=function(e){return t.getData(e).subscriptionStatus.isSubscribed},t.getStream=function(e){var r=t.getContext(e);return r&&r.stream},t.getStreamId=function(e){var r=t.getContext(e);return r&&r.stream.id};var T=h("pendingAnnotationInfo");function E(e){return T(e).numberedAnnotation}t.getPlayerCurrentTime=function(e){return T(e).playerCurrentTime},t.getPlayerCurrentTimeSec=function(e){return T(e).playerCurrentTimeSec},t.getCurrentPageNumber=function(e){return T(e).currentPageNumber},t.getPendingNumberedAnnotation=E,t.getHasPendingNumberedAnnotation=function(e){return t.getIsComments2Ready(e)&&!!E(e)},t.getVisibleInSidebar=h("visibleInSidebar");var A=a.createSelector([t.getVisibleInSidebar,t.isEnabled,t.getShowResolved,S],(function(e,t,r,n){return e&&t?(r?n:n.filter((function(e){return!e.resolvedInfo}))).filter((function(e){return e.comments.some((function(e){return!e.deleted}))})):[]})),C=a.createSelector(A,(function(e){return e.filter(c.isThreadWithDocumentAnnotation)})),M=a.createSelector(C,(function(e){return n.groupBy(e,(function(e){return e.annotation.regions[0].page}))}));function I(e,t){return n.get(M(e),t,[])}function k(e){var t=e.annotation;return!!t&&("document"===t.type||"image"===t.type)}function F(e){return A(e).filter((function(e){return e&&void 0!==e.annotation&&"image"===e.annotation.type}))}t.getDisplayedThreadsForLayer=function(e,t){return void 0===t?F(e):I(e,t)},t.getDisplayedThreadsWithDocumentAnnotationsOnPage=I,t.getDisplayedThreadsWithImageAnnotations=F,t.getDisplayedThreadsWithNumberedAnnotations=function(e){return A(e).filter(k)};var R=h("canSeeCommentEditor");t.getStreamSettings=a.createSelector([p,t.getViewer,R],(function(e,t,r){return{canComment:e,canModifyThreads:r&&!!t,canShowEditor:r,canShowEditorMeatball:!1}})),t.getDocumentMetadata=function(e){switch(v(e)){case d.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case d.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}},t.getIsEditorFocusRequested=h("requestEditorFocus"),t.getThirdPartySource=h("thirdPartySource")})),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/constants","modules/clean/react/comments2/data/api","file-viewer/core/index","modules/clean/react/file_sidebar/store/instance","typescript/libraries/comments2/src/transforms/index","modules/clean/react/comments2/data/types","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","typescript/libraries/comments2/src/components/utils/throttle-debounce","modules/clean/bolt/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_viewer/data/actions"],(function(e,t,r,n,a,i,o,s,c,l,u,d,m,g,f,p,_,v,h,S,b,w,y,T){"use strict";function E(e){var t=this,n=e.clientFn,a=e.successCallback,i=e.eventToLog;return function(e,o){return r.__awaiter(t,void 0,void 0,(function(){var t,c,l;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=v.getContext(o()))||!t.viewer)throw new Error;c=new s.Comments2Api(t.viewer.id,t.stream),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n(c)];case 2:return l=r.sent(),p.logEvent(i,{stream:t.stream}),a(e,o,l),[3,4];case 3:return r.sent(),p.logErrorEvent("error trying to execute client event "+i,{stream:t.stream}),[3,4];case 4:return[2]}}))}))}}function A(e){return function(r,n){r(Q(e));var a=e.thread,i=n(),o=v.getStream(i);p.logEvent("activate_thread",{stream:o,thread:a}),a.read||a.readonly||r(t.Actions.markThreadRead({threadId:a.id,origin:d.MarkThreadReadOrigin.ThreadActivated}))}}function C(){return E({clientFn:function(e){return e.enableCommenting()},successCallback:M,eventToLog:"enable_comments"})}function M(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return v.getStreamId(t())!==n.id?[2]:[4,e(Y(d.Comments2ContextStatus.Pending))];case 1:return r.sent(),e(z(!0,!1)),[2]}}))}))}function I(){return E({clientFn:function(e){return e.disableCommenting()},successCallback:k,eventToLog:"disable_comments"})}function k(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var a;return r.__generator(this,(function(r){return v.getStreamId(t())!==n.id?[2]:(a=v.getContext(t()),F(e,a,!0),[2])}))}))}function F(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,e(Y(d.Comments2ContextStatus.Disabled))];case 1:return t.sent(),e(T.disableMode(c.FileViewerMode.Commenting)),[4,l.store.dispatch(y.setComments2DisabledState())];case 2:return t.sent(),[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=t.ActionTypes=t.perfLoggingMiddleware=t.statusHandlingMiddleware=t.setFileContext=t.bolt=t.disableCommenting=t.enableCommenting=void 0,n=r.__importStar(n),a=r.__importStar(a),f=r.__importStar(f),p=r.__importStar(p),_=r.__importStar(_),v=r.__importStar(v),y=r.__importStar(y),t.enableCommenting=C,t.disableCommenting=I,t.bolt={client:null,subscribe:function(e,r,n){var a=e.app_id,i=e.revision,o=e.token,s=e.unique_id,c=new S.SignedChannelState(a,s,i,o);t.bolt.client?t.bolt.client.update_states([c]):(t.bolt.client=new S.BoltClient([c],r,n),t.bolt.client.start())},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};var R=f.createBackoff(),O=R.backoff,P=R.resetBackoff;function D(e){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return n=i(),o=v.getContext(n),f.isContextSame(o,e)?[3,2]:(t.bolt.unsubscribe(),a(j(e)),a(qe({setContextTime:+new Date,listCompleteTime:0})),e?(s=o&&o.viewer,e.viewer&&!f.isUserSame(s,e.viewer)&&(a(t.Actions.checkOnboardingStatus(void 0)),a(t.Actions.getMediaFeatures(void 0))),v.getStickers(n)||a(t.Actions.getStickers(void 0)),e.stream&&a(t.Actions.getFileMetadata({fileId:e.stream.id,linkUrl:e.stream.linkUrl})),[4,a(z(!0))]):[3,2]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}}t.setFileContext=D;var x=w.namespacedActions("Comments2"),L=x.asyncAction,U=x.syncAction,N=x.syncAction0;function V(e){var t=this,n=e.handleError,a=e.handleSuccess;return function(e,o){return r.__awaiter(t,void 0,void 0,(function(){function t(){return r.__awaiter(this,void 0,void 0,(function(){var c,l,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e(o)];case 1:return c=r.sent(),[3,3];case 2:throw l=r.sent(),(u=(function(e,t){if(t instanceof s.Comments2Error&&(t.code===s.ErrorCode.FILE_NOT_FOUND||t.code===s.ErrorCode.PERMISSION_DENIED)&&e!==ae.name)return{message:i.intl.formatMessage({id:"CKj3RT",defaultMessage:"Either that file was deleted or you no longer have access to it."}),isRetriable:!1};switch(e){case he.name:case we.name:case Ae.name:return{message:i.intl.formatMessage({id:"3hOA04",defaultMessage:"We were unable to post the comment."}),isRetriable:!0};case Te.name:return{message:i.intl.formatMessage({id:"CiZnrG",defaultMessage:"We were unable to delete the comment."}),isRetriable:!0};case Re.name:return{message:i.intl.formatMessage({id:"+YPQ5/",defaultMessage:"We were unable to resolve the thread."}),isRetriable:!0};case Pe.name:return{message:i.intl.formatMessage({id:"QUs54P",defaultMessage:"We were unable to unresolve the thread."}),isRetriable:!0};case Me.name:return{message:i.intl.formatMessage({id:"Vgd16U",defaultMessage:"We were unable to mark the thread as read."}),isRetriable:!0};case ke.name:return{message:i.intl.formatMessage({id:"4apXur",defaultMessage:"We were unable to mark the thread as unread."}),isRetriable:!0};case ze.name:return{message:i.intl.formatMessage({id:"RmXnr0",defaultMessage:"We were unable to subscribe to the file."}),isRetriable:!0};case $e.name:return{message:i.intl.formatMessage({id:"oz0V3s",defaultMessage:"We were unable to unsubscribe from the file."}),isRetriable:!0};case ee.name:case re.name:case ae.name:case me.name:case je.name:default:return null}})(o.action.name,l))&&n({message:u.message,retryFn:u.isRetriable?t:void 0}),l;case 3:return(d=(function(e){switch(e){case ze.name:return{message:i.intl.formatMessage({id:"WQpgoO",defaultMessage:"You have subscribed to the file."})};case $e.name:return{message:i.intl.formatMessage({id:"8o4LmU",defaultMessage:"You have unsubscribed from the file."})};default:return null}})(o.action.name))&&a(d),[2,c]}}))}))}return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}}))}))}}function W(){return+new Date}function B(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){function t(t){var r=e(a.action.name,t);if(r){var n=W();a.dispatch(Tt(r,a.context,n-i))}}var i,o,c;return r.__generator(this,(function(e){switch(e.label){case 0:i=W(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n(a)];case 2:return o=e.sent(),[3,4];case 3:throw c=e.sent(),t(c instanceof s.Comments2Error?c.code:"unknown_error"),c;case 4:return t(),[2,o]}}))}))}}t.statusHandlingMiddleware=V,t.perfLoggingMiddleware=B;var H=w.createAsyncHandler(V({handleError:m.showErrorSnackbar,handleSuccess:m.showSuccessSnackbar}),(function(e,t){var r=t.context;if(!r)throw new Error("Bad state");var a=new s.Comments2LoggedOutApi(r.stream);return e(n.merge({},t,{api:a,context:r}))}),w.dispatchMiddleware()),G=w.createAsyncHandler(V({handleError:m.showErrorSnackbar,handleSuccess:m.showSuccessSnackbar}),(function(e,t){var r=t.context;if(!r||!r.viewer)throw new Error("Bad state");var a=new s.Comments2Api(r.viewer.id,r.stream);return e(n.merge({},t,{api:a,context:r}))}),(function(e){var t=this;return function(a,i){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,a(i)];case 1:return t=r.sent(),e(n.merge({},i,{payload:t,status:o.ApiClientStatus.Success})),[2,t];case 2:throw s=r.sent(),e(n.merge({},i,{error:s,status:o.ApiClientStatus.Error})),s;case 3:return[2]}}))}))}})((function(e){var t,r,n=e.context.stream,a=v.getThreadMap(e.getState());if(e.status===o.ApiClientStatus.Error)p.logErrorEvent("encountered an error with async api call "+e.action.name,{stream:n});else if(e.status===o.ApiClientStatus.Success){var i=e.args,s=e.payload;switch(e.action.name){case he.name:var c=a[s.id],l=!(null===(t=i.content)||void 0===t||!t.metadata[0]||"sticker"!==i.content.metadata[0].type);p.logEvent("new_comment",{commentId:s.id,stream:n,thread:c,isSticker:l});break;case we.name:c=a[i.threadId],l=!(null===(r=i.content)||void 0===r||!r.metadata[0]||"sticker"!==i.content.metadata[0].type);p.logEvent("reply_to_comment",{commentId:s.id,stream:n,thread:c,isSticker:l});break;case Te.name:c=a[i.threadId];p.logEvent("delete_comment",{commentId:i.commentId,stream:n,thread:c});break;case Ae.name:c=a[i.threadId];p.logEvent("edit_comment",{commentId:i.commentId,stream:n,thread:c});break;case Re.name:c=a[i.threadId];p.logEvent("resolve_thread",{stream:n,thread:c});break;case Pe.name:c=a[i];p.logEvent("unresolve_thread",{stream:n,thread:c});break;case Me.name:var u=i.origin===d.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";c=a[i.threadId];p.logEvent(u,{stream:n,thread:c});break;case ke.name:c=a[i];p.logEvent("mark_thread_as_unread",{stream:n,thread:c});break;case ze.name:p.logEvent("subscribe",{stream:n});break;case $e.name:p.logEvent("unsubscribe",{stream:n})}}})),B((function(e,t){switch(e){case he.name:case we.name:case Me.name:case ke.name:case Re.name:case Pe.name:return _.threadActionCompleted(e,t);case Te.name:case Ae.name:return _.commentActionCompleted(e,t)}})),w.dispatchMiddleware()),K=U("SetContext"),j=w.syncHandler(K),q=U("SetContextStatus"),Y=w.syncHandler(q),X=L("ListComments"),z=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),function(a,o){return r.__awaiter(void 0,void 0,void 0,(function(){var _,S,b,w,E,A,C,M,I,k,R,D,x,L,U,N,V,W,B,H,G,K,j,q,Z,Q,J,$;return r.__generator(this,(function(r){switch(r.label){case 0:if(_=o(),!(S=v.getContext(_)))return[2];a({type:X.actionTypes.request}),b=S.stream,w=S.viewer,E=w?new s.Comments2Api(w.id,b):new s.Comments2LoggedOutApi(b),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,E.listComments(e,v.getCursor(_))];case 2:if(A=r.sent(),C=A.bolt_info,M=A.cursor,I=A.status,k=A.supported_enhancements,R=A.threads,D=A.users,x=A.permissions,L=+new Date,U=v.getContextStatus(_),N=I[".tag"],V="enabled"===N||"readonly"===N,U===d.Comments2ContextStatus.Pending&&V&&(W=v.getData(_),B=W.perfEvents&&W.perfEvents.setContextTime||0,a(t.Actions.logSimplePerfEvent("initial_list_completed_ms",L-B))),H=o(),G=v.getContext(H),!f.isContextSame(G,S))return[2];if(x&&(a(Ke({canEnable:x.can_enable_commenting})),a(Xe({canSubscribe:x.can_subscribe,isSubscribed:x.is_subscribed})),a(He(x.can_see_comment_editor)),a(V?T.enableMode(c.FileViewerMode.Commenting):T.disableMode(c.FileViewerMode.Commenting))),k&&(K=k.third_party_source,j=k.time_based_annotations,q=k.time_based_annotations_upsell_tooltip_variant,Z=(void 0===q?{".tag":"other"}:q)[".tag"],j&&a(Le()),"other"!==Z&&a(Ne(Z)),K&&a(We(K[".tag"]))),Q=n?g.parseActiveCommentFromUrl():void 0,U===d.Comments2ContextStatus.Pending)switch(I[".tag"]){case"disabled":null!=x&&x.can_enable_commenting,F(a),Q&&m.showErrorSnackbar({message:i.intl.formatMessage({id:"cwWK1c",defaultMessage:"Comments are disabled on this file."})});break;case"enabled":a(qe({listCompleteTime:L})),a(Y(d.Comments2ContextStatus.FullyEnabled)),l.store.dispatch(y.setComments2ShownState({commentCount:R.filter((function(e){return!e.resolved})).length}));break;case"readonly":a(qe({listCompleteTime:L})),a(Y(d.Comments2ContextStatus.ReadOnly)),l.store.dispatch(y.setComments2ShownState({commentCount:R.filter((function(e){return!e.resolved})).length}));break;case"comments1":a(Y(d.Comments2ContextStatus.Comments1))}return v.isEnabled(_)||U===d.Comments2ContextStatus.Pending&&("enabled"===I[".tag"]||"readonly"===I[".tag"])?[4,a((ee=C,function(e){if(f.useBolt()){var r=h.debounce((function(){P(),e(z(!1,!1))}),2e3);t.bolt.subscribe(ee,r,(function(){t.bolt.unsubscribe(),O((function(){e(z(!1,!1))}))}))}}))]:[3,5];case 3:return r.sent(),J=u.streamToRevision(b),[4,a({type:X.actionTypes.success,payload:{authors:D,cursor:M,threads:R,currentRevision:J}})];case 4:r.sent(),Q&&a(t.Actions.activateComment(Q)),r.label=5;case 5:return[3,7];case 6:return($=r.sent())instanceof s.Comments2Error&&($.code===s.ErrorCode.FILE_NOT_FOUND?a(Y(d.Comments2ContextStatus.Disabled)):w&&E instanceof s.Comments2Api&&p.logErrorEvent(($.message,": "+$.message),{stream:b})),a({type:X.actionTypes.error,error:$}),[3,7];case 7:return[2]}var ee}))}))}},Z=U("ActivateThread"),Q=w.syncHandler(Z),J=N("DeactivateAllThreads"),$=w.syncHandler(J),ee=L("CheckOnboardingStatus"),te=G(ee,(function(e,t){return t.api.checkOnboardingStatus()})),re=L("GetMediaFeatures"),ne=G(re,(function(e,t){return t.api.getMediaFeatures()})),ae=L("GetFileMetadata"),ie=G(ae,(function(e,t){var r=e.fileId,n=e.linkUrl;return t.api.getFileMetadata(r,n)})),oe=L("GetStickers"),se=G(oe,(function(e,t){return t.api.getStickers()})),ce=U("HoverAnnotation"),le=w.syncHandler(ce),ue=U("FocusAnnotation"),de=w.syncHandler(ue),me=L("MarkOnboarded"),ge=G(me,(function(e,t){return t.api.markHasOnboarded(e)})),fe=U("DismissOnboarding"),pe=w.syncHandler(fe),_e=U("MarkModalVariantShown"),ve=w.syncHandler(_e),he=L("CreateThread"),Se=G(he,(function(e,t){var r=e.annotation,n=(e.author,e.content),a=(e.guid,e.source),i=t.api,o=t.context.stream,s=u.iCommentContentToUserSubmittedComment({annotation:r,content:n,stream:o});return i.createThread(s,a)})),be=H(L("LoggedOutCreateThread"),(function(e,t){var r=e.annotation,n=e.content,a=(e.guid,e.source),i=t.api,o=t.context.stream,s=u.iCommentContentToUserSubmittedComment({annotation:r,content:n,stream:o});return i.createThread(s,a)})),we=L("ReplyToThread"),ye=G(we,(function(e,t){e.author;var r=e.content,n=(e.guid,e.threadId),a=t.api,i=t.context.stream,o=u.iCommentContentToUserSubmittedComment({content:r,stream:i});return a.replyToThread(o,n)})),Te=L("DeleteComment"),Ee=G(Te,(function(e,t){var r=e.commentId;e.threadId;return t.api.deleteComment(r)})),Ae=L("EditComment"),Ce=G(Ae,(function(e,t){var r=e.commentId,n=e.content,a=(e.threadId,t.api),i=t.context.stream,o=u.iCommentContentToUserSubmittedComment({content:n,stream:i});return a.editComment(r,o)})),Me=L("MarkThreadRead"),Ie=G(Me,(function(e,t){e.origin;var r=e.threadId;return t.api.markThreadRead(r)})),ke=L("MarkThreadUnread"),Fe=G(ke,(function(e,t){return t.api.markThreadUnread(e)})),Re=L("MarkThreadResolved"),Oe=G(Re,(function(e,t){var r=e.threadId;return t.api.markThreadResolved(r)})),Pe=L("MarkThreadUnresolved"),De=G(Pe,(function(e,t){return t.api.markThreadUnresolved(e)})),xe=N("EnablePlayerIntegration"),Le=w.syncHandler(xe),Ue=U("SetUpsellTooltipVariant"),Ne=w.syncHandler(Ue),Ve=U("SetThirdPartySource"),We=w.syncHandler(Ve),Be=U("SetCanSeeCommentEditor"),He=w.syncHandler(Be),Ge=U("RecordEnabledStatus"),Ke=w.syncHandler(Ge),je=U("SetPerfData"),qe=w.syncHandler(je),Ye=U("SetSubscriptionStatus"),Xe=w.syncHandler(Ye),ze=L("Subscribe"),Ze=G(ze,(function(e,t){return t.api.subscribe()})),Qe=N("ToggleShowResolved"),Je=w.syncHandler(Qe),$e=L("Unsubscribe"),et=G($e,(function(e,t){return t.api.unsubscribe()})),tt=U("UpdateDocumentCurrentPage"),rt=w.syncHandler(tt),nt=U("UpdateEditorIsEmpty"),at=w.syncHandler(nt),it=U("UpdatePlayerCurrentTime"),ot=w.syncHandler(it),st=U("DocMetadataLoad"),ct=w.syncHandler(st),lt=U("SetPendingNumberedAnnotation"),ut=w.syncHandler(lt),dt=N("ClearPendingNumberedAnnotation"),mt=w.syncHandler(dt),gt=N("SetPendingNumberedAnnotationMayBeOffscreen"),ft=w.syncHandler(gt),pt=N("RequestEditorFocus"),_t=w.syncHandler(pt),vt=N("FulfillEditorFocusRequest"),ht=w.syncHandler(vt),St=U("TrackSidebarCommentsVisibility"),bt=w.syncHandler(St),wt=U("ResetStore"),yt=w.syncHandler(wt);function Tt(e,t,n){var a=this;return function(){return r.__awaiter(a,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(r){return t?(a=t.viewer,i=t.stream,(a?new s.Comments2Api(a.id,i):new s.Comments2LoggedOutApi(i)).logPerfEvent(e,n),[2]):[2]}))}))}}t.ActionTypes={SetContext:K,SetContextStatus:q,ActivateThread:Z,CheckOnboardingStatus:ee,CreateThread:he,DeactivateAllThreads:J,DeleteComment:Te,EditComment:Ae,EnablePlayerIntegration:xe,ListComments:X,HoverThread:ce,FocusThread:ue,MarkOnboarded:me,DismissOnboarding:fe,GetMediaFeatures:re,GetFileMetadata:ae,GetStickers:oe,MarkModalVariantShown:_e,MarkThreadRead:Me,MarkThreadResolved:Re,MarkThreadUnread:ke,MarkThreadUnresolved:Pe,RecordEnabledStatus:Ge,ReplyToThread:we,SetCanSeeCommentEditor:Be,SetPerfData:je,SetSubscriptionStatus:Ye,SetThirdPartySource:Ve,SetUpsellTooltipVariant:Ue,Subscribe:ze,ToggleShowResolved:Qe,Unsubscribe:$e,UpdateDocumentCurrentPage:tt,UpdateEditorIsEmpty:nt,UpdatePlayerCurrentTime:it,DocMetadataLoad:st,SetPendingNumberedAnnotation:lt,ClearPendingNumberedAnnotation:dt,SetPendingNumberedAnnotationMayBeOffscreen:gt,RequestEditorFocus:pt,FulfillEditorFocusRequest:vt,TrackSidebarCommentsVisibility:St,ResetStore:wt},t.Actions={setContextStatus:Y,setFileContext:D,activateComment:function(e){return function(t,r){var n=v.getThreads(r()),a=f.findCommentThread(n,e);!a||a.comment.deleted?m.showErrorSnackbar({message:i.intl.formatMessage({id:"/83u+2",defaultMessage:"That comment has been deleted."})}):a.thread.resolved&&m.showErrorSnackbar({message:i.intl.formatMessage({id:"Uu2ETy",defaultMessage:"That comment has been resolved."})}),a&&t(A({thread:a.thread,pendingAnnotationInfo:f.getAnnotationInfoForThread(a.thread)}))}},activateThread:Q,activateThreadAndMarkAsRead:A,activateThreadByLayerClick:function(e,t){return function(r,n){var a=n();if(v.getIsComments2Ready(a)){var i=v.getDisplayedThreadsForLayer(a,e.page);r($());var o=f.getThreadForNumberedAnnotationAtPoint(e,i,t);o&&r(A({thread:o,wasPreviewLayerClick:!0}))}}},activateThreadByMarkerClick:function(e){return function(t){return r.__awaiter(void 0,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=l.store.getState().sidebar).open?[3,2]:[4,l.store.dispatch(y.open("annotation_select"))];case 1:r.sent(),r.label=2;case 2:return"comments"===n.activeTab?[3,4]:[4,l.store.dispatch(y.selectTab("comments"))];case 3:r.sent(),r.label=4;case 4:return t(A(e)),[2]}}))}))}},checkOnboardingStatus:te,createThread:Se,loggedOutCreateThread:be,deactivateAllThreads:$,deleteComment:Ee,disableCommenting:I,editComment:Ce,enableCommenting:C,enablePlayerIntegration:Le,hoverThread:le,focusThread:de,hoverThreadByLayer:function(e,t){return function(r,n){var a=n();if(v.getIsComments2Ready(a)){var i=v.getDisplayedThreadsForLayer(a,e.page),o=f.getThreadForNumberedAnnotationAtPoint(e,i,t);v.getHoverThreadId(a)!==(o&&o.id)&&r(le(o&&o.id))}}},getMediaFeatures:ne,getFileMetadata:ie,getStickers:se,listComments:z,markOnboarded:ge,markOnboardedIfUnmarked:function(e){return function(t,r){v.getOnboardingVariants(r())[e]&&t(ge(e))}},dismissOnboarding:pe,markModalVariantShown:ve,markThreadRead:Ie,markThreadResolved:Oe,markThreadUnread:Fe,markThreadUnresolved:De,recordEnabledStatus:Ke,replyToThread:ye,setCanSeeCommentEditor:He,setPerfData:qe,setSubscriptionStatus:Xe,setThirdPartySource:We,setUpsellTooltipVariant:Ne,subscribe:Ze,toggleShowResolved:Je,unsubscribe:et,updateDocumentCurrentPage:rt,updateEditorIsEmpty:at,updatePlayerCurrentTime:ot,setPendingNumberedAnnotation:ut,clearPendingNumberedAnnotation:mt,setPendingNumberedAnnotationMayBeOffscreen:ft,requestEditorFocus:_t,fulfillEditorFocusRequest:ht,trackSidebarCommentsVisibility:bt,openVersionHistory:function(){return function(e,t){var r=t(),n=v.getViewerId(r),i=v.getFQPath(r);if(i&&n){var o=b.getFileHistoryUrl({fqPath:i,userId:n});a.redirect(o)}}},docMetadataLoad:ct,logPerfEvent:function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){return n=v.getContext(i()),a(Tt(e,n,t)),[2]}))}))}},logSimplePerfEvent:function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n,a;return r.__generator(this,(function(r){return n=i(),(a=v.getContext(n))&&a.viewer&&new s.Comments2Api(a.viewer.id,a.stream).logSimplePerfEvent(e,t),[2]}))}))}},resetStore:yt}})),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/models"],(function(e,t,r,n,a){"use strict";function i(e,t){var r=a.FileViewerSession.currentSession,i=a.FilePreviewSession.currentSession;if(i&&r){var o={event_name:e,file_viewer_session_id:r.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};n.SilentBackgroundRequest({url:"/log/file_sidebar",data:o})}}Object.defineProperty(t,"__esModule",{value:!0}),t.logFileViewActivityCardExpanded=t.logActivityStreamInteractivity=t.logSidebarClosed=t.logSidebarOpened=t.logSidebarTabSelected=void 0,n=r.__importStar(n),t.logSidebarTabSelected=function(e){i("sidebar_tab_selected",e)},t.logSidebarOpened=function(e){i("sidebar_opened",e)},t.logSidebarClosed=function(e){i("sidebar_closed",e)},t.logActivityStreamInteractivity=function(e){i("activity_stream_interactivity",e)},t.logFileViewActivityCardExpanded=function(e){i("file_view_activity_expanded",e)}})),define("modules/clean/react/file_viewer/controller_mode",["require","exports","api_v2/noauth_client","api_v2/user_client"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchControllerMode=void 0,t.fetchControllerMode=function(e,t){return null!=t?(function(e,t){return(new n.UserApiV2Client).ns("file_viewer").rpc("get_mode",e,{subjectUserId:t.id})})(e,t):(function(e){return(new r.NoAuthApiV2Client).ns("file_viewer").rpc("logged_out/get_mode",e,{})})(e)}})),define("modules/clean/react/file_viewer/data/actions",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/constants","modules/clean/file_store/actions","modules/clean/previews/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/file_store/utils","modules/clean/react/file_viewer/data/types","modules/clean/previews/data/util","modules/clean/react/file_viewer/constants","modules/clean/downloads","modules/core/uri","modules/core/browser","modules/clean/react/file_viewer/controller_mode","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/watermarking/utils","file-viewer/core/index","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/prompt/campaign_api","modules/clean/react/size_class/constants","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/branding/api"],(function(e,t,r,n,a,i,o,s,c,l,u,d,m,g,f,p,_,v,h,S,b,w,y,T,E,A,C,M){"use strict";function I(e){return{type:u.Actions.OpenFile,payload:{fileId:e}}}function k(e){return function(t,r){var n,a=((n={})[b.FileViewerMode.Default]=B,n[b.FileViewerMode.Documentation]=G,n[b.FileViewerMode.Commenting]=K,n[b.FileViewerMode.Watermarking]=j,n[b.FileViewerMode.Zoom]=q,n[b.FileViewerMode.Slack]=Y,n[b.FileViewerMode.Markup]=X,n[b.FileViewerMode.Plugins]=Z,n[b.FileViewerMode.HelloSign]=Q,n[b.FileViewerMode.ProAnalytics]=z,n);a[e]&&a[e](t,r)}}function F(e){return h.filePreviewEventEmitter.emit(m.EventType.SidebarModeSelected,v.FilePreviewSession.currentSession,{selected_mode:e}),{type:u.Actions.UpdateMode,payload:{mode:e}}}function R(e){return function(t,r){var n=c.getCurrentFileId(r());n&&t((function(e,t){return{type:u.Actions.UpdateRenderStatus,payload:{fileId:e,renderStatus:t}}})(n,e))}}function O(e){return h.filePreviewEventEmitter.emit(m.EventType.SidebarPaneSelected,v.FilePreviewSession.currentSession,{selected_pane:e}),{type:u.Actions.PushSidebarPane,payload:{paneId:e}}}function P(){return{type:u.Actions.ResetSidebarPaneStack}}function D(){return{type:u.Actions.ResetSelectedSidebarControlId}}function x(e){return{type:u.Actions.SetSelectedSidebarControlId,payload:{controlId:e}}}function L(e){var t=e===b.SidebarVisibility.Open?m.EventType.SidebarOpened:m.EventType.SidebarClosed;return h.filePreviewEventEmitter.emit(t,v.FilePreviewSession.currentSession),{type:u.Actions.SetSidebarVisibility,payload:{visibility:e}}}function U(e){return function(t,r){t({type:u.Actions.UpdateWatermarkOptions,payload:{options:e}}),S.setLocalStorageWatermarkingState(c.getCurrentUser(r()),A.getWatermarkState(r()))}}function N(e){return function(t,r){t({type:u.Actions.SwitchWatermarkingMode,payload:{mode:e}}),S.setLocalStorageWatermarkingState(c.getCurrentUser(r()),A.getWatermarkState(r()))}}function V(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,S.getUserMetadataTextWatermarkingState(e)];case 1:return a=o.sent(),[4,S.getLocalStorageWatermarkingState(e)];case 2:return(i=o.sent())?(U({textWatermarkingOptions:r.__assign(r.__assign({},i.textWatermarkingOptions),a),imageWatermarkingOptions:i.imageWatermarkingOptions})(t,n),N(i.mode)(t,n)):a?U({textWatermarkingOptions:a})(t,n):U({textWatermarkingOptions:{text:S.getDefaultText(e)}})(t,n),[2]}}))}))}function W(e){return{type:u.Actions.SetTrialMode,payload:{isTrialMode:e}}}function B(e,t){var r=t(),n=c.getMode(r);e(W(!1)),e(D()),n!==b.FileViewerMode.Default&&e(F(b.FileViewerMode.Default))}function H(e,t,r,n){return function(a,i){var o=i(),s=c.getSidebar(o).visibility,l=c.getMode(o);s===b.SidebarVisibility.Closed&&a(L(b.SidebarVisibility.Open)),l!==e&&(a(W(!!n&&n(o))),a(x(t)),a(P()),a(O(r)),a(F(e)))}}Object.defineProperty(t,"__esModule",{value:!0}),t.overflowZoomOff=t.overflowZoomOn=t.loadWatermarkingStateFromStorage=t.registerUser=t.pageUp=t.pageDown=t.updateCurrentPageIndex=t.fetchDocClassificationAction=t.fetchBestCampaignsAction=t.fetchActiveUserBrandingInfoAction=t.fetchControllerModeAction=t.disableForceHideToolbar=t.forceHideToolbar=t.resetFileViewerStore=t.setMediaPaused=t.setMediaPlaying=t.pendingFileUploaded=t.download=t.saveForwardRevision=t.restoreRevisionAction=t.switchRevisionAction=t.resetMarkupState=t.setMarkupFormatSubmenu=t.setMarkupFill=t.setMarkupStroke=t.setMarkupDrawingMode=t.updateMarkupCanvasScale=t.setMarkupCanvas=t.switchWatermarkingMode=t.updateWatermarkOptions=t.setPageDimensions=t.setSidebarVisibility=t.setSelectedSidebarControlId=t.resetSelectedSidebarControlId=t.resetSidebarPaneStack=t.popSidebarPane=t.pushSidebarPane=t.fetchShowOverQuotaUpsell=t.setRenderStatusSuccessForCurrentFile=t.setRenderStatusForCurrentFile=t.openFile=t.updateMode=t.enableMode=t.disableMode=t.changeMode=t.closeFile=t.openFileById=t.dismissAppDownloadInterstitial=t.closeSidebar=t.openSidebar=t.closeFullScreen=t.openFullScreen=void 0,n=r.__importStar(n),g=r.__importStar(g),p=r.__importStar(p),t.openFullScreen=function(){return{type:u.Actions.OpenFullScreen}},t.closeFullScreen=function(){return{type:u.Actions.CloseFullScreen}},t.openSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(r){r({type:u.Actions.OpenSidebar,payload:{type:e}}),s.logUserAction(a.UserAction.ToggleSidebarOn,t)}},t.closeSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(r){r({type:u.Actions.CloseSidebar,payload:{type:e}}),s.logUserAction(a.UserAction.ToggleSidebarOff,t)}},t.dismissAppDownloadInterstitial=function(){return{type:u.Actions.DismissAppDownloadInterstitial}},t.openFileById=I,t.closeFile=function(){return{type:u.Actions.CloseFile}},t.changeMode=k,t.disableMode=function(e){return{type:u.Actions.DisableMode,payload:{mode:e}}},t.enableMode=function(e){return{type:u.Actions.EnableMode,payload:{mode:e}}},t.updateMode=F,t.openFile=function(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){return t=l.getFileStoreId(e),s=i.putFile(e),n(s),!d.previewDataPresentForFile(a(),e)&&!d.previewDataInFlight(a(),e)&&(s.payload.file.preview?n(o.populateFilesPreviewData([s.payload.file])):n(o.fetchPreviewData([s.payload.file]))),n(I(t)),[2]}))}))}},t.setRenderStatusForCurrentFile=R,t.setRenderStatusSuccessForCurrentFile=function(){return R(m.PreviewRenderStatus.Succeeded)},t.fetchShowOverQuotaUpsell=function(e){return function(t,r){e&&void 0===c.getShowOverQuotaUpsell(r())&&n.SilentBackgroundRequest({url:"/should_show_file_preview_upsell",data:{_subject_uid:e.id},success:function(e){try{var r=JSON.parse(e);r&&t((n=r.shouldShowFilePreviewUpsell,{type:u.Actions.SetShowOverQuotaUpsell,payload:n}))}catch(e){}var n}})}},t.pushSidebarPane=O,t.popSidebarPane=function(){return{type:u.Actions.PopSidebarPane}},t.resetSidebarPaneStack=P,t.resetSelectedSidebarControlId=D,t.setSelectedSidebarControlId=x,t.setSidebarVisibility=L,t.setPageDimensions=function(e){return{type:u.Actions.SetPageDimensions,payload:{pageDimensions:e}}},t.updateWatermarkOptions=U,t.switchWatermarkingMode=N,t.setMarkupCanvas=function(e,t,r){return{type:u.Actions.SetMarkupCanvas,payload:{page:e,fabric:t,scale:r}}},t.updateMarkupCanvasScale=function(e,t){return{type:u.Actions.UpdateMarkupCanvasScale,payload:{page:e,scale:t}}},t.setMarkupDrawingMode=function(e){return function(t,r){t({type:u.Actions.SetMarkupDrawingMode,payload:{isDrawingMode:e}}),w.setDrawingMode(y.getMarkupState(r()),e)}},t.setMarkupStroke=function(e){return function(t){t({type:u.Actions.SetMarkupStroke,payload:{color:e}}),w.setBaseBrushColor(e)}},t.setMarkupFill=function(e){return{type:u.Actions.SetMarkupFill,payload:{color:e}}},t.setMarkupFormatSubmenu=function(e){return{type:u.Actions.SetMarkupSubmenuType,payload:{formatSubmenu:e}}},t.resetMarkupState=function(){return function(e,t){w.disposeCanvas(y.getMarkupState(t())),e({type:u.Actions.ResetMarkupState})}},t.switchRevisionAction=function(e){return function(t){e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:u.Actions.SwitchRevision,payload:{file:e}})}},t.restoreRevisionAction=function(){return function(e,t){var r=c.getActiveFile(t());r&&e(o.clearCommentsPreviewOverride(r)),e({type:u.Actions.RestoreRevision})}},t.saveForwardRevision=function(e){return function(t){t(i.putFile(e,e.revision_id)),e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:u.Actions.SaveForwardRevision,payload:{revisionKey:e.revision_id}})}},t.download=function(e){var t=f.URI.parse(e.href);t.updateQuery({dl:"1"}),g.get({url:t.toString()})},t.pendingFileUploaded=function(){p.reload(!0)},t.setMediaPlaying=function(){return function(e){e({type:u.Actions.PlayMedia})}},t.setMediaPaused=function(){return function(e){e({type:u.Actions.PauseMedia})}},t.resetFileViewerStore=function(){return function(e){e({type:u.Actions.ResetStore})}},t.forceHideToolbar=function(){return{type:u.Actions.ForceHideToolbar}},t.disableForceHideToolbar=function(){return{type:u.Actions.DisableForceHideToolbar}},t.fetchControllerModeAction=function(e,t,n){var a=this;return function(i,o){return r.__awaiter(a,void 0,void 0,(function(){var a,s,l,d;return r.__generator(this,(function(r){switch(r.label){case 0:i({type:u.Actions.FetchControllerModeRequest}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,_.fetchControllerMode(e,t)];case 2:return a=r.sent().mode,h.filePreviewEventEmitter.emit(m.EventType.FilePreviewModeDetermined,v.FilePreviewSession.currentSession,{mode:a}),n===E.SizeClass.Small||n===E.SizeClass.Medium?(i(x(b.SidebarControlId.Documentation)),i(O(b.SidebarPaneId.Documentation)),i(F(b.FileViewerMode.Documentation)),[2]):(s=(function(e){var t=b.FileViewerMode.Default;if(e)switch(e[".tag"]){case"commenting_mode":t=b.FileViewerMode.Commenting;break;case"documentation_mode":t=b.FileViewerMode.Documentation;break;case"other":t=b.FileViewerMode.Default}return t})(a),(l=c.getMode(o()))&&l!==b.FileViewerMode.Default||i(k(s)),[3,4]);case 3:return d=r.sent(),i({type:u.Actions.FetchControllerModeError,payload:d}),[3,4];case 4:return[2]}}))}))}},t.fetchActiveUserBrandingInfoAction=function(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){var t,a,i,o,s,c;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.all([M.getLogo(e.id),M.getName(e.id)])];case 1:return t=r.sent(),a=t[0],i=t[1],o=null,"image"===(null==(s=null===(c=null==a?void 0:a.graphic)||void 0===c?void 0:c.value)?void 0:s[".tag"])&&s.original_url&&(o=s.original_url),n({type:u.Actions.SetActiveUserBrandingInfo,payload:{activeUserBrandingInfo:{logoUrl:o,organizationName:i}}}),[3,3];case 2:return r.sent(),[3,3];case 3:return[2]}}))}))}},t.fetchBestCampaignsAction=function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,T.fetchBestCampaigns(e.id,t)];case 1:return n=r.sent().campaigns,a({type:u.Actions.SetBestCampaign,payload:{campaign:n[0]}}),[2]}}))}))}},t.fetchDocClassificationAction=function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,C.fetchDocClassification(e,t)];case 1:return n=r.sent().predicted_types,a({type:u.Actions.SetDocClassification,payload:{docClassification:{predicted_types:n},fileId:t}}),[2]}}))}))}},t.updateCurrentPageIndex=function(e){return{type:u.Actions.UpdateCurrentPageIndex,payload:{currentPageIndex:e}}},t.pageDown=function(){return{type:u.Actions.PageDown}},t.pageUp=function(){return{type:u.Actions.PageUp}},t.registerUser=function(e){return function(t,r){t({type:u.Actions.RegisterUser,payload:{user:e}}),V(e,t,r)}},t.loadWatermarkingStateFromStorage=V;var G=H(b.FileViewerMode.Documentation,b.SidebarControlId.Documentation,b.SidebarPaneId.Documentation),K=H(b.FileViewerMode.Commenting,b.SidebarControlId.Comments,b.SidebarPaneId.Comments),j=H(b.FileViewerMode.Watermarking,b.SidebarControlId.Watermarking,b.SidebarPaneId.Watermarking,(function(e){return S.allowWatermarkTrial(c.getCurrentUser(e))})),q=H(b.FileViewerMode.Zoom,b.SidebarControlId.Zoom,b.SidebarPaneId.Zoom),Y=H(b.FileViewerMode.Slack,b.SidebarControlId.Slack,b.SidebarPaneId.SlackHome),X=H(b.FileViewerMode.Markup,b.SidebarControlId.Markup,b.SidebarPaneId.Markup),z=H(b.FileViewerMode.ProAnalytics,b.SidebarControlId.ProAnalytics,b.SidebarPaneId.ProAnalytics),Z=function(){},Q=function(){};t.overflowZoomOn=function(){return{type:u.Actions.OverflowZoomOn}},t.overflowZoomOff=function(){return{type:u.Actions.OverflowZoomOff}}})),define("modules/clean/react/file_viewer/data/selectors",["require","exports","tslib","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/file_store/selectors","modules/clean/previews/data/selectors","modules/clean/react/file_viewer/constants","modules/clean/previews/data/preview_type_util","reselect","lodash","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/client","file-viewer/core/index"],(function(e,t,r,n,a,i,o,s,c,l,u,d,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDocClassificationForFile=t.getHelloSignAppActionForFile=t.isOverflowZoomMode=t.getExtensionsEnabled=t.shouldForceHideToolbar=t.getIsFlippingEnabled=t.getPreviewApiDataForCurrentFile=t.getPauseCount=t.getIsMediaPlaying=t.getRenderStatusForCurrentFile=t.getActiveUserBrandingInfo=t.getSelectedPromptCampaign=t.getShowOverQuotaUpsell=t.getActiveFile=t.getPageDimensions=t.getIsMarkupMode=t.getIsWatermarkingMode=t.getIsEditMode=t.getIsTrialMode=t.getAnnotationAllowed=t.getSidebar=t.getDisabledModes=t.getMode=t.getCurrentUser=t.getPastFile=t.getCurrentFile=t.getCurrentFileId=t.getAppDownloadInterstitial=t.getCurrentPageIndex=t.getIsSidebarOpen=t.getIsFullScreen=t.getFileViewerState=void 0,u=r.__importStar(u),t.getFileViewerState=function(e){return a.getStateAtNamespace(e,n.FILE_VIEWER_NAMESPACE_KEY)},t.getIsFullScreen=function(e){return t.getFileViewerState(e).isFullScreen},t.getIsSidebarOpen=function(e){return t.getFileViewerState(e).isSidebarOpen},t.getCurrentPageIndex=function(e){return t.getFileViewerState(e).currentPageIndex},t.getAppDownloadInterstitial=function(e){return t.getFileViewerState(e).appDownloadInterstitialDismissed},t.getCurrentFileId=function(e){return t.getFileViewerState(e).currentFileId},t.getCurrentFile=l.createSelector(u.nthArg(0),t.getCurrentFileId,i.getFile),t.getPastFile=function(e){return t.getFileViewerState(e).fileRevision},t.getCurrentUser=function(e){return t.getFileViewerState(e).currentUser},t.getMode=function(e){return t.getFileViewerState(e).mode},t.getDisabledModes=function(e){return t.getFileViewerState(e).disabledModes},t.getSidebar=function(e){return t.getFileViewerState(e).sidebar},t.getAnnotationAllowed=l.createSelector(t.getMode,(function(e){return e===g.FileViewerMode.Commenting})),t.getIsTrialMode=function(e){return t.getFileViewerState(e).isTrialMode},t.getIsEditMode=function(e){return t.getIsMarkupMode(e)||t.getIsWatermarkingMode(e)},t.getIsWatermarkingMode=function(e){return t.getMode(e)===g.FileViewerMode.Watermarking},t.getIsMarkupMode=function(e){return t.getMode(e)===g.FileViewerMode.Markup},t.getPageDimensions=function(e){return t.getFileViewerState(e).pageDimensions},t.getActiveFile=function(e){return t.getPastFile(e)||t.getCurrentFile(e)},t.getShowOverQuotaUpsell=function(e){return t.getFileViewerState(e).showOverQuotaUpsell};t.getSelectedPromptCampaign=function(e){return t.getFileViewerState(e).campaign},t.getActiveUserBrandingInfo=function(e){return t.getFileViewerState(e).activeUserBrandingInfo},t.getRenderStatusForCurrentFile=function(e){var r=t.getCurrentFileId(e);if(r)return(function(e,r){return t.getFileViewerState(e).renderStatuses[r]})(e,r)},t.getIsMediaPlaying=function(e){return t.getFileViewerState(e).isMediaPlaying},t.getPauseCount=function(e){var r=t.getFileViewerState(e).pauseCount;return r||0},t.getPreviewApiDataForCurrentFile=function(e){var r=t.getCurrentFile(e);return o.getApiDataForFile(e,r).data},t.getIsFlippingEnabled=function(e){var r=t.getPreviewApiDataForCurrentFile(e);return!(t.getIsEditMode(e)||t.getIsMediaPlaying(e)||t.getIsFullScreen(e)&&c.isSsrDoc(r))},t.shouldForceHideToolbar=function(e){return t.getFileViewerState(e).forceHideToolbar},t.getExtensionsEnabled=function(e){var r=t.getActiveFile(e);return!r||!d.fileExtensionsConfigs(e)[r.file_id]||d.fileExtensionsConfigs(e)[r.file_id].displayState!==m.DisplayState.DISABLED},t.isOverflowZoomMode=function(e){return!0===t.getFileViewerState(e).overflowZoom},t.getHelloSignAppActionForFile=function(e,t){return d.getShareActionsForFiles(e,[t]).filter((function(e){return e.app_id===s.HELLOSIGN_PROD_APP_ID}))[0]},t.getDocClassificationForFile=function(e,r){var n=t.getFileViewerState(e);if(n&&n.docClassifications&&n.docClassifications[r])return n.docClassifications[r]}})),define("modules/clean/react/file_viewer/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=void 0,(function(e){e.CloseFile="FileViewer/CloseFile",e.CloseFullScreen="FileViewer/CloseFullScreen",e.CloseSidebar="FileViewer/CloseSidebar",e.DismissAppDownloadInterstitial="FileViewer/DismissAppDownloadInterstitial",e.DisableForceHideToolbar="FileViewer/DisableForceHideToolbar",e.ForceHideToolbar="FileViewer/ForceHideToolbar",e.UpdateMode="FileViewer/UpdateMode",e.DisableMode="FileViewer/DisableMode",e.EnableMode="FileViewer/EnableMode",e.OpenFile="FileViewer/OpenFile",e.OpenFullScreen="FileViewer/OpenFullScreen",e.OpenSidebar="FileViewer/OpenSidebar",e.PageDown="FileViewer/PageDown",e.PageUp="FileViewer/PageUp",e.PauseMedia="FileViewer/PauseMedia",e.PlayMedia="FileViewer/PlayMedia",e.PopSidebarPane="FileViewer/PopSidebarPane",e.PushSidebarPane="FileViewer/PushSidebarPane",e.SetSelectedSidebarControlId="FileViewer/SetSelectedSidebarControlId",e.ResetSidebarPaneStack="FileViewer/ResetSidebarPaneStack",e.ResetSelectedSidebarControlId="FileViewer/ResetSelectedSidebarControlId",e.ResetStore="FileViewer/ResetStore",e.UpdateCurrentPageIndex="FileViewer/UpdateCurrentPageIndex",e.RestoreRevision="FileViewer/RestoreRevision",e.SaveForwardRevision="FileViewer/SaveForwardRevision",e.SetCurrentCalloutType="FileViewer/SetCurrentCalloutType",e.SetShowOverQuotaUpsell="FileViewer/SetShowOverQuotaUpsell",e.SetSidebarVisibility="FileViewer/SetSidebarVisibility",e.SetPageDimensions="FileViewer/SetPageDimensions",e.UpdateWatermarkOptions="FileViewer/UpdateWatermarkOptions",e.SwitchWatermarkingMode="FileViewer/SwitchWatermarkingMode",e.SetMarkupCanvas="FileViewer/SetMarkupCanvas",e.UpdateMarkupCanvasScale="FileViewer/UpdateMarkupCanvasScale",e.ResetMarkupState="FileViewer/ResetMarkupState",e.SetMarkupDrawingMode="FileViewer/SetMarkupDrawingMode",e.SetMarkupFill="FileViewer/SetMarkupFill",e.SetMarkupStroke="FileViewer/SetMarkupStroke",e.SetMarkupSubmenuType="FileViewer/SetMarkupSubmenuType",e.SwitchRevision="FileViewer/SwitchRevision",e.UpdateRenderStatus="FileViewer/UpdateRenderStatus",e.RegisterUser="FileViewer/RegisterUser",e.SetTrialMode="FileViewer/SetTrialMode",e.FetchControllerModeRequest="FileViewer/FetchControllerModeRequest",e.FetchControllerModeSuccess="FileViewer/FetchControllerModeSuccess",e.FetchControllerModeError="FileViewer/FetchControllerModeError",e.FetchBestCampaign="FileViewer/FetchBestCampaign",e.SetBestCampaign="FileViewer/SetBestCampaign",e.SetActiveUserBrandingInfo="FileViewer/SetActiveUserBrandingInfo",e.SetDocClassification="FileViewer/SetDocClassification",e.OverflowZoomOn="FileViewer/OverflowZoomOn",e.OverflowZoomOff="FileViewer/OverflowZoomOff"})(t.Actions||(t.Actions={}))})),define("modules/clean/react/file_viewer/open_button/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButtonAction=void 0,(function(e){e[e.DOWNLOAD=0]="DOWNLOAD",e[e.UNITY_FILE=1]="UNITY_FILE",e[e.UNITY_FOLDER=2]="UNITY_FOLDER",e[e.OPEN_WITH=3]="OPEN_WITH",e[e.OPEN_IN_PAPER=4]="OPEN_IN_PAPER",e[e.APP_ACTION=5]="APP_ACTION",e[e.PREPARE_FOR_SIGNATURE=6]="PREPARE_FOR_SIGNATURE",e[e.SHARE_TO_SLACK=7]="SHARE_TO_SLACK",e[e.PRESENT_IN_ZOOM=8]="PRESENT_IN_ZOOM",e[e.SHARE_TO_TRELLO=9]="SHARE_TO_TRELLO",e[e.INVITE_VIA_EMAIL=10]="INVITE_VIA_EMAIL",e[e.OPEN_WITH_CLOUD_DOC=11]="OPEN_WITH_CLOUD_DOC",e[e.OPEN_MORE_APPS=12]="OPEN_MORE_APPS",e[e.OPEN_ADD_APPS=13]="OPEN_ADD_APPS",e[e.DECOMPRESS_FILE=14]="DECOMPRESS_FILE",e[e.PREVIEW_FILE=15]="PREVIEW_FILE",e[e.TRANSFER=16]="TRANSFER",e[e.OPEN_IN_DESKTOP=17]="OPEN_IN_DESKTOP",e[e.GO_TO_FOLDER=18]="GO_TO_FOLDER",e[e.OPEN_IN_REPLAY=19]="OPEN_IN_REPLAY"})(t.OpenButtonAction||(t.OpenButtonAction={}))})),define("modules/clean/react/file_viewer/prompt/campaign_api",["require","exports","api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBestCampaigns=void 0,t.fetchBestCampaigns=function(e,t){var n={client_context:{platform:"web",locations:["targeted_bubble"],ref_page:["preview","file_viewer"],display_context:"fv_preview_type="+t}};return(new r.UserApiV2Client).ns("prompt").rpc("get_best_campaigns",n,{subjectUserId:e})}})),define("modules/clean/react/location/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Location=void 0;var r=(function(){function e(e,t){void 0===t&&(t={}),this.path=e,this.query=t}return e.fromURI=function(t){return new e(t.getPath(),t.getQuery())},e})();t.Location=r})),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSmallerThanLarge=void 0,t.isSmallerThanLarge=function(e){return e!==r.SizeClass.Large&&e!==r.SizeClass.ExtraLarge}})),define("modules/clean/react/watermarking/drawing",["require","exports"],(function(e,t){"use strict";function r(e,t,r,n,a){void 0===a&&(a=!1),e.save(),e.font=r+"px "+n;var i=e.measureText(t);return e.restore(),a?{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent||r}:{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent||r}}Object.defineProperty(t,"__esModule",{value:!0}),t.drawImageTile=t.drawTextTile=void 0,t.drawTextTile=function(e,t,n,a,i,o){var s=document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new Error("Cannot draw on canvas");var l=r(c,e,t,n),u=l.width,d=l.height;s.width=Math.abs(u*Math.cos(o))+Math.abs(d*Math.sin(o)),s.height=Math.abs(u*Math.sin(o))+Math.abs(d*Math.cos(o)),c.font=t+"px "+n,c.globalAlpha=i,c.fillStyle=a,c.textBaseline="bottom";var m=0,g=s.height;o<.5*Math.PI?m=d*Math.sin(o):o<Math.PI?(m=d*Math.sin(o)-u*Math.cos(o),g+=d*Math.cos(o)):o<1.5*Math.PI?(m=-u*Math.cos(o),g=0):g+=u*Math.sin(o),c.translate(m,g),c.rotate(-o),c.fillText(e,0,0);var f=r(c,e,t,n,!0),p=f.width;return{canvas:s,actualUnrotatedHeight:f.height,actualUnrotatedWidth:p}},t.drawImageTile=function(e,t,r,n){var a=document.createElement("canvas"),i=a.getContext("2d");if(!i)throw new Error("Cannot draw on canvas");var o=n||0,s=e.width*t,c=e.height*t;a.width=Math.round(Math.abs(s*Math.cos(o))+Math.abs(c*Math.sin(o))),a.height=Math.round(Math.abs(s*Math.sin(o))+Math.abs(c*Math.cos(o)));var l=0,u=0;return o<.5*Math.PI?u=s*Math.sin(o):o<Math.PI?(l=-s*Math.cos(o),u=s*Math.sin(o)-c*Math.cos(o)):o<1.5*Math.PI?(l=-s*Math.cos(o)-c*Math.sin(o),u=-c*Math.cos(o)):l=-c*Math.sin(o),i.globalAlpha=r,i.translate(l,u),i.rotate(-o),i.drawImage(e,0,0,s,c),{canvas:a,actualUnrotatedHeight:c,actualUnrotatedWidth:s}}})),define("modules/clean/react/watermarking/selectors",["require","exports","tslib","reselect","lodash","modules/clean/react/watermarking/types","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/drawing","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWatermarkTilingFunc=t.getWatermarkState=void 0,a=r.__importStar(a),t.getWatermarkState=function(e){return c.getFileViewerState(e).watermark},t.getWatermarkTilingFunc=n.createSelector(t.getWatermarkState,(function(e){return a.memoize((function(t){var r=i.getWatermarkingOptions(e),n=r.angle,a=r.opacity,c=r.size,l=n%360,u=n/180*Math.PI,d=u%(Math.PI/2),m=(function(r){if(e.mode===i.WatermarkingMode.TEXT){var n=e.textWatermarkingOptions,l=n.color,u=n.fontFamily,d=n.text;return s.drawTextTile(d,c*t,u,l,a/100,r)}var m=e.imageWatermarkingOptions.image;if(!m)throw new o.WatermarkingError(o.WatermarkingError.TILE_NO_INPUT);return s.drawImageTile(m,c*t,a/100,r)})(u),g=m.canvas,f=m.actualUnrotatedHeight,p=m.actualUnrotatedWidth,_=Math.max(f,p),v=_/2,h=_/2;e.mode===i.WatermarkingMode.TEXT&&(v=2*f,h=e.textWatermarkingOptions.lineHeight*f);var S=p+v,b=f+h,w=0,y=0,T=0;return l%180==0?(w=S,y=b,T=v/-1.2):l%180==90?(w=b,y=S):l>0&&l<90||l>180&&l<270?(w=b/Math.sin(d),y=S*Math.sin(d),T=-S*Math.cos(d)):(l>90&&l<180||l>270&&l<360)&&(w=b/Math.cos(d),y=S*Math.cos(d),T=S*Math.sin(d)),{canvas:g,width:g.width,height:g.height,distanceX:w,distanceY:y,startX:-g.width/2,startY:-g.height/2,offsetXPerRow:T,offsetYPerCol:0}}))}))})),define("modules/clean/react/watermarking/types",["require","exports"],(function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getWatermarkingOptions=t.WatermarkPosition=t.WatermarkingMode=void 0,(function(e){e.TEXT="text",e.IMAGE="image"})(r=t.WatermarkingMode||(t.WatermarkingMode={})),(function(e){e.REPEAT="REPEAT",e.CENTER="CENTER",e.NORTHWEST="NORTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.SOUTHWEST="SOUTHWEST"})(t.WatermarkPosition||(t.WatermarkPosition={})),t.getWatermarkingOptions=function(e){return e.mode===r.TEXT?e.textWatermarkingOptions:e.imageWatermarkingOptions}})),define("modules/clean/react/watermarking/utils",["require","exports","tslib","sjcl","lodash","modules/constants/file_viewer","modules/clean/i18n/formatters","modules/constants/page_load","modules/clean/file_store/utils","modules/core/i18n","modules/clean/previews/constants","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/types","modules/core/persistence/storage","modules/core/cookies","modules/core/exception","modules/clean/react/user_metadata/api"],(function(e,t,r,n,a,i,o,s,c,l,u,d,m,g,f,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUnauthorizedAccessError=t.isUnsupportedFileError=t.isFilesystemError=t.isOverQuotaError=t.setUserMetadataTextWatermarkingState=t.getUserMetadataTextWatermarkingState=t.getLocalStorageWatermarkingState=t.setLocalStorageWatermarkingState=t.getWatermarkMilestone=t.getImageFromURL=t.getWatermarkingLabelText=t.getWatermarkScale=t.DEFAULT_WATERMARKING_STATE=t.getImageDefaultSizes=t.getDefaultText=t.allowWatermarkOrTrial=t.allowWatermarkTrial=t.getWatermarkTrialVariant=t.allowWatermark=t.isWatermarkingEnabled=t.fileIsWatermarkable=t.WatermarkingError=t.WATERMARKING_LOCAL_STORAGE_KEY=t.DEFAULT_SIZES=void 0,n=r.__importStar(n),a=r.__importStar(a),p=r.__importStar(p);var v=[".pdf",".jpg",".jpeg",".png",".bmp"];t.DEFAULT_SIZES={size:1,minSize:.2,maxSize:5},t.WATERMARKING_LOCAL_STORAGE_KEY="fileviewer_watermarking_data";var h=(function(e){function t(t){var r=e.call(this,t)||this;return r.message=t,r.name="WatermarkingError",r}return r.__extends(t,e),t.TILE_NO_INPUT="Unable to tile: missing text or image",t})(Error);function S(e){return e&&i.WATERMARK_TRIAL_VARIANT_BY_USER_ID?i.WATERMARK_TRIAL_VARIANT_BY_USER_ID[e.id]:""}function b(e){return!t.isWatermarkingEnabled(e)&&["DEACTIVATED_MENU","POPOVER_WM_VALUE_PROPS","POPOVER_PRO_VALUE_PROPS","TOOLTIP_ON_HOVER"].includes(S(e))}function w(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=function(e){r(e)},n.crossOrigin="anonymous",n.src=e}))}function y(e,r){var a=(function(e){try{var t=n.codec.utf8String.toBits(f.Cookies.read("__Host-js_csrf"));return n.encrypt(t,JSON.stringify(e))}catch(e){return void p.reportException({err:e,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]})}})(r);a&&g.UserLocalStorage.set(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY,a)}t.WatermarkingError=h,t.fileIsWatermarkable=function(e){return!!e&&(c.isBrowseFile(e)&&!e.read_only&&!!e.ext&&v.includes(e.ext.toLowerCase()))},t.isWatermarkingEnabled=function(e){return!!(e&&i.WATERMARKING_BY_USER_ID&&i.WATERMARKING_BY_USER_ID[e.id])},t.allowWatermark=function(e,r){return t.isWatermarkingEnabled(r)&&t.fileIsWatermarkable(e)},t.getWatermarkTrialVariant=S,t.allowWatermarkTrial=b,t.allowWatermarkOrTrial=function(e,r){return t.allowWatermark(e,r)||b(r)},t.getDefaultText=function(e){if(!e)return"DRAFT";var t=(0,o.createFormatters(s.USER_LOCALE,{}).formatDate)(new Date,{});return e.display_name+" | "+t},t.getImageDefaultSizes=function(e,r){if(!e||!r)return t.DEFAULT_SIZES;var n=e.width/r.width,a=e.height/r.height,i=Math.max(n,a);if(i*t.DEFAULT_SIZES.maxSize<=.9)return t.DEFAULT_SIZES;var o=.9/i;return{size:o/5,minSize:o/25,maxSize:o}},t.DEFAULT_WATERMARKING_STATE={mode:m.WatermarkingMode.TEXT,textWatermarkingOptions:{angle:45,color:"black",opacity:30,fontFamily:"Helvetica, sans-serif",size:20,minSize:5,maxSize:200,lineHeight:3,text:"DRAFT",position:m.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},imageWatermarkingOptions:r.__assign({angle:45,opacity:30,position:m.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},t.DEFAULT_SIZES)},t.getWatermarkScale=function(e){return e===u.PreviewType.SsrDoc?300/72:1},t.getWatermarkingLabelText=function(e,t){if(e)return t===u.PreviewType.Image?l.intl.formatMessage({id:"35NidE",defaultMessage:"Watermarking is available on PDFs, PNGs, JPEGs, and BMPs."}):l.intl.formatMessage({id:"HcLjiD",defaultMessage:"Watermarking is available on PDFs and images."})},t.getImageFromURL=w,t.getWatermarkMilestone=function(e){return"M2"},t.setLocalStorageWatermarkingState=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(a){if(!e||!t)return[2];n=(function(e){var t=r.__assign(r.__assign({},e),{imageWatermarkingOptions:r.__assign({},e.imageWatermarkingOptions)});t.imageWatermarkingOptions.image&&!t.imageWatermarkingOptions.imageAsDataURL&&(t.imageWatermarkingOptions.imageAsDataURL=d.drawImageTile(t.imageWatermarkingOptions.image,1,1).canvas.toDataURL());return delete t.imageWatermarkingOptions.image,t})(t);try{y(e,n)}catch(t){if(n.imageWatermarkingOptions.imageAsDataURL){delete n.imageWatermarkingOptions.imageAsDataURL;try{y(e,n)}catch(e){p.reportException({err:t,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}}return[2]}))}))},t.getLocalStorageWatermarkingState=function(e){return r.__awaiter(this,void 0,void 0,(function(){var a,i,o,s,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(a=g.UserLocalStorage.get(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY)))return[3,5];r.label=1;case 1:return r.trys.push([1,4,,5]),i=n.codec.utf8String.toBits(f.Cookies.read("__Host-js_csrf")),(o=JSON.parse(n.decrypt(i,a))).imageWatermarkingOptions.imageAsDataURL?(s=o.imageWatermarkingOptions,[4,w(o.imageWatermarkingOptions.imageAsDataURL)]):[3,3];case 2:s.image=r.sent(),r.label=3;case 3:return[2,o];case 4:return c=r.sent(),p.reportException({err:c,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[3,5];case 5:return[2]}}))}))},t.getUserMetadataTextWatermarkingState=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,_.getUserMetadata(["TEXT_WATERMARKING_COLOR","TEXT_WATERMARKING_TEXT","TEXT_WATERMARKING_OPACITY","TEXT_WATERMARKING_ANGLE","TEXT_WATERMARKING_POSITION","TEXT_WATERMARKING_SIZE"],e.id)];case 1:return t=r.sent(),n={color:t.TEXT_WATERMARKING_COLOR?t.TEXT_WATERMARKING_COLOR:void 0,text:t.TEXT_WATERMARKING_TEXT,opacity:t.TEXT_WATERMARKING_OPACITY,angle:t.TEXT_WATERMARKING_ANGLE,position:t.TEXT_WATERMARKING_POSITION?t.TEXT_WATERMARKING_POSITION:void 0,size:t.TEXT_WATERMARKING_SIZE},[2,a.omitBy(n,a.isUndefined)];case 2:return i=r.sent(),p.reportException({err:i,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[2];case 3:return[2]}}))}))},t.setUserMetadataTextWatermarkingState=function(e,t){var r=t.textWatermarkingOptions;_.setUserMetadata({TEXT_WATERMARKING_COLOR:r.color,TEXT_WATERMARKING_TEXT:r.text,TEXT_WATERMARKING_OPACITY:r.opacity,TEXT_WATERMARKING_ANGLE:r.angle,TEXT_WATERMARKING_POSITION:r.position,TEXT_WATERMARKING_SIZE:r.size},e.id)},t.isOverQuotaError=function(e){return!(!e||"over_quota_error"!==e[".tag"])},t.isFilesystemError=function(e){return!(!e||"filesystem_error"!==e[".tag"])},t.isUnsupportedFileError=function(e){return!(!e||"unsupported_file_error"!==e[".tag"])},t.isUnauthorizedAccessError=function(e){return!(!e||"unauthorized_access"!==e[".tag"])}})),define("modules/clean/react/workflows/markup/fabric_wrapper",["require","exports","tslib","fabric"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fabric=void 0;var a=(n=r.__importDefault(n)).default.fabric||n.default;t.fabric=a})),define("modules/clean/react/workflows/markup/fabric",["require","exports","tslib","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/previews/constants","modules/clean/react/workflows/markup/types","api_v2/user_client"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFill=t.getStroke=t.setOptionsForActiveObjects=t.saveMarkup=t.disposeCanvas=t.setBaseBrushColor=t.setDrawingMode=t.addMarkupObject=void 0;n.fabric.Object&&(n.fabric.util.object.extend(n.fabric.Object.prototype,{cornerStyle:"circle",cornerColor:"#0052D9",cornerSize:10,cornerStrokeColor:"white",transparentCorners:!1,drawControls:function(e,t){t=t||{};var r=this._calculateCurrentDimensions(),n=r.x,a=r.y,i=t.cornerSize||this.cornerSize,o=-(n+i)/2,s=-(a+i)/2,c=void 0!==t.transparentCorners?t.transparentCorners:this.transparentCorners,l=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,u=c?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,u,o,s,t),this._drawControl("tr",e,u,o+n,s,t),this._drawControl("bl",e,u,o,s+a,t),this._drawControl("br",e,u,o+n,s+a,t),l&&this._drawControl("mtr",e,u,o+n/2,s-this.rotatingPointOffset,t),e.restore(),this},_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t=e.x,r=e.y;for(var n in this.__corner=0,this.oCoords)if(this.isControlVisible(n)&&("mtr"!==n||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==n&&"mr"!==n&&"mb"!==n&&"ml"!==n)){var a=void 0;switch(n){case"mt":a=this._getHorizontalImageLines(this.oCoords.tl.corner,this.oCoords.tr.corner);break;case"mr":a=this._getVerticalImageLines(this.oCoords.tr.corner,this.oCoords.br.corner);break;case"mb":a=this._getHorizontalImageLines(this.oCoords.bl.corner,this.oCoords.br.corner);break;case"ml":a=this._getVerticalImageLines(this.oCoords.tl.corner,this.oCoords.bl.corner);break;default:a=this._getImageLines(this.oCoords[n].corner)}var i=this._findCrossPoints({x:t,y:r},a);if(0!==i&&i%2==1)return this.__corner=n,n}return!1},_getHorizontalImageLines:function(e,t){return{topline:{o:e.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_getVerticalImageLines:function(e,t){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:e.tl}}}}),n.fabric.util.object.extend(n.fabric.Canvas.prototype,{uniScaleKey:null,_getActionFromCorner:function(e,t,r){if(!t||!e)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return r.shiftKey?"scale":"scaleX";case"mt":case"mb":return r.shiftKey?"scale":"scaleY";default:return"scale"}}})),n.fabric.BaseBrush&&(c(i.MarkupColor.RED_CHERRY),n.fabric.BaseBrush.prototype.width=3);var s={strokeUniform:!0,strokeWidth:3,stroke:"red"};function c(e){n.fabric.BaseBrush&&(n.fabric.BaseBrush.prototype.color=e)}function l(e){return e&&"group"===e.type}function u(e){return e&&"i-text"===e.type}t.addMarkupObject=function(e,t,a){var o;switch(t){case i.MarkupType.TEXT:o=new n.fabric.IText("Text",r.__assign(r.__assign(r.__assign(r.__assign({},s),{fontSize:22}),a),{fill:a.stroke,stroke:void 0}));break;case i.MarkupType.CIRCLE:o=new n.fabric.Circle(r.__assign(r.__assign(r.__assign({},s),{radius:50,fill:void 0}),a));break;case i.MarkupType.RECT:o=new n.fabric.Rect(r.__assign(r.__assign(r.__assign({},s),{width:100,height:100,fill:void 0}),a));break;case i.MarkupType.ARROW:var c=a.left,l=a.top,u=a.stroke,d=[c,l+100,c+100,l],m=180*Math.atan2(100,100)/Math.PI,g=new n.fabric.Triangle(r.__assign(r.__assign({},s),{angle:m,top:d[3],left:d[2]+3,height:15,width:15,originX:"center",originY:"center",stroke:u,fill:u})),f=new n.fabric.Line(d,r.__assign(r.__assign({},s),a));o=new n.fabric.Group([f,g],r.__assign(r.__assign(r.__assign({},s),{lockUniScaling:!0,centeredScaling:!0}),a))}o&&(e.add(o),e.setActiveObject(o))},t.setDrawingMode=function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&"object"==typeof e[r]){var n=e[r].fabric;n&&(n.isDrawingMode=t)}},t.setBaseBrushColor=c,t.disposeCanvas=function(e){for(var t in e)e[t].fabric&&e[t].fabric.dispose()},t.saveMarkup=function(e,t,n,i,s){return r.__awaiter(this,void 0,void 0,(function(){var c,l,u,d,m,g,f,p,_,v,h,S;return r.__generator(this,(function(r){for(d in c=new o.UserApiV2Client,l=[],u=s===a.PreviewType.SsrDoc?300/72:1,i)if(i.hasOwnProperty(d)&&"object"==typeof i[d]&&(m=i[d].scale,g=u/m,f=i[d].fabric))for(p=0,_=f.getObjects();p<_.length;p++)v=_[p],h=v.getBoundingRect(),l.push({".tag":"burn_image",image:v.toDataURL({multiplier:g}).split(",",2).pop(),x:Math.round(h.left/m),y:Math.round(h.top/m),page:Number(d)});return S={path:t,should_overwrite:n,burn_objects:l},[2,c.ns("workflows").rpc("markup_file",S,{subjectUserId:e})]}))}))},t.setOptionsForActiveObjects=function(e,t){e&&(e.getActiveObjects().forEach((function(e){u(e)?e.set(r.__assign(r.__assign({},t),{stroke:void 0,fill:t.stroke||e.fill})):l(e)?e.forEachObject((function(e){return e.set(r.__assign(r.__assign({},t),{fill:t.stroke||e.stroke}))})):!(function(e){return e&&"path"===e.type})(e)?e.set(t):e.set(r.__assign(r.__assign({},t),{fill:void 0}))})),e.renderAll())},t.getStroke=function(e){return u(e)?e.fill:l(e)?e.getObjects().filter((function(e){return"line"===e.type}))[0].stroke:"stroke"in e?e.stroke:void 0},t.getFill=function(e){if((function(e){return e&&"circle"===e.type})(e)||(function(e){return e&&"rect"===e.type})(e))return e.fill}})),define("modules/clean/react/workflows/markup/selectors",["require","exports","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkupState=void 0,t.getMarkupState=function(e){return r.getFileViewerState(e).markup}})),define("modules/clean/react/workflows/markup/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupColor=t.FormatSubmenuEntry=t.MarkupType=void 0,(function(e){e[e.TEXT=0]="TEXT",e[e.CIRCLE=1]="CIRCLE",e[e.RECT=2]="RECT",e[e.ARROW=3]="ARROW",e[e.FREEFORM=4]="FREEFORM"})(t.MarkupType||(t.MarkupType={})),(function(e){e.STROKE="stroke",e.FILL="fill"})(t.FormatSubmenuEntry||(t.FormatSubmenuEntry={})),(function(e){e.TRANSPARENT="transparent",e.RED_CHERRY="#D62C0B",e.ORANGE_TANGERINE="#FF8E21",e.GREEN="#00864C",e.DARK_BLUE="#005DD6",e.ULTRAVIOLET="#813BF6",e.WHITE="white",e.BLACK="black"})(t.MarkupColor||(t.MarkupColor={}))})),define("modules/clean/react/branding/api",["require","exports","tslib","modules/clean/react/premium_kit/api","modules/clean/react/premium_kit/types","modules/clean/react/user_metadata/api","modules/core/uri"],(function(e,t,r,n,a,i,o){"use strict";function s(e,t){var r=new o.URI({scheme:"https",authority:"www.dropbox.com",path:"/team/"+t+"/"+e,query:{suppress_default_logo:"1"}}).toString();return new Promise((function(e,n){var a=new XMLHttpRequest;a.open("HEAD",r),a.onload=function(){switch(a.status){case 200:return e(r);case 404:return e(void 0);default:throw new Error("Failed to get "+t)}},a.onerror=function(){return n(new Error("Failed to get "+t))},a.send()}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getTeamBackgroundUrl=t.getTeamLogoUrl=t.DISALLOWED=t.saveName=t.getName=t.saveLogoFlag=t.removeLogo=t.getLogo=t.saveSelectedBackgroundAssetId=t.getSelectedBackgroundAssetId=t.getBackgroundAssets=t.USER_METADATA_BRANDING_LOGO_SET_KEY=t.USER_METADATA_BACKGROUND_KEY=t.USER_METADATA_ORG_NAME_KEY=void 0,t.USER_METADATA_ORG_NAME_KEY="PREMIUM_KIT_ORGANIZATION_NAME",t.USER_METADATA_BACKGROUND_KEY="PREMIUM_KIT_BACKGROUND_ASSET_ID",t.USER_METADATA_BRANDING_LOGO_SET_KEY="PREMIUM_KIT_BRANDING_LOGO_SET",t.getBackgroundAssets=function(e){var t,i;return r.__awaiter(this,void 0,Promise,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.getAssetLibraries(e,[a.AssetLibraryId.BrandingBackground])];case 1:return o=r.sent(),[2,(null===(i=null===(t=o.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||[]]}}))}))},t.getSelectedBackgroundAssetId=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.getUserMetadata([t.USER_METADATA_BACKGROUND_KEY],e)];case 1:return[2,r.sent()[t.USER_METADATA_BACKGROUND_KEY]||""]}}))}))},t.saveSelectedBackgroundAssetId=function(e,n){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_BACKGROUND_KEY]=n||"",a),e)];case 1:return r.sent(),[2]}}))}))},t.getLogo=function(e){var t,i,o;return r.__awaiter(this,void 0,Promise,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.getAssetLibraries(e,[a.AssetLibraryId.BrandingLogo])];case 1:return s=r.sent(),[2,null===(o=null===(i=null===(t=s.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||void 0===o?void 0:o[0]]}}))}))},t.removeLogo=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,n.removeAssetLibrary(e,a.AssetLibraryId.BrandingLogo)];case 1:return t.sent(),[2]}}))}))},t.saveLogoFlag=function(e,n){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_BRANDING_LOGO_SET_KEY]=n,a),e)];case 1:return r.sent(),[2]}}))}))},t.getName=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.getUserMetadata([t.USER_METADATA_ORG_NAME_KEY],e)];case 1:return[2,r.sent()[t.USER_METADATA_ORG_NAME_KEY]||""]}}))}))},t.saveName=function(e,n){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_ORG_NAME_KEY]=n,a),e)];case 1:return r.sent(),[2]}}))}))},t.DISALLOWED={disallowed:!0},t.getTeamLogoUrl=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){return[2,s(e,"team_logo")]}))}))},t.getTeamBackgroundUrl=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){return[2,s(e,"team_background")]}))}))}})),define("modules/clean/react/premium_kit/api",["require","exports","tslib","api_v2/user_client"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeAssetLibrary=t.getAssetLibraries=t.addAssetByBlock=void 0,t.addAssetByBlock=function(e,t,a,i){return r.__awaiter(this,void 0,Promise,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:if(0===a.length)throw new Error("blockTokens list must not be empty");return o={library_assets_to_add:[{asset_library_id:i,assets_to_add:[{asset_id:t,file_args:{".tag":"add_by_blocks",tokens:a}}]}]},[4,(new n.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/add_assets",o,{subjectUserId:e}).then((function(e){var t,r=e.added_library_assets[0].added_assets[0].result;switch(r[".tag"]){case"asset":return(null===(t=null==r?void 0:r.graphic)||void 0===t?void 0:t.fallback_image_url)?r:void 0;case"asset_error":throw new Error(r.message);default:throw new Error("unexpected .tag value "+r[".tag"])}}))];case 1:return[2,r.sent()]}}))}))},t.getAssetLibraries=function(e,t){var r={asset_library_ids:t};return(new n.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/get",r,{subjectUserId:e})},t.removeAssetLibrary=function(e,t){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return a={asset_library_id:t},[4,(new n.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/remove",a,{subjectUserId:e})];case 1:return[2,r.sent()]}}))}))}})),define("modules/clean/react/premium_kit/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssetType=t.AssetId=t.AssetLibraryId=void 0,(function(e){e.BrandingBackground="branding_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo"})(t.AssetLibraryId||(t.AssetLibraryId={})),(function(e){e.BrandingCustomBackground="branding_custom_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo",e.Sapphire="sapphire",e.PinkLibrary="pink_library",e.Wheat="wheat",e.BlackCherry="black_cherry",e.Canopy="canopy",e.Turquoise="turquoise",e.Topaz="topaz",e.Pollen="pollen",e.Azalea="azalea",e.Shark="shark",e.AbstractHands="abstract_hands",e.RedMan="red_man",e.TransferAnimals="transfer_animals",e.BlueStairs="blue_stairs",e.WAVE="wave"})(t.AssetId||(t.AssetId={})),(function(e){e.Image="image",e.Video="video",e.Color="color",e.Other="other"})(t.AssetType||(t.AssetType={}))}));
//# sourceMappingURL=pkg-shared_link_core.min.js-vflD-ks50.map