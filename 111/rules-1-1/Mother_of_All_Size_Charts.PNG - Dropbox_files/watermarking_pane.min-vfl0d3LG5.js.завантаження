define(["require","exports","tslib","react","classnames","react-redux","dig-components/progress_indicators","dig-components/snackbar","dig-components/buttons","dig-components/text_fields","dig-components/tabs","spectrum/dropdown_menu/index","file-viewer/watermarking/plugin/icons/index","file-viewer/watermarking/plugin/redux/index","file-viewer/watermarking/plugin/components/watermarking_option","file-viewer/watermarking/plugin/components/watermarking_image_chooser","file-viewer/watermarking/plugin/selectors","file-viewer/watermarking/plugin/utils/index","dig-components/menu","dig-components/icons","dig-components/icons/src"],(function(e,a,t,n,r,i,l,s,o,u,m,d,c,g,f,p,_,k,v,M,E){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.WatermarkingPane=a.UnconnectedWatermarkingPane=void 0,n=t.__importStar(n),r=t.__importDefault(r);var w="watermarking-color-icon__3f1BSMFycu__watermarking_plugin",x="watermarking-color-icon-dark__2nOIZsq0oF__watermarking_plugin",S="watermarking-color-icon-light__ZS1NvrWAV-__watermarking_plugin",b="watermarking-options__1gegGxEjQY__watermarking_plugin",W="dropdown-menu__3iuBX5kRdV__watermarking_plugin",O="dropdown-icon__3SKpp_xj9X__watermarking_plugin",y="watermarking-rotate-button__L1SR33VTuh__watermarking_plugin",I="watermarking-slider__1Gu38i5KLl__watermarking_plugin",T="watermarking-actions__pnv9tXZU1n__watermarking_plugin",h="watermarking-save-button__2jMGHpb-4M__watermarking_plugin",R="watermarking-exit-button__345pPO9C5G__watermarking_plugin",N="watermarking-snackbar__1-fxJtndv7__watermarking_plugin";a.UnconnectedWatermarkingPane=function(e){var a=e.intl,i=e.context,g=e.status,_=e.mode,C=e.currentWatermarkOptions,P=e.imageWatermarkOptions,z=e.textWatermarkOptions,L=e.layerSize,U=e.setStatusReady,D=e.setMode,j=e.setImageWatermarkOptions,A=e.setTextWatermarkOptions,B=e.applyWatermark,H=e.logEvent,V=i.getPluginData().navigation,G=V.reinitializeFileViewer,K=V.exitEditMode,F=C.angle,Y=C.angleStep,X=C.maxSize,Z=C.minSize,q=C.opacity,J=C.position,Q=C.size,$=function(e){"text"===_?A(e):"image"===_&&j(e)},ee="pending"===g.state||"loaded"===g.state,ae=!1;"text"===_?ae=ee||0===z.text.length:"image"===_&&(ae=ee||null==P.image);var te=n.useMemo((function(){return[{name:a.formatMessage({id:"5aSWgz",defaultMessage:"Center"}),value:"CENTER",icon:n.default.createElement(c.PositionCenter,null)},{name:a.formatMessage({id:"zbi0wT",defaultMessage:"Upper left"}),value:"NORTHWEST",icon:n.default.createElement(c.PositionUpperLeft,null)},{name:a.formatMessage({id:"x2Kt2r",defaultMessage:"Upper right"}),value:"NORTHEAST",icon:n.default.createElement(c.PositionUpperRight,null)},{name:a.formatMessage({id:"2Y3n9L",defaultMessage:"Lower left"}),value:"SOUTHWEST",icon:n.default.createElement(c.PositionLowerLeft,null)},{name:a.formatMessage({id:"f+D0SV",defaultMessage:"Lower right"}),value:"SOUTHEAST",icon:n.default.createElement(c.PositionLowerRight,null)},{name:a.formatMessage({id:"KIU6pg",defaultMessage:"Repeat"}),value:"REPEAT",icon:n.default.createElement(c.PositionTile,null)}]}),[a]),ne=n.useMemo((function(){return[{name:a.formatMessage({id:"o541DB",defaultMessage:"Dark"}),value:"dark",icon:n.default.createElement("div",{className:r.default(w,x)})},{name:a.formatMessage({id:"rHOoG3",defaultMessage:"Light"}),value:"light",icon:n.default.createElement("div",{className:r.default(w,S)})}]}),[a]),re=function(e){void 0===e&&(e=1);var a=F+Y*e;a>=360&&(a-=360),a<0&&(a+=360),$({angle:a})};n.useEffect((function(){if("loaded"===g.state&&null!=g.data.result){var e=g.data.result.file_metadata,a=e.file_id,t=e.name,n=e.size_bytes,r=e.ns_id,i=e.sjid;G({fileSize:n,fileId:a,fileName:t,nsId:r,sjId:i,userAction:"visit",sourceContext:"workflow"})}}),[g,i,G]);var ie=te.find((function(e){return e.value===J})),le=ne.find((function(e){return e.value===z.color}));return n.default.createElement("div",{className:b},n.default.createElement(s.Snackbar,{className:N,open:"pending"===g.state||"errored"===g.state},"pending"===g.state&&n.default.createElement(l.Spinner,{"aria-valuetext":"Loading",size:"small",inverse:!0}),"errored"===g.state&&n.default.createElement(M.UIIcon,{src:E.FailLine}),n.default.createElement(s.Snackbar.Message,null,"pending"===g.state&&a.formatMessage({id:"6aVZjI",defaultMessage:"Watermarking your file..."}),"errored"===g.state&&g.error.message),"errored"===g.state&&n.default.createElement(s.Snackbar.Actions,null,n.default.createElement(o.Button,{variant:"transparent",inverse:!0,onClick:U},"Dismiss"))),n.default.createElement("div",{className:T},n.default.createElement(v.Menu.Wrapper,{onSelection:function(e){(function(e){H("watermark_apply_save_as_copy",{watermark_type:_,num_characters:_?String(z.text.length):"0",end_position:J,end_rotation:String(F),end_size:String(Q),end_transparency:String(q)}),B(e)})("replace"===e)}},(function(e){var t=e.getTriggerProps,r=e.getContentProps;return n.default.createElement(o.Button,Object.assign({},t(),{withDropdownIcon:!0,className:h,variant:"primary",disabled:ae,inverse:!0}),a.formatMessage({id:"xghqSe",defaultMessage:"Save"}),n.default.createElement(v.Menu.Content,Object.assign({},r()),n.default.createElement(v.Menu.Segment,null,n.default.createElement(v.Menu.ActionItem,{value:"copy"},a.formatMessage({id:"IZM92X",defaultMessage:"Make a copy"})),n.default.createElement(v.Menu.ActionItem,{value:"replace"},a.formatMessage({id:"RfzK2R",defaultMessage:"Replace original"})))))})),n.default.createElement(o.Button,{variant:"outline",onClick:function(){H("watermark_cancel",{watermark_type:_}),K()},disabled:"ready"!==g.state,inverse:!0,className:R},"Cancel")),n.default.createElement(m.Tabs,{selectedTab:_,onSelection:function(e){return D(e)},inverse:!0},n.default.createElement(m.Tabs.Group,null,n.default.createElement(m.Tabs.Tab,{id:"text"},a.formatMessage({id:"x8R7Bu",defaultMessage:"Text"})),n.default.createElement(m.Tabs.Tab,{id:"image"},a.formatMessage({id:"cw3HAU",defaultMessage:"Image"}))),n.default.createElement(m.Tabs.Panel,{tabId:"text"},n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"S/79Yf",defaultMessage:"Watermark"})},n.default.createElement(u.TextInput,{value:z.text,onChange:function(e){A({text:e.target.value})},placeholder:a.formatMessage({id:"RLlVEd",defaultMessage:"Add watermark text"}),"aria-label":a.formatMessage({id:"ylXIje",defaultMessage:"Text of Watermark"}),autoComplete:"off",disabled:ee,inverse:!0,isTransparent:!1}))),n.default.createElement(m.Tabs.Panel,{tabId:"image"},n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"S/79Yf",defaultMessage:"Watermark"})},n.default.createElement(p.WatermarkingImageChooser,{intl:a,image:P.image,onImageChange:function(e){j(t.__assign({image:e},k.getImageDefaultSizes(e,{height:L.canvasHeight,width:L.canvasWidth})))}})))),n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"/JYexz",defaultMessage:"Position"})},n.default.createElement(d.DropdownMenu,{key:"dropdown-position-"+_,disabled:ae,onSelection:function(e){$({position:e})}},n.default.createElement(d.DropdownMenuButton,{fullWidth:!0},n.default.createElement("span",{className:O},null==ie?void 0:ie.icon),null==ie?void 0:ie.name),n.default.createElement(d.Menu,{className:W},te.map((function(e){var a=e.name,t=e.value,r=e.icon;return n.default.createElement(d.MenuItem,{key:t,value:t},n.default.createElement("span",{className:O},r),a)}))))),"text"===_&&n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"G32RJ7",defaultMessage:"Color"})},n.default.createElement(d.DropdownMenu,{disabled:ae,onSelection:function(e){A({color:e})}},n.default.createElement(d.DropdownMenuButton,{fullWidth:!0},n.default.createElement("span",{className:O},null==le?void 0:le.icon),null==le?void 0:le.name),n.default.createElement(d.Menu,{className:W},ne.map((function(e){var a=e.name,t=e.value,r=e.icon;return n.default.createElement(d.MenuItem,{key:t,value:t,selected:t===z.color},n.default.createElement("span",{className:O},r),a)}))))),n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"b2mHDQ",defaultMessage:"Rotation"})},n.default.createElement(o.IconButton,{className:y,onClick:function(){return re(1)},variant:"outline",disabled:ae,"aria-label":a.formatMessage({id:"QSlcsR",defaultMessage:"Rotate counterclockwise button"}),inverse:!0},n.default.createElement(c.RotateLeftIcon,null)),n.default.createElement(o.IconButton,{className:y,onClick:function(){return re(-1)},variant:"outline",disabled:ae,"aria-label":a.formatMessage({id:"HLjGpv",defaultMessage:"Rotate clockwise button"}),inverse:!0},n.default.createElement(c.RotateRightIcon,null))),n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"3KCxAM",defaultMessage:"Opacity"})},n.default.createElement("input",{"aria-label":a.formatMessage({id:"Rm9SCY",defaultMessage:"Opacity slider"}),className:I,type:"range",min:"0",max:"1",step:"0.0001",value:q,onChange:function(e){$({opacity:parseFloat(e.target.value)})},disabled:ae})),n.default.createElement(f.WatermarkingOption,{name:a.formatMessage({id:"e0UsOS",defaultMessage:"Size"})},n.default.createElement("input",{"aria-label":a.formatMessage({id:"nHKL5p",defaultMessage:"Size slider"}),className:I,type:"range",min:Z,max:X,step:"0.0001",value:Q,onChange:function(e){$({size:parseFloat(e.target.value)})},disabled:ae})))};a.WatermarkingPane=i.connect((function(e,a){var t=a.context.fileViewerId,n=e.mode,r=e.status,i=e.textWatermarkOptions,l=e.imageWatermarkOptions,s=e.layerSize;return{status:r[t],currentWatermarkOptions:_.getCurrentWatermarkOptions(t,e),textWatermarkOptions:i[t],imageWatermarkOptions:l[t],layerSize:s[t],mode:n[t]}}),(function(e,a){var t=a.context.fileViewerId,n="image"===a.previewType||"ssr_doc"===a.previewType?a.file:null;return{setStatusReady:function(){return e(g.setStatusReady(t))},setMode:function(a){return e(g.setMode(t,a))},setImageWatermarkOptions:function(a){return e(g.setImageWatermarkOptions(t,a))},setTextWatermarkOptions:function(a){return e(g.setTextWatermarkOptions(t,a))},applyWatermark:function(a){null!==n&&e(g.applyWatermark(t,n,a))},logEvent:function(a,n){return e(g.logEvent({fileViewerId:t,eventName:a,extra:n}))}}}))(a.UnconnectedWatermarkingPane)}));
//# sourceMappingURL=watermarking_pane.min.js-vflzPHnAz.map