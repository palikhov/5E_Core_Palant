define(["require","exports","tslib","modules/clean/react/integrations/pdf_editor/redux/features/page_actions/page_actions_slice","classnames","modules/clean/react/integrations/pdf_editor/redux/features/sidebar_actions/sidebar_actions_slice","modules/clean/react/integrations/pdf_editor/strings","react-beautiful-dnd","react-window","dig-components/icons/src","dig-components/buttons","react","modules/clean/react/integrations/pdf_editor/utils/reorder_util","modules/clean/react/components/css","modules/clean/react/integrations/pdf_editor/components/thumbnail","dig-components/tooltips","dig-components/icons","react-redux","react-intl"],(function(e,t,a,n,r,i,l,s,o,d,c,u,f,g,m,p,b,v,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentSidebar=t.DocumentSidebarWithoutCSS=void 0,r=a.__importDefault(r),u=a.__importStar(u);function h(){var e=S.useIntl(),t=v.useDispatch(),g=Object.keys(v.useSelector((function(e){return e.pageActions.selectedPages}))).map(Number),h=v.useSelector((function(e){return e.sidebarActions.pagesData})),D=u.useState(!1),_=D[0],E=D[1],x=u.useState(),P=x[0],y=x[1],w=u.useState(),C=w[0],N=w[1],I=u.useRef(null),A=u.useState(),L=A[0],R=A[1],T=u.useState(),z=T[0],M=T[1],k=u.useRef(null),H=u.useState(1),O=H[0],V=H[1],K=function(e){t(n.clearSelectedPages());for(var a=0,r=e;a<r.length;a++){var i=r[a];t(n.addSelectedPage(i))}},W=function(e,t){t.defaultPrevented||0===t.button&&(t.preventDefault(),q(e,t))},j=function(e,t,a){t.defaultPrevented||a.isDragging||(t.preventDefault(),q(e,t))},q=function(e,a){B(a)?g.includes(e)?t(n.removeSelectedPage(e)):t(n.addSelectedPage(e)):F(a)?U(e):K([e])},B=function(e){return navigator.platform.indexOf("Mac")>=0?e.metaKey:e.ctrlKey},F=function(e){return e.shiftKey},G=function(e){_!==e&&E(e)},U=function(e){var a=g.slice(-1)[0];if(e>a)for(var r=e-a+1,i=0,l=Array.from({length:r},(function(e,t){return t+a}));i<l.length;i++){var s=l[i];t(n.addSelectedPage(s))}else if(e<a){r=a-e;for(var o=0,d=Array.from({length:r},(function(t,a){return a+e}));o<d.length;o++){s=d[o];t(n.addSelectedPage(s))}}else;},J=function(){if(I.current){var e=I.current.clientWidth;R(e);var t=I.current.clientHeight;M(t);var a=Math.floor((e-212)/198);y(Math.max(a,1))}};u.useEffect((function(){J()})),u.useEffect((function(){window.addEventListener("resize",J),t(i.setInitialPageOrder(15)),t(n.addSelectedPage(0))}),[]),u.useEffect((function(){N(h.length)}),[h]),u.useEffect((function(){k.current&&k.current.scrollToItem(g[0],"center")}),[P]),u.useEffect((function(){var e=Array.from(new Set(g));V(e.length)}),[g]);var Q=function(e){var t=+e.draggableId.replace("page","");g.includes(t)||K([t])},X=function(e){if(e.destination&&e.source.index!==e.destination.index){var a=f.reorder(h,g,e.destination.index),n=a.result,r=a.indicesAfterDrag;t(i.updatePageOrder(n)),K(r)}},Y=function(a){var n=a.index,r=(function(e){var a=v.useSelector((function(t){return!!t.pageActions.selectedPages[e.toString()]})),n=v.useSelector((function(t){return!!t.sidebarActions.pagesData[e]&&t.sidebarActions.pagesData[e].isLoading})),r=v.useSelector((function(t){return!!t.sidebarActions.pagesData[e]&&t.sidebarActions.pagesData[e].thumbnailID})),l=v.useSelector((function(e){return r?e.sidebarActions.thumbnailCache[r]:m.emptyThumbnail}));return l.data||t(i.createThumbnail(e)),{isSelected:a,isLoading:n,thumbnailData:l}})(n),l=r.isSelected,s=r.isLoading,o=r.thumbnailData;return u.default.createElement(m.Thumbnail,{key:n,index:n,isSelected:l,isLoading:s,onClick:W,onKeyDown:j,snapshot:a.snapshot,inGridView:_,thumbnailData:o,intl:e})},Z=function(e){var t=e.index,n=e.style;return u.default.createElement("div",{className:"thumbnail-outer",style:n},u.default.createElement(s.Draggable,{draggableId:"page"+t,index:t},(function(e,n){return u.default.createElement("div",a.__assign({},e.draggableProps,e.dragHandleProps,{ref:e.innerRef}),u.default.createElement(Y,{index:t,snapshot:n}))})))},$=function(t){var n=t.index,r=t.style;if(!P||!C)return u.default.createElement("div",{className:"thumbnail-outer",style:r});var i=n*P,o=(n+1)*P-1,d=h.slice(i,o+1).map((function(e,t){return e?u.default.createElement("li",{key:i+t,className:"grid-list"},u.default.createElement(s.Draggable,{draggableId:"page"+(i+t),index:i+t,key:i+t},(function(e,n){return u.default.createElement("div",a.__assign({className:"grid-horizontal-list"},e.draggableProps,e.dragHandleProps,{ref:e.innerRef}),u.default.createElement(Y,{index:i+t,snapshot:n}))}))):u.default.createElement("div",{className:"thumbnail-outer",style:r})})),c=O>1?l.DocumentSidebarStrings.pluralDragTooltip:l.DocumentSidebarStrings.singularDragTooltip,f={isPortaled:!1};return u.default.createElement("div",{className:"grid-row",style:r},u.default.createElement(s.Droppable,{key:n,droppableId:"droppable"+n,direction:"horizontal",mode:"virtual",renderClone:function(t,n,r){return u.default.createElement("div",a.__assign({className:"clone-drag"},t.draggableProps,t.dragHandleProps,{ref:t.innerRef}),u.default.createElement(Y,{index:r.source.index,snapshot:n}),u.default.createElement(p.Tooltip.Control,a.__assign({id:"dragging-page",triggerRef:t.innerRef,open:n.isDragging,placement:"right",inverse:!1},f),e.formatMessage(a.__assign({},c),{val:O})))}},(function(e,t){return u.default.createElement("div",a.__assign({style:{display:"flex"},ref:e.innerRef},e.droppableProps),u.default.createElement("ol",null,d))})))};return u.default.createElement("div",{className:r.default("sidebar",{"grid-view":_}),ref:I},u.default.createElement("div",{className:r.default("sidebar-inner",{"grid-view":_})},(function(t,n,r){if(t&&P)return u.default.createElement(s.DragDropContext,{onDragEnd:X,onDragStart:Q},u.default.createElement(o.FixedSizeList,{className:"page-list",height:n-64-48-184,width:r,overscanCount:5,itemCount:Math.ceil(h.length/P),itemSize:208,ref:k},$));var i=O>1?l.DocumentSidebarStrings.pluralDragTooltip:l.DocumentSidebarStrings.singularDragTooltip,d={isPortaled:!1};return u.default.createElement(s.DragDropContext,{onDragEnd:X,onDragStart:Q},u.default.createElement(s.Droppable,{droppableId:"droppable",mode:"virtual",renderClone:function(t,n,r){return u.default.createElement("div",a.__assign({},t.draggableProps,t.dragHandleProps,{ref:t.innerRef,className:"clone-drag"}),u.default.createElement(Y,{index:r.source.index,snapshot:n}),u.default.createElement(p.Tooltip.Control,a.__assign({id:"dragging-page",triggerRef:t.innerRef,open:n.isDragging,placement:"right",inverse:!1},d),e.formatMessage(a.__assign({},i),{val:O})))}},(function(e,t){return u.default.createElement("div",a.__assign({ref:e.innerRef},e.droppableProps),u.default.createElement(o.FixedSizeList,{className:"page-list",height:n-64-48-88,width:r,overscanCount:5,itemCount:C,itemSize:164,ref:k},Z))})))})(_,z,L)),u.default.createElement("div",{className:"sidebar-view-toggle-buttons"},u.default.createElement(c.IconButton,{variant:"transparent",inverse:!0,className:r.default("list-view","view-change",{selected:!_}),onClick:function(){return G(!1)},"aria-label":e.formatMessage(a.__assign({},l.DocumentSidebarStrings.listViewAriaLabel))},u.default.createElement(b.UIIcon,{src:d.ListViewLine,size:"small"})),u.default.createElement(c.IconButton,{variant:"transparent",inverse:!0,className:r.default("grid-view","view-change",{selected:_}),onClick:function(){return G(!0)},"aria-label":e.formatMessage(a.__assign({},l.DocumentSidebarStrings.gridViewAriaLabel))},u.default.createElement(b.UIIcon,{src:d.GridViewLine,size:"small"}))))}t.DocumentSidebarWithoutCSS=h,t.DocumentSidebar=g.requireCssWithComponent(h,["/static/css/pdf_editor/document_sidebar-vflJFXBkR.css"])}));
//# sourceMappingURL=document_sidebar.min.js-vflcVoB4O.map