define(["require","exports","tslib","classnames","lodash","react","react-redux","dig-components/menu","dig-components/buttons","dig-components/icons/src","dig-components/icons","spectrum/tooltip/index","modules/clean/cloud_docs/constants","modules/clean/filepath/filepath","modules/clean/integrations/data/selectors","modules/clean/react/extensions/apis","modules/clean/react/extensions/education/types","modules/clean/react/app_actions/redirect","modules/clean/react/app_actions/telemetry_client","modules/clean/react/components/css","modules/clean/react/extensions/common","modules/clean/react/extensions/connect_flow","modules/clean/react/extensions/data/action_creators","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/store","modules/clean/react/extensions/data/types","modules/clean/react/extensions/extensions_mini_directory_modal","modules/clean/react/extensions/extensions_utils","modules/clean/react/extensions/file","modules/clean/react/extensions/tooltips","modules/clean/react/extensions/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/open_button/types","modules/clean/static_urls","modules/clean/user_education/react/user_education_effect","modules/core/i18n","modules/clean/web_user_action_events","modules/clean/react/file_transfers/lib/utils","modules/clean/react/file_transfers/async/browse_entry_point_onboarding_modal_async"],(function(e,t,n,o,r,i,a,s,l,c,p,u,d,h,g,f,S,_,m,A,v,O,E,I,T,y,P,M,x,b,w,N,C,B,U,L,F,D,k,R,V,H){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SplitShareButton=t.SplitShareButtonComponent=void 0,o=n.__importDefault(o),i=n.__importStar(i),y.getStore();var G=function(e){var t,n=e.openOption,o=e.description,r=e.rightAccessory;return t=n.iconElement?n.iconElement:n.iconUrl?i.default.createElement("img",{alt:"",src:n.iconUrl,width:24,height:24}):null,i.default.createElement(s.Menu.ActionItem,{value:n,withLeftAccessory:t,withSubtitle:o,withRightAccessory:r},n.text)},q=(function(t){function a(a){var h=t.call(this,a)||this;return h.handleClickShare=function(e){e.preventDefault(),h.props.onShowShare(),h.props.logShareButtonClick&&h.props.logShareButtonClick(h.props.renderMenuOnly?R.ActionSourceValue.OVERFLOW_MENU:R.ActionSourceValue.SPLIT_SHARE),h.currentSession&&h.currentSession.event("click_share",{trigger_type:h.props.triggerType}),e.stopPropagation()},h.handleSelectAction=function(e){e.handler()},h.logSelectActionOverflowMenu=function(e,t){h.props.logShareButtonClick&&h.props.logShareButtonClick(h.props.renderMenuOnly?R.ActionSourceValue.OVERFLOW_MENU:R.ActionSourceValue.SPLIT_SHARE,e),v.logEvent(h.currentSession,"select_action",{type:t,trigger_type:h.props.triggerType})},h.handlePreventMouseDown=function(e){e.preventDefault(),h.state.tooltipState===S.TooltipState.BIG_ONBOARDING_TOOLTIP&&(h.markSplitShareTooltipViewed(),h.setState({tooltipState:S.TooltipState.NO_TOOLTIP})),e.stopPropagation()},h.handlePopoverHover=function(){h.currentSession&&h.currentSession.event("popover_trigger_hover",{trigger_type:h.props.triggerType})},h.handleShareHover=function(){h.currentSession&&h.currentSession.event("share_hover",{trigger_type:h.props.triggerType})},h.handlePopoverToggle=function(e){var t=e.isOpen,n=h.props,o=n.onDropdownOpen,r=n.onDropdownClose,i=n.triggerType,a=n.isCollapsed;if(t&&o?o():!t&&r&&r(),h.currentSession&&h.currentSession.event(t?"open_popover":"close_popover",{trigger_type:i}),t){var s=a?C.EventType.SidebarCollapsedShareClicked:C.EventType.SidebarOpenedShareClicked;B.filePreviewEventEmitter.emit(s,U.FilePreviewSession.currentSession)}},h.handlePresentInZoom=function(e,t){var n=h.props,o=n.refreshSharingServiceInfo,r=n.sharingServiceInfo,i=n.onPresentInZoom,a=n.landingPageEnabled;r&&o&&i&&O.presentInZoomFlow(e,r,o,i,"split_share_button",a,t)},h.handleShareInSlack=function(e,t,n){var o=h.props,r=o.refreshSharingServiceInfo,i=o.sharingServiceInfo,a=o.landingPageEnabled;i&&r&&O.shareInSlackFlow(t,i,r,e,"split_share_button",a,n)},h.handleShareToTrello=function(e,t,n){var o=h.props,r=o.refreshSharingServiceInfo,i=o.sharingServiceInfo,a=o.landingPageEnabled;i&&r&&O.shareInTrelloFlow(t,i,r,e,"split_share_button",a,n)},h.handleUploadToCanvas=function(e,t,n){var o=h.props,r=o.refreshSharingServiceInfo,i=o.sharingServiceInfo,a=o.landingPageEnabled;i&&r&&O.shareInCanvasFlow(t,i,r,e,"split_share_button",a,n)},h.handleUpdateLinkState=function(e,t){(0,h.props.updateLinkState)({actionId:e,linkState:t})},h.handleAppAction=function(e,t,n){var o=h.props,r=o.context,i=o.featureFlags,a=e.map((function(e){return e}));_.redirectToActionOrShowAuth(t,a,n,i,r,h.handleUpdateLinkState,h.handleShareAction),v.logEvent(h.currentSession,"select_action",v.getAppActionExtras(n))},h.handleShareAction=function(e,t,n){var o=n.handler.service_type[".tag"],r={".tag":"profile_linked"},i=function(){h.handleUpdateLinkState(n.id,r),_.authorizeNoRedirect(e,n.id)};switch(o){case"slack_dropbox":return h.handleShareInSlack(t,e,i);case"zoom":return h.handlePresentInZoom(e,i);case"trello":return h.handleShareToTrello(t,e,i);case"canvas":return h.handleUploadToCanvas(t,e,i)}},h.getAppActionIconUrl=function(e){var t=e.icon;return t&&t.url&&!t.is_static?t.url:F.static_url("/static/images/generic_app_icon-vflIPYT1H.png")},h.getAppActionOpenOptionActions=function(e){var t=e.handler;if("profile_service"!==t[".tag"])return{type:L.OpenButtonAction.APP_ACTION,userAction:C.UserAction.ShareToAction};switch(t.service_type[".tag"]){case"slack_dropbox":return{type:L.OpenButtonAction.SHARE_TO_SLACK,userAction:C.UserAction.ShareToSlack};case"zoom":return{type:L.OpenButtonAction.PRESENT_IN_ZOOM,userAction:C.UserAction.PresentInZoom};case"trello":return{type:L.OpenButtonAction.SHARE_TO_TRELLO,userAction:C.UserAction.ShareToTrello};default:return{type:L.OpenButtonAction.APP_ACTION,userAction:C.UserAction.ShareToAction}}},h.handleHellosignDeepIntegrationLaunch=function(t,o){return new Promise((function(t,n){e(["modules/clean/integrations/hellosign_deep_integration/launcher"],t,n)})).then(n.__importStar).then((function(e){var n=(0,e.getLauncher)();return n.init({entryPoint:"share_menu",file:t,user:o}),n})).then((function(e){return e.launch(),e}))},h.getHellosignOpenOption=function(e,t){return{handler:function(){h.handleHellosignDeepIntegrationLaunch(e,t),h.logSelectActionOverflowMenu(C.UserAction.SendForSignatureAction,L.OpenButtonAction.PREPARE_FOR_SIGNATURE)},iconUrl:F.static_url("/static/images/integrations/hellosign/signature-vflBGJCuJ.svg"),spriteName:null,text:k.intl.formatMessage({id:"KPapIP",defaultMessage:"Send for signature"}),type:L.OpenButtonAction.PREPARE_FOR_SIGNATURE,userAction:C.UserAction.SendForSignatureAction}},h.getAppActionOpenOption=function(e,t,n){var o=h.getAppActionOpenOptionActions(n),r=o.type,i=o.userAction;return{handler:function(){h.handleAppAction(e,t,n),h.logSelectActionOverflowMenu(i,r)},spriteName:null,text:n.description,type:r,userAction:i,iconUrl:h.getAppActionIconUrl(n)}},h.getMoreAppsOpenOption=function(e,t){return{handler:function(){h.handleMoreApps(e,t),v.logEvent(h.currentSession,"select_show_more",{}),h.logSelectActionOverflowMenu(C.UserAction.OpenMoreApps,L.OpenButtonAction.OPEN_MORE_APPS)},text:k.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}),type:L.OpenButtonAction.OPEN_MORE_APPS,userAction:C.UserAction.OpenMoreApps,spriteName:null}},h.getAddAppsOpenOption=function(e,t){return{handler:function(){h.handleMoreApps(e,t),v.logEvent(h.currentSession,"select_add_apps",{}),h.logSelectActionOverflowMenu(C.UserAction.OpenAddApps,L.OpenButtonAction.OPEN_ADD_APPS)},text:k.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}),type:L.OpenButtonAction.OPEN_ADD_APPS,userAction:C.UserAction.OpenAddApps,spriteName:null,iconUrl:F.static_url("/static/images/extensions/circled_plus-vfl7N2-Lg.svg")}},h.handleMoreApps=function(e,t){var n=h.props,o=n.appActions,r=n.featureFlags,i=n.context,a=n.categoryInfo,s=x.getCategoryIdToInfos(a);M.showExtensionsMiniDirectoryModal(k.intl.formatMessage({id:"A7cFjC",defaultMessage:"Share with these apps"}),t,e,o.sort(I.actionCompareFn),s,r,h.handleUpdateLinkState,i,h.currentSession,h.handleShareAction)},h.getShareWithEmailOpenOption=function(){var e=h.props.onShowShare;return{handler:function(){e(),h.logSelectActionOverflowMenu(C.UserAction.InviteViaEmail,L.OpenButtonAction.INVITE_VIA_EMAIL)},spriteName:null,text:k.intl.formatMessage({id:"8U/qbn",defaultMessage:"Share with Dropbox"}),type:L.OpenButtonAction.INVITE_VIA_EMAIL,userAction:C.UserAction.InviteViaEmail,iconElement:i.default.createElement(p.UIIcon,{className:"test-id-share-dig-icon",src:c.ShareArrowLine})}},h.getTransferOpenOptions=function(e,t){return{handler:function(){e(),h.logSelectActionOverflowMenu(C.UserAction.Transfer,L.OpenButtonAction.TRANSFER)},spriteName:null,text:t?k.intl.formatMessage({id:"3MahuB",defaultMessage:"Send a copy"}):k.intl.formatMessage({id:"yf3+2O",defaultMessage:"Send with Transfer"}),type:L.OpenButtonAction.TRANSFER,userAction:C.UserAction.Transfer,iconElement:i.default.createElement(p.UIIcon,{src:t?c.DropboxTransferLine:c.SendLine})}},h.getPopoverTriggerRenderer=function(e,t,r){return function(a){var s=h.props,d=s.isVisible,g=s.variant,f=n.__assign({className:o.default("extensions-split-share-menu__trigger",{"extensions-split-share-menu__trigger--collapsed":e}),tabIndex:d?void 0:-1,onMouseEnter:h.handlePopoverHover,"aria-label":k.intl.formatMessage({id:"5MpLpV",defaultMessage:"Expand share menu"})},a);return e?i.default.createElement(u.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:k.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"})},i.default.createElement(l.IconButton,n.__assign({variant:"primary"===g?"filled":g},f),i.default.createElement(p.UIIcon,{src:c.ShareArrowLine,"aria-label":r}))):t?i.default.createElement(l.Button,n.__assign({},f,{withIconLeft:i.default.createElement(p.UIIcon,{src:c.ShareArrowLine,className:"extensions-split-share--icon"}),variant:g,withDropdownIcon:!0}),k.intl.formatMessage({id:"DHK0zq",defaultMessage:"Share all selected"})):i.default.createElement(l.Button,n.__assign({},f,{variant:g,withDropdownIcon:!0,_hasSquaredSize:!0}))}},h.renderPopoverItems=function(){var e=h.props,t=e.user,o=e.files,a=e.appActions,l=e.nonHellosignAppActions,c=e.featureFlags,p=c.hellosignDeepIntegration,u=c.dndSplitShare,g=c.fileTransfersAppAction,f=c.multiObjectSharingRedesignExp,S=e.isSendForSignatureEnabled,_=e.showTransferButton,m=e.onAddToTransfer,A=1===o.length,v=o[0],O="DEEP_INTEGRATION"===p,E=A&&d.isHellosignFileByExtension(b.getFileExt(n.__assign(n.__assign({},v),{bytes:0}))),T=null,y=a;if(O&&E&&S){y=l;var P=h.getHellosignOpenOption(v,t);T=i.default.createElement(G,{openOption:P})}var M=null;if("ON"===u){var x=y.find((function(e){return e.app_id===C.DOCSEND_PROD_APP_ID}));if(x){y=y.filter((function(e){return e.app_id!==C.DOCSEND_PROD_APP_ID}));var w=h.getAppActionOpenOption(o,t,x);w.text=k.intl.formatMessage({id:"r4C3UE",defaultMessage:"Send and track"}),M=i.default.createElement(G,{key:w.text,openOption:w})}}var N=I.partitionActions(y),B=N.installedActions,U=N.unpromotedActions,L=(!r.isEmpty(U)||!r.isEmpty(B))&&i.default.createElement(s.Menu.Segment,null,B.map((function(e){var n=h.getAppActionOpenOption(o,t,e);return i.default.createElement(G,{key:n.text,openOption:n})})),!r.isEmpty(U)&&A&&i.default.createElement(G,{openOption:r.isEmpty(B)?h.getAddAppsOpenOption(v,t):h.getMoreAppsOpenOption(v,t)})),F="ON"===f,D=F?V.shouldShowTransferInSplitShare("ON"===g,o.map((function(e){return e}))):_,R=F?function(){return h.handleAddToTransfer(o,t)}:m;return i.default.createElement(i.Fragment,null,i.default.createElement(s.Menu.Segment,null,A&&i.default.createElement(G,{openOption:h.getShareWithEmailOpenOption()}),D&&R&&i.default.createElement(G,{openOption:h.getTransferOpenOptions(R,F)}),T,M),L)},h.markSplitShareTooltipViewed=function(){f.markTooltipViewed(h.props.user.id,"split_share_edu")},h.state={tooltipState:S.TooltipState.NO_TOOLTIP},h.telemetryClient=m.createTelemetryClient(n.__assign({component:"split-share-btn"},a.context)),h}return n.__extends(a,t),a.prototype.componentDidMount=function(){this.props.showEduTooltip&&this.setEduTooltip()},a.prototype.setEduTooltip=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,f.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"])];case 1:return e=n.sent(),t=this.props.files[0],o=w.allowedTooltips(this.props.appActions.length>0,t.fq_path?"."+h.file_extension(h.filename(t.fq_path)):"",this.props.featureFlags),"split_share_edu"===o.find((function(t){return void 0!==e[t]&&!e[t]}))&&this.setState({tooltipState:S.TooltipState.BIG_ONBOARDING_TOOLTIP}),[2]}}))}))},a.prototype.handleAddToTransfer=function(e,t){var n=e.map((function(e){return e})),o=this.props.renderMenuOnly?R.ActionSourceValue.OVERFLOW_MENU:R.ActionSourceValue.SPLIT_SHARE,r=V.computeAddToTransferReferrer(n,o,this.props.retrievalSource,this.props.actionSurface);H.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:function(){return V.redirectToCreateTransferWithFiles(n,r)},userId:t.id})},a.prototype.render=function(){var e=this,t=this.props,a=t.files,u=t.context,g=t.isVisible,f=t.shareButtonLabel,S=t.triggerType,_=t.isCollapsed,A=t.shouldUsePortalPopover,v=t.appActions,O=t.featureFlags,E=t.showLeftDigIcon,I=t.variant,T=t.renderMenuOnly,y=t.expActionBarRedesignEnabled,M=1===a.length,x=a[0];u?this.currentSession=this.telemetryClient.session({ext:m.getPiiSafeExtension(x?"."+h.file_extension(h.filename(x.fq_path)):"")}):delete this.currentSession;var w={"aria-label":f,className:o.default("extensions-split-share__share-button",{"primary-action-menu__button":S===P.TriggerType.SidebarPrimaryButton}),onClick:this.handleClickShare,tabIndex:g?void 0:-1,onMouseEnter:this.handleShareHover},C=i.default.createElement(l.Button,n.__assign({},w,{withIconLeft:E&&i.default.createElement(p.UIIcon,{src:c.ShareArrowLine,className:"extensions-split-share--icon"}),variant:I}),i.default.createElement(D.UserEducationEffect,{containerName:"SplitShareButton",name:"ShareButtonLabel",useSpan:!0},f)),B=this.getPopoverTriggerRenderer(_,!M,f),U=this.props.sharingServiceInfo&&N.isSlackAvailable(this.props.sharingServiceInfo)&&N.isZoomAvailable(this.props.sharingServiceInfo),L=M&&"DEEP_INTEGRATION"===O.hellosignDeepIntegration&&d.isHellosignFileByExtension(b.getFileExt(n.__assign(n.__assign({},x),{bytes:0})));return T?this.renderPopoverItems():i.default.createElement("div",{className:o.default("extensions-split-share-btn",{"extensions-split-share-btn--invisible":!g,"slack-zoom-available":U&&!_,"slack-zoom-available-collapsed":U&&_,"hellosign-available":L,"share-fake-split-button":!r.isEmpty(v)})},!_&&M&&C,i.default.createElement(s.Menu.Wrapper,{className:o.default("extensions-split-share__popover",{"hellosign-available-dropdown":L,"extensions-split-share__unportaled-menu":!A}),onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onToggle:this.handlePopoverToggle,closeOnSelection:!0,isPortaled:A},(function(t){var o=t.getContentProps,r=t.getTriggerProps;return i.default.createElement(i.default.Fragment,null,B(r()),i.default.createElement(s.Menu.Content,n.__assign({placement:"bottom-end",className:y?"rc-action-bar-submenu-content":""},o()),e.renderPopoverItems()))})))},a.defaultProps={isVisible:!0,shareButtonLabel:k.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),triggerType:P.TriggerType.PrimaryButton,variant:"opacity"},a.displayName="SplitShareButtonComponent",a})(i.default.Component);t.SplitShareButtonComponent=q;var z={refreshSharingServiceInfo:E.refreshSharingServiceInfoAdapter,updateLinkState:E.updateLinkState},W=a.connect((function(e,t){var o=t.files.map((function(e){return n.__assign(n.__assign({},e),{bytes:0})}));return{appActions:T.getShareActionsForFiles(e,o),nonHellosignAppActions:T.getNonHellosignActionsForFiles(e,o,C.HELLOSIGN_PROD_APP_ID),categoryInfo:T.getCategoryInfos(e),featureFlags:T.getFeatureFlags(e),sharingServiceInfo:T.getSharingServiceInfoAdapter(e),landingPageEnabled:g.isConnectServiceLandingPagesEnabled(e),isSendForSignatureEnabled:g.isSendForSignatureEnabled(e)}}),z)(q);t.SplitShareButton=A.requireCssWithComponent(W,["/static/css/extensions/index-vflTeCGSU.css","/static/css/app_actions/index-vfl6RtqH3.css"])}));
//# sourceMappingURL=split_share_button_component.min.js-vflemEpAe.map