define(["require","exports","tslib","react","dig-components/modal","dig-components/typography","dig-components/buttons","dig-illustrations/hero/remote-work","modules/core/i18n","modules/clean/auth/login_or_register/types","modules/clean/react/file_viewer/utils","file-viewer/core/config","modules/clean/react/action_bar/file_actions/portable/save_as_copy/save_as_copy","modules/clean/file_store/utils","modules/clean/react/action_bar/file_actions/portable/save_as_copy/snackbars","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/utils","modules/clean/react/action_bar/file_actions/portable/download","modules/clean/react/components/modal","modules/core/persistence/storage"],(function(e,o,t,a,n,i,l,r,s,d,c,u,f,m,_,g,p,w,h){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.PostDownloadSignInModal=o.downloadActiveFile=o.saveToDropbox=void 0,a=t.__importDefault(a),o.saveToDropbox=function(e,o,t,a,n){if(a)if(t)o("save_to_dropbox"),f.portableSaveAsCopy({fileName:m.getFilename(e),user:t,shareToken:a},{onNetworkRequest:function(){_.saveCopySnackBarInProgress(g.PREVIEWS_SNACKBAR_ID),o("save_to_dropbox_approve")},onModalClose:function(){o("save_to_dropbox_cancel")}});else{var i=new URL(window.location.href);i.searchParams.set("copy_to_dropbox","true"),window.history.replaceState(i.href,"",i.href),c.showAuthModal({mode:u.AuthMode.REGISTER,sharedLinkUrl:i.href,kind:u.LoginOrRegisterKind.DOWNLOAD,encryptionOptions:n})}},o.downloadActiveFile=function(n,i,l,r){if(r!==d.LoginOrRegisterKind.DOWNLOAD||h.LocalStorage.get("has_seen_download_signup_modal"))p.downloadSingleFile({href:n.href,source:"PREVIEWS",isFswm:m.isSharedFile(n)}),i||(function(e){if((function(e){var o=window.localStorage.getItem(e);if(!o)return!0;var t=JSON.parse(o);if((new Date).getTime()>t)return window.localStorage.removeItem(e),!0;return!1})("dbx_previews_log_out_download_modal")){w.Modal.showInstance(a.default.createElement(o.PostDownloadSignInModal,t.__assign({},e)));var n=(new Date).getTime()+864e5;window.localStorage.setItem("dbx_previews_log_out_download_modal",JSON.stringify(n))}})({encryptionOptions:l});else{var s=function(){h.LocalStorage.set("has_seen_download_signup_modal",!0)},c=function(){h.LocalStorage.set("has_seen_download_signup_modal",!0)};new Promise((function(o,t){e(["modules/clean/auth/login_or_register/modal"],o,t)})).then(t.__importStar).then((function(e){var o=e.LoginOrRegisterModal;w.Modal.showInstance(a.default.createElement(o,{downloadAction:d.DownloadAction.DIRECT_DOWNLOAD,id:"shared-link-download-signup-modal",initialMode:d.Mode.REGISTER,kind:r,onAuthenticateSuccess:s,onCancel:c,signup_tag:"shmodel_download_register",encryptionOptions:l}))}))}},o.PostDownloadSignInModal=function(e){var o=e.encryptionOptions,t=a.default.useState(!0),d=t[0],f=t[1],m=function(){return f(!1)},_=s.intl.formatMessage({id:"RfGyPH",defaultMessage:"Close"}),g=function(e){c.showAuthModal({mode:e,kind:u.LoginOrRegisterKind.IMMEDIATE,encryptionOptions:o})};return a.default.createElement(n.Modal,{open:d,isCentered:!0,onRequestClose:m},a.default.createElement(n.Modal.Header,{hasBottomSpacing:"title-standard",className:"naming-conventions__header"},a.default.createElement(r.RemoteWorkHero,{aspectRatio:"16:9"})),a.default.createElement(n.Modal.Body,{hasVerticalSpacing:!0},a.default.createElement(i.Title,null,s.intl.formatMessage({id:"I4X18Q",defaultMessage:"Your file is downloading"})),a.default.createElement("div",null,a.default.createElement(i.Text,null,s.intl.formatMessage({id:"VuxToA",defaultMessage:"In the meantime, sign up for Dropbox to have secure access to all your files."}))),a.default.createElement(i.Text,{tagName:"span"},s.intl.formatMessage({id:"HvoIMq",defaultMessage:"Collaborate with friends, family and coworkers from any device."}))),a.default.createElement(n.Modal.Footer,null,a.default.createElement(l.Button,{variant:"transparent",onClick:m},_),a.default.createElement(l.Button,{variant:"opacity",onClick:function(){return g(u.AuthMode.LOGIN)}},s.intl.formatMessage({id:"N0xz5m",defaultMessage:"Sign in"})),a.default.createElement(l.Button,{variant:"primary",onClick:function(){return g(u.AuthMode.REGISTER)}},s.intl.formatMessage({id:"5KEf7W",defaultMessage:"Sign up"}))))}}));
//# sourceMappingURL=download_utils.min.js-vflxXBIW7.map