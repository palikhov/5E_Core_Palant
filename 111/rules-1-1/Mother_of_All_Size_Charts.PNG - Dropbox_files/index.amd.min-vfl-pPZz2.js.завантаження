define(["require","exports","tslib","react","dig-components/typeahead","dig-components/text_fields","dig-components/chips","dig-components/avatar","react-intl","dig-components/typography","dig-components/tooltips"],(function(e,t,n,a,i,l,r,o,s,u,c){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.TypeaheadSuggestion=t.ContactTypeahead=t.getContactKey=t.ValidationResult=void 0,a=n.__importStar(a),(d=t.ValidationResult||(t.ValidationResult={})).OK="OK",d.DUPLICATE="DUPLICATE",d.INVALID="INVALID",d.OVER_RECIPIENTS_LIMIT="OVER_RECIPIENTS_LIMIT",t.getContactKey=function(e){return"CONTACT-"+e.email};var p=/[ ,]+/,g=/^['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}$/i;t.ContactTypeahead=function(e){var d,f=a.useState(""),m=f[0],h=f[1],y=a.useState(!1),T=y[0],E=y[1],I=a.useState(!1),C=I[0],v=I[1],R=a.useState(!1),S=R[0],O=R[1],N=a.useRef(null),V={noMatches:(d=s.useIntl()).formatMessage({id:"T2ynaE",defaultMessage:"No matches"}),typeToSearch:d.formatMessage({id:"sMt4nm",defaultMessage:"Begin typing to search"}),selectFromSuggestionErrMsg:d.formatMessage({id:"4gphPK",defaultMessage:"Please select an assignee"})},L=V.noMatches,_=V.typeToSearch,A=V.selectFromSuggestionErrMsg;a.useEffect((function(){e.recipients.length>e.recipientNumLimit?v(!0):v(!1),e.recipients.length>0&&e.recipients.filter((function(e){return e.validationResult!==t.ValidationResult.OK})).length>0?E(!0):E(!1)}),[e.recipients,e.recipientNumLimit]);var M=function(t){var n=e.recipients.filter((function(e){return e.email!==t.email}));e.onRecipientsChange(n)},b=function(n){return e.recipients.length>e.recipientNumLimit?t.ValidationResult.OVER_RECIPIENTS_LIMIT:e.recipients.find((function(e){return n.email===e.email}))?t.ValidationResult.DUPLICATE:g.test(n.email)?t.ValidationResult.OK:t.ValidationResult.INVALID},P=function(a,i,l){if(e.onQueryChange(""),h(""),e.suggestionOnly&&!a)return!1;if(!a&&!l)return!1;for(var r=a?[a]:l.split(p).filter(Boolean).map((function(e){return{email:e}})),o={},s=n.__spreadArrays(e.recipients),u=0,c=r;u<c.length;u++){var d=c[u];if(!(d.email in o)){var g=b(d);if(g===t.ValidationResult.OVER_RECIPIENTS_LIMIT)break;g!==t.ValidationResult.DUPLICATE&&(o[d.email]=null,d.validationResult=g,s.push(d))}}return s.length>e.recipients.length&&e.onRecipientsChange(s),0===s.filter((function(e){return e.validationResult!==t.ValidationResult.OK})).length},x=function(e){P(e,0,m)},F=function(t){var n=t.currentTarget.value;h(n),e.onQueryChange(n)},K=function(t){8===t.keyCode&&""===m&&e.recipients.length>0&&M(e.recipients[e.recipients.length-1]),13===t.keyCode&&""!==m&&P(null,0,m)},w=function(){e.onFocus&&e.onFocus(),O(!0)},D="flows-typeahead__input",z=e.recipients.length>=e.recipientNumLimit,U=function(){return a.default.createElement(i.Typeahead.Wrapper,{onSelection:x},(function(n){var s=n.getTriggerProps,u=n.getContentProps;return a.default.createElement(a.default.Fragment,null,a.default.createElement(l.TextInput.Container,{isInvalid:T||C||e.suggestionOnly&&!S&&!!m,ref:N},a.default.createElement(l.TextInput.ChipsContainer,null,!!e.recipients.length&&e.recipients.map((function(e,n){return a.default.createElement(r.InputChip,{key:n,size:"small",isError:e.validationResult!==t.ValidationResult.OK,onDelete:function(){return M(e)},withAvatarLeft:e.avatarUrl&&a.default.createElement(o.Avatar,{hasNoOutline:!0,size:"xsmall",src:e.avatarUrl})},e.name||e.email)})),a.default.createElement(l.TextInput.Input,Object.assign({id:D,placeholder:z?void 0:e.placeholder,"aria-label":e.placeholder,value:m},s({onChange:F,onKeyDown:K}),{disabled:z,onBlur:function(){return O(!1)},onFocus:w,style:{fontSize:"12px"},autoComplete:"off"})))),e.suggestionOnly&&!S&&m&&a.default.createElement(l.FormHelperText,{isInvalid:!0},A),a.default.createElement(i.Typeahead.Container,Object.assign({},u(),{triggerRef:{current:N.current},isEmptyQuery:e.suggestionOnly&&(!Boolean(m)||0==e.suggestions.length),emptyState:a.default.createElement(i.Typeahead.EmptyState,{placeholderText:Boolean(m)?L:_}),onBlur:function(){return O(!1)},onFocus:function(){return O(!0)}}),a.default.createElement(i.Typeahead.Results,{results:e.suggestions,renderRow:e.renderTypeaheadSuggestion})))}))};return a.default.createElement(a.default.Fragment,null,e.label&&a.default.createElement(l.FormLabel,{htmlFor:D},a.default.createElement(u.Text,{isBold:!0,size:"small",tagName:"label"},e.label)),z?a.default.createElement(c.Tooltip,{title:e.maxNumTooltip},a.default.createElement("span",{style:{display:"inline-block",width:"100%"},tabIndex:0},U())):U())},t.ContactTypeahead.displayName="ContactTypeahead",t.TypeaheadSuggestion=function(e){var t=e.suggestion,n=(0,e.getInitials)(t.name||t.email);return a.default.createElement(i.Typeahead.Row,{key:t.email,value:t,withTitle:t.name,withSubtitle:t.email,withLeftAccessory:a.default.createElement(o.Avatar,{src:t.avatarUrl,backgroundColor:o.avatarColorForUserIdentifier(n),hasNoOutline:!0},n)})},t.TypeaheadSuggestion.displayName="TypeaheadSuggestion"}));
//# sourceMappingURL=index.amd.min.js-vflzNbGSY.map