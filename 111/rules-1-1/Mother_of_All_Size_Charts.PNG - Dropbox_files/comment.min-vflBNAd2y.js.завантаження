define(["require","exports","tslib","react","classnames","spectrum/tertiary_link/index","spectrum/tooltip/index","typescript/libraries/comments2/src/components/comment/separator","typescript/libraries/comments2/src/components/comment_avatar/index","typescript/libraries/comments2/src/components/comment_editor/comment_editor","typescript/libraries/comments2/src/components/comment_editor/components/post_bar","typescript/libraries/comments2/src/components/comment_editor/comment_renderer","prop-types","typescript/libraries/dbx-i18n/src/index","react-intl","dig-components/typography","dig-components/buttons","typescript/libraries/comments2/src/components/utils/approval_utils","typescript/libraries/comments2/src/components/approval_comment/comment_title"],(function(e,t,n,o,a,r,s,i,m,c,l,p,d,u,v,f,h,g,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Comment=t.CommentActionMenu=t.InactiveCommentInfo=t.RightRailCommentInfo=t.ActiveCommentInfo=t.OlderInfo=t.InlineCommentEditorPostBar=void 0,o=n.__importStar(o),a=n.__importDefault(a),d=n.__importDefault(d);var y=function(e,t){var n=t.localization.intl;return o.createElement(l.PostBar,Object.assign({},e,{postLabel:n.formatMessage({id:"GM9O28",defaultMessage:"Save"}),cancelLabel:n.formatMessage({id:"xuJw2w",defaultMessage:"Cancel"})}))};function M(e){var t=e.actions,n=e.active,a=e.comment,i=a.revisionInfo,m=a.threadId,c=e.intl,l=i.timestamp?c.formatMessage({id:"TrMn7R",defaultMessage:"On older version ({timestamp})"},{timestamp:c.formatTime(i.timestamp,{day:"numeric",month:"short"})}):c.formatMessage({id:"KwIXAO",defaultMessage:"On older version"});return n&&i.revision?o.createElement(s.Tooltip,{positioning:"above",tooltipContent:c.formatMessage({id:"1d7dxH",defaultMessage:"View version history"})},o.createElement(r.TertiaryLink,{className:"sc-comment-older-version",onClick:function(){return t.onClickOlderInfo(i,m)}},l)):o.createElement("div",{className:"sc-comment-older-version"},l)}function b(e){var t=e.comment,n=e.intl,a=e.showRevisionInfo,r=t.author,s=t.id,i=t.revisionInfo,m=t.threadId,c=t.timestamp;return o.createElement("div",{className:"sc-comment-info"},a&&!i.isCurrent&&s===m?o.createElement(M,Object.assign({},e)):null,o.createElement("div",{className:"sc-comment-author-timestamp"},o.createElement("span",{className:"sc-comment-author"},r.name.display),c.getTime()?o.createElement("span",{className:"sc-comment-timestamp"},u.timeSince(n,c,{displayLocation:"label",displayContext:"sentence-middle"})):null))}function C(e){var t=e.comment,n=t.id,a=t.revisionInfo,r=t.threadId;return e.showRevisionInfo&&!a.isCurrent&&n==r?o.createElement("div",{className:"sc-comment-info"},o.createElement(M,Object.assign({},e))):null}y.contextTypes={localization:d.default.object},t.InlineCommentEditorPostBar=o.memo(y),t.OlderInfo=M,t.ActiveCommentInfo=b,t.RightRailCommentInfo=function(e){var t=e.comment,n=e.intl,a=e.showRevisionInfo,r=e.commentControls,s=t.author,i=t.id,m=t.revisionInfo,c=t.threadId,l=t.timestamp;return o.createElement("div",{className:"sc-comment-info--right-rail"},a&&!m.isCurrent&&i===c?o.createElement(M,Object.assign({},e)):null,o.createElement("div",{className:"sc-comment-author-timestamp"},o.createElement("span",{className:"sc-comment-author--right-rail"},s.name.display),l.getTime()?o.createElement("span",{className:"sc-comment-timestamp--right-rail"},u.timeSince(n,l,{displayLocation:"label",displayContext:"sentence-middle"})):null),o.createElement("div",{className:"sc-comments-thread-control-wrapper"},r))},t.InactiveCommentInfo=C;var I=v.defineMessage({id:"ZeF6kJ",defaultMessage:"Edit"}),N=v.defineMessage({id:"2WeS6D",defaultMessage:"Delete"});t.CommentActionMenu=function(e){var t=e.comment,n=e.comment,s=n.userPermissions,i=s.canEdit,m=s.canDelete,c=n.content,l=c.text,p=c.metadata,d=e.actions,u=d.onDeleted,v=d.onApproverRespond,E=d.onEditApproval,y=d.onDeleteApprovalComment,M=d.onResubmitApprovalFocus,b=e.isMobile,C=e.active,_=e.onStartEdit,A=e.intl,D=e.useV2Design,x=e.isLatestReply,O=e.isApprovalOpen,w=e.showApproval,R=o.useCallback((function(){_(t)}),[t,_]),j=function(e){return void 0===e&&(e=R),D?o.createElement(f.Text,{size:"small"},o.createElement(f.Link,{href:e,variant:"monochromatic"},A.formatMessage(I))):o.createElement(r.TertiaryLink,{onClick:e},A.formatMessage(I))},k=function(e){return void 0===e&&(e=u),D?o.createElement(f.Text,{size:"small"},o.createElement(f.Link,{href:e,variant:"monochromatic"},A.formatMessage(N))):o.createElement(r.TertiaryLink,{onClick:e},A.formatMessage(N))},T=g.getApprovalMetadata(p),V=null==T?void 0:T.actor,P=Boolean(T&&("requester"==V||"approver"==V));if(!i&&!m&&!P||b||!C)return null;if(w&&T&&V){if(!D)return null;if(!x||O)return null;var L=o.createElement(h.Button,{variant:"outline",onClick:v,size:"small"},A.formatMessage({id:"q997hq",defaultMessage:"Respond"})),S=o.createElement(h.Button,{variant:"outline",onClick:M,size:"small"},A.formatMessage({id:"MoNd+x",defaultMessage:"Resubmit request"}));return o.createElement("div",{className:a.default("sc-comment-actions","approval")},i&&E&&j((function(){return E({commentId:t.id,content:l,approvalMetadata:T})})),i&&m&&o.createElement("span",{className:"sc-comment-actions-separator"},"•"),m&&y&&k((function(){return y(t.id,V)})),v&&"request"===T.approval_type&&"approver"===V&&!i&&!m&&L,M&&"response"===T.approval_type&&"requester"===V&&!i&&!m&&S)}return o.createElement("div",{className:"sc-comment-actions"},i&&j(),i&&m&&o.createElement("span",{className:"sc-comment-actions-separator"},"•"),m&&k())};var _=(function(e){function r(){var t=e.apply(this,arguments)||this;return t.onSave=function(e){t.props.actions.onEdited(e),t.props.onEndEdit()},t.onMentionsQueryUpdated=t.props.actions.onMentionsQueryUpdated,t}return n.__extends(r,e),r.prototype.classNameUtil=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.props,r=o.active,s=void 0!==r&&r,i=o.className,m=o.comment.deleted;return a.default.apply(void 0,n.__spreadArrays([i],e,[{"sc-comment-active":s,"sc-comment-deleted":m}]))},Object.defineProperty(r.prototype,"intl",{get:function(){return this.context.localization.intl},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"useV2Design",{get:function(){return this.context.useV2Design},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"showApproval",{get:function(){return this.context.showApproval},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"approvalMetadata",{get:function(){return g.getApprovalMetadata(this.props.comment.content.metadata)},enumerable:!1,configurable:!0}),r.prototype.renderDeletedMode=function(){var e=this.props.children;return o.createElement("li",{className:this.classNameUtil(this.useV2Design?"sc-comment-deleted--right-rail":void 0)},this.useV2Design?o.createElement(m.DeletedDIGCommentAvatar,null):o.createElement(m.DeletedCommentAvatar,null),o.createElement("div",{className:"sc-comment-content-container"},o.createElement("div",{className:"sc-comment-content"},e,e&&o.createElement(i.Separator,null),o.createElement("span",{className:"sc-comment-text"},this.intl.formatMessage({id:"w9I0zq",defaultMessage:"This comment was deleted."})))))},r.prototype.renderDisplayMode=function(){var e=this,a=this.props,r=a.active,s=void 0!==r&&r,i=a.children,m=a.comment,c=m.content,l=m.author,d=m.revisionInfo,u=a.commentAvatarComponent,v=n.__assign(n.__assign({},this.props),{intl:this.intl}),f=this.useV2Design?p.CommentRendererV2:p.CommentRenderer;return o.createElement("li",{className:this.classNameUtil(this.context.useV2Design?"sc-comment-renderer--right-rail":"sc-comment-renderer")},o.createElement(f,{content:c,author:l,commentAvatarComponent:u,annotation:i,revisionInfo:d},(function(n){return o.createElement("div",{className:"sc-comment-renderer-content-wrapper"},e.useV2Design?o.createElement(t.RightRailCommentInfo,Object.assign({},v)):s?o.createElement(b,Object.assign({},v)):o.createElement(C,Object.assign({},v)),e.showApproval&&e.approvalMetadata&&o.createElement(E.ApprovalCommentTitle,{intl:e.intl,metadata:e.approvalMetadata,content:c.text}),n,o.createElement(t.CommentActionMenu,Object.assign({},v,{useV2Design:e.useV2Design,showApproval:e.showApproval})))})))},r.prototype.renderEditMode=function(){var e=this.props,n=e.comment,a=e.mentionsMatches,r=e.onEndEdit;return o.createElement("li",{className:this.classNameUtil("sc-comment-editor","sc-comment-inline-editor",this.useV2Design?"sc-comment-editor--right-rail":void 0)},o.createElement(c.CommentEditor,{author:n.author,content:n.content,postSignalComponent:t.InlineCommentEditorPostBar,onCancel:r,onPost:this.onSave,mentionsMatches:a,onMentionsQueryUpdated:this.onMentionsQueryUpdated,renderBare:!0,shouldFocus:!0}))},r.prototype.render=function(){return this.approvalMetadata&&this.props.isEditingApproval&&this.props.isLatestReply?null:this.props.comment.deleted?this.renderDeletedMode():this.props.isEditing?this.renderEditMode():this.renderDisplayMode()},r})(o.PureComponent);t.Comment=_,_.contextTypes={localization:d.default.object,useV2Design:d.default.bool,showApproval:d.default.bool},_.defaultProps={isEditing:!1}}));
//# sourceMappingURL=comment.min.js-vfljlrGT2.map