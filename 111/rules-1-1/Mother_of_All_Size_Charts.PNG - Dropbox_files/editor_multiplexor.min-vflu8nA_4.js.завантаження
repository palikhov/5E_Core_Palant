define(["require","exports","tslib","typescript/libraries/comments2/src/components/comment_editor/index","react","dig-components/buttons","dig-components/typography","dig-components/icons","react-intl","dig-components/icons/src","dig-components/tooltips","react-redux","typescript/component_libraries/files_components/src/blades/comments/data/actions","file-viewer/comments2/disabled_time_annotation_tooltip","file-viewer/comments2/plugin/utils"],(function(e,t,n,a,o,i,r,s,l,d,u,m,c,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentEditorMultiplexor=t.getFrameRateFromMetadata=t.toFramePrecisionProps=void 0,o=n.__importStar(o);var p={type:"image",region:{x:0,y:0,width:1,height:1}},E=function(){return window.localStorage.setItem("has_seen_timestamp_annotation_tooltip","true")},v=function(e){var t=e.draftNumberedAnnotation,i=e.annotationState,r=e.intl,s=e.placeholder,l=n.__rest(e,["draftNumberedAnnotation","annotationState","intl","placeholder"]);return o.default.createElement(a.NumberedCommentEditor,Object.assign({},l,{disabled:g.isAnnotating(i),placeholder:g.isAnnotating(i)?r.formatMessage(x):s,defaultAnnotation:p,pendingAnnotation:t}))},b=function(e){var t=e.currentPageIndex,i=e.draftNumberedAnnotation,r=e.annotationState,s=e.intl,l=e.placeholder,d=n.__rest(e,["currentPageIndex","draftNumberedAnnotation","annotationState","intl","placeholder"]),u=o.default.useMemo((function(){return{type:"document",regionType:"rectangle",regions:[{page:t+1,x:0,y:0,width:1,height:1}]}}),[t]);return o.default.createElement(a.NumberedCommentEditor,Object.assign({},d,{disabled:g.isAnnotating(r),placeholder:g.isAnnotating(r)?s.formatMessage(S):l,defaultAnnotation:u,pendingAnnotation:i}))},M=function(e){var t=e.currentTimestamp,i=e.intl,r=e.annotationState,s=e.useV2Design,d=n.__rest(e,["currentTimestamp","intl","annotationState","useV2Design"]),u=d.playerIntegrationEnabled,m=!s||g.isEditingAnnotation(r),c=o.default.useMemo((function(){return m?{type:"audio",time:u?Math.floor(100*t):0}:void 0}),[t,u,m]);return o.default.createElement(l.IntlContext.Provider,{value:i},o.default.createElement(a.TimeCodedCommentEditor,Object.assign({pendingAnnotation:c},d)))};function h(e,t){return e&&void 0!==t?{framePreciseCommentsEnabled:!0,frameRate:t}:{framePreciseCommentsEnabled:!1}}function A(e){if(null!=e)switch(e[".tag"]){case"video":return e.frame_rate;default:return}}t.toFramePrecisionProps=h,t.getFrameRateFromMetadata=A;var y=function(e){var t=e.currentTimestamp,i=e.isPlaying,r=e.intl,s=e.annotationState,d=e.useV2Design,u=n.__rest(e,["currentTimestamp","isPlaying","intl","annotationState","useV2Design"]),m=u.framePreciseCommentsEnabled,c=u.playerIntegrationEnabled,p=(function(e){var t=e.lastTimestampFromVideoPlayer,n=e.shouldApproximate,a=o.default.useState(t),i=a[0],r=a[1];return o.default.useEffect((function(){if(n){var e=performance.now(),a=!0,o=function(){if(a){var n=performance.now()-e;r(t+n/1e3),requestAnimationFrame(o)}};return o(),function(){a=!1}}}),[t,n]),n?i:t})({lastTimestampFromVideoPlayer:c?t:0,shouldApproximate:Boolean(i&&c&&m)}),E=!d||g.isEditingAnnotation(s),v=o.default.useMemo((function(){return E?{type:"video",time:Math.floor(100*p),timeSec:p}:void 0}),[p,E]);return o.default.createElement("span",null,o.default.createElement(l.IntlContext.Provider,{value:r},o.default.createElement(a.TimeCodedCommentEditor,Object.assign({pendingAnnotation:v},u,{tooltipComponent:c?void 0:f.DisabledTimeAnnotationTooltip}))))},C=l.defineMessage({id:"mXX6Pu",defaultMessage:"Comment on a section"}),_=l.defineMessage({id:"AeKHE6",defaultMessage:"Comment on an area"}),I=l.defineMessage({id:"ueIzgL",defaultMessage:"Click to comment on this timestamp"}),T=l.defineMessage({id:"HRP1D0",defaultMessage:"This file is not on a plan that includes time-based commenting."}),w=l.defineMessage({id:"JgXeI9",defaultMessage:"Cancel"}),S=l.defineMessage({id:"HrUUyJ",defaultMessage:"Highlight a section to comment on"}),x=l.defineMessage({id:"+XrOKO",defaultMessage:"Highlight an area to comment on"}),P=l.defineMessage({id:"qAINeh",defaultMessage:"Comment on a timestamp"}),k=l.defineMessage({id:"STlbVd",defaultMessage:"Click this icon to comment on a specific point in the file."}),F=l.defineMessage({id:"oCFCES",defaultMessage:"To comment on the entire thing, simply click into the comment box."}),D=l.defineMessage({id:"oNp+kB",defaultMessage:"Got it"}),N=function(e){var t=e.visible,n=e.setSeen,a=e.intl,s=e.triggerRef;return o.default.createElement(u.Tooltip.Control,{triggerRef:s,variant:"rich",open:t,auto:!0,placement:"bottom-start"},o.default.createElement(r.Title,{size:"standard",inverse:!0},a.formatMessage(P)),o.default.createElement(r.Text,{tagName:"p",color:"standard",inverse:!0},a.formatMessage(k)),o.default.createElement(r.Text,{tagName:"p",color:"standard",inverse:!0},a.formatMessage(F)),o.default.createElement("div",{className:"step-actions"},o.default.createElement(i.Button,{variant:"outline",inverse:!0,onClick:n,autoFocus:!0},a.formatMessage(D))))},O=o.default.memo((function(e){var t,n,a=e.file,r=e.annotationState,f=e.previewType,p=e.fileViewerId,v=e.timestampAnnotationsEnabled,b=e.navigation,M=e.axAnnotationsEnabled,h=o.useRef(null),A=o.useState((function(){return null!==localStorage.getItem("has_seen_timestamp_annotation_tooltip")})),y=A[0],S=A[1],x=l.useIntl(),P=m.useDispatch(),k=function(e){return e.preventDefault()};if(o.useEffect((function(){return window.addEventListener("beforeunload",E),function(){return window.removeEventListener("beforeunload",E)}}),[]),g.isEditingAnnotation(r)){var F=x.formatMessage(w);return o.default.createElement(i.IconButton,{variant:"transparent",size:"small",onClick:function(){P(c.cancelAnnotating(p))},onMouseDown:k,"aria-label":F},o.default.createElement(s.UIIcon,{src:d.CloseLine}))}var D,O=!1;switch(f){case"image":a.dimensions?(t=x.formatMessage(_),D=function(e){P(c.startAnnotating(p,e))}):(t=void 0,D=void 0,O=!0),n=o.default.createElement(s.UIIcon,{src:d.AddCommentLine});break;case"other":t=x.formatMessage(_),D=function(e){P(c.startAnnotating(p,e))},n=o.default.createElement(s.UIIcon,{src:d.AddCommentLine});break;case"ssr_doc":t=x.formatMessage(C),n=o.default.createElement(s.UIIcon,{src:d.AddCommentLine}),D=function(e){P(c.startAnnotating(p,e))};break;case"audio":case"video":v?y?(t=x.formatMessage(I),D=function(){b.pause(),P(c.confirmDraftAnnotation(p))}):t=void 0:(D=void 0,t=x.formatMessage(T),O=!0),n=o.default.createElement(s.UIIcon,{src:d.ClockLine});break;default:return null}return o.default.createElement(o.default.Fragment,null,o.default.createElement(N,{intl:x,visible:!y&&v,setSeen:function(){S(!0),E()},triggerRef:h}),o.default.createElement("div",{ref:h},o.default.createElement(u.Tooltip,{title:t,placement:"bottom"},o.default.createElement("span",{style:{display:"inline-block"},tabIndex:O?0:-1},o.default.createElement(i.IconButton,{variant:"transparent",size:"small",onClick:function(){D&&D(!1)},onMouseDown:k,onKeyDown:function(e){" "!==e.key&&"Enter"!==e.key||D&&(D(M),e.stopPropagation(),e.preventDefault())},"aria-label":t,disabled:O},n)))))}));t.CommentEditorMultiplexor=function(e){var t,n,i=e.draftNumberedAnnotation,r=e.editorFocusRequested,s=e.commentEditorProps,l=e.intl,d=e.file,u=e.context,c=e.navigation,f=o.default.useMemo((function(){return A(d.contentMetadata)}),[d]),g=m.useSelector((function(e){return e.annotationState})),p=null!==(n=null===(t=e.supportedEnhancements)||void 0===t?void 0:t.time_based_annotations)&&void 0!==n&&n,E=o.default.createElement(O,{file:e.file,annotationState:g,previewType:e.previewType,fileViewerId:u.fileViewerId,timestampAnnotationsEnabled:p,navigation:c,axAnnotationsEnabled:u.sdkConfig.ax_annotations}),C=u.sdkConfig.preview_page_revamp;switch(e.previewType){case"image":return o.default.createElement(v,Object.assign({},s,{rightAccessory:E,draftNumberedAnnotation:i,shouldFocus:r,annotationState:g,intl:l}));case"ssr_doc":return o.default.createElement(b,Object.assign({},s,{rightAccessory:E,draftNumberedAnnotation:i,currentPageIndex:e.ui.currentPageIndex,shouldFocus:r,annotationState:g,intl:l}));case"audio":return o.default.createElement(M,Object.assign({},s,{rightAccessory:E,currentTimestamp:e.ui.currentTimestamp,intl:l,shouldFocus:r,playerIntegrationEnabled:p,annotationState:g,useV2Design:C}));case"video":return o.default.createElement(y,Object.assign({},s,{rightAccessory:E,currentTimestamp:e.ui.currentTimestamp,isPlaying:e.ui.isPlaying,intl:l,shouldFocus:r,playerIntegrationEnabled:p,annotationState:g,useV2Design:C},h(e.framePreciseCommentsEnabled,f)));case"cloud_doc":return null}return o.default.createElement(a.CommentEditor,Object.assign({},s))},t.CommentEditorMultiplexor.displayName="CommentEditorMultiplexor"}));
//# sourceMappingURL=editor_multiplexor.min.js-vflsPN9gM.map