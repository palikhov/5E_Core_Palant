define(["require","exports","tslib","react","dig-components/buttons","classnames","typescript/component_libraries/flows/src/components/spacer/index","react-intl","react-intl","typescript/component_libraries/flows/src/components/contact-typeahead/index","typescript/component_libraries/flows/src/components/contact-typeahead/index","dig-components/text_fields","dig-components/typography","dig-components/avatar","dig-components/tooltips","dig-components/badges"],(function(e,a,t,l,r,o,n,s,p,i,u,d,m,c,f,v){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ApprovalRequestForm=a.ApprovalRequestFormInternal=void 0,l=t.__importStar(l),o=t.__importDefault(o);a.ApprovalRequestFormInternal=function(e){var a,t,s=e.onCancel,g=e.onRequestSuccess,_=e.onEditSuccess,b=e.ioClient,h=e.user,y=e.fileId,M=e.inlineWithComments,A=e.editArgs,q=e.threadId,E=l.useState(A&&A.approvalMetadata.approver_email?[{email:A.approvalMetadata.approver_email,name:A.approvalMetadata.approver_display_name,validationResult:u.ValidationResult.OK}]:[]),R=E[0],S=E[1],I=l.useState(null!==(a=null==A?void 0:A.content)&&void 0!==a?a:""),T=I[0],x=I[1],F=l.useState(!1),L=F[0],C=F[1],N=b.useSuggestions(R),B=N.suggestions,w=N.onQueryChange,O=l.useState(!1),P=O[0],z=O[1],D=l.default.useRef(null),K={title:(t=p.useIntl()).formatMessage({id:"SbRB6f",defaultMessage:"Request Approval"}),requestSubmitButtonLabel:t.formatMessage({id:"TLlK3S",defaultMessage:"Request approval"}),cancelButtonLabel:t.formatMessage({id:"KQ8scR",defaultMessage:"Cancel"}),detailsInputLabel:t.formatMessage({id:"HDv0DD",defaultMessage:"Details"}),detailsInputPlaceholder:t.formatMessage({id:"6TM4L0",defaultMessage:"Tell the approver what you need their approval on."}),approverInputPlaceholder:t.formatMessage({id:"CNwO3W",defaultMessage:"Add approver"}),approverInputLabel:t.formatMessage({id:"v53Uf+",defaultMessage:"Approver"}),genericError:t.formatMessage({id:"vK1TiB",defaultMessage:"Something went wrong. Please try again later."}),editSubmitButtonLabel:t.formatMessage({id:"WGyt7S",defaultMessage:"Save changes"}),addAnApproverTooltip:t.formatMessage({id:"CoADMJ",defaultMessage:"Add an approver to your request"}),createNewRequestTooltip:t.formatMessage({id:"2hpgtD",defaultMessage:"Create a new request to get approval from another person"}),onlyOneApproverAllowedTooltip:t.formatMessage({id:"6CxwHA",defaultMessage:"You can only have one approver per request"}),betaBadgeLabel:t.formatMessage({id:"PbRgl7",defaultMessage:"Beta"})},k=K.title,H=K.requestSubmitButtonLabel,Q=K.cancelButtonLabel,U=K.detailsInputLabel,W=K.detailsInputPlaceholder,j=K.approverInputPlaceholder,V=K.approverInputLabel,G=K.genericError,J=K.editSubmitButtonLabel,Y=K.addAnApproverTooltip,X=K.createNewRequestTooltip,Z=K.onlyOneApproverAllowedTooltip,$=K.betaBadgeLabel,ee=b.getLogger();l.default.useEffect((function(){ee.logShownRequestForm(y)}),[y]);var ae=function(){var e,a;C(!1),z(!0);var t={type:"approval",status:"pending",approver_email:null!==(e=null==A?void 0:A.approvalMetadata.approver_email)&&void 0!==e?e:R[0].email,requester_email:null==A?void 0:A.approvalMetadata.requester_email,approval_type:"request",actor:"requester",approver_display_name:null!==(a=null==A?void 0:A.approvalMetadata.approver_display_name)&&void 0!==a?a:R[0].name};A?b.editApprovalRequest(y,A.commentId,T).then((function(e){_&&(_(A.commentId,q,{text:T,metadata:[t]}),ee.logEditApprovalRequestSuccess(y,T.length,q,e.comment_id))})).catch((function(){C(!0),z(!1)})):b.createApproval(y,T,R[0].email).then((function(e){g&&g({text:T,metadata:[t]}),ee.logSubmitApprovalSuccess(y,T.length,e.comment_id)})).catch((function(){C(!0),z(!1)}))},te=R.length>0&&R.length<=1&&0==R.filter((function(e){return e.validationResult!=u.ValidationResult.OK})).length,le=function(e){return l.default.createElement(r.Button,{onClick:ae,variant:"primary",disabled:e,size:"small",className:"approval-form__footer_primary-action",isLoading:P},A?J:H)};return l.default.createElement("div",{className:o.default("approval-form",{"inline-with-comments":M}),ref:D},l.default.createElement("div",{className:"approval-form__title"},l.default.createElement(c.Avatar,{src:h.photoUrl,backgroundColor:c.avatarColorForUserIdentifier(h.initials),hasNoOutline:!0,size:"small",style:{marginRight:"6px"}},h.initials),l.default.createElement(m.Text,{isBold:!0,tagName:"h1"},k),l.default.createElement(v.AccessoryBadge,null,$)),l.default.createElement("div",{className:"approval-form__body"},A?l.default.createElement(l.default.Fragment,null,l.default.createElement(d.FormLabel,{htmlFor:"approval-form__approver"},l.default.createElement(m.Text,{isBold:!0,size:"small",tagName:"label"},V)),l.default.createElement(f.Tooltip,{title:X,boundary:D,placement:"top-start",auto:!0},l.default.createElement(m.Text,{id:"approval-form__approver",size:"small",className:"approval-form__approver-display-name"},"@"+A.approvalMetadata.approver_display_name))):l.default.createElement(i.ContactTypeahead,{placeholder:j,recipients:R,onRecipientsChange:function(e){C(!1),e.length>R.length&&ee.logAddApprover(y),S(e)},suggestions:B,onQueryChange:w,renderTypeaheadSuggestion:function(e){return l.default.createElement(i.TypeaheadSuggestion,{suggestion:e,getInitials:b.getInitials})},recipientNumLimit:1,label:V,suggestionOnly:!0,maxNumTooltip:Z,onFocus:function(){return ee.logFocusApproverTypeahead(y)}}),l.default.createElement(n.Spacer,{multiplier:2}),l.default.createElement(d.FormLabel,{htmlFor:"approval-request-form__details-input"},l.default.createElement(m.Text,{isBold:!0,size:"small",tagName:"label"},U)),l.default.createElement(d.TextArea,{className:"approval-forms__text-area",id:"approval-request-form__details-input",placeholder:W,"aria-label":W,value:T,onChange:function(e){C(!1),x(e.currentTarget.value)},style:{boxSizing:"border-box"}}),L&&l.default.createElement(d.FormHelperText,{isInvalid:!0},G)),l.default.createElement("div",{className:"approval-form__footer"},l.default.createElement(r.Button,{onClick:function(){ee.logCancelApproval(y,"request_approval_form"),s()},variant:"transparent",size:"small",disabled:P},Q),te?le(!1):l.default.createElement(f.Tooltip,{title:Y,placement:"top-start",auto:!0,boundary:D},l.default.createElement("span",{style:{display:"inline-block"},tabIndex:0},le(!0)))))},a.ApprovalRequestFormInternal.displayName="ApprovalRequestFormInternal",a.ApprovalRequestForm=function(e){return l.default.createElement(s.RawIntlProvider,{value:e.intl},l.default.createElement(a.ApprovalRequestFormInternal,Object.assign({},e)))},a.ApprovalRequestForm.displayName="ApprovalRequestForm"}));
//# sourceMappingURL=request_form.amd.min.js-vflImB0yR.map